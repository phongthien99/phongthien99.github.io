<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Designing a Centralized Authentication System with an API Gateway and Identity Broker Äáº·t váº¥n Ä‘á» Trong cÃ¡c há»‡ thá»‘ng hiá»‡n Ä‘áº¡i, Ä‘áº·c biá»‡t lÃ  há»‡ thá»‘ng phÃ¢n tÃ¡n vÃ  microservices, bÃ i toÃ¡n xÃ¡c thá»±c vÃ  phÃ¢n quyá»n ngÃ y cÃ ng trá»Ÿ nÃªn phá»©c táº¡p. Nhiá»u há»‡ thá»‘ng Ä‘á»ƒ má»—i dá»‹ch vá»¥ tá»± xá»­ lÃ½ xÃ¡c thá»±c, dáº«n Ä‘áº¿n logic trÃ¹ng láº·p vÃ  khÃ³ báº£o trÃ¬. á» chiá»u ngÆ°á»£c láº¡i, viá»‡c Ä‘á»ƒ client phá»¥ thuá»™c trá»±c tiáº¿p vÃ o há»‡ thá»‘ng xÃ¡c thá»±c bÃªn ngoÃ i láº¡i gÃ¢y ra rá»§i ro khÃ³a cháº·t vÃ o cÃ´ng cá»¥ cá»¥ thá»ƒ.\n"><title>Designing a Centralized Authentication System with an API Gateway and Identity Broker</title><link rel=canonical href=https://phongthien99.github.io/posts/designing-a-centralized-authentication-system-with-an-api-gateway-and-identity-broker/><link rel=stylesheet href=/scss/style.min.769133d016a4a1944b3a27800e000cccd439a8c1a9c0c61f7c4fa0bc0e42de57.css><meta property='og:title' content="Designing a Centralized Authentication System with an API Gateway and Identity Broker"><meta property='og:description' content="Designing a Centralized Authentication System with an API Gateway and Identity Broker Äáº·t váº¥n Ä‘á» Trong cÃ¡c há»‡ thá»‘ng hiá»‡n Ä‘áº¡i, Ä‘áº·c biá»‡t lÃ  há»‡ thá»‘ng phÃ¢n tÃ¡n vÃ  microservices, bÃ i toÃ¡n xÃ¡c thá»±c vÃ  phÃ¢n quyá»n ngÃ y cÃ ng trá»Ÿ nÃªn phá»©c táº¡p. Nhiá»u há»‡ thá»‘ng Ä‘á»ƒ má»—i dá»‹ch vá»¥ tá»± xá»­ lÃ½ xÃ¡c thá»±c, dáº«n Ä‘áº¿n logic trÃ¹ng láº·p vÃ  khÃ³ báº£o trÃ¬. á» chiá»u ngÆ°á»£c láº¡i, viá»‡c Ä‘á»ƒ client phá»¥ thuá»™c trá»±c tiáº¿p vÃ o há»‡ thá»‘ng xÃ¡c thá»±c bÃªn ngoÃ i láº¡i gÃ¢y ra rá»§i ro khÃ³a cháº·t vÃ o cÃ´ng cá»¥ cá»¥ thá»ƒ.\n"><meta property='og:url' content='https://phongthien99.github.io/posts/designing-a-centralized-authentication-system-with-an-api-gateway-and-identity-broker/'><meta property='og:site_name' content='phongthien'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='principle'><meta property='article:tag' content='architecture'><meta property='article:published_time' content='2026-01-26T00:17:00+08:00'><meta property='article:modified_time' content='2026-01-26T00:17:00+08:00'><meta name=twitter:title content="Designing a Centralized Authentication System with an API Gateway and Identity Broker"><meta name=twitter:description content="Designing a Centralized Authentication System with an API Gateway and Identity Broker Äáº·t váº¥n Ä‘á» Trong cÃ¡c há»‡ thá»‘ng hiá»‡n Ä‘áº¡i, Ä‘áº·c biá»‡t lÃ  há»‡ thá»‘ng phÃ¢n tÃ¡n vÃ  microservices, bÃ i toÃ¡n xÃ¡c thá»±c vÃ  phÃ¢n quyá»n ngÃ y cÃ ng trá»Ÿ nÃªn phá»©c táº¡p. Nhiá»u há»‡ thá»‘ng Ä‘á»ƒ má»—i dá»‹ch vá»¥ tá»± xá»­ lÃ½ xÃ¡c thá»±c, dáº«n Ä‘áº¿n logic trÃ¹ng láº·p vÃ  khÃ³ báº£o trÃ¬. á» chiá»u ngÆ°á»£c láº¡i, viá»‡c Ä‘á»ƒ client phá»¥ thuá»™c trá»±c tiáº¿p vÃ o há»‡ thá»‘ng xÃ¡c thá»±c bÃªn ngoÃ i láº¡i gÃ¢y ra rá»§i ro khÃ³a cháº·t vÃ o cÃ´ng cá»¥ cá»¥ thá»ƒ.\n"><link rel="shortcut icon" href=/favicon.png><script src=https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js></script><script>mermaid.initialize({startOnLoad:!0})</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_7ee69f593e8680d3.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ…</span></figure><div class=site-meta><h1 class=site-name><a href=/>phongthien</a></h1><h2 class=site-description>Software Engineer</h2></div></header><ol class=menu-social><li><a href=https://github.com/phongthien99 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=linkedin rel=me><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/about-me/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About me</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#Ä‘áº·t-váº¥n-Ä‘á»>Äáº·t váº¥n Ä‘á»</a></li><li><a href=#giáº£i-phÃ¡p-thiáº¿t-káº¿>Giáº£i phÃ¡p thiáº¿t káº¿</a><ol><li><a href=#21-Ä‘á»‹nh-hÆ°á»›ng-kiáº¿n-trÃºc>2.1 Äá»‹nh hÆ°á»›ng kiáº¿n trÃºc</a></li><li><a href=#22-phÃ¢n-táº§ng-vÃ -ranh-giá»›i-há»‡-thá»‘ng>2.2 PhÃ¢n táº§ng vÃ  ranh giá»›i há»‡ thá»‘ng</a></li><li><a href=#23-design-concept>2.3 Design Concept</a></li></ol></li><li><a href=#implementation>Implementation</a></li><li><a href=#31-edge-layer--api-gateway>3.1 Edge Layer â€“ API Gateway</a></li><li><a href=#32-auth--security-layer--broker-gateway>3.2 Auth / Security Layer â€“ Broker Gateway</a></li><li><a href=#33-identity-provider--quáº£n-lÃ½-danh-tÃ­nh>3.3 Identity Provider â€“ Quáº£n lÃ½ danh tÃ­nh</a></li><li><a href=#34-internal-services--user--policy>3.4 Internal Services â€“ User & Policy</a><ol><li><a href=#user-service>User Service</a></li><li><a href=#policy--permission-service>Policy / Permission Service</a></li></ol></li><li><a href=#35-application-layer--backend-services>3.5 Application Layer â€“ Backend Services</a></li><li><a href=#káº¿t-luáº­n>Káº¿t luáº­n</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/principle/>Principle
</a><a href=/categories/programming/>Programming</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/designing-a-centralized-authentication-system-with-an-api-gateway-and-identity-broker/>Designing a Centralized Authentication System with an API Gateway and Identity Broker</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2026-01-26T00:17:00+08:00>Jan 26, 2026</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>7 minute read</time></div></footer></div></header><section class=article-content><h1 id=designing-a-centralized-authentication-system-with-an-api-gateway-and-identity-broker>Designing a Centralized Authentication System with an API Gateway and Identity Broker</h1><h2 id=Ä‘áº·t-váº¥n-Ä‘á»>Äáº·t váº¥n Ä‘á»</h2><p>Trong cÃ¡c há»‡ thá»‘ng hiá»‡n Ä‘áº¡i, Ä‘áº·c biá»‡t lÃ  há»‡ thá»‘ng phÃ¢n tÃ¡n vÃ  microservices, bÃ i toÃ¡n xÃ¡c thá»±c vÃ  phÃ¢n quyá»n ngÃ y cÃ ng trá»Ÿ nÃªn phá»©c táº¡p. Nhiá»u há»‡ thá»‘ng Ä‘á»ƒ má»—i dá»‹ch vá»¥ tá»± xá»­ lÃ½ xÃ¡c thá»±c, dáº«n Ä‘áº¿n logic trÃ¹ng láº·p vÃ  khÃ³ báº£o trÃ¬. á» chiá»u ngÆ°á»£c láº¡i, viá»‡c Ä‘á»ƒ client phá»¥ thuá»™c trá»±c tiáº¿p vÃ o há»‡ thá»‘ng xÃ¡c thá»±c bÃªn ngoÃ i láº¡i gÃ¢y ra rá»§i ro khÃ³a cháº·t vÃ o cÃ´ng cá»¥ cá»¥ thá»ƒ.</p><p>Váº¥n Ä‘á» cá»‘t lÃµi náº±m á»Ÿ viá»‡c thiáº¿u ranh giá»›i rÃµ rÃ ng giá»¯a xÃ¡c thá»±c ngÆ°á»i dÃ¹ng, quáº£n lÃ½ danh tÃ­nh ná»™i bá»™ vÃ  kiá»ƒm soÃ¡t truy cáº­p API. Khi cÃ¡c trÃ¡ch nhiá»‡m nÃ y bá»‹ trá»™n láº«n, há»‡ thá»‘ng khÃ³ má»Ÿ rá»™ng, khÃ³ thay Ä‘á»•i vÃ  khÃ³ Ã¡p dá»¥ng cÃ¡c nguyÃªn táº¯c báº£o máº­t hiá»‡n Ä‘áº¡i nhÆ° Zero Trust. Do Ä‘Ã³, cáº§n má»™t cÃ¡ch tiáº¿p cáº­n kiáº¿n trÃºc giÃºp tÃ¡ch báº¡ch trÃ¡ch nhiá»‡m, giáº£m phá»¥ thuá»™c cÃ´ng cá»¥ vÃ  Ä‘áº£m báº£o an toÃ n lÃ¢u dÃ i.</p><h2 id=giáº£i-phÃ¡p-thiáº¿t-káº¿>Giáº£i phÃ¡p thiáº¿t káº¿</h2><h3 id=21-Ä‘á»‹nh-hÆ°á»›ng-kiáº¿n-trÃºc>2.1 Äá»‹nh hÆ°á»›ng kiáº¿n trÃºc</h3><p>Giáº£i phÃ¡p Ä‘Æ°á»£c xÃ¢y dá»±ng theo Ä‘á»‹nh hÆ°á»›ng <strong>xÃ¡c thá»±c táº­p trung vÃ  tÃ¡ch báº¡ch trÃ¡ch nhiá»‡m</strong>, trong Ä‘Ã³ báº£o máº­t Ä‘Æ°á»£c Ä‘Æ°a lÃªn ranh giá»›i há»‡ thá»‘ng thay vÃ¬ phÃ¢n tÃ¡n trong tá»«ng dá»‹ch vá»¥. Má»¥c tiÃªu chÃ­nh lÃ  giáº£m sá»± phá»¥ thuá»™c giá»¯a cÃ¡c thÃ nh pháº§n, trÃ¡nh khÃ³a cháº·t vÃ o cÃ´ng cá»¥ cá»¥ thá»ƒ vÃ  Ä‘áº£m báº£o kháº£ nÄƒng má»Ÿ rá»™ng lÃ¢u dÃ i.</p><h3 id=22-phÃ¢n-táº§ng-vÃ -ranh-giá»›i-há»‡-thá»‘ng>2.2 PhÃ¢n táº§ng vÃ  ranh giá»›i há»‡ thá»‘ng</h3><p>Kiáº¿n trÃºc Ä‘Æ°á»£c tá»• chá»©c thÃ nh cÃ¡c táº§ng logic rÃµ rÃ ng:</p><ul><li><p><strong>Edge Layer</strong></p><p>LÃ  ranh giá»›i tiáº¿p xÃºc vá»›i bÃªn ngoÃ i, chá»‹u trÃ¡ch nhiá»‡m kiá»ƒm soÃ¡t truy cáº­p, thá»±c thi chÃ­nh sÃ¡ch báº£o máº­t á»Ÿ má»©c háº¡ táº§ng vÃ  báº£o vá»‡ há»‡ thá»‘ng ná»™i bá»™.</p></li><li><p><strong>Security / Broker Layer</strong></p><p>ÄÃ³ng vai trÃ² trung tÃ¢m trong viá»‡c xá»­ lÃ½ xÃ¡c thá»±c, phÃ¡t hÃ nh danh tÃ­nh vÃ  kiá»ƒm soÃ¡t quyá»n truy cáº­p. Táº§ng nÃ y Ä‘Ã³ng vai trÃ² lá»›p Ä‘á»‡m giá»¯a há»‡ thá»‘ng ná»™i bá»™ vÃ  cÃ¡c há»‡ thá»‘ng danh tÃ­nh bÃªn ngoÃ i.</p></li><li><p><strong>Identity Layer</strong></p><p>Chá»‹u trÃ¡ch nhiá»‡m xÃ¡c minh danh tÃ­nh ngÆ°á»i dÃ¹ng, Ä‘á»™c láº­p vá»›i routing, nghiá»‡p vá»¥ vÃ  chÃ­nh sÃ¡ch truy cáº­p ná»™i bá»™.</p></li><li><p><strong>Application Layer</strong></p><p>Táº­p trung xá»­ lÃ½ logic nghiá»‡p vá»¥, khÃ´ng tham gia vÃ o cÃ¡c quyáº¿t Ä‘á»‹nh liÃªn quan Ä‘áº¿n xÃ¡c thá»±c hay danh tÃ­nh.</p></li></ul><p>Viá»‡c xÃ¡c Ä‘á»‹nh rÃµ ranh giá»›i giÃºp há»‡ thá»‘ng dá»… hiá»ƒu, dá»… báº£o trÃ¬ vÃ  giáº£m coupling giá»¯a cÃ¡c thÃ nh pháº§n.</p><h3 id=23-design-concept>2.3 Design Concept</h3><div class=table-wrapper><table><thead><tr><th>Design Concept</th><th>Ã nghÄ©a trong kiáº¿n trÃºc</th></tr></thead><tbody><tr><td><strong>Single Responsibility Principle (SRP)</strong></td><td>Má»—i thÃ nh pháº§n chá»‰ Ä‘áº£m nhiá»‡m má»™t trÃ¡ch nhiá»‡m: Gateway xá»­ lÃ½ routing & enforcement, Broker xá»­ lÃ½ xÃ¡c thá»±c vÃ  token, IdP quáº£n lÃ½ danh tÃ­nh, Backend táº­p trung nghiá»‡p vá»¥</td></tr><tr><td><strong>Separation of Concerns (SoC)</strong></td><td>TÃ¡ch rÃµ network, security, identity vÃ  business logic; trÃ¡nh backend xá»­ lÃ½ OAuth hay gateway xá»­ lÃ½ login flow</td></tr><tr><td><strong>Identity Broker / IdP Facade</strong></td><td>Broker che giáº¥u IdP tháº­t khá»i client & backend, cho phÃ©p thay Ä‘á»•i hoáº·c bá»• sung IdP mÃ  khÃ´ng áº£nh hÆ°á»Ÿng há»‡ thá»‘ng</td></tr><tr><td><strong>Authenticate as Early as Possible</strong></td><td>XÃ¡c thá»±c request ngay táº¡i táº§ng gateway trÆ°á»›c khi vÃ o há»‡ thá»‘ng ná»™i bá»™, giáº£m rá»§i ro báº£o máº­t vÃ  táº£i cho backend</td></tr><tr><td><strong>Openâ€“Closed Principle (OCP)</strong></td><td>Má»Ÿ rá»™ng IdP, auth rule, claim structure mÃ  khÃ´ng cáº§n sá»­a client hay backend</td></tr></tbody></table></div><h2 id=implementation>Implementation</h2><p>Pháº§n nÃ y trÃ¬nh bÃ y cÃ¡ch hiá»‡n thá»±c kiáº¿n trÃºc báº±ng cÃ¡c cÃ´ng cá»¥ phá»• biáº¿n trong thá»±c táº¿, bÃ¡m sÃ¡t sÆ¡ Ä‘á»“ tá»•ng thá»ƒ Ä‘Ã£ mÃ´ táº£.</p><h2 id=31-edge-layer--api-gateway>3.1 Edge Layer â€“ API Gateway</h2><p><strong>CÃ´ng cá»¥ vÃ­ dá»¥</strong></p><ul><li>Traefik (Ingress / API Gateway)</li><li>Nginx / Envoy (tÆ°Æ¡ng Ä‘Æ°Æ¡ng)</li></ul><p><strong>Vai trÃ²</strong></p><ul><li>Entry point duy nháº¥t cá»§a há»‡ thá»‘ng</li><li>Routing request</li><li>Terminate TLS</li><li>Enforce authentication</li></ul><p><strong>CÃ¡ch hiá»‡n thá»±c vá»›i Traefik</strong></p><ul><li>Sá»­ dá»¥ng <code>IngressRoute</code> hoáº·c <code>HTTPRouter</code></li><li>Route:<ul><li><code>/auth/*</code> â†’ Broker Gateway</li><li><code>/api/*</code> â†’ Backend services</li></ul></li><li>DÃ¹ng <strong>forwardAuth middleware</strong>:<ul><li>Má»i API request Ä‘Æ°á»£c gá»i sang <code>/auth/verify</code></li><li>Chá»‰ cho phÃ©p request há»£p lá»‡ Ä‘i tiáº¿p</li></ul></li></ul><p>ğŸ‘‰ Traefik lÃºc nÃ y Ä‘Ã³ng vai trÃ² <strong>Policy Enforcement Point (PEP)</strong></p><p>ğŸ‘‰ KhÃ´ng xá»­ lÃ½ login, khÃ´ng verify JWT cá»¥c bá»™</p><h2 id=32-auth--security-layer--broker-gateway>3.2 Auth / Security Layer â€“ Broker Gateway</h2><p><strong>CÃ´ng cá»¥ vÃ­ dá»¥</strong></p><ul><li>Custom service (Node.js / Java Spring Boot / Go)</li><li>CÃ³ thá»ƒ dÃ¹ng OAuth2 Proxy lÃ m ná»n táº£ng má»Ÿ rá»™ng</li></ul><p><strong>Vai trÃ²</strong></p><ul><li>Login endpoint</li><li>Verify JWT</li><li>Issue JWT cho há»‡ thá»‘ng</li><li>LÃ m IdP Facade</li></ul><p><strong>Endpoints Ä‘iá»ƒn hÃ¬nh</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST   /auth/login
</span></span><span class=line><span class=cl>POST   /auth/verify
</span></span><span class=line><span class=cl>POST   /auth/refresh
</span></span></code></pre></td></tr></table></div></div><p><strong>Khi login</strong></p><ul><li>Nháº­n request tá»« Gateway</li><li>Gá»i sang Identity Provider</li><li>Láº¥y user info tá»« User Service</li><li>Gá»i Policy Service Ä‘á»ƒ resolve permission</li><li>Issue JWT (access + refresh)</li></ul><p><strong>Khi verify</strong></p><ul><li>Verify signature + expiry</li><li>Validate claim</li><li>Enrich context:<ul><li>user_id</li><li>roles</li><li>permissions</li></ul></li><li>Tráº£ header vá» cho Gateway</li></ul><p>ğŸ‘‰ Broker = <strong>Security Control Plane + Identity Facade</strong></p><h2 id=33-identity-provider--quáº£n-lÃ½-danh-tÃ­nh>3.3 Identity Provider â€“ Quáº£n lÃ½ danh tÃ­nh</h2><p><strong>CÃ´ng cá»¥ vÃ­ dá»¥</strong></p><ul><li>Keycloak</li><li>Casdoor</li><li>Auth0 / Azure AD (enterprise)</li></ul><p><strong>Vai trÃ²</strong></p><ul><li>XÃ¡c thá»±c danh tÃ­nh ngÆ°á»i dÃ¹ng</li><li>Há»— trá»£:<ul><li>Username / Password</li><li>SSO</li><li>Social login</li></ul></li></ul><p><strong>NguyÃªn táº¯c</strong></p><ul><li>IdP <strong>khÃ´ng expose trá»±c tiáº¿p ra ngoÃ i</strong></li><li>Client <strong>khÃ´ng nÃ³i chuyá»‡n trá»±c tiáº¿p vá»›i IdP</strong></li><li>Chá»‰ Broker Gateway lÃ m viá»‡c vá»›i IdP qua OAuth2 / OIDC</li></ul><p>ğŸ‘‰ Dá»… thay:</p><ul><li>Keycloak â†” Casdoor</li><li>On-prem â†” Cloud</li></ul><h2 id=34-internal-services--user--policy>3.4 Internal Services â€“ User & Policy</h2><h3 id=user-service>User Service</h3><p><strong>CÃ´ng cá»¥ vÃ­ dá»¥</strong></p><ul><li>Spring Boot / NestJS</li><li>Database ná»™i bá»™</li></ul><p><strong>Chá»©c nÄƒng</strong></p><ul><li>Profile ngÆ°á»i dÃ¹ng</li><li>Mapping user vá»›i domain ná»™i bá»™</li><li>Tráº¡ng thÃ¡i (active / blocked)</li></ul><h3 id=policy--permission-service>Policy / Permission Service</h3><p><strong>CÃ´ng cá»¥ vÃ­ dá»¥</strong></p><ul><li>Custom RBAC / ABAC service</li><li>OPA (Open Policy Agent)</li></ul><p><strong>Chá»©c nÄƒng</strong></p><ul><li>Resolve quyá»n</li><li>Ãp rule theo:<ul><li>role</li><li>resource</li><li>context</li></ul></li></ul><p>ğŸ‘‰ <strong>Chá»‰ Broker gá»i cÃ¡c service nÃ y</strong></p><p>ğŸ‘‰ Backend khÃ´ng gá»i Ä‘á»ƒ check permission</p><h2 id=35-application-layer--backend-services>3.5 Application Layer â€“ Backend Services</h2><p><strong>CÃ´ng cá»¥ vÃ­ dá»¥</strong></p><ul><li>Spring Boot</li><li>Node.js / NestJS</li><li>Go services</li></ul><p><strong>NguyÃªn táº¯c</strong></p><ul><li>KhÃ´ng xá»­ lÃ½ OAuth / JWT</li><li>KhÃ´ng gá»i IdP</li><li>KhÃ´ng check permission phá»©c táº¡p</li></ul><p><strong>Backend nháº­n</strong></p><ul><li>Header tá»« Gateway:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>X-User-Id
</span></span><span class=line><span class=cl>X-User-Roles
</span></span><span class=line><span class=cl>X-User-Permissions
</span></span></code></pre></td></tr></table></div></div><p>ğŸ‘‰ Backend <strong>security-agnostic</strong></p><p>ğŸ‘‰ Chá»‰ táº­p trung business logic</p><pre class=mermaid>
  ---
config:
  layout: dagre
---
flowchart TB
    User[&#34;ğŸ‘¤ User / Client&lt;br&gt;Browser / Mobile&#34;]

    subgraph Edge[&#34;ğŸŒ Edge Layer&#34;]
        Traefik[&#34;ğŸš¦ Traefik Gateway&lt;br&gt;(Routing Â· TLS Â· Middleware)&#34;]
    end

    subgraph Auth[&#34;ğŸ”‘ Auth / Identity Layer&#34;]
        Broker[&#34;ğŸ§­ Broker Gateway&lt;br&gt;(Login Â· JWT Issuer Â· Verify)&#34;]
        IdP[&#34;ğŸŸ¦ Identity Provider&lt;br&gt;(Keycloak / Casdoor)&#34;]
    end

    subgraph Internal[&#34;ğŸ¢ Internal Services&#34;]
        UserSvc[&#34;ğŸ‘¥ User Service&#34;]
        PolicySvc[&#34;ğŸ“œ Policy / Permission Service&#34;]
    end

    subgraph Backend[&#34;âš™ï¸ Application Layer&#34;]
        API1[&#34;Service A&#34;]
        API2[&#34;Service B&#34;]
    end

    %% â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LUá»’NG 1: LOGIN (1.x) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    User -- &#34;1.1 Login request&#34; --&gt; Traefik
    Traefik -- &#34;1.2 Route /auth/*&#34; --&gt; Broker
    Broker -- &#34;1.3 Authenticate user&#34; --&gt; IdP
    Broker -- &#34;1.4 Identity result&#34; --&gt; Broker
    Broker -- &#34;1.5 Fetch user info&#34; --&gt; UserSvc
    Broker -- &#34;1.6 Policy check&#34; --&gt; PolicySvc
    Broker -- &#34;1.7 Issue JWT&#34; --&gt; User

    %% â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LUá»’NG 2: API REQUEST (2.x) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    User -- &#34;2.1 API request + JWT&#34; --&gt; Traefik
    Traefik -- &#34;2.2 forwardAuth â†’ /auth/verify&#34; --&gt; Broker
    Broker -- &#34;2.3 Verify JWT &amp; enrich context&#34; --&gt; Traefik
    Traefik -- &#34;2.4 Proxy to Service A&#34; --&gt; API1
    Traefik -- &#34;2.4 Proxy to Service B&#34; --&gt; API2
</pre><h2 id=káº¿t-luáº­n>Káº¿t luáº­n</h2><p>BÃ i viáº¿t Ä‘Ã£ tiáº¿p cáº­n bÃ i toÃ¡n xÃ¡c thá»±c vÃ  phÃ¢n quyá»n tá»« gÃ³c nhÃ¬n kiáº¿n trÃºc, thay vÃ¬ báº¯t Ä‘áº§u tá»« cÃ´ng cá»¥ hay framework cá»¥ thá»ƒ. Báº±ng cÃ¡ch <strong>Ä‘Æ°a xÃ¡c thá»±c lÃªn ranh giá»›i há»‡ thá»‘ng</strong>, tÃ¡ch báº¡ch rÃµ rÃ ng giá»¯a gateway, lá»›p báº£o máº­t, há»‡ thá»‘ng danh tÃ­nh vÃ  backend nghiá»‡p vá»¥, kiáº¿n trÃºc giÃºp giáº£m Ä‘Ã¡ng ká»ƒ Ä‘á»™ phá»©c táº¡p vÃ  rá»§i ro báº£o máº­t trong há»‡ thá»‘ng phÃ¢n tÃ¡n.</p><p>Viá»‡c sá»­ dá»¥ng <strong>Identity Broker</strong> nhÆ° má»™t lá»›p trung gian cho phÃ©p há»‡ thá»‘ng linh hoáº¡t trong viá»‡c thay Ä‘á»•i hoáº·c má»Ÿ rá»™ng nhÃ  cung cáº¥p danh tÃ­nh, Ä‘á»“ng thá»i trÃ¡nh phá»¥ thuá»™c cháº·t vÃ o má»™t giáº£i phÃ¡p xÃ¡c thá»±c duy nháº¥t. Backend trá»Ÿ nÃªn Ä‘Æ¡n giáº£n hÆ¡n khi khÃ´ng cáº§n xá»­ lÃ½ OAuth hay JWT, tá»« Ä‘Ã³ táº­p trung hoÃ n toÃ n vÃ o logic nghiá»‡p vá»¥.</p><p>Kiáº¿n trÃºc nÃ y khÃ´ng nháº±m thay tháº¿ cÃ¡c cÃ´ng cá»¥ xÃ¡c thá»±c hiá»‡n cÃ³, mÃ  cung cáº¥p má»™t <strong>khung tÆ° duy thiáº¿t káº¿</strong> giÃºp sá»­ dá»¥ng chÃºng Ä‘Ãºng chá»—, Ä‘Ãºng vai trÃ². Khi há»‡ thá»‘ng phÃ¡t triá»ƒn vá» quy mÃ´, sá»‘ lÆ°á»£ng dá»‹ch vá»¥ vÃ  yÃªu cáº§u báº£o máº­t, cÃ¡ch tiáº¿p cáº­n nÃ y cho phÃ©p má»Ÿ rá»™ng má»™t cÃ¡ch cÃ³ kiá»ƒm soÃ¡t mÃ  khÃ´ng lÃ m xÃ¡o trá»™n toÃ n bá»™ kiáº¿n trÃºc.</p><p>Cuá»‘i cÃ¹ng, giÃ¡ trá»‹ lá»›n nháº¥t cá»§a giáº£i phÃ¡p khÃ´ng náº±m á»Ÿ viá»‡c chá»n Ä‘Ãºng cÃ´ng cá»¥, mÃ  á»Ÿ viá»‡c <strong>Ä‘áº·t Ä‘Ãºng ranh giá»›i kiáº¿n trÃºc ngay tá»« Ä‘áº§u</strong> â€” ná»n táº£ng quan trá»ng Ä‘á»ƒ xÃ¢y dá»±ng cÃ¡c há»‡ thá»‘ng an toÃ n, linh hoáº¡t vÃ  bá»n vá»¯ng trong dÃ i háº¡n.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/principle/>Principle</a>
<a href=/tags/architecture/>Architecture</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/posts/golang-module-design-simplifying-struct-and-interface-reuse/><div class=article-details><h2 class=article-title>Golang Module Design: Simplifying Struct and Interface Reuse</h2></div></a></article><article><a href=/posts/object-oriented-programming-in-golang/><div class=article-details><h2 class=article-title>Object-Oriented Programming in Golang</h2></div></a></article><article><a href=/posts/understanding-and-applying-the-solid-principles-in-programming/><div class=article-details><h2 class=article-title>Understanding and Applying the SOLID Principles in Programming</h2></div></a></article><article><a href=/posts/fake-domain-trong-docker-case-study-v%E1%BB%9Bi-kafka/><div class=article-details><h2 class=article-title>Fake Domain trong Docker: Case Study vá»›i Kafka</h2></div></a></article></div></div></aside><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2026 phongthien</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>