[{"content":"Object-Oriented Programming in Golang 1. Äáº·t váº¥n Ä‘á» Khi há»c láº­p trÃ¬nh, Ä‘a sá»‘ chÃºng ta Ä‘á»u Ä‘Æ°á»£c tiáº¿p cáº­n vá»›i láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng (OOP) qua cÃ¡c ngÃ´n ngá»¯ nhÆ° Java, C++, C#, hoáº·c Python. Nhá»¯ng khÃ¡i niá»‡m nhÆ° class, káº¿ thá»«a, Ä‘a hÃ¬nh trá»Ÿ nÃªn quen thuá»™c vÃ  gáº§n nhÆ° lÃ  tiÃªu chuáº©n.\nTuy nhiÃªn, khi chuyá»ƒn sang Golang, nhiá»u láº­p trÃ¬nh viÃªn cáº£m tháº¥y bá»‘i rá»‘i:\nGo khÃ´ng cÃ³ class KhÃ´ng cÃ³ extends hay inheritance truyá»n thá»‘ng KhÃ´ng cÃ³ constructor chuáº©n nhÆ° OOP cá»• Ä‘iá»ƒn Váº­y cÃ¢u há»i Ä‘áº·t ra lÃ :\nGolang cÃ³ há»— trá»£ OOP khÃ´ng? Náº¿u cÃ³ thÃ¬ Ä‘Æ°á»£c thiáº¿t káº¿ nhÆ° tháº¿ nÃ o?\nBÃ i viáº¿t nÃ y sáº½ giÃºp báº¡n hiá»ƒu cÃ¡ch Go tiáº¿p cáº­n OOP theo má»™t triáº¿t lÃ½ Ä‘Æ¡n giáº£n vÃ  linh hoáº¡t hÆ¡n.\n2. LÃ½ thuyáº¿t: 4 tÃ­nh cháº¥t cá»§a OOP Láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng Ä‘Æ°á»£c xÃ¢y dá»±ng trÃªn 4 tÃ­nh cháº¥t cá»‘t lÃµi. Nhá»¯ng tÃ­nh cháº¥t nÃ y giÃºp há»‡ thá»‘ng pháº§n má»m:\nDá»… báº£o trÃ¬ Dá»… má»Ÿ rá»™ng Giáº£m phá»¥ thuá»™c giá»¯a cÃ¡c thÃ nh pháº§n TÄƒng kháº£ nÄƒng tÃ¡i sá»­ dá»¥ng code 2.1 Encapsulation â€“ ÄÃ³ng gÃ³i Encapsulation lÃ  nguyÃªn táº¯c gÃ³i dá»¯ liá»‡u vÃ  hÃ nh vi vÃ o cÃ¹ng má»™t Ä‘á»‘i tÆ°á»£ng, Ä‘á»“ng thá»i áº©n cÃ¡c chi tiáº¿t ná»™i bá»™ vÃ  chá»‰ cho phÃ©p truy cáº­p thÃ´ng qua cÃ¡c phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c kiá»ƒm soÃ¡t.\nNÃ³i cÃ¡ch khÃ¡c:\nÄá»‘i tÆ°á»£ng khÃ´ng cho phÃ©p truy cáº­p trá»±c tiáº¿p vÃ o tráº¡ng thÃ¡i bÃªn trong náº¿u Ä‘iá»u Ä‘Ã³ cÃ³ thá»ƒ gÃ¢y ra lá»—i hoáº·c phÃ¡ vá»¡ logic nghiá»‡p vá»¥.\n2.2 Abstraction â€“ Trá»«u tÆ°á»£ng Abstraction lÃ  quÃ¡ trÃ¬nh áº©n Ä‘i chi tiáº¿t cÃ i Ä‘áº·t, chá»‰ cung cáº¥p giao diá»‡n hÃ nh vi cho ngÆ°á»i sá»­ dá»¥ng.\nNguyÃªn táº¯c:\nNgÆ°á»i dÃ¹ng chá»‰ cáº§n biáº¿t Ä‘á»‘i tÆ°á»£ng lÃ m Ä‘Æ°á»£c gÃ¬, khÃ´ng cáº§n biáº¿t nÃ³ hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o.\nVÃ­ dá»¥ Ä‘á»i thá»±c Khi sá»­ dá»¥ng mÃ¡y ATM:\nBáº¡n chá»‰ tháº¥y: rÃºt tiá»n, chuyá»ƒn tiá»n, kiá»ƒm tra sá»‘ dÆ°. KhÃ´ng cáº§n biáº¿t: Há»‡ thá»‘ng core banking xá»­ lÃ½ ra sao Database Ä‘Æ°á»£c thiáº¿t káº¿ nhÆ° tháº¿ nÃ o ÄÃ³ lÃ  trá»«u tÆ°á»£ng.\n2.3 Inheritance â€“ Káº¿ thá»«a Inheritance lÃ  cÆ¡ cháº¿ cho phÃ©p class con tÃ¡i sá»­ dá»¥ng thuá»™c tÃ­nh vÃ  hÃ nh vi cá»§a class cha.\nMá»¥c Ä‘Ã­ch chÃ­nh:\nTÃ¡i sá»­ dá»¥ng code XÃ¢y dá»±ng há»‡ thá»‘ng theo dáº¡ng phÃ¢n cáº¥p Giáº£m láº·p láº¡i logic 2.4 Polymorphism â€“ Äa hÃ¬nh Polymorphism nghÄ©a lÃ :\nCÃ¹ng má»™t interface hoáº·c hÃ nh vi, nhÆ°ng cÃ³ nhiá»u cÃ¡ch thá»±c hiá»‡n khÃ¡c nhau.\nMá»¥c tiÃªu:\nViáº¿t code linh hoáº¡t Giáº£m phá»¥ thuá»™c vÃ o implementation cá»¥ thá»ƒ Dá»… má»Ÿ rá»™ng há»‡ thá»‘ng Compile-time polymorphism (Ä‘a hÃ¬nh táº¡i thá»i Ä‘iá»ƒm biÃªn dá»‹ch) ÄÃ¢y lÃ  loáº¡i Ä‘a hÃ¬nh Ä‘Æ°á»£c quyáº¿t Ä‘á»‹nh khi compile, thÆ°á»ng xuáº¥t hiá»‡n dÆ°á»›i dáº¡ng:\nFunction overloading Operator overloading Template (C++) Compiler sáº½ chá»n hÃ m phÃ¹ há»£p dá»±a trÃªn kiá»ƒu dá»¯ liá»‡u.\nâ¡ Quyáº¿t Ä‘á»‹nh Ä‘Æ°á»£c Ä‘Æ°a ra á»Ÿ compile time.\nRuntime polymorphism (Ä‘a hÃ¬nh táº¡i thá»i Ä‘iá»ƒm cháº¡y) ÄÃ¢y lÃ  loáº¡i Ä‘a hÃ¬nh xáº£y ra khi:\nHÃ nh vi thá»±c sá»± chá»‰ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh khi chÆ°Æ¡ng trÃ¬nh cháº¡y. ThÆ°á»ng thÃ´ng qua: Virtual method Interface Method overriding 3. OOP trong Golang Go khÃ´ng pháº£i lÃ  ngÃ´n ngá»¯ OOP thuáº§n tÃºy, nhÆ°ng váº«n há»— trá»£ Ä‘áº§y Ä‘á»§ 4 tÃ­nh cháº¥t trÃªn theo cÃ¡ch riÃªng.\nTriáº¿t lÃ½ cá»§a Go:\nâ€œComposition over inheritanceâ€\n(Æ¯u tiÃªn ghÃ©p thÃ nh pháº§n thay vÃ¬ káº¿ thá»«a)\n3.1 Encapsulation trong Go Go sá»­ dá»¥ng quy táº¯c chá»¯ hoa â€“ chá»¯ thÆ°á»ng Ä‘á»ƒ Ä‘Ã³ng gÃ³i dá»¯ liá»‡u.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 type User struct { Name string // public age int // private } func (u *User) SetAge(age int) { if age \u0026gt; 0 { u.age = age } } func (u User) GetAge() int { return u.age } Name cÃ³ thá»ƒ truy cáº­p tá»« package khÃ¡c. age bá»‹ áº©n, chá»‰ truy cáº­p qua method. ÄÃ¢y chÃ­nh lÃ  Ä‘Ã³ng gÃ³i trong Go.\n3.2 Abstraction báº±ng interface Go dÃ¹ng interface Ä‘á»ƒ Ä‘á»‹nh nghÄ©a hÃ nh vi.\n1 2 3 type Animal interface { Speak() string } Interface chá»‰ quan tÃ¢m:\nÄá»‘i tÆ°á»£ng cÃ³ thá»ƒ lÃ m gÃ¬ KhÃ´ng quan tÃ¢m nÃ³ lÃ m tháº¿ nÃ o 3.3 Inheritance báº±ng Composition (Embedding) Go khÃ´ng cÃ³ káº¿ thá»«a truyá»n thá»‘ng, thay vÃ o Ä‘Ã³ dÃ¹ng struct embedding.\n1 2 3 4 5 6 7 8 9 10 11 type Animal struct { Name string } func (a Animal) Speak() string { return \u0026#34;Some sound\u0026#34; } type Dog struct { Animal // embedding } Dog khÃ´ng káº¿ thá»«a Animal, mÃ  nhÃºng Animal vÃ o bÃªn trong.\nNhá» váº­y:\n1 2 3 4 5 d := Dog{ Animal: Animal{Name: \u0026#34;Buddy\u0026#34;}, } fmt.Println(d.Speak()) Dog váº«n cÃ³ method Speak().\n3.4 Polymorphism báº±ng interface 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 type Animal interface { Speak() string } type Dog struct{} func (Dog) Speak() string { return \u0026#34;Woof\u0026#34; } type Cat struct{} func (Cat) Speak() string { return \u0026#34;Meow\u0026#34; } func MakeSound(a Animal) { fmt.Println(a.Speak()) } Sá»­ dá»¥ng:\n1 2 MakeSound(Dog{}) MakeSound(Cat{}) CÃ¹ng má»™t interface:\nNhÆ°ng má»—i struct cÃ³ hÃ nh vi khÃ¡c nhau. ÄÃ¢y lÃ  Ä‘a hÃ¬nh trong Go.\n4. Káº¿t há»£p Abstraction + Embedding Má»™t pattern phá»• biáº¿n trong Go:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 type Logger interface { Log(message string) } type BaseLogger struct { prefix string } func (b BaseLogger) Log(message string) { fmt.Println(b.prefix + \u0026#34;: \u0026#34; + message) } type FileLogger struct { BaseLogger filePath string } Sá»­ dá»¥ng:\n1 2 3 4 5 6 7 8 9 10 func PrintLog(l Logger) { l.Log(\u0026#34;Hello\u0026#34;) } f := FileLogger{ BaseLogger: BaseLogger{prefix: \u0026#34;FILE\u0026#34;}, filePath: \u0026#34;/tmp/log.txt\u0026#34;, } PrintLog(f) á» Ä‘Ã¢y:\nLogger â†’ abstraction BaseLogger â†’ logic chung FileLogger â†’ embedding Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng code 5. Káº¿t há»£p OOP vá»›i Generic (tá»« Go 1.18) Tá»« Go 1.18, ngÃ´n ngá»¯ nÃ y bá»• sung Generics, giÃºp viáº¿t code tá»•ng quÃ¡t, tÃ¡i sá»­ dá»¥ng tá»‘t hÆ¡n, Ä‘áº·c biá»‡t khi káº¿t há»£p vá»›i cÃ¡c nguyÃªn lÃ½ OOP.\nGenerics cho phÃ©p:\nViáº¿t struct vÃ  function dÃ¹ng cho nhiá»u kiá»ƒu dá»¯ liá»‡u Giáº£m láº·p code Giá»¯ Ä‘Æ°á»£c type safety 5.1 Generic struct VÃ­ dá»¥ má»™t repository tá»•ng quÃ¡t:\n1 2 3 4 5 6 7 8 9 10 11 type Repository[T any] struct { data []T } func (r *Repository[T]) Save(item T) { r.data = append(r.data, item) } func (r *Repository[T]) All() []T { return r.data } Sá»­ dá»¥ng:\n1 2 3 4 5 6 type User struct { Name string } userRepo := Repository[User]{} userRepo.Save(User{Name: \u0026#34;Giang\u0026#34;}) 5.2 Generic káº¿t há»£p vá»›i abstraction Ta cÃ³ thá»ƒ káº¿t há»£p interface + generic:\n1 2 3 4 5 6 7 8 9 10 11 type Saver[T any] interface { Save(T) } type MemoryRepository[T any] struct { data []T } func (m *MemoryRepository[T]) Save(item T) { m.data = append(m.data, item) } Sá»­ dá»¥ng Ä‘a hÃ¬nh:\n1 2 3 4 5 6 func Process[T any](s Saver[T], item T) { s.Save(item) } repo := \u0026amp;MemoryRepository[string]{} Process(repo, \u0026#34;hello\u0026#34;) á» Ä‘Ã¢y:\nSaver[T] â†’ abstraction MemoryRepository[T] â†’ implementation 6. Káº¿t luáº­n Golang khÃ´ng Ä‘i theo OOP truyá»n thá»‘ng, mÃ  chá»n má»™t cÃ¡ch tiáº¿p cáº­n Ä‘Æ¡n giáº£n vÃ  linh hoáº¡t hÆ¡n:\nTÃ­nh cháº¥t OOP CÃ¡ch Go thá»±c hiá»‡n Encapsulation Exported / unexported fields Abstraction Interface Inheritance Composition (embedding) Polymorphism Interface + dynamic dispatch Tá»« Go 1.18, generics giÃºp:\nTÄƒng kháº£ nÄƒng tÃ¡i sá»­ dá»¥ng Giáº£m láº·p code Káº¿t há»£p tá»‘t vá»›i interface Ä‘á»ƒ táº¡o abstraction máº¡nh hÆ¡n ","date":"2026-02-08T00:00:00+07:00","permalink":"https://phongthien99.github.io/posts/object-oriented-programming-in-golang/","title":"Object-Oriented Programming in Golang"},{"content":"Optimizing the Development Workflow with Taskfile in Spring Boot 1. Äáº·t váº¥n Ä‘á» Ná»—i Ä‘au cá»§a Java Developer Má»—i ngÃ y, má»™t Java developer pháº£i gÃµ Ä‘i gÃµ láº¡i nhá»¯ng cÃ¢u lá»‡nh dÃ i dÃ²ng:\n1 2 3 mvn clean package -DskipTests mvn spring-boot:run -Dspring-boot.run.profiles=dev -Dspring-boot.run.jvmArguments=\u0026#34;-Dserver.port=8081\u0026#34; mvn test -Dtest=\u0026#34;UserServiceTest\u0026#34; Váº¥n Ä‘á» khÃ´ng chá»‰ dá»«ng á»Ÿ viá»‡c gÃµ nhiá»u. CÃ²n cÃ³:\n1. Thiáº¿u nháº¥t quÃ¡n trong team\nDev A cháº¡y port 8080, Dev B cháº¡y port 8081 NgÆ°á»i dÃ¹ng profile dev, ngÆ°á»i dÃ¹ng local Config database má»—i ngÆ°á»i má»™t kiá»ƒu 2. Secret bá»‹ commit lÃªn Git\n1 2 # Äá»«ng lÃ m tháº¿ nÃ y! spring.datasource.password=my_super_secret_password 3. Onboarding cháº­m\nDev má»›i vÃ o team máº¥t 1-2 ngÃ y chá»‰ Ä‘á»ƒ setup mÃ´i trÆ°á»ng Äá»c README dÃ i 3 trang váº«n khÃ´ng cháº¡y Ä‘Æ°á»£c 4. CI/CD phá»©c táº¡p\nScript build khÃ¡c vá»›i local \u0026ldquo;Works on my machine\u0026rdquo; syndrome Makefile khÃ´ng pháº£i giáº£i phÃ¡p tá»‘i Æ°u Nhiá»u team chuyá»ƒn sang dÃ¹ng Makefile:\n1 2 3 .PHONY: run run: mvn spring-boot:run NhÆ°ng Makefile cÃ³ háº¡n cháº¿:\nSyntax khÃ³ Ä‘á»c vá»›i ngÆ°á»i má»›i KhÃ´ng há»— trá»£ cross-platform tá»‘t (Windows) KhÃ´ng cÃ³ dependency management giá»¯a cÃ¡c task KhÃ´ng Ä‘á»c Ä‘Æ°á»£c file .env 2. Giáº£i phÃ¡p: Taskfile Taskfile lÃ  gÃ¬? Taskfile lÃ  má»™t task runner hiá»‡n Ä‘áº¡i, viáº¿t báº±ng Go:\nCross-platform: Windows, macOS, Linux Single binary: KhÃ´ng cáº§n runtime YAML syntax: Dá»… Ä‘á»c, dá»… viáº¿t Dotenv support: Tá»± Ä‘á»™ng load .env Task dependencies: Cháº¡y task theo thá»© tá»± Triáº¿t lÃ½ thiáº¿t káº¿ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Developer â”‚ â”‚ â”‚ â”‚ â”‚ task dev â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ Taskfile.yml â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ .env â”‚ â”‚ Scripts â”‚ â”‚ Maven/Gradle â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚ â”‚ â–¼ â”‚ â”‚ Spring Boot App â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 3. Thá»±c hiá»‡n BÆ°á»›c 1: CÃ i Ä‘áº·t Taskfile Báº¡n cÃ³ thá»ƒ cÃ i Ä‘áº·t Taskfile theo hÆ°á»›ng dáº«n chÃ­nh thá»©c táº¡i https://taskfile.dev/docs/installation.\nBÆ°á»›c 2: Cáº¥u trÃºc project 1 2 3 4 5 6 7 8 9 project/ â”œâ”€â”€ src/main/resources/ â”‚ â”œâ”€â”€ application.properties # Config chung (commit) â”‚ â”œâ”€â”€ application-local.properties # Local dev profile â”‚ â””â”€â”€ application-staging.properties # Staging (dÃ¹ng ENV) â”œâ”€â”€ Taskfile.yml # Task definitions â”œâ”€â”€ .env.example # Template (commit) â”œâ”€â”€ .env # Local secrets (ignored) â””â”€â”€ .gitignore BÆ°á»›c 3: Táº¡o .env.example 1 2 3 4 5 6 7 8 9 10 # .env.example - Template cho dev má»›i SPRING_PROFILES_ACTIVE=local SERVER_PORT=8081 # Database (cho staging/prod) DB_HOST=localhost DB_PORT=5432 DB_NAME=demo DB_USER=dev DB_PASSWORD= BÆ°á»›c 4: Táº¡o Taskfile.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 # https://taskfile.dev version: \u0026#39;3\u0026#39; dotenv: [\u0026#39;.env\u0026#39;] vars: MVN: mvn tasks: # ===== DEVELOPMENT ===== default: desc: \u0026#34;Show available tasks\u0026#34; cmds: - task --list dev: desc: \u0026#34;Run app in dev mode (with .env)\u0026#34; cmds: - \u0026#34;{{.MVN}} spring-boot:run -Dspring-boot.run.jvmArguments=\u0026#39;-Dserver.port={{.SERVER_PORT}}\u0026#39;\u0026#34; env: SPRING_PROFILES_ACTIVE: \u0026#34;{{.SPRING_PROFILES_ACTIVE | default \\\u0026#34;local\\\u0026#34;}}\u0026#34; run: desc: \u0026#34;Run app (alias for dev)\u0026#34; cmds: - task dev # ===== BUILD ===== build: desc: \u0026#34;Build the project\u0026#34; cmds: - \u0026#34;{{.MVN}} clean package -DskipTests\u0026#34; build:test: desc: \u0026#34;Build with tests\u0026#34; cmds: - \u0026#34;{{.MVN}} clean package\u0026#34; compile: desc: \u0026#34;Compile only (fast)\u0026#34; cmds: - \u0026#34;{{.MVN}} compile\u0026#34; # ===== TESTING ===== test: desc: \u0026#34;Run all tests\u0026#34; cmds: - \u0026#34;{{.MVN}} test\u0026#34; test:unit: desc: \u0026#34;Run unit tests only\u0026#34; cmds: - \u0026#34;{{.MVN}} test -Dtest=\u0026#39;!*IntegrationTest\u0026#39;\u0026#34; test:integration: desc: \u0026#34;Run integration tests only\u0026#34; cmds: - \u0026#34;{{.MVN}} test -Dtest=\u0026#39;*IntegrationTest\u0026#39;\u0026#34; # ===== DATABASE ===== db:console: desc: \u0026#34;Open H2 console in browser\u0026#34; cmds: - \u0026#39;echo \u0026#34;H2 Console at http://localhost:{{.SERVER_PORT}}/h2-console\u0026#34;\u0026#39; - \u0026#39;echo \u0026#34;JDBC URL: jdbc:h2:mem:demodb\u0026#34;\u0026#39; # ===== UTILITIES ===== clean: desc: \u0026#34;Clean build artifacts\u0026#34; cmds: - \u0026#34;{{.MVN}} clean\u0026#34; deps: desc: \u0026#34;Show dependency tree\u0026#34; cmds: - \u0026#34;{{.MVN}} dependency:tree\u0026#34; deps:update: desc: \u0026#34;Check for dependency updates\u0026#34; cmds: - \u0026#34;{{.MVN}} versions:display-dependency-updates\u0026#34; # ===== PRODUCTION BUILD ===== prod:build: desc: \u0026#34;Build for production\u0026#34; cmds: - \u0026#34;{{.MVN}} clean package -Pprod -DskipTests\u0026#34; # ===== SETUP ===== setup: desc: \u0026#34;Initial project setup\u0026#34; cmds: - cp -n .env.example .env || true - echo \u0026#34;env file ready\u0026#34; - \u0026#34;{{.MVN}} clean compile\u0026#34; - echo \u0026#34;Project compiled. Run \u0026#39;task dev\u0026#39; to start\u0026#34; BÆ°á»›c 5: Config Spring Boot Ä‘á»c ENV application-local.properties:\n1 2 3 4 5 6 # Server port tá»« ENV, default 8081 server.port=${SERVER_PORT:8081} # H2 in-memory cho local dev spring.datasource.url=jdbc:h2:mem:demodb spring.h2.console.enabled=true application-staging.properties:\n1 2 3 4 # PostgreSQL vá»›i ENV variables spring.datasource.url=jdbc:postgresql://${DB_HOST}:${DB_PORT}/${DB_NAME} spring.datasource.username=${DB_USER} spring.datasource.password=${DB_PASSWORD} Sá»­ dá»¥ng hÃ ng ngÃ y 1 2 3 4 5 6 7 8 9 10 11 12 13 14 # Dev má»›i join team git clone \u0026lt;repo\u0026gt; task setup # Tá»± Ä‘á»™ng copy .env vÃ  compile # Cháº¡y app task dev # 1 lá»‡nh duy nháº¥t! # Build \u0026amp; Test task build # Build nhanh task test # Cháº¡y test task test:unit # Chá»‰ unit test # Xem táº¥t cáº£ tasks task --list Output cá»§a task --list:\n1 2 3 4 5 6 7 8 9 10 task: Available tasks for this project: * build: Build without tests * build:test: Build with tests * clean: Clean build artifacts * default: Show available tasks * dev: Run app in dev mode * setup: Initial project setup * test: Run all tests * test:integration: Run integration tests * test:unit: Run unit tests only Advanced: Task Dependencies 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 tasks: # Cháº¡y lint trÆ°á»›c khi test test: deps: [lint] cmds: - \u0026#34;{{.MVN}} test\u0026#34; lint: cmds: - \u0026#34;{{.MVN}} checkstyle:check\u0026#34; # Build chá»‰ khi test pass release: deps: [test] cmds: - \u0026#34;{{.MVN}} clean package -Pprod\u0026#34; Advanced: Parallel Tasks 1 2 3 4 5 6 7 8 tasks: ci: desc: \u0026#34;Run CI pipeline\u0026#34; deps: - task: lint - task: test:unit - task: test:integration # Táº¥t cáº£ deps cháº¡y song song! 4. Káº¿t luáº­n Lá»£i Ã­ch Ä‘áº¡t Ä‘Æ°á»£c TrÆ°á»›c Sau GÃµ lá»‡nh dÃ i task dev Secret trong code .env (gitignored) Onboarding 1-2 ngÃ y task setup - 5 phÃºt Script CI khÃ¡c local CÃ¹ng Taskfile Má»—i ngÆ°á»i config khÃ¡c Team dÃ¹ng chung .env.example NguyÃªn táº¯c quan trá»ng Commit .env.example, ignore .env\nTemplate lÃ  documentation sá»‘ng Secret khÃ´ng bao giá» lÃªn Git CI/CD khÃ´ng phá»¥ thuá»™c Taskfile\nTaskfile lÃ  convenience cho dev CI cháº¡y Maven/Gradle trá»±c tiáº¿p vá»›i ENV tá»« secrets Profile phÃ¢n tÃ¡ch rÃµ rÃ ng\nlocal: H2, khÃ´ng cáº§n setup staging/prod: Real DB, config tá»« ENV Má»™t lá»‡nh Ä‘á»ƒ cháº¡y\nDev má»›i: task setup \u0026amp;\u0026amp; task dev KhÃ´ng cáº§n Ä‘á»c README dÃ i \u0026ldquo;Automation is not about replacing humans. It\u0026rsquo;s about freeing humans to do more meaningful work.\u0026rdquo;\nHappy coding!\n","date":"2026-01-29T00:00:00Z","permalink":"https://phongthien99.github.io/posts/optimizing-the-development-workflow-with-taskfile-in-spring-boot/","title":"Optimizing the Development Workflow with Taskfile in Spring Boot"},{"content":"Designing a Centralized Authentication System with an API Gateway and Identity Broker Äáº·t váº¥n Ä‘á» Trong cÃ¡c há»‡ thá»‘ng hiá»‡n Ä‘áº¡i, Ä‘áº·c biá»‡t lÃ  há»‡ thá»‘ng phÃ¢n tÃ¡n vÃ  microservices, bÃ i toÃ¡n xÃ¡c thá»±c vÃ  phÃ¢n quyá»n ngÃ y cÃ ng trá»Ÿ nÃªn phá»©c táº¡p. Nhiá»u há»‡ thá»‘ng Ä‘á»ƒ má»—i dá»‹ch vá»¥ tá»± xá»­ lÃ½ xÃ¡c thá»±c, dáº«n Ä‘áº¿n logic trÃ¹ng láº·p vÃ  khÃ³ báº£o trÃ¬. á» chiá»u ngÆ°á»£c láº¡i, viá»‡c Ä‘á»ƒ client phá»¥ thuá»™c trá»±c tiáº¿p vÃ o há»‡ thá»‘ng xÃ¡c thá»±c bÃªn ngoÃ i láº¡i gÃ¢y ra rá»§i ro khÃ³a cháº·t vÃ o cÃ´ng cá»¥ cá»¥ thá»ƒ.\nVáº¥n Ä‘á» cá»‘t lÃµi náº±m á»Ÿ viá»‡c thiáº¿u ranh giá»›i rÃµ rÃ ng giá»¯a xÃ¡c thá»±c ngÆ°á»i dÃ¹ng, quáº£n lÃ½ danh tÃ­nh ná»™i bá»™ vÃ  kiá»ƒm soÃ¡t truy cáº­p API. Khi cÃ¡c trÃ¡ch nhiá»‡m nÃ y bá»‹ trá»™n láº«n, há»‡ thá»‘ng khÃ³ má»Ÿ rá»™ng, khÃ³ thay Ä‘á»•i vÃ  khÃ³ Ã¡p dá»¥ng cÃ¡c nguyÃªn táº¯c báº£o máº­t hiá»‡n Ä‘áº¡i nhÆ° Zero Trust. Do Ä‘Ã³, cáº§n má»™t cÃ¡ch tiáº¿p cáº­n kiáº¿n trÃºc giÃºp tÃ¡ch báº¡ch trÃ¡ch nhiá»‡m, giáº£m phá»¥ thuá»™c cÃ´ng cá»¥ vÃ  Ä‘áº£m báº£o an toÃ n lÃ¢u dÃ i.\nGiáº£i phÃ¡p thiáº¿t káº¿ 2.1 Äá»‹nh hÆ°á»›ng kiáº¿n trÃºc Giáº£i phÃ¡p Ä‘Æ°á»£c xÃ¢y dá»±ng theo Ä‘á»‹nh hÆ°á»›ng xÃ¡c thá»±c táº­p trung vÃ  tÃ¡ch báº¡ch trÃ¡ch nhiá»‡m, trong Ä‘Ã³ báº£o máº­t Ä‘Æ°á»£c Ä‘Æ°a lÃªn ranh giá»›i há»‡ thá»‘ng thay vÃ¬ phÃ¢n tÃ¡n trong tá»«ng dá»‹ch vá»¥. Má»¥c tiÃªu chÃ­nh lÃ  giáº£m sá»± phá»¥ thuá»™c giá»¯a cÃ¡c thÃ nh pháº§n, trÃ¡nh khÃ³a cháº·t vÃ o cÃ´ng cá»¥ cá»¥ thá»ƒ vÃ  Ä‘áº£m báº£o kháº£ nÄƒng má»Ÿ rá»™ng lÃ¢u dÃ i.\n2.2 PhÃ¢n táº§ng vÃ  ranh giá»›i há»‡ thá»‘ng Kiáº¿n trÃºc Ä‘Æ°á»£c tá»• chá»©c thÃ nh cÃ¡c táº§ng logic rÃµ rÃ ng:\nEdge Layer\nLÃ  ranh giá»›i tiáº¿p xÃºc vá»›i bÃªn ngoÃ i, chá»‹u trÃ¡ch nhiá»‡m kiá»ƒm soÃ¡t truy cáº­p, thá»±c thi chÃ­nh sÃ¡ch báº£o máº­t á»Ÿ má»©c háº¡ táº§ng vÃ  báº£o vá»‡ há»‡ thá»‘ng ná»™i bá»™.\nSecurity / Broker Layer\nÄÃ³ng vai trÃ² trung tÃ¢m trong viá»‡c xá»­ lÃ½ xÃ¡c thá»±c, phÃ¡t hÃ nh danh tÃ­nh vÃ  kiá»ƒm soÃ¡t quyá»n truy cáº­p. Táº§ng nÃ y Ä‘Ã³ng vai trÃ² lá»›p Ä‘á»‡m giá»¯a há»‡ thá»‘ng ná»™i bá»™ vÃ  cÃ¡c há»‡ thá»‘ng danh tÃ­nh bÃªn ngoÃ i.\nIdentity Layer\nChá»‹u trÃ¡ch nhiá»‡m xÃ¡c minh danh tÃ­nh ngÆ°á»i dÃ¹ng, Ä‘á»™c láº­p vá»›i routing, nghiá»‡p vá»¥ vÃ  chÃ­nh sÃ¡ch truy cáº­p ná»™i bá»™.\nApplication Layer\nTáº­p trung xá»­ lÃ½ logic nghiá»‡p vá»¥, khÃ´ng tham gia vÃ o cÃ¡c quyáº¿t Ä‘á»‹nh liÃªn quan Ä‘áº¿n xÃ¡c thá»±c hay danh tÃ­nh.\nViá»‡c xÃ¡c Ä‘á»‹nh rÃµ ranh giá»›i giÃºp há»‡ thá»‘ng dá»… hiá»ƒu, dá»… báº£o trÃ¬ vÃ  giáº£m coupling giá»¯a cÃ¡c thÃ nh pháº§n.\n2.3 Design Concept Design Concept Ã nghÄ©a trong kiáº¿n trÃºc Single Responsibility Principle (SRP) Má»—i thÃ nh pháº§n chá»‰ Ä‘áº£m nhiá»‡m má»™t trÃ¡ch nhiá»‡m: Gateway xá»­ lÃ½ routing \u0026amp; enforcement, Broker xá»­ lÃ½ xÃ¡c thá»±c vÃ  token, IdP quáº£n lÃ½ danh tÃ­nh, Backend táº­p trung nghiá»‡p vá»¥ Separation of Concerns (SoC) TÃ¡ch rÃµ network, security, identity vÃ  business logic; trÃ¡nh backend xá»­ lÃ½ OAuth hay gateway xá»­ lÃ½ login flow Identity Broker / IdP Facade Broker che giáº¥u IdP tháº­t khá»i client \u0026amp; backend, cho phÃ©p thay Ä‘á»•i hoáº·c bá»• sung IdP mÃ  khÃ´ng áº£nh hÆ°á»Ÿng há»‡ thá»‘ng Authenticate as Early as Possible XÃ¡c thá»±c request ngay táº¡i táº§ng gateway trÆ°á»›c khi vÃ o há»‡ thá»‘ng ná»™i bá»™, giáº£m rá»§i ro báº£o máº­t vÃ  táº£i cho backend Openâ€“Closed Principle (OCP) Má»Ÿ rá»™ng IdP, auth rule, claim structure mÃ  khÃ´ng cáº§n sá»­a client hay backend Implementation Pháº§n nÃ y trÃ¬nh bÃ y cÃ¡ch hiá»‡n thá»±c kiáº¿n trÃºc báº±ng cÃ¡c cÃ´ng cá»¥ phá»• biáº¿n trong thá»±c táº¿, bÃ¡m sÃ¡t sÆ¡ Ä‘á»“ tá»•ng thá»ƒ Ä‘Ã£ mÃ´ táº£.\n3.1 Edge Layer â€“ API Gateway CÃ´ng cá»¥ vÃ­ dá»¥\nTraefik (Ingress / API Gateway) Nginx / Envoy (tÆ°Æ¡ng Ä‘Æ°Æ¡ng) Vai trÃ²\nEntry point duy nháº¥t cá»§a há»‡ thá»‘ng Routing request Terminate TLS Enforce authentication CÃ¡ch hiá»‡n thá»±c vá»›i Traefik\nSá»­ dá»¥ng IngressRoute hoáº·c HTTPRouter Route: /auth/* â†’ Broker Gateway /api/* â†’ Backend services DÃ¹ng forwardAuth middleware: Má»i API request Ä‘Æ°á»£c gá»i sang /auth/verify Chá»‰ cho phÃ©p request há»£p lá»‡ Ä‘i tiáº¿p ğŸ‘‰ Traefik lÃºc nÃ y Ä‘Ã³ng vai trÃ² Policy Enforcement Point (PEP)\nğŸ‘‰ KhÃ´ng xá»­ lÃ½ login, khÃ´ng verify JWT cá»¥c bá»™\n3.2 Auth / Security Layer â€“ Broker Gateway CÃ´ng cá»¥ vÃ­ dá»¥\nCustom service (Node.js / Java Spring Boot / Go) CÃ³ thá»ƒ dÃ¹ng OAuth2 Proxy lÃ m ná»n táº£ng má»Ÿ rá»™ng Vai trÃ²\nLogin endpoint Verify JWT Issue JWT cho há»‡ thá»‘ng LÃ m IdP Facade Endpoints Ä‘iá»ƒn hÃ¬nh\n1 2 3 POST /auth/login POST /auth/verify POST /auth/refresh Khi login\nNháº­n request tá»« Gateway Gá»i sang Identity Provider Láº¥y user info tá»« User Service Gá»i Policy Service Ä‘á»ƒ resolve permission Issue JWT (access + refresh) Khi verify\nVerify signature + expiry Validate claim Enrich context: user_id roles permissions Tráº£ header vá» cho Gateway ğŸ‘‰ Broker = Security Control Plane + Identity Facade\n3.3 Identity Provider â€“ Quáº£n lÃ½ danh tÃ­nh CÃ´ng cá»¥ vÃ­ dá»¥\nKeycloak Casdoor Auth0 / Azure AD (enterprise) Vai trÃ²\nXÃ¡c thá»±c danh tÃ­nh ngÆ°á»i dÃ¹ng Há»— trá»£: Username / Password SSO Social login NguyÃªn táº¯c\nIdP khÃ´ng expose trá»±c tiáº¿p ra ngoÃ i Client khÃ´ng nÃ³i chuyá»‡n trá»±c tiáº¿p vá»›i IdP Chá»‰ Broker Gateway lÃ m viá»‡c vá»›i IdP qua OAuth2 / OIDC ğŸ‘‰ Dá»… thay:\nKeycloak â†” Casdoor On-prem â†” Cloud 3.4 Internal Services â€“ User \u0026amp; Policy User Service CÃ´ng cá»¥ vÃ­ dá»¥\nSpring Boot / NestJS Database ná»™i bá»™ Chá»©c nÄƒng\nProfile ngÆ°á»i dÃ¹ng Mapping user vá»›i domain ná»™i bá»™ Tráº¡ng thÃ¡i (active / blocked) Policy / Permission Service CÃ´ng cá»¥ vÃ­ dá»¥\nCustom RBAC / ABAC service OPA (Open Policy Agent) Chá»©c nÄƒng\nResolve quyá»n Ãp rule theo: role resource context ğŸ‘‰ Chá»‰ Broker gá»i cÃ¡c service nÃ y\nğŸ‘‰ Backend khÃ´ng gá»i Ä‘á»ƒ check permission\n3.5 Application Layer â€“ Backend Services CÃ´ng cá»¥ vÃ­ dá»¥\nSpring Boot Node.js / NestJS Go services NguyÃªn táº¯c\nKhÃ´ng xá»­ lÃ½ OAuth / JWT KhÃ´ng gá»i IdP KhÃ´ng check permission phá»©c táº¡p Backend nháº­n\nHeader tá»« Gateway: 1 2 3 X-User-Id X-User-Roles X-User-Permissions ğŸ‘‰ Backend security-agnostic\nğŸ‘‰ Chá»‰ táº­p trung business logic\n--- config: layout: dagre --- flowchart TB User[\u0026#34;ğŸ‘¤ User / Client\u0026lt;br\u0026gt;Browser / Mobile\u0026#34;] subgraph Edge[\u0026#34;ğŸŒ Edge Layer\u0026#34;] Traefik[\u0026#34;ğŸš¦ Traefik Gateway\u0026lt;br\u0026gt;(Routing Â· TLS Â· Middleware)\u0026#34;] end subgraph Auth[\u0026#34;ğŸ”‘ Auth / Identity Layer\u0026#34;] Broker[\u0026#34;ğŸ§­ Broker Gateway\u0026lt;br\u0026gt;(Login Â· JWT Issuer Â· Verify)\u0026#34;] IdP[\u0026#34;ğŸŸ¦ Identity Provider\u0026lt;br\u0026gt;(Keycloak / Casdoor)\u0026#34;] end subgraph Internal[\u0026#34;ğŸ¢ Internal Services\u0026#34;] UserSvc[\u0026#34;ğŸ‘¥ User Service\u0026#34;] PolicySvc[\u0026#34;ğŸ“œ Policy / Permission Service\u0026#34;] end subgraph Backend[\u0026#34;âš™ï¸ Application Layer\u0026#34;] API1[\u0026#34;Service A\u0026#34;] API2[\u0026#34;Service B\u0026#34;] end %% â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LUá»’NG 1: LOGIN (1.x) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ User -- \u0026#34;1.1 Login request\u0026#34; --\u0026gt; Traefik Traefik -- \u0026#34;1.2 Route /auth/*\u0026#34; --\u0026gt; Broker Broker -- \u0026#34;1.3 Authenticate user\u0026#34; --\u0026gt; IdP Broker -- \u0026#34;1.4 Identity result\u0026#34; --\u0026gt; Broker Broker -- \u0026#34;1.5 Fetch user info\u0026#34; --\u0026gt; UserSvc Broker -- \u0026#34;1.6 Policy check\u0026#34; --\u0026gt; PolicySvc Broker -- \u0026#34;1.7 Issue JWT\u0026#34; --\u0026gt; User %% â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LUá»’NG 2: API REQUEST (2.x) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ User -- \u0026#34;2.1 API request + JWT\u0026#34; --\u0026gt; Traefik Traefik -- \u0026#34;2.2 forwardAuth â†’ /auth/verify\u0026#34; --\u0026gt; Broker Broker -- \u0026#34;2.3 Verify JWT \u0026amp; enrich context\u0026#34; --\u0026gt; Traefik Traefik -- \u0026#34;2.4 Proxy to Service A\u0026#34; --\u0026gt; API1 Traefik -- \u0026#34;2.4 Proxy to Service B\u0026#34; --\u0026gt; API2 Káº¿t luáº­n BÃ i viáº¿t Ä‘Ã£ tiáº¿p cáº­n bÃ i toÃ¡n xÃ¡c thá»±c vÃ  phÃ¢n quyá»n tá»« gÃ³c nhÃ¬n kiáº¿n trÃºc, thay vÃ¬ báº¯t Ä‘áº§u tá»« cÃ´ng cá»¥ hay framework cá»¥ thá»ƒ. Báº±ng cÃ¡ch Ä‘Æ°a xÃ¡c thá»±c lÃªn ranh giá»›i há»‡ thá»‘ng, tÃ¡ch báº¡ch rÃµ rÃ ng giá»¯a gateway, lá»›p báº£o máº­t, há»‡ thá»‘ng danh tÃ­nh vÃ  backend nghiá»‡p vá»¥, kiáº¿n trÃºc giÃºp giáº£m Ä‘Ã¡ng ká»ƒ Ä‘á»™ phá»©c táº¡p vÃ  rá»§i ro báº£o máº­t trong há»‡ thá»‘ng phÃ¢n tÃ¡n.\nViá»‡c sá»­ dá»¥ng Identity Broker nhÆ° má»™t lá»›p trung gian cho phÃ©p há»‡ thá»‘ng linh hoáº¡t trong viá»‡c thay Ä‘á»•i hoáº·c má»Ÿ rá»™ng nhÃ  cung cáº¥p danh tÃ­nh, Ä‘á»“ng thá»i trÃ¡nh phá»¥ thuá»™c cháº·t vÃ o má»™t giáº£i phÃ¡p xÃ¡c thá»±c duy nháº¥t. Backend trá»Ÿ nÃªn Ä‘Æ¡n giáº£n hÆ¡n khi khÃ´ng cáº§n xá»­ lÃ½ OAuth hay JWT, tá»« Ä‘Ã³ táº­p trung hoÃ n toÃ n vÃ o logic nghiá»‡p vá»¥.\nKiáº¿n trÃºc nÃ y khÃ´ng nháº±m thay tháº¿ cÃ¡c cÃ´ng cá»¥ xÃ¡c thá»±c hiá»‡n cÃ³, mÃ  cung cáº¥p má»™t khung tÆ° duy thiáº¿t káº¿ giÃºp sá»­ dá»¥ng chÃºng Ä‘Ãºng chá»—, Ä‘Ãºng vai trÃ². Khi há»‡ thá»‘ng phÃ¡t triá»ƒn vá» quy mÃ´, sá»‘ lÆ°á»£ng dá»‹ch vá»¥ vÃ  yÃªu cáº§u báº£o máº­t, cÃ¡ch tiáº¿p cáº­n nÃ y cho phÃ©p má»Ÿ rá»™ng má»™t cÃ¡ch cÃ³ kiá»ƒm soÃ¡t mÃ  khÃ´ng lÃ m xÃ¡o trá»™n toÃ n bá»™ kiáº¿n trÃºc.\nCuá»‘i cÃ¹ng, giÃ¡ trá»‹ lá»›n nháº¥t cá»§a giáº£i phÃ¡p khÃ´ng náº±m á»Ÿ viá»‡c chá»n Ä‘Ãºng cÃ´ng cá»¥, mÃ  á»Ÿ viá»‡c Ä‘áº·t Ä‘Ãºng ranh giá»›i kiáº¿n trÃºc ngay tá»« Ä‘áº§u â€” ná»n táº£ng quan trá»ng Ä‘á»ƒ xÃ¢y dá»±ng cÃ¡c há»‡ thá»‘ng an toÃ n, linh hoáº¡t vÃ  bá»n vá»¯ng trong dÃ i háº¡n.\n","date":"2026-01-26T00:17:00+08:00","permalink":"https://phongthien99.github.io/posts/designing-a-centralized-authentication-system-with-an-api-gateway-and-identity-broker/","title":"Designing a Centralized Authentication System with an API Gateway and Identity Broker"},{"content":"Implementing Command and Compensation in Applications 1. Problem Trong cÃ¡c á»©ng dá»¥ng frontend dáº¡ng editor hoáº·c CRUD-heavy UI, má»—i thao tÃ¡c ngÆ°á»i dÃ¹ng Ä‘á»u táº¡o ra má»™t thay Ä‘á»•i mang Ã½ nghÄ©a nghiá»‡p vá»¥ rÃµ rÃ ng. Nhá»¯ng thay Ä‘á»•i nÃ y thÆ°á»ng xáº£y ra liÃªn tá»¥c, cÃ³ thá»© tá»± vÃ  cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng láº«n nhau. Khi ngÆ°á»i dÃ¹ng nháº­n ra thao tÃ¡c vá»«a thá»±c hiá»‡n lÃ  khÃ´ng mong muá»‘n, há»‡ thá»‘ng cáº§n cung cáº¥p kháº£ nÄƒng quay vá» tráº¡ng thÃ¡i trÆ°á»›c Ä‘Ã³ má»™t cÃ¡ch an toÃ n vÃ  dá»… kiá»ƒm soÃ¡t.\nNáº¿u khÃ´ng cÃ³ má»™t cÆ¡ cháº¿ rÃµ rÃ ng, viá»‡c â€œquay láº¡iâ€ ráº¥t dá»… trá»Ÿ thÃ nh logic vÃ¡ vÃ­u, náº±m ráº£i rÃ¡c trong nhiá»u nÆ¡i cá»§a codebase. Äiá»u nÃ y lÃ m cho hÃ nh vi há»‡ thá»‘ng khÃ³ dá»± Ä‘oÃ¡n, khÃ³ má»Ÿ rá»™ng vÃ  khÃ³ Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n khi nghiá»‡p vá»¥ ngÃ y cÃ ng phá»©c táº¡p. VÃ¬ váº­y, bÃ i toÃ¡n Ä‘áº·t ra khÃ´ng chá»‰ lÃ  quay láº¡i káº¿t quáº£ trÆ°á»›c Ä‘Ã³, mÃ  lÃ  pháº£i undo Ä‘Ãºng Ã½ nghÄ©a cá»§a hÃ nh Ä‘á»™ng Ä‘Ã£ xáº£y ra.\n2. Solution Giáº£i phÃ¡p lÃ  mÃ´ hÃ¬nh hoÃ¡ má»—i thao tÃ¡c ngÆ°á»i dÃ¹ng thÃ nh má»™t Command, trong Ä‘Ã³ Command khÃ´ng chá»‰ biáº¿t cÃ¡ch thá»±c thi hÃ nh Ä‘á»™ng mÃ  cÃ²n biáº¿t cÃ¡ch bÃ¹ trá»« láº¡i chÃ­nh tÃ¡c Ä‘á»™ng cá»§a hÃ nh Ä‘á»™ng Ä‘Ã³. Thay vÃ¬ cá»‘ gáº¯ng Ä‘iá»u khiá»ƒn tráº¡ng thÃ¡i, há»‡ thá»‘ng chá»‰ cáº§n Ä‘iá»u phá»‘i cÃ¡c Command Ä‘Ã£ Ä‘Æ°á»£c thá»±c thi theo Ä‘Ãºng thá»© tá»±.\nCompensation Ä‘Æ°á»£c xem nhÆ° má»™t hÃ nh Ä‘á»™ng nghiá»‡p vá»¥ há»£p lá»‡, Ä‘áº¡i diá»‡n cho viá»‡c Ä‘áº£o ngÆ°á»£c Ã½ nghÄ©a cá»§a hÃ nh Ä‘á»™ng ban Ä‘áº§u. Khi má»™t Command Ä‘Æ°á»£c bÃ¹ trá»«, há»‡ thá»‘ng khÃ´ng â€œquay ngÆ°á»£c thá»i gianâ€, mÃ  thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng khÃ¡c Ä‘á»ƒ trung hoÃ  tÃ¡c Ä‘á»™ng Ä‘Ã£ xáº£y ra. CÃ¡ch tiáº¿p cáº­n nÃ y giÃºp Ä‘Æ°a toÃ n bá»™ logic liÃªn quan Ä‘áº¿n viá»‡c quay láº¡i vá» Ä‘Ãºng nÆ¡i: ngay trong hÃ nh Ä‘á»™ng gÃ¢y ra thay Ä‘á»•i.\n--- config: layout: dagre --- classDiagram direction TB class Command { +execute() +compensate() } class UpdateTitleCommand { -before: string -after: string +execute() +compensate() } class DeleteItemCommand { -item: Item +execute() +compensate() } class CommandExecutor { -history: Command[] +execute(cmd: Command) +compensate() } \u0026lt;\u0026lt;interface\u0026gt;\u0026gt; Command Command \u0026lt;|.. UpdateTitleCommand Command \u0026lt;|.. DeleteItemCommand CommandExecutor --\u0026gt; Command : execute / compensate 3. Implement Pháº§n nÃ y hiá»‡n thá»±c hoÃ¡ trá»±c tiáº¿p thiáº¿t káº¿ lá»›p Ä‘Ã£ Ä‘Æ°á»£c mÃ´ hÃ¬nh hoÃ¡.\nMá»—i class trong sÆ¡ Ä‘á»“ Ä‘á»u cÃ³ trÃ¡ch nhiá»‡m rÃµ rÃ ng vÃ  khÃ´ng chá»“ng chÃ©o.\nCommand Ä‘áº¡i diá»‡n cho hÃ nh Ä‘á»™ng, CommandExecutor chá»‹u trÃ¡ch nhiá»‡m Ä‘iá»u phá»‘i.\nViá»‡c bÃ¹ trá»« Ä‘Æ°á»£c thá»±c hiá»‡n thÃ´ng qua cÆ¡ cháº¿ cursor trÃªn lá»‹ch sá»­ command.\n3.1. Command interface Command lÃ  há»£p Ä‘á»“ng chung cho má»i hÃ nh Ä‘á»™ng trong há»‡ thá»‘ng.\nNÃ³ Ä‘á»‹nh nghÄ©a hai hÃ nh vi báº¯t buá»™c: thá»±c thi vÃ  bÃ¹ trá»«.\n1 2 3 4 export interface Command { execute(): void; compensate(): void; } 3.2. UpdateTitleCommand Command nÃ y Ä‘áº¡i diá»‡n cho hÃ nh Ä‘á»™ng cáº­p nháº­t tiÃªu Ä‘á».\nNÃ³ lÆ°u láº¡i giÃ¡ trá»‹ trÆ°á»›c vÃ  sau Ä‘á»ƒ cÃ³ thá»ƒ bÃ¹ trá»« chÃ­nh xÃ¡c.\nLogic thá»±c thi vÃ  bÃ¹ trá»« luÃ´n náº±m trong cÃ¹ng má»™t class.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 export class UpdateTitleCommand implements Command { constructor( private readonly setState: (fn: any) =\u0026gt; void, private readonly before: string, private readonly after: string, ) {} execute() { this.setState((s: any) =\u0026gt; ({ ...s, title: this.after, })); } compensate() { this.setState((s: any) =\u0026gt; ({ ...s, title: this.before, })); } } 3.3. DeleteItemCommand Command nÃ y Ä‘áº¡i diá»‡n cho hÃ nh Ä‘á»™ng xoÃ¡ má»™t item.\nNÃ³ giá»¯ láº¡i item bá»‹ xoÃ¡ Ä‘á»ƒ phá»¥c vá»¥ cho viá»‡c bÃ¹ trá»«.\nCompensation á»Ÿ Ä‘Ã¢y lÃ  thÃªm láº¡i item Ä‘Ã£ bá»‹ xoÃ¡ trÆ°á»›c Ä‘Ã³.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 export class DeleteItemCommand implements Command { constructor( private readonly setState: (fn: any) =\u0026gt; void, private readonly item: { id: string; [key: string]: any }, ) {} execute() { this.setState((s: any) =\u0026gt; ({ ...s, items: s.items.filter((i) =\u0026gt; i.id !== this.item.id), })); } compensate() { this.setState((s: any) =\u0026gt; ({ ...s, items: [...s.items, this.item], })); } } 3.4. CommandExecutor CommandExecutor chá»‹u trÃ¡ch nhiá»‡m Ä‘iá»u phá»‘i viá»‡c thá»±c thi vÃ  bÃ¹ trá»«.\nNÃ³ quáº£n lÃ½ má»™t danh sÃ¡ch lá»‹ch sá»­ cÃ¡c command Ä‘Ã£ cháº¡y.\nExecutor khÃ´ng chá»©a logic nghiá»‡p vá»¥.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 export class CommandExecutor { private history: Command[] = []; execute(cmd: Command) { cmd.execute(); this.history.push(cmd); } compensate() { const cmd = this.history.pop(); if (!cmd) return; cmd.compensate(); } } 3.5. VÃ­ dá»¥ sá»­ dá»¥ng trong thá»±c táº¿ VÃ­ dá»¥ dÆ°á»›i Ä‘Ã¢y minh hoáº¡ cÃ¡ch thiáº¿t káº¿ Ä‘Æ°á»£c dÃ¹ng trong UI.\nKhá»Ÿi táº¡o executor 1 const executor =newCommandExecutor() Thá»±c thi hÃ nh Ä‘á»™ng cáº­p nháº­t tiÃªu Ä‘á» 1 2 3 4 function onUpdateTitle(before:string,after:string) { const cmd =newUpdateTitleCommand(setState, before, after) executor.execute(cmd) } Thá»±c thi hÃ nh Ä‘á»™ng xoÃ¡ item 1 2 3 4 function onDeleteItem(item:Item) { const cmd =newDeleteItemCommand(setState, item) executor.execute(cmd) } BÃ¹ trá»« hÃ nh Ä‘á»™ng gáº§n nháº¥t 1 2 3 function onCompensate() { executor.compensate() } 3.6. Luá»“ng hoáº¡t Ä‘á»™ng tÆ°Æ¡ng á»©ng vá»›i thiáº¿t káº¿ UI táº¡o Command tá»« hÃ nh Ä‘á»™ng ngÆ°á»i dÃ¹ng Executor gá»i execute() Command Ä‘Æ°á»£c push vÃ o stack Khi Undo: pop() command cuá»‘i Gá»i compensate() 4. Conclusion Thiáº¿t káº¿ Command + Compensation cho phÃ©p mÃ´ hÃ¬nh hoÃ¡ má»—i thao tÃ¡c ngÆ°á»i dÃ¹ng thÃ nh má»™t hÃ nh Ä‘á»™ng Ä‘á»™c láº­p, cÃ³ kháº£ nÄƒng tá»± bÃ¹ trá»«. Má»—i hÃ nh Ä‘á»™ng cÃ³ vÃ²ng Ä‘á»i rÃµ rÃ ng, tá»± chá»‹u trÃ¡ch nhiá»‡m cho viá»‡c thá»±c thi vÃ  hoÃ n tÃ¡c cá»§a chÃ­nh nÃ³.\nViá»‡c tÃ¡ch Command vÃ  CommandExecutor giÃºp Ä‘Ã³ng gÃ³i logic nghiá»‡p vá»¥ gá»n trong tá»«ng hÃ nh Ä‘á»™ng, giá»¯ cho há»‡ thá»‘ng dá»… hiá»ƒu vÃ  dá»… kiá»ƒm soÃ¡t. CÃ¡ch tiáº¿p cáº­n nÃ y giÃºp luá»“ng xá»­ lÃ½ nháº¥t quÃ¡n, má»Ÿ rá»™ng tá»± nhiÃªn khi sá»‘ lÆ°á»£ng hÃ nh Ä‘á»™ng tÄƒng\n","date":"2026-01-18T00:00:00+07:00","permalink":"https://phongthien99.github.io/posts/implementing-command-and-compensation-in-applications/","title":"Implementing Command and Compensation in Applications"},{"content":"POC: Centralized Logging Implementation on Kubernetes with Fluent Bit, Grafana Loki, and Grafana 1. Problem Statement Há»‡ thá»‘ng hiá»‡n táº¡i bao gá»“m nhiá»u service cháº¡y phÃ¢n tÃ¡n (microservices / container / nhiá»u node), má»—i service ghi log cá»¥c bá»™ hoáº·c theo cÆ¡ cháº¿ riÃªng láº». Log Ä‘Æ°á»£c lÆ°u trá»¯ ráº£i rÃ¡c trÃªn nhiá»u mÃ¡y chá»§, pod hoáº·c file system khÃ¡c nhau, khÃ´ng cÃ³ má»™t Ä‘iá»ƒm táº­p trung Ä‘á»ƒ quan sÃ¡t vÃ  truy váº¥n.\nKhi xáº£y ra sá»± cá»‘ (lá»—i application, timeout, performance degradation), viá»‡c truy váº¿t nguyÃªn nhÃ¢n gáº·p nhiá»u khÃ³ khÄƒn do:\nLog bá»‹ phÃ¢n tÃ¡n theo service, node vÃ  thá»i gian KhÃ´ng thá»ƒ truy váº¥n log xuyÃªn suá»‘t nhiá»u service trong cÃ¹ng má»™t request Pháº£i truy cáº­p thá»§ cÃ´ng tá»«ng mÃ¡y/pod Ä‘á»ƒ kiá»ƒm tra log KhÃ´ng cÃ³ kháº£ nÄƒng filter, search vÃ  correlation theo label (service, env, request_idâ€¦) Äiá»u nÃ y dáº«n Ä‘áº¿n:\nThá»i gian xÃ¡c Ä‘á»‹nh nguyÃªn nhÃ¢n sá»± cá»‘ (MTTR) kÃ©o dÃ i KhÃ³ debug cÃ¡c lá»—i liÃªn quan Ä‘áº¿n luá»“ng request liÃªn service Gia tÄƒng rá»§i ro váº­n hÃ nh vÃ  áº£nh hÆ°á»Ÿng Ä‘áº¿n Ä‘á»™ á»•n Ä‘á»‹nh há»‡ thá»‘ng Äá»™i váº­n hÃ nh phá»¥ thuá»™c nhiá»u vÃ o thao tÃ¡c thá»§ cÃ´ng, thiáº¿u kháº£ nÄƒng quan sÃ¡t táº­p trung Do Ä‘Ã³, cáº§n má»™t giáº£i phÃ¡p centralized logging cÃ³ kháº£ nÄƒng:\nThu tháº­p log tá»« nhiá»u nguá»“n phÃ¢n tÃ¡n\nChuáº©n hoÃ¡, gáº¯n label vÃ  lÆ°u trá»¯ táº­p trung\nCho phÃ©p truy váº¥n nhanh, chÃ­nh xÃ¡c theo thá»i gian vÃ  ngá»¯ cáº£nh\nnháº±m cáº£i thiá»‡n kháº£ nÄƒng quan sÃ¡t vÃ  rÃºt ngáº¯n thá»i gian xá»­ lÃ½ sá»± cá»‘.\n2. Objectives POC nÃ y nháº±m Ä‘Ã¡nh giÃ¡ tÃ­nh kháº£ thi cá»§a giáº£i phÃ¡p centralized logging trong mÃ´i trÆ°á»ng Kubernetes, vá»›i cÃ¡c má»¥c tiÃªu cá»¥ thá»ƒ nhÆ° sau:\nXá»­ lÃ½ log Ä‘áº§u vÃ o ~5GB/ngÃ y\nHá»‡ thá»‘ng cÃ³ kháº£ nÄƒng thu tháº­p, ingest vÃ  lÆ°u trá»¯ log tá»« nhiá»u service cháº¡y trÃªn Kubernetes vá»›i tá»•ng dung lÆ°á»£ng khoáº£ng 5GB má»—i ngÃ y mÃ  khÃ´ng xáº£y ra máº¥t log hoáº·c suy giáº£m hiá»‡u nÄƒng Ä‘Ã¡ng ká»ƒ.\nÄÃ¡p á»©ng chÃ­nh sÃ¡ch lÆ°u trá»¯ (Retention) 7 ngÃ y\nLog Ä‘Æ°á»£c lÆ°u trá»¯ táº­p trung trong vÃ²ng 7 ngÃ y, Ä‘áº£m báº£o kháº£ nÄƒng truy váº¥n, tra cá»©u phá»¥c vá»¥ má»¥c Ä‘Ã­ch váº­n hÃ nh, giÃ¡m sÃ¡t vÃ  Ä‘iá»u tra sá»± cá»‘.\nCháº¡y á»•n Ä‘á»‹nh trÃªn ná»n táº£ng Kubernetes\nGiáº£i phÃ¡p Ä‘Æ°á»£c triá»ƒn khai vÃ  váº­n hÃ nh á»•n Ä‘á»‹nh trong Kubernetes cluster, Ä‘áº£m báº£o cÃ¡c pod hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng, tá»± phá»¥c há»“i khi restart vÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n workload hiá»‡n cÃ³.\nKháº£ nÄƒng má»Ÿ rá»™ng lÆ°u trá»¯ thÃ´ng qua Object Storage (S3-compatible)\nDá»¯ liá»‡u log Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn object storage (S3 hoáº·c S3-compatible nhÆ° MinIO), cho phÃ©p má»Ÿ rá»™ng dung lÆ°á»£ng linh hoáº¡t, giáº£m phá»¥ thuá»™c vÃ o storage cá»¥c bá»™ cá»§a node vÃ  tá»‘i Æ°u chi phÃ­ khi má»Ÿ rá»™ng há»‡ thá»‘ng.\n3. Proposed Solution Giáº£i phÃ¡p Ä‘Æ°á»£c Ä‘á» xuáº¥t sá»­ dá»¥ng mÃ´ hÃ¬nh centralized logging dá»±a trÃªn bá»™ cÃ´ng cá»¥ Fluent Bit â€“ Grafana Loki â€“ Grafana, triá»ƒn khai trÃªn ná»n táº£ng Kubernetes nháº±m giáº£i quyáº¿t váº¥n Ä‘á» log phÃ¢n tÃ¡n vÃ  khÃ³ truy váº¿t.\nKiáº¿n trÃºc tá»•ng thá»ƒ Fluent Bit Triá»ƒn khai dÆ°á»›i dáº¡ng DaemonSet trÃªn Kubernetes Thu tháº­p log tá»« stdout/stderr cá»§a container Gáº¯n metadata Kubernetes (namespace, pod, container, label) Gá»­i log tá»›i Loki thÃ´ng qua HTTP API Grafana Loki (Microservices Mode) Loki Ä‘Æ°á»£c triá»ƒn khai theo mÃ´ hÃ¬nh microservices (Distributed mode), trong Ä‘Ã³ má»—i thÃ nh pháº§n Ä‘áº£m nhiá»‡m má»™t vai trÃ² riÃªng biá»‡t: Distributor: nháº­n log tá»« Fluent Bit vÃ  phÃ¢n phá»‘i tá»›i cÃ¡c Ingester Ingester: buffer vÃ  ghi log xuá»‘ng storage Querier: xá»­ lÃ½ truy váº¥n log tá»« Grafana Query Frontend: tá»‘i Æ°u vÃ  phÃ¢n phá»‘i truy váº¥n Compactor: quáº£n lÃ½ retention vÃ  compact dá»¯ liá»‡u Index Gateway / Ruler (tuá»³ chá»n trong POC) Dá»¯ liá»‡u log Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn object storage S3-compatible, cho phÃ©p má»Ÿ rá»™ng dung lÆ°á»£ng linh hoáº¡t vÃ  giáº£m phá»¥ thuá»™c vÃ o storage cá»¥c bá»™ Grafana Cung cáº¥p giao diá»‡n truy váº¥n, phÃ¢n tÃ­ch vÃ  trá»±c quan hoÃ¡ log\nHá»— trá»£ filter theo label, time range vÃ  service\nGiÃºp truy váº¿t log xuyÃªn suá»‘t nhiá»u service\nflowchart TD %% NgoÃ i Kubernetes Cluster ObjectStorage[(S3 / MinIO\u0026lt;br/\u0026gt;Object Storage)] subgraph K8S [\u0026#34;KUBERNETES CLUSTER\u0026#34;] subgraph CLIENTS [\u0026#34;Clients\u0026#34;] FluentBit([\u0026#34;Fluent Bit / Agents\u0026#34;]) Grafana[\u0026#34;Grafana UI\u0026#34;] end subgraph GATEWAY [\u0026#34;Gateway\u0026#34;] Gateway(\u0026#34;Loki Gateway\u0026lt;br/\u0026gt;nginx-unprivileged:1.29-alpine\u0026#34;) end subgraph WRITE [\u0026#34;Write Path\u0026#34;] Distributor(\u0026#34;Distributor\u0026lt;br/\u0026gt;loki:3.6.3\u0026#34;) Ingester(\u0026#34;Ingester\u0026lt;br/\u0026gt;loki:3.6.3\u0026#34;) end subgraph READ [\u0026#34;Read Path\u0026#34;] QueryFrontend(\u0026#34;Query Frontend\u0026lt;br/\u0026gt;loki:3.6.3\u0026#34;) QueryScheduler(\u0026#34;Query Scheduler\u0026lt;br/\u0026gt;loki:3.6.3\u0026#34;) Querier(\u0026#34;Querier\u0026lt;br/\u0026gt;loki:3.6.3\u0026#34;) end subgraph STORAGE [\u0026#34;Index \u0026amp; Compactor\u0026#34;] IndexGateway(\u0026#34;Index Gateway\u0026lt;br/\u0026gt;loki:3.6.3\u0026#34;) Compactor(\u0026#34;Compactor\u0026lt;br/\u0026gt;loki:3.6.3\u0026#34;) end subgraph CACHE [\u0026#34;Cache\u0026#34;] ChunksCache{Chunks Cache\u0026lt;br/\u0026gt;memcached:1.6.39} ResultsCache{Results Cache\u0026lt;br/\u0026gt;memcached:1.6.39} end subgraph CANARY [\u0026#34;Canary\u0026#34;] Canary(\u0026#34;Loki Canary\u0026lt;br/\u0026gt;loki-canary:3.6.3\u0026#34;) end end %% Luá»“ng ghi (write) FluentBit --\u0026gt; Gateway Gateway --\u0026gt; Distributor Distributor --\u0026gt; Ingester Ingester -- Push chunks \u0026amp; index --\u0026gt; ObjectStorage %% Luá»“ng Ä‘á»c (read) Grafana --\u0026gt; Gateway Gateway --\u0026gt; QueryFrontend QueryFrontend --\u0026gt; QueryScheduler QueryScheduler --\u0026gt; Querier Querier -.-\u0026gt; ObjectStorage Querier --\u0026gt; IndexGateway %% Index \u0026amp; compactor Ingester --\u0026gt; IndexGateway IndexGateway --\u0026gt; ObjectStorage Compactor --\u0026gt; ObjectStorage %% Cache usage Querier --\u0026gt; ResultsCache Ingester --\u0026gt; ChunksCache classDef canary fill:#fffbe7,stroke:#fbe292,stroke-width:2px; class Canary canary; 4. Tech Stack NhÃ³m CÃ´ng cá»¥ / ThÃ nh pháº§n Image container MÃ´ táº£ Log Aggregation Grafana Loki (Core services) docker.io/grafana/loki:3.6.3 Distributor, Ingester, Querier, Query-Frontend, Query-Scheduler, Index-Gateway, Compactor Health Check Loki Canary docker.io/grafana/loki-canary:3.6.3 Ghi \u0026amp; query log máº«u Ä‘á»ƒ kiá»ƒm tra end-to-end Log Collector Fluent Bit cr.fluentbit.io/fluent/fluent-bit:latest Thu tháº­p log container \u0026amp; gá»­i vá» Loki Reverse Proxy Loki Gateway (Nginx) docker.io/nginxinc/nginx-unprivileged:1.29-alpine Entry point cho ingestion \u0026amp; query Cache (Chunks) Memcached memcached:1.6.39-alpine Cache log chunks, giáº£m truy cáº­p object storage Cache (Results) Memcached memcached:1.6.39-alpine Cache káº¿t quáº£ truy váº¥n LogQL Metrics Exporter Memcached Exporter prom/memcached-exporter:v0.15.4 Expose metrics cho Prometheus Visualization Grafana docker.io/grafana/grafana:13.2.1 Truy váº¥n \u0026amp; trá»±c quan hÃ³a log Object Storage S3 / MinIO minio/minio:latest (náº¿u self-host) LÆ°u trá»¯ log dÃ i háº¡n Sidecar Dashboard Grafana Sidecar quay.io/kiwigrid/k8s-sidecar:2.2.1 Tá»± Ä‘á»™ng load dashboard ConfigMap vÃ o Grafana 5. MÃ´i trÆ°á»ng triá»ƒn khai POC MÃ´i trÆ°á»ng triá»ƒn khai: k3d (Kubernetes in Docker) Sá»‘ cluster: 01 Kiáº¿n trÃºc cluster: 01 Master node 02 Worker nodes 5.1 Namespace Namespace ThÃ nh pháº§n Helm chart sá»­ dá»¥ng Ghi chÃº logging Grafana Loki (microservices mode) grafana/loki Há»‡ thá»‘ng log táº­p trung logging-agent Fluent Bit grafana/fluent-bit Thu tháº­p log tá»« node/pod monitoring Grafana grafana/grafana Truy váº¥n \u0026amp; hiá»ƒn thá»‹ log 6. Results Há»‡ thá»‘ng Ä‘áº¡t má»¥c tiÃªu chÃ­nh: thu tháº­p, lÆ°u trá»¯ vÃ  truy váº¥n log táº­p trung trÃªn Kubernetes. Log tá»« cÃ¡c á»©ng dá»¥ng Ä‘Æ°á»£c ingest vÃ  hiá»ƒn thá»‹ Ä‘áº§y Ä‘á»§ trÃªn Grafana thÃ´ng qua Loki. 7. Conclusion POC chá»©ng minh há»‡ thá»‘ng Loki Ä‘Ã¡p á»©ng tá»‘t nhu cáº§u xem vÃ  truy váº¥n log táº­p trung trong pháº¡m vi thá»­ nghiá»‡m, lÃ  ná»n táº£ng phÃ¹ há»£p Ä‘á»ƒ má»Ÿ rá»™ng sang mÃ´i trÆ°á»ng production khi cáº§n.\n","date":"2026-01-13T00:00:00Z","permalink":"https://phongthien99.github.io/posts/poc-centralized-logging-implementation-on-kubernetes-with-fluent-bit-grafana-loki-and-grafana/","title":"POC: Centralized Logging Implementation on Kubernetes with Fluent Bit, Grafana Loki, and Grafana"},{"content":"Clean Architecture trong Frontend React 1. Má»¥c tiÃªu TrÃ¬nh bÃ y káº¿t quáº£ cá»§a má»™t Proof of Concept (POC) nháº±m:\nÄÃ¡nh giÃ¡ kháº£ nÄƒng Ã¡p dá»¥ng Clean Architecture cho Frontend (React / Next.js) XÃ¡c Ä‘á»‹nh cÃ¡ch tá»• chá»©c code tÃ¡ch biá»‡t rÃµ business logic vÃ  UI Kiá»ƒm chá»©ng hiá»‡u quáº£ cá»§a viá»‡c tÃ¡ch mutation state vÃ  persistent state Äá» xuáº¥t má»™t mÃ´ hÃ¬nh kiáº¿n trÃºc cÃ³ thá»ƒ má»Ÿ rá»™ng vÃ  tÃ¡i sá»­ dá»¥ng cho cÃ¡c feature liÃªn quan Ä‘áº¿n Authentication 2. Pháº¡m vi vÃ  Ä‘á»‘i tÆ°á»£ng Ã¡p dá»¥ng 2.1 Pháº¡m vi Feature: Login Ná»n táº£ng: Next.js 15 + TypeScript Tráº¡ng thÃ¡i xÃ¡c thá»±c: Client-side (POC) 2.2 Äá»‘i tÆ°á»£ng Frontend Engineer Tech Lead / Software Architect NhÃ³m phÃ¡t triá»ƒn Ä‘ang cÃ¢n nháº¯c Ã¡p dá»¥ng Clean Architecture cho FE 3. Tá»•ng quan kiáº¿n trÃºc 3.1 MÃ´ hÃ¬nh kiáº¿n trÃºc POC sá»­ dá»¥ng mÃ´ hÃ¬nh 3-layer theo tinh tháº§n Clean Architecture (dependency):\nflowchart TD Presentation[\u0026#34;Presentation Layer\u0026#34;] Domain[\u0026#34;Domain Layer\u0026#34;] Infrastructure[\u0026#34;Infrastructure Layer\u0026#34;] Presentation --\u0026gt; Domain Infrastructure --\u0026gt; Domain 3.2 NguyÃªn táº¯c thiáº¿t káº¿ chÃ­nh Ká»¹ thuáº­t Váº¥n Ä‘á» gáº·p pháº£i CÃ¡ch giáº£i quyáº¿t Lá»£i Ã­ch Separation of Concerns UI, business, data access trá»™n láº«n TÃ¡ch Presentation / Use Case / Domain / Infrastructure Code rÃµ rÃ ng, dá»… test, dá»… báº£o trÃ¬ Dependency Inversion Business phá»¥ thuá»™c framework, API Phá»¥ thuá»™c vÃ o interface, inject implementation Thay Ä‘á»•i háº¡ táº§ng khÃ´ng áº£nh hÆ°á»Ÿng logic Use Caseâ€“centric Design Code tá»• chá»©c theo technical Tá»• chá»©c theo hÃ nh vi nghiá»‡p vá»¥ (Use Case) BÃ¡m sÃ¡t nghiá»‡p vá»¥, dá»… Ä‘á»c Framework-agnostic Domain Logic Logic bá»‹ lock vÃ o React/Next Domain khÃ´ng import framework TÃ¡i sá»­ dá»¥ng, Ä‘á»™c láº­p cÃ´ng nghá»‡ 4. CÃ¡c concept ká»¹ thuáº­t Ä‘Æ°á»£c sá»­ dá»¥ng 4.1 Clean Architecture Ná»™i dung MÃ´ táº£ Äá»‹nh nghÄ©a Clean Architecture tá»• chá»©c há»‡ thá»‘ng theo cÃ¡c vÃ²ng trÃ²n phá»¥ thuá»™c Quy táº¯c phá»¥ thuá»™c Domain Layer khÃ´ng phá»¥ thuá»™c Presentation hay Infrastructure HÆ°á»›ng phá»¥ thuá»™c Dependency luÃ´n hÆ°á»›ng tá»« ngoÃ i vÃ o trong Ãp dá»¥ng trong POC LoginUseCase khÃ´ng phá»¥ thuá»™c React, Next.js Repository Ä‘Æ°á»£c inject thÃ´ng qua interface 4.2 Use Case Pattern Ná»™i dung MÃ´ táº£ KhÃ¡i niá»‡m Use Case Ä‘áº¡i diá»‡n cho má»™t hÃ nh vi nghiá»‡p vá»¥ cá»¥ thá»ƒ Use Case trong POC LoginUseCase.execute(credentials) TrÃ¡ch nhiá»‡m Validate dá»¯ liá»‡u Ä‘áº§u vÃ o Gá»i Repository Tráº£ vá» AuthSession 4.3 Dependency Injection qua React Context Ná»™i dung MÃ´ táº£ CÃ¡ch tiáº¿p cáº­n Sá»­ dá»¥ng React Context nhÆ° DI container nháº¹ Dependency Ä‘Æ°á»£c inject LoginUseCase AuthStore Lá»£i Ã­ch Dependency rÃµ rÃ ng (explicit) Dá»… mock khi test KhÃ´ng phá»¥ thuá»™c DI framework bÃªn ngoÃ i 4.4 Quáº£n lÃ½ State theo vÃ²ng Ä‘á»i Loáº¡i State Äáº·c Ä‘iá»ƒm CÃ´ng cá»¥ Temporary State Ngáº¯n háº¡n, gáº¯n vá»›i request TanStack Query Persistent State LÃ¢u dÃ i, dÃ¹ng toÃ n app Zustand 4.5 Interface Segregation Ná»™i dung MÃ´ táº£ NguyÃªn táº¯c Feature chá»‰ phá»¥ thuá»™c vÃ o interface tá»‘i thiá»ƒu cáº§n thiáº¿t Ãp dá»¥ng trong Login Login feature chá»‰ phá»¥ thuá»™c AuthStore interface Lá»£i Ã­ch Giáº£m coupling vá»›i store implementation Dá»… thay Ä‘á»•i hoáº·c má»Ÿ rá»™ng store 5. PhÃ¢n tÃ­ch tá»«ng Layer 5.1.1 TrÃ¡ch nhiá»‡m TrÃ¡ch nhiá»‡m MÃ´ táº£ Render UI Hiá»ƒn thá»‹ giao diá»‡n ngÆ°á»i dÃ¹ng (form login, message, layout) Nháº­n input ngÆ°á»i dÃ¹ng Thu tháº­p dá»¯ liá»‡u tá»« form (email, password, submit) Hiá»ƒn thá»‹ tráº¡ng thÃ¡i Xá»­ lÃ½ vÃ  hiá»ƒn thá»‹ loading, error, success KÃ­ch hoáº¡t Use Case Gá»i use case thÃ´ng qua custom hook 5.1.2 CÃ´ng nghá»‡ sá»­ dá»¥ng CÃ´ng nghá»‡ Vai trÃ² React Components XÃ¢y dá»±ng UI, tÃ¡ch nhá» theo component Custom Hooks ÄÃ³ng gÃ³i logic tÆ°Æ¡ng tÃ¡c giá»¯a UI vÃ  domain TanStack Query Quáº£n lÃ½ lifecycle cá»§a async mutation Zustand Tráº¡ng thÃ¡i global (auth state) 5.1.3 Vai trÃ² cá»§a TanStack Query KhÃ­a cáº¡nh MÃ´ táº£ Mutation lifecycle Quáº£n lÃ½ tráº¡ng thÃ¡i loading, success, error cá»§a login TÃ¡ch biá»‡t state Logic request khÃ´ng bá»‹ trá»™n vÃ o global store Cáº£i thiá»‡n UX Loading/error Ä‘á»™c láº­p theo tá»«ng form hoáº·c action 5.2 Domain Layer 5.2.1 TrÃ¡ch nhiá»‡m TrÃ¡ch nhiá»‡m MÃ´ táº£ Business rules Chá»©a toÃ n bá»™ logic nghiá»‡p vá»¥ Äá»‹nh nghÄ©a model Khai bÃ¡o entity, DTO, interface Äá»™c láº­p framework KhÃ´ng phá»¥ thuá»™c React, Next.js hay thÆ° viá»‡n bÃªn ngoÃ i 5.2.2 ThÃ nh pháº§n chÃ­nh ThÃ nh pháº§n VÃ­ dá»¥ Má»¥c Ä‘Ã­ch Entity User, AuthSession Biá»ƒu diá»…n khÃ¡i niá»‡m cá»‘t lÃµi cá»§a domain DTO LoginCredentials Äá»‹nh dáº¡ng dá»¯ liá»‡u Ä‘áº§u vÃ o cho use case Use Case LoginUseCaseImpl Thá»±c thi nghiá»‡p vá»¥ login Interface LoginRepository Äá»‹nh nghÄ©a contract cho táº§ng háº¡ táº§ng 5.2.3 Äáº·c Ä‘iá»ƒm Äáº·c Ä‘iá»ƒm Ã nghÄ©a Test Ä‘á»™c láº­p CÃ³ thá»ƒ unit test khÃ´ng cáº§n UI hay API TÃ¡i sá»­ dá»¥ng DÃ¹ng láº¡i cho web, mobile hoáº·c backend service 5.3 Infrastructure Layer 5.3.1 TrÃ¡ch nhiá»‡m TrÃ¡ch nhiá»‡m MÃ´ táº£ Káº¿t ná»‘i bÃªn ngoÃ i LÃ m viá»‡c vá»›i API, storage, service Hiá»‡n thá»±c Repository CÃ i Ä‘áº·t cÃ¡c interface tá»« Domain Layer 5.3.2 VÃ­ dá»¥ trong POC ThÃ nh pháº§n Vai trÃ² LocalStorageAuthRepo LÆ°u session/auth info vÃ o localStorage Authenticate Thá»±c hiá»‡n xÃ¡c thá»±c vÃ  xá»­ lÃ½ dá»¯ liá»‡u Mapping Chuyá»ƒn dá»¯ liá»‡u raw sang domain entity 5.3.3 Kháº£ nÄƒng má»Ÿ rá»™ng Ká»‹ch báº£n TÃ¡c Ä‘á»™ng Thay LocalStorage báº±ng REST API KhÃ´ng áº£nh hÆ°á»Ÿng Domain Layer Thay REST báº±ng GraphQL Chá»‰ thay Infrastructure Mock repository Ä‘á»ƒ test KhÃ´ng cáº§n chá»‰nh sá»­a business logic 6. Luá»“ng xá»­ lÃ½ nghiá»‡p vá»¥ (Login Flow) NgÆ°á»i dÃ¹ng submit form login LoginForm gá»i useLogin TanStack Query khá»Ÿi cháº¡y mutation LoginUseCase.execute() Ä‘Æ°á»£c gá»i Use Case validate vÃ  gá»i Repository Tráº£ vá» AuthSession Mutation onSuccess cáº­p nháº­t authStore UI redirect ngÆ°á»i dÃ¹ng 8. ÄÃ¡nh giÃ¡ NhÃ³m Ná»™i dung MÃ´ táº£ Æ¯u Ä‘iá»ƒm Kiáº¿n trÃºc rÃµ rÃ ng PhÃ¢n tÃ¡ch rÃµ cÃ¡c layer, dá»… Ä‘á»c, dá»… báº£o trÃ¬ Æ¯u Ä‘iá»ƒm Dá»… má»Ÿ rá»™ng CÃ³ thá»ƒ thay Ä‘á»•i UI, API hoáº·c storage mÃ  khÃ´ng áº£nh hÆ°á»Ÿng business logic Æ¯u Ä‘iá»ƒm TÄƒng kháº£ nÄƒng test Domain vÃ  use case cÃ³ thá»ƒ test Ä‘á»™c láº­p Æ¯u Ä‘iá»ƒm Giáº£m coupling UI khÃ´ng phá»¥ thuá»™c trá»±c tiáº¿p vÃ o logic xá»­ lÃ½ Háº¡n cháº¿ TÄƒng sá»‘ lÆ°á»£ng file Cáº§n nhiá»u folder vÃ  class/interface hÆ¡n Háº¡n cháº¿ YÃªu cáº§u kiáº¿n thá»©c kiáº¿n trÃºc Dev cáº§n hiá»ƒu Clean Architecture vÃ  Dependency Rule Háº¡n cháº¿ KhÃ´ng phÃ¹ há»£p dá»± Ã¡n nhá» Dá»… over-engineering vá»›i MVP hoáº·c app Ä‘Æ¡n giáº£n 9. Káº¿t luáº­n POC cho tháº¥y:\nClean Architecture cÃ³ thá»ƒ Ã¡p dá»¥ng hiá»‡u quáº£ cho Frontend Viá»‡c tÃ¡ch mutation state vÃ  persistent state giÃºp code rÃµ rÃ ng vÃ  UX tá»‘t hÆ¡n MÃ´ hÃ¬nh phÃ¹ há»£p cho cÃ¡c há»‡ thá»‘ng cÃ³ vÃ²ng Ä‘á»i dÃ i vÃ  yÃªu cáº§u má»Ÿ rá»™ng ","date":"2026-01-01T00:00:00+07:00","permalink":"https://phongthien99.github.io/posts/clean-architecture-trong-frontend-react/","title":"Clean Architecture trong Frontend React"},{"content":"Analysis of the Ansible Model in Multi-Node Kubernetes Deployment 1.Äáº¶T Váº¤N Äá»€ Trong cÃ¡c há»‡ thá»‘ng háº¡ táº§ng hiá»‡n Ä‘áº¡i, viá»‡c tá»± Ä‘á»™ng hÃ³a triá»ƒn khai vÃ  quáº£n lÃ½ cáº¥u hÃ¬nh Ä‘Ã³ng vai trÃ² quan trá»ng nháº±m Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n vÃ  giáº£m thiá»ƒu lá»—i do thao tÃ¡c thá»§ cÃ´ng. Ansible lÃ  má»™t cÃ´ng cá»¥ tá»± Ä‘á»™ng hÃ³a khÃ´ng cáº§n agent, cho phÃ©p quáº£n lÃ½ vÃ  Ä‘iá»u phá»‘i nhiá»u mÃ¡y chá»§ thÃ´ng qua cÃ¡c playbook vÃ  role cÃ³ cáº¥u trÃºc rÃµ rÃ ng.\nNghiÃªn cá»©u nÃ y táº­p trung phÃ¢n tÃ­ch cÃ¡ch Ansible tá»• chá»©c vÃ  Ä‘iá»u phá»‘i quy trÃ¬nh triá»ƒn khai háº¡ táº§ng Ä‘a node, thÃ´ng qua má»™t case study triá»ƒn khai Kubernetes báº±ng kubeadm. Kubernetes Ä‘Æ°á»£c sá»­ dá»¥ng nhÆ° má»™t vÃ­ dá»¥ thá»±c táº¿ nháº±m lÃ m rÃµ kháº£ nÄƒng tá»± Ä‘á»™ng hÃ³a, tÃ¡i sá»­ dá»¥ng vÃ  má»Ÿ rá»™ng cá»§a Ansible trong triá»ƒn khai há»‡ thá»‘ng phá»©c táº¡p\n2. KIáº¾N THá»¨C Ná»€N Táº¢NG 2.1 Tá»•ng quan mÃ´ hÃ¬nh hoáº¡t Ä‘á»™ng cá»§a Ansible Trong Ansible, Playbook Ä‘Ã³ng vai trÃ² trung tÃ¢m, chá»‹u trÃ¡ch nhiá»‡m Ä‘iá»u phá»‘i toÃ n bá»™ quÃ¡ trÃ¬nh triá»ƒn khai. Playbook sá»­ dá»¥ng Inventory Ä‘á»ƒ xÃ¡c Ä‘á»‹nh cÃ¡c node má»¥c tiÃªu vÃ  gá»i cÃ¡c Role tÆ°Æ¡ng á»©ng vá»›i tá»«ng chá»©c nÄƒng triá»ƒn khai.\nSÆ¡ Ä‘á»“ lá»›p (class diagram) á»Ÿ pháº§n kiáº¿n thá»©c mÃ´ táº£ rÃµ má»‘i quan há»‡ giá»¯a cÃ¡c thÃ nh pháº§n:\nPlaybook gá»i (include/import) cÃ¡c Role. Má»—i Role bao gá»“m cÃ¡c Task cá»¥ thá»ƒ vÃ  cÃ³ thá»ƒ sá»­ dá»¥ng Template Ä‘á»ƒ sinh file cáº¥u hÃ¬nh Ä‘á»™ng. Inventory káº¿t há»£p vá»›i group_vars vÃ  host_vars Ä‘á»ƒ cung cáº¥p biáº¿n cáº¥u hÃ¬nh cho toÃ n bá»™ há»‡ thá»‘ng. CÃ¡ch tá»• chá»©c nÃ y giÃºp tÃ¡ch biá»‡t logic triá»ƒn khai, cáº¥u hÃ¬nh háº¡ táº§ng vÃ  tham sá»‘ mÃ´i trÆ°á»ng, tá»« Ä‘Ã³ tÄƒng kháº£ nÄƒng tÃ¡i sá»­ dá»¥ng vÃ  giáº£m sá»± phá»¥ thuá»™c cá»©ng vÃ o mÃ´i trÆ°á»ng cá»¥ thá»ƒ.\nclassDiagram class Playbook { +includes(Role) +uses(Inventory) } class Role { +contains(Tasks) +uses(Templates) } class Tasks { +executes() } class Templates { +generatesConfig() } class Inventory { +has(group_vars) +has(host_vars) } class group_vars { +providesVariables() } class host_vars { +providesVariables() } Playbook --\u003e Role : includes Playbook --\u003e Inventory : uses Role --\u003e Tasks : contains Role --\u003e Templates : uses Inventory --\u003e group_vars : has Inventory --\u003e host_vars : has group_vars --\u003e Role : providesVariables host_vars --\u003e Role : providesVariables 2.2 Kubernetes vÃ  kubeadm Kubeadm lÃ  cÃ´ng cá»¥ chÃ­nh thá»©c do Kubernetes cung cáº¥p nháº±m Ä‘Æ¡n giáº£n hÃ³a viá»‡c khá»Ÿi táº¡o cluster. Kubeadm Ä‘áº£m nhiá»‡m cÃ¡c nhiá»‡m vá»¥ chÃ­nh nhÆ°:\nKhá»Ÿi táº¡o control plane Sinh chá»©ng chá»‰ Thiáº¿t láº­p cáº¥u hÃ¬nh kubelet Cung cáº¥p lá»‡nh kubeadm join Ä‘á»ƒ thÃªm worker node Tuy nhiÃªn, kubeadm khÃ´ng tá»± Ä‘á»™ng hÃ³a cÃ¡c bÆ°á»›c chuáº©n bá»‹ há»‡ thá»‘ng (cÃ i container runtime, cáº¥u hÃ¬nh kernel, network, v.v.). ÄÃ¢y chÃ­nh lÃ  pháº§n mÃ  Ansible bá»• sung Ä‘á»ƒ hoÃ n thiá»‡n quy trÃ¬nh triá»ƒn khai end-to-end\n2. Case study triá»ƒn khai k8s báº±ng kubeadmin SÆ¡ Ä‘á»“ thiáº¿t káº¿ triá»ƒn khai cho tháº¥y cáº¥u trÃºc phÃ¢n lá»›p rÃµ rÃ ng cá»§a project Ansible:\nansible.cfg vÃ  Makefile Ä‘Ã³ng vai trÃ² lá»›p Ä‘iá»u khiá»ƒn, giÃºp tiÃªu chuáº©n hÃ³a cÃ¡ch cháº¡y playbook. Inventory vÃ  group_vars Ä‘á»‹nh nghÄ©a háº¡ táº§ng vÃ  tham sá»‘ cáº¥u hÃ¬nh cluster. CÃ¡c Playbook Ä‘áº£m nhiá»‡m Ä‘iá»u phá»‘i theo tá»«ng giai Ä‘oáº¡n: chuáº©n bá»‹ node, khá»Ÿi táº¡o control plane vÃ  thÃªm worker. CÃ¡c Role Ä‘Æ°á»£c thiáº¿t káº¿ theo Ä‘Ãºng trÃ¬nh tá»± logic cá»§a kubeadm: common: chuáº©n bá»‹ há»‡ thá»‘ng containerd: cÃ i runtime kubernetes: cÃ i thÃ nh pháº§n K8s control_plane: khá»Ÿi táº¡o cluster cni: triá»ƒn khai máº¡ng workers: join node 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 classDiagram %% Root Files class AnsibleConfig[\u0026#34;ansible.cfg\u0026#34;] { \u0026lt;\u0026lt;config\u0026gt;\u0026gt; +inventory = inventory/hosts.ini +roles_path = ./roles +host_key_checking = False } class Makefile[\u0026#34;Makefile\u0026#34;] { \u0026lt;\u0026lt;commands\u0026gt;\u0026gt; +ping: Test connectivity +check: Check prerequisites +deploy: Full deployment +deploy-nodes: Setup nodes +deploy-control-plane: Setup CP +deploy-workers: Setup workers +verify: Check cluster +reset: Reset cluster } %% Inventory Package namespace inventory { class HostsIni[\u0026#34;hosts.ini\u0026#34;] { \u0026lt;\u0026lt;inventory\u0026gt;\u0026gt; +[control_plane] +k8s-dev-cp: 192.168.100.10 +[workers] +k8s-dev-worker-1: 192.168.100.11 +k8s-dev-worker-2: 192.168.100.12 +[k8s_cluster:vars] +k8s_version: v1.29.0 +pod_network_cidr: 10.244.0.0/16 } } %% Group Vars Package namespace group_vars { class AllYml[\u0026#34;all.yml\u0026#34;] { \u0026lt;\u0026lt;variables\u0026gt;\u0026gt; +k8s_version: \u0026#34;1.29\u0026#34; +pod_network_cidr: \u0026#34;10.244.0.0/16\u0026#34; +service_cidr: \u0026#34;10.96.0.0/12\u0026#34; +control_plane_endpoint: \u0026#34;192.168.100.10\u0026#34; +cni_plugin: \u0026#34;calico\u0026#34; +pod_ready_timeout: 300 } class K8sClusterYml[\u0026#34;k8s_cluster.yml\u0026#34;] { \u0026lt;\u0026lt;variables\u0026gt;\u0026gt; +cluster specific vars } } %% Playbooks Package namespace playbooks { class DeployK8sCluster[\u0026#34;deploy-k8s-cluster.yml\u0026#34;] { \u0026lt;\u0026lt;playbook\u0026gt;\u0026gt; +import_playbook: setup-nodes.yml +import_playbook: setup-control-plane.yml +import_playbook: setup-workers.yml +task: Get all pods status +task: Display cluster summary } class CheckPrereq[\u0026#34;check-prerequisites.yml\u0026#34;] { \u0026lt;\u0026lt;playbook\u0026gt;\u0026gt; +task: Check OS compatibility +task: Check memory \u0026gt;= 2GB +task: Check CPU \u0026gt;= 2 cores +task: Check required ports +task: Validate inventory } class SetupNodes[\u0026#34;setup-nodes.yml\u0026#34;] { \u0026lt;\u0026lt;playbook\u0026gt;\u0026gt; +hosts: k8s_cluster +role: common +role: containerd +role: kubernetes } class SetupControlPlane[\u0026#34;setup-control-plane.yml\u0026#34;] { \u0026lt;\u0026lt;playbook\u0026gt;\u0026gt; +hosts: control_plane +role: control_plane +role: cni } class SetupWorkers[\u0026#34;setup-workers.yml\u0026#34;] { \u0026lt;\u0026lt;playbook\u0026gt;\u0026gt; +hosts: workers +role: workers } } %% Roles Package - Common namespace roles.common { class CommonTasks[\u0026#34;tasks/main.yml\u0026#34;] { \u0026lt;\u0026lt;tasks\u0026gt;\u0026gt; +Disable swap permanently +Load kernel module: overlay +Load kernel module: br_netfilter +Set sysctl: net.ipv4.ip_forward=1 +Set sysctl: net.bridge.bridge-nf-call-iptables=1 +Update apt cache } } %% Roles Package - Containerd namespace roles.containerd { class ContainerdDefaults[\u0026#34;defaults/main.yml\u0026#34;] { \u0026lt;\u0026lt;defaults\u0026gt;\u0026gt; +containerd_version: \u0026#34;latest\u0026#34; } class ContainerdTasks[\u0026#34;tasks/main.yml\u0026#34;] { \u0026lt;\u0026lt;tasks\u0026gt;\u0026gt; +Install containerd package +Create /etc/containerd directory +Generate default config +Set SystemdCgroup = true +Restart containerd service +Enable containerd on boot } } %% Roles Package - Kubernetes namespace roles.kubernetes { class K8sTemplates[\u0026#34;templates/kubeadm-config.yaml.j2\u0026#34;] { \u0026lt;\u0026lt;template\u0026gt;\u0026gt; +apiVersion: kubeadm.k8s.io/v1beta3 +kind: ClusterConfiguration +kubernetesVersion: k8s_version +networking.podSubnet: pod_network_cidr } class K8sHandlers[\u0026#34;handlers/main.yml\u0026#34;] { \u0026lt;\u0026lt;handlers\u0026gt;\u0026gt; +restart kubelet } class K8sTasks[\u0026#34;tasks/main.yml\u0026#34;] { \u0026lt;\u0026lt;tasks\u0026gt;\u0026gt; +Add K8s apt key +Add K8s repository +Install kubeadm= k8s_version +Install kubelet= k8s_version +Install kubectl= k8s_version +Hold kubeadm package +Hold kubelet package +Hold kubectl package +Enable kubelet service } } %% Roles Package - Control Plane namespace roles.control_plane { class ControlPlaneTasks[\u0026#34;tasks/main.yml\u0026#34;] { \u0026lt;\u0026lt;tasks\u0026gt;\u0026gt; +Check if cluster initialized +Run kubeadm init with config +Create .kube directory +Copy admin.conf to .kube/config +Set kubeconfig ownership +Generate join command +Save join command to /tmp/ +Wait for control plane pods } } %% Roles Package - CNI namespace roles.cni { class CNIDefaults[\u0026#34;defaults/main.yml\u0026#34;] { \u0026lt;\u0026lt;defaults\u0026gt;\u0026gt; +cni_plugin: \u0026#34;calico\u0026#34; +calico_version: \u0026#34;v3.26.1\u0026#34; +flannel_version: \u0026#34;v0.22.0\u0026#34; } class CNITasks[\u0026#34;tasks/main.yml\u0026#34;] { \u0026lt;\u0026lt;tasks\u0026gt;\u0026gt; +Download Calico manifest +Apply Calico to cluster +Wait for calico-node DaemonSet +Wait for calico-kube-controllers } } %% Roles Package - Workers namespace roles.workers { class WorkersTasks[\u0026#34;tasks/main.yml\u0026#34;] { \u0026lt;\u0026lt;tasks\u0026gt;\u0026gt; +Check if kubelet.conf exists +Generate join command from CP +Execute join command +Wait for kubelet to start +Verify node joined successfully } } %% Relationships - Config to Inventory AnsibleConfig --\u0026gt; HostsIni : uses %% Relationships - Makefile to Playbooks Makefile --\u0026gt; DeployK8sCluster : executes Makefile --\u0026gt; CheckPrereq : executes %% Relationships - Playbooks Imports DeployK8sCluster ..\u0026gt; SetupNodes : imports DeployK8sCluster ..\u0026gt; SetupControlPlane : imports DeployK8sCluster ..\u0026gt; SetupWorkers : imports %% Relationships - Playbooks use Variables AllYml ..\u0026gt; DeployK8sCluster : configures AllYml ..\u0026gt; SetupNodes : configures AllYml ..\u0026gt; SetupControlPlane : configures K8sClusterYml ..\u0026gt; DeployK8sCluster : configures %% Relationships - Playbooks to Roles SetupNodes --\u0026gt; CommonTasks : includes role SetupNodes --\u0026gt; ContainerdTasks : includes role SetupNodes --\u0026gt; K8sTasks : includes role SetupControlPlane --\u0026gt; ControlPlaneTasks : includes role SetupControlPlane --\u0026gt; CNITasks : includes role SetupWorkers --\u0026gt; WorkersTasks : includes role %% Relationships - Roles internal ContainerdTasks ..\u0026gt; ContainerdDefaults : uses K8sTasks ..\u0026gt; K8sTemplates : uses K8sTasks ..\u0026gt; K8sHandlers : notifies CNITasks ..\u0026gt; CNIDefaults : uses Káº¿t luáº­n Káº¿t quáº£ nghiÃªn cá»©u cho tháº¥y viá»‡c triá»ƒn khai Kubernetes báº±ng Ansible káº¿t há»£p kubeadm mang láº¡i nhiá»u lá»£i Ã­ch rÃµ rá»‡t so vá»›i phÆ°Æ¡ng phÃ¡p thá»§ cÃ´ng.\nTrÆ°á»›c háº¿t, quÃ¡ trÃ¬nh triá»ƒn khai Ä‘Æ°á»£c chuáº©n hÃ³a vÃ  tá»± Ä‘á»™ng hÃ³a hoÃ n toÃ n, giÃºp giáº£m thá»i gian cÃ i Ä‘áº·t vÃ  háº¡n cháº¿ lá»—i cáº¥u hÃ¬nh. Thá»© hai, cáº¥u trÃºc project theo hÆ°á»›ng role-based giÃºp há»‡ thá»‘ng dá»… báº£o trÃ¬, dá»… má»Ÿ rá»™ng vÃ  dá»… tÃ¡i sá»­ dá»¥ng trong cÃ¡c mÃ´i trÆ°á»ng khÃ¡c nhau\n","date":"2025-12-21T21:40:00+07:00","permalink":"https://phongthien99.github.io/posts/analysis-of-the-ansible-model-in-multi-node-kubernetes-deployment/","title":"Analysis of the Ansible Model in Multi-Node Kubernetes Deployment"},{"content":"Äáº·t váº¥n Ä‘á» Trong cÃ¡c á»©ng dá»¥ng frontend hiá»‡n Ä‘áº¡i, kÃ­ch thÆ°á»›c JavaScript bundle ban Ä‘áº§u lÃ  yáº¿u tá»‘ then chá»‘t áº£nh hÆ°á»Ÿng Ä‘áº¿n thá»i gian táº£i, kháº£ nÄƒng tÆ°Æ¡ng tÃ¡c sá»›m (Time to Interactive) vÃ  hiá»‡u nÄƒng thá»±c táº¿ trÃªn client.\nBundle lá»›n lÃ m tÄƒng chi phÃ­ download, parse vÃ  execute trÃªn main thread, Ä‘áº·c biá»‡t rÃµ rá»‡t trÃªn thiáº¿t bá»‹ di Ä‘á»™ng vÃ  mÃ´i trÆ°á»ng máº¡ng cÃ³ Ä‘á»™ trá»… cao. Há»‡ quáº£ lÃ  perceived performance suy giáº£m, ngay cáº£ khi backend vÃ  UI Ä‘Ã£ Ä‘Æ°á»£c tá»‘i Æ°u tá»‘t.\nBÃªn cáº¡nh tÃ¡c Ä‘á»™ng Ä‘áº¿n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng, má»—i KB JavaScript Ä‘Æ°á»£c phÃ¢n phá»‘i qua CDN sáº½ nhÃ¢n lÃªn theo sá»‘ lÆ°á»£ng request, khiáº¿n chi phÃ­ CDN tÄƒng tuyáº¿n tÃ­nh theo traffic náº¿u khÃ´ng cÃ³ chiáº¿n lÆ°á»£c chia chunk vÃ  cache phÃ¹ há»£p.\nDo Ä‘Ã³, kiá»ƒm soÃ¡t bundle size khÃ´ng chá»‰ lÃ  má»™t bÆ°á»›c tá»‘i Æ°u á»Ÿ cuá»‘i pipeline, mÃ  lÃ  má»™t quyáº¿t Ä‘á»‹nh kiáº¿n trÃºc frontend cáº§n Ä‘Æ°á»£c cÃ¢n nháº¯c tá»« sá»›m.\nGiáº£i phÃ¡p Äá»ƒ kiá»ƒm soÃ¡t kÃ­ch thÆ°á»›c bundle vÃ  tá»‘i Æ°u hiá»‡u nÄƒng tá»•ng thá»ƒ, cÃ³ thá»ƒ káº¿t há»£p ba ká»¹ thuáº­t cá»‘t lÃµi theo Ä‘Ãºng thá»© tá»± tá»« build-time Ä‘áº¿n runtime:\nTree Shaking: loáº¡i bá» code khÃ´ng sá»­ dá»¥ng á»Ÿ giai Ä‘oáº¡n build Vendor Chunking: tÃ¡ch vÃ  cache hiá»‡u quáº£ cÃ¡c thÆ° viá»‡n á»•n Ä‘á»‹nh Lazy Loading: trÃ¬ hoÃ£n táº£i code khÃ´ng cáº§n thiáº¿t cho luá»“ng ban Ä‘áº§u Ba ká»¹ thuáº­t nÃ y bá»• trá»£ láº«n nhau, giÃºp giáº£m bundle tá»« gá»‘c, tá»‘i Æ°u phÃ¢n phá»‘i qua CDN vÃ  cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng.\nThá»±c hiá»‡n vÃ  VÃ­ dá»¥ minh há»a 1. Tree Shaking Tree Shaking Ä‘Æ°á»£c thá»±c hiá»‡n á»Ÿ giai Ä‘oáº¡n build nháº±m loáº¡i bá» cÃ¡c module, function vÃ  export khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng khá»i bundle cuá»‘i cÃ¹ng.\nâŒ BAD 1 2 3 4 5 import *asIconsfrom\u0026#39;lucide-react\u0026#39;; functionHeader() { return\u0026lt;Icons.Home /\u0026gt;; } Import toÃ n bá»™ module Bundler khÃ´ng thá»ƒ tree shake hiá»‡u quáº£ LÃ m tÄƒng kÃ­ch thÆ°á»›c bundle khÃ´ng cáº§n thiáº¿t âœ… GOOD 1 2 3 4 5 import {Home }from\u0026#39;lucide-react\u0026#39;; functionHeader() { return\u0026lt;Home /\u0026gt;; } Import theo named export Chá»‰ bundle code thá»±c sá»± Ä‘Æ°á»£c sá»­ dá»¥ng 2. Vendor Chunking Vendor Chunking tÃ¡ch code á»©ng dá»¥ng khá»i cÃ¡c thÆ° viá»‡n bÃªn thá»© ba cÃ³ vÃ²ng Ä‘á»i á»•n Ä‘á»‹nh nháº±m cáº£i thiá»‡n hiá»‡u quáº£ cache.\nâŒ BAD 1 2 // KhÃ´ng cáº¥u hÃ¬nh chia chunk // Vendor vÃ  app code bá»‹ gá»™p chung Má»—i láº§n deploy invalidate toÃ n bá»™ bundle Cache CDN vÃ  trÃ¬nh duyá»‡t kÃ©m hiá»‡u quáº£ âœ… GOOD (Vite) 1 2 3 4 5 6 7 8 9 10 11 12 13 // vite.config.ts exportdefault { build: { rollupOptions: { output: { manualChunks: { \u0026#39;vendor-react\u0026#39;: [\u0026#39;react\u0026#39;,\u0026#39;react-dom\u0026#39;], \u0026#39;vendor-ui\u0026#39;: [\u0026#39;lucide-react\u0026#39;,\u0026#39;@radix-ui/react-icons\u0026#39;], }, }, }, }, }; Vendor chunk á»•n Ä‘á»‹nh Giáº£m lÆ°á»£ng JavaScript cáº§n táº£i láº¡i khi deploy 3. Lazy Loading Lazy Loading Ä‘Æ°á»£c Ã¡p dá»¥ng á»Ÿ runtime nháº±m trÃ¬ hoÃ£n viá»‡c táº£i cÃ¡c route vÃ  component khÃ´ng thuá»™c luá»“ng sá»­ dá»¥ng ban Ä‘áº§u.\nâŒ BAD 1 2 3 4 5 6 7 importDashboardfrom\u0026#39;@/pages/Dashboard\u0026#39;; importSettingsfrom\u0026#39;@/pages/Settings\u0026#39;; \u0026lt;Routes\u0026gt; \u0026lt;Routepath=\u0026#34;/dashboard\u0026#34;element={\u0026lt;Dashboard /\u0026gt;} /\u0026gt; \u0026lt;Routepath=\u0026#34;/settings\u0026#34;element={\u0026lt;Settings /\u0026gt;} /\u0026gt; \u0026lt;/Routes\u0026gt; Eager load toÃ n bá»™ route Initial bundle lá»›n âœ… GOOD 1 2 3 4 5 6 7 8 9 10 11 import { lazy,Suspense }from\u0026#39;react\u0026#39;; constDashboard =lazy(() =\u0026gt;import(\u0026#39;@/pages/Dashboard\u0026#39;)); constSettings =lazy(() =\u0026gt;import(\u0026#39;@/pages/Settings\u0026#39;)); \u0026lt;Suspensefallback={\u0026lt;Loading /\u0026gt;}\u0026gt; \u0026lt;Routes\u0026gt; \u0026lt;Routepath=\u0026#34;/dashboard\u0026#34;element={\u0026lt;Dashboard /\u0026gt;} /\u0026gt; \u0026lt;Routepath=\u0026#34;/settings\u0026#34;element={\u0026lt;Settings /\u0026gt;} /\u0026gt; \u0026lt;/Routes\u0026gt; \u0026lt;/Suspense\u0026gt; Route chá»‰ Ä‘Æ°á»£c load khi cáº§n Giáº£m initial bundle Cáº£i thiá»‡n Time to Interactive Káº¿t luáº­n Viá»‡c káº¿t há»£p Tree Shaking â†’ Vendor Chunking â†’ Lazy Loading táº¡o thÃ nh má»™t chiáº¿n lÆ°á»£c tá»‘i Æ°u bundle toÃ n diá»‡n cho React:\nGiáº£m kÃ­ch thÆ°á»›c bundle ngay tá»« build-time Táº­n dá»¥ng cache CDN vÃ  trÃ¬nh duyá»‡t hiá»‡u quáº£ hÆ¡n Cáº£i thiá»‡n tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng á»Ÿ thá»i Ä‘iá»ƒm táº£i ban Ä‘áº§u ","date":"2025-12-19T11:09:00+07:00","permalink":"https://phongthien99.github.io/posts/javascript-bundle-size-as-a-frontend-architecture-concern/","title":"JavaScript Bundle Size as a Frontend Architecture Concern"},{"content":"Database-Centric Architecture 1. Giá»›i thiá»‡u Database-Centric Architecture lÃ  kiá»ƒu kiáº¿n trÃºc pháº§n má»m mÃ  cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘Ã³ng vai trÃ² trung tÃ¢m cá»§a há»‡ thá»‘ng.\nThay vÃ¬ xá»­ lÃ½ logic nghiá»‡p vá»¥ á»Ÿ táº§ng á»©ng dá»¥ng, pháº§n lá»›n logic Ä‘Æ°á»£c Ä‘Æ°a vÃ o database thÃ´ng qua:\nStored Procedures Triggers Views / Materialized Views Constraints RLS / CLS Transaction logic á»¨ng dá»¥ng Ä‘Ã³ng vai trÃ² chá»§ yáº¿u lÃ  giao diá»‡n tÆ°Æ¡ng tÃ¡c (presentation + API gateway) hÆ¡n lÃ  nÆ¡i xá»­ lÃ½ logic.\n2. Lá»£i Ã­ch 2.1. Dá»¯ liá»‡u nháº¥t quÃ¡n vÃ  integrity cao DB Ä‘áº£m nhiá»‡m toÃ n bá»™ constraint, validation vÃ  loáº¡i bá» logic trÃ¹ng láº·p. Nhiá»u clients truy cáº­p váº«n Ä‘áº£m báº£o ACID, háº¡n cháº¿ lá»—i race-condition hoáº·c mismatch logic. 2.2. Business logic táº­p trung Quy táº¯c nghiá»‡p vá»¥ táº­p trung táº¡i má»™t nÆ¡i duy nháº¥t. Dá»… kiá»ƒm soÃ¡t, audit vÃ  giáº£m sai lá»‡ch giá»¯a cÃ¡c service hoáº·c á»©ng dá»¥ng client khÃ¡c nhau. 2.3. Báº£o máº­t máº¡nh vÃ  cháº·t cháº½ DÃ¹ng RLS, CLS, roles giÃºp kiá»ƒm soÃ¡t truy cáº­p theo tá»«ng dÃ²ng dá»¯ liá»‡u hoáº·c tá»«ng cá»™t. KhÃ´ng phá»¥ thuá»™c á»©ng dá»¥ng Ä‘á»ƒ enforce security â€” tÄƒng tÃ­nh an toÃ n. 2.4. PhÃ¹ há»£p cho há»‡ thá»‘ng giao dá»‹ch Banking, ERP, CRM, healthcare,â€¦ nÆ¡i consistency cá»±c ká»³ quan trá»ng. CÃ¡c stored procedure cháº¡y ná»™i bá»™ giÃºp giáº£m round-trip vÃ  tÄƒng tá»‘c xá»­ lÃ½ giao dá»‹ch. 3. NhÆ°á»£c Ä‘iá»ƒm 3.1. Váº¥n Ä‘á» vá» Scale Database trá»Ÿ thÃ nh bottleneck: CPU, RAM, IO Ä‘á»u dá»“n vÃ o DB. KhÃ³ scale ngang: sharding, replication phá»©c táº¡p khi logic náº±m trong DB. TÄƒng latency khi nhiá»u trigger/procedure náº·ng. Read replicas khÃ´ng thá»±c hiá»‡n Ä‘Æ°á»£c logic write, gÃ¢y lá»‡ thuá»™c master. 3.2. Váº¥n Ä‘á» vá» Maintainability á» Ä‘Ã¢u cÅ©ng cÃ³ logic: triggers, procedure, view â†’ khÃ³ debug, khÃ³ trace. KhÃ³ version control: khÃ´ng Ä‘á»“ng bá»™ vá»›i Git/CI/CD tá»‘t nhÆ° code application. Schema thay Ä‘á»•i phá»©c táº¡p: dá»… gÃ¢y lá»—i dÃ¢y chuyá»n trong trigger/procedure. ÄÃ²i há»i skill Ä‘áº·c thÃ¹ nhÆ° SQL nÃ¢ng cao, locking, query planning. Coupling cao: Ä‘á»•i DB hoáº·c chuyá»ƒn sang microservices ráº¥t tá»‘n kÃ©m. 4. Case Study â€” Khi nÃ o nÃªn dÃ¹ng Database-Centric Architecture 4.1. NgÃ nh tÃ i chÃ­nh â€“ ngÃ¢n hÃ ng Cáº§n ACID tuyá»‡t Ä‘á»‘i. Giao dá»‹ch tiá»n tá»‡: chuyá»ƒn khoáº£n, thanh toÃ¡n, kiá»ƒm tra sá»‘ dÆ°. Stored procedure Ä‘áº£m báº£o logic nháº¥t quÃ¡n, rollback an toÃ n. Triá»ƒn khai Ä‘iá»ƒn hÃ¬nh:\nSP xá»­ lÃ½ giao dá»‹ch (debit/credit). Trigger táº¡o lá»‹ch sá»­ giao dá»‹ch. Constraint ngÄƒn máº¥t cÃ¢n báº±ng tÃ i khoáº£n. RLS Ä‘áº£m báº£o user chá»‰ tháº¥y tÃ i khoáº£n cá»§a há». Materialized view dÃ nh cho bÃ¡o cÃ¡o tá»•ng há»£p. 4.2. ERP / CRM / Accounting Dá»¯ liá»‡u phá»©c táº¡p nhÆ°ng consistency quan trá»ng hÆ¡n performance. Quy trÃ¬nh nghiá»‡p vá»¥ á»•n Ä‘á»‹nh, Ã­t thay Ä‘á»•i. 5. Káº¿t luáº­n Database-Centric Architecture phÃ¹ há»£p cho cÃ¡c há»‡ thá»‘ng:\nDá»¯ liá»‡u lÃ  trung tÃ¢m TÃ­nh toÃ n váº¹n (integrity) vÃ  nháº¥t quÃ¡n lÃ  Æ°u tiÃªn hÃ ng Ä‘áº§u Nghiá»‡p vá»¥ á»•n Ä‘á»‹nh, Ã­t thay Ä‘á»•i Sá»‘ lÆ°á»£ng giao dá»‹ch lá»›n nhÆ°ng user khÃ´ng quÃ¡ Ä‘Ã´ng Tuy nhiÃªn, khÃ´ng phÃ¹ há»£p cho:\nHá»‡ thá»‘ng cáº§n scale-out lá»›n, traffic cao (social network, ecommerce lá»›n) Microservices architecture Há»‡ thá»‘ng cáº§n release nhanh, thay Ä‘á»•i thÆ°á»ng xuyÃªn TÃ³m láº¡i:\nDatabase-Centric Architecture phÃ¡t huy tá»‘i Ä‘a trong mÃ´i trÆ°á»ng yÃªu cáº§u Ä‘á»™ chÃ­nh xÃ¡c cao, tÃ­nh nháº¥t quÃ¡n máº¡nh, vÃ  quy táº¯c nghiá»‡p vá»¥ á»•n Ä‘á»‹nh. NhÆ°ng nÃ³ pháº£i Ä‘Ã¡nh Ä‘á»•i báº±ng kháº£ nÄƒng má»Ÿ rá»™ng vÃ  chi phÃ­ báº£o trÃ¬ lÃ¢u dÃ i.\n","date":"2025-12-12T00:40:00+08:00","permalink":"https://phongthien99.github.io/posts/database-centric-architecture/","title":"Database-Centric Architecture"},{"content":"Sum Type and Pattern Matching 1. Äáº·t váº¥n Ä‘á» Trong láº­p trÃ¬nh truyá»n thá»‘ng, viá»‡c biá»ƒu diá»…n tráº¡ng thÃ¡i vÃ  luá»“ng xá»­ lÃ½ thÆ°á»ng dÃ¹ng:\nif/else switch/case null Ä‘á»ƒ Ä‘áº¡i diá»‡n cho â€œkhÃ´ng cÃ³ giÃ¡ trá»‹â€ nÃ©m exception Ä‘á»ƒ biá»ƒu diá»…n lá»—i Nhá»¯ng cÃ¡ch lÃ m nÃ y tá»“n táº¡i nhiá»u váº¥n Ä‘á»:\nNull quÃ¡ nguy hiá»ƒm â†’ dá»… dáº«n tá»›i null pointer exception. Exception khÃ³ kiá»ƒm soÃ¡t â†’ hÃ m cÃ³ thá»ƒ throw báº¥t ká»³ lÃºc nÃ o. Kiá»ƒu dá»¯ liá»‡u khÃ´ng diá»…n Ä‘áº¡t Ä‘Æ°á»£c tráº¡ng thÃ¡i tháº­t â†’ vÃ­ dá»¥ hÃ m getUser() tráº£ vá» User | null, ráº¥t mÆ¡ há»“. if/else chá»“ng cháº¥t â†’ logic dá»… vá»¡, khÃ³ má»Ÿ rá»™ng. KhÃ´ng buá»™c compiler kiá»ƒm tra Ä‘áº§y Ä‘á»§ cÃ¡c nhÃ¡nh â†’ dá»… bá» sÃ³t trÆ°á»ng há»£p. Khi há»‡ thá»‘ng lá»›n lÃªn, viá»‡c quáº£n lÃ½ cÃ¡c tráº¡ng thÃ¡i dáº¡ng \u0026ldquo;má»™t trong nhiá»u kháº£ nÄƒng\u0026rdquo; trá»Ÿ nÃªn phá»©c táº¡p. ÄÃ¢y chÃ­nh lÃ  lÃºc Sum Type vÃ  Pattern Matching trá»Ÿ thÃ nh giáº£i phÃ¡p máº¡nh máº½.\n2. Giáº£i phÃ¡p: Sum Type + Pattern Matching 2.1 Sum Type lÃ  gÃ¬? Sum Type (cÃ²n gá»i lÃ  Tagged Union, Discriminated Union, Variant Types, Union Types an toÃ n) lÃ  kiá»ƒu dá»¯ liá»‡u mÃ´ táº£ má»™t giÃ¡ trá»‹ cÃ³ thá»ƒ á»Ÿ má»™t trong nhiá»u dáº¡ng, nhÆ°ng chá»‰ má»™t dáº¡ng táº¡i má»™t thá»i Ä‘iá»ƒm.\nVÃ­ dá»¥ â€“ má»™t káº¿t quáº£ cá»§a API cÃ³ thá»ƒ lÃ :\n1 Result = Success(data) | Failure(error) Tá»©c lÃ :\nHoáº·c thÃ nh cÃ´ng â†’ cÃ³ data Hoáº·c tháº¥t báº¡i â†’ cÃ³ lá»—i KhÃ´ng cÃ³ trÆ°á»ng há»£p nÃ o khÃ¡c Äiá»u nÃ y an toÃ n hÆ¡n ráº¥t nhiá»u so vá»›i null, boolean flag, hay exception.\n2.2 Pattern Matching lÃ  gÃ¬? Pattern Matching lÃ  ká»¹ thuáº­t so khá»›p cáº¥u trÃºc cá»§a Sum Type Ä‘á»ƒ xá»­ lÃ½ tá»«ng trÆ°á»ng há»£p má»™t cÃ¡ch rÃµ rÃ ng vÃ  tÆ°á»ng minh.\nThay vÃ¬:\n1 2 if (result.status === \u0026#34;success\u0026#34;) { ... } else if (result.status === \u0026#34;error\u0026#34;) { ... } Báº¡n viáº¿t:\n1 2 3 4 match(result) .with({ type: \u0026#34;success\u0026#34; }, ({ data }) =\u0026gt; ...) .with({ type: \u0026#34;error\u0026#34; }, ({ error }) =\u0026gt; ...) .exhaustive(); .exhaustive() buá»™c compiler kiá»ƒm tra táº¥t cáº£ nhÃ¡nh Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½ â†’ khÃ´ng cho phÃ©p quÃªn case.\n3. á»¨ng dá»¥ng cá»§a Sum Type + Pattern Matching 3.1 Quáº£n lÃ½ lá»—i (thay tháº¿ exception) Trong nhiá»u ngÃ´n ngá»¯ hiá»‡n Ä‘áº¡i (Rust, Haskell, TS, Swiftâ€¦):\n1 Result\u0026lt;T, E\u0026gt; = Ok(T) | Err(E) Lá»£i Ã­ch:\nKhÃ´ng throw lung tung â†’ flow logic dá»… dá»± Ä‘oÃ¡n. Compiler Ã©p pháº£i xá»­ lÃ½ Ä‘áº§y Ä‘á»§. Code test vÃ  code gá»i hÃ m rÃµ rÃ ng hÆ¡n. 3.2 Thay tháº¿ null báº±ng Option 1 Option\u0026lt;T\u0026gt; = Some(T) | None á»¨ng dá»¥ng:\nOptional field GiÃ¡ trá»‹ cÃ³ thá»ƒ tá»“n táº¡i hoáº·c khÃ´ng TrÃ¡nh null pointer exception 3.3 Biá»ƒu diá»…n tráº¡ng thÃ¡i domain VÃ­ dá»¥ tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng:\n1 OrderState = Created | Paid | Shipping | Completed | Cancelled Pattern Matching Ä‘áº£m báº£o má»i trÆ°á»ng há»£p Ä‘á»u Ä‘Æ°á»£c xá»­ lÃ½ khi viáº¿t workflow.\n3.4 Xá»­ lÃ½ API response 1 2 3 4 ApiResponse = | { type: \u0026#34;loading\u0026#34; } | { type: \u0026#34;error\u0026#34;; message: string } | { type: \u0026#34;success\u0026#34;; data: User } Pattern Matching loáº¡i bá» if/else cá»“ng ká»nh â†’ UI logic ráº¥t sáº¡ch.\n3.5 State Machine / Workflow Engine Sum Type cá»±c phÃ¹ há»£p cho mÃ´ hÃ¬nh State Machine vÃ¬ báº£n cháº¥t nÃ³ mÃ´ táº£ cÃ¡c tráº¡ng thÃ¡i rá»i ráº¡c.\n4. Káº¿t luáº­n Sum Type + Pattern Matching lÃ  má»™t tÆ° duy kiá»ƒu dá»¯ liá»‡u hiá»‡n Ä‘áº¡i giÃºp:\nLoáº¡i bá» null Loáº¡i bá» exception trÃ n lan Ã‰p compiler kiá»ƒm tra Ä‘áº§y Ä‘á»§ â†’ code an toÃ n hÆ¡n Biá»ƒu diá»…n domain rÃµ rÃ ng ÄÆ¡n giáº£n hÃ³a state machine Giáº£m if/else, giáº£m bug ","date":"2025-11-25T00:40:00+08:00","permalink":"https://phongthien99.github.io/posts/sum-type-and-pattern-matching/","title":"Sum Type and Pattern Matching"},{"content":"Log Observability with Fluent Bit, Loki and Grafana 1. Äáº·t váº¥n Ä‘á» Trong ká»· nguyÃªn cá»§a há»‡ thá»‘ng phÃ¢n tÃ¡n vÃ  microservices, log Ä‘Ã£ trá»Ÿ thÃ nh â€œdÃ²ng mÃ¡uâ€ nuÃ´i dÆ°á»¡ng kháº£ nÄƒng quan sÃ¡t cá»§a toÃ n bá»™ ná»n táº£ng. Tháº¿ nhÆ°ng, chÃ­nh bá»Ÿi sá»± phÃ¢n tÃ¡n cá»§a á»©ng dá»¥ng â€” má»—i container, má»—i node, má»—i dá»‹ch vá»¥ láº¡i sinh log á»Ÿ má»™t nÆ¡i khÃ¡c nhau â€” viá»‡c táº­p trung vÃ  phÃ¢n tÃ­ch log trá»Ÿ thÃ nh má»™t thÃ¡ch thá»©c khÃ´ng há» nhá».\nNhiá»u tá»• chá»©c váº«n phá»¥ thuá»™c vÃ o phÆ°Æ¡ng phÃ¡p xem log truyá»n thá»‘ng: truy cáº­p tá»«ng container, Ä‘á»c tá»«ng file, hoáº·c sá»­ dá»¥ng nhá»¯ng giáº£i phÃ¡p náº·ng ná» nhÆ° ELK. DÃ¹ máº¡nh máº½, ELK láº¡i tiÃªu tá»‘n lÆ°á»£ng tÃ i nguyÃªn khá»•ng lá»“, khÃ³ má»Ÿ rá»™ng, vÃ  chi phÃ­ váº­n hÃ nh khÃ´ng dá»… chá»‹u.\nTrong bá»‘i cáº£nh Ä‘Ã³, nhu cáº§u vá» má»™t há»‡ thá»‘ng gá»n nháº¹ hÆ¡n, dá»… triá»ƒn khai hÆ¡n vÃ  chi phÃ­ tháº¥p hÆ¡n trá»Ÿ nÃªn cáº¥p bÃ¡ch. Má»™t giáº£i phÃ¡p cÃ³ thá»ƒ thu gom log tá»« nhiá»u nguá»“n, lÆ°u trá»¯ thÃ´ng minh mÃ  khÃ´ng â€œngá»‘nâ€ tÃ i nguyÃªn nhÆ° Elasticsearch, Ä‘á»“ng thá»i váº«n Ä‘em láº¡i tráº£i nghiá»‡m quan sÃ¡t máº¡nh máº½ qua giao diá»‡n trá»±c quan. CÃ¢u tráº£ lá»i cho bÃ i toÃ¡n áº¥y chÃ­nh lÃ  sá»± káº¿t há»£p giá»¯a Fluent Bit, Loki vÃ  Grafana.\n2. Giáº£i phÃ¡p: Fluent Bit â†’ Loki â†’ Grafana 2.1 Kiáº¿n trÃºc tá»•ng quan 1 2 3 4 5 6 7 8 9 10 [Application Log] â†“ Fluent Bit (collector) â†“ Loki (storage/index) â†“ Grafana (visualization) 2.2 Vai trÃ² tá»«ng há»‡ thá»‘ng Fluent Bit: agent nháº¹, láº¥y log tá»« file/container vÃ  gá»­i vá» Loki qua HTTP. Loki: lÆ°u log theo mÃ´ hÃ¬nh index tá»‘i giáº£n â†’ giáº£m chi phÃ­. Grafana: dashboard trá»±c quan, query báº±ng LogQL. 2.3 Æ¯u Ä‘iá»ƒm cá»§a giáº£i phÃ¡p TiÃªu chÃ­ Fluent Bit + Loki + Grafana TÃ i nguyÃªn Ráº¥t tháº¥p Triá»ƒn khai Dá»…, chá»‰ cáº§n Docker/K8s Chi phÃ­ Tá»‘i Æ°u hÆ¡n ELK TÃ¬m kiáº¿m log Máº¡nh vá»›i LogQL TÆ°Æ¡ng thÃ­ch Tuyá»‡t vá»i vá»›i Kubernetes Bá»™ ba nÃ y Ä‘áº·c biá»‡t phÃ¹ há»£p vá»›i doanh nghiá»‡p muá»‘n tá»‘i Æ°u tÃ i nguyÃªn, giáº£m chi phÃ­, vÃ  tÄƒng kháº£ nÄƒng observability.\n3. Thá»±c nghiá»‡m triá»ƒn khai báº±ng Docker Compose 3.1 Má»¥c tiÃªu thá»±c nghiá»‡m Sinh log thá»§ cÃ´ng tá»« má»™t container demo. Thu gom log báº±ng Fluent Bit. LÆ°u log táº¡i Loki. Hiá»ƒn thá»‹ log trÃªn Grafana. 3.2 Cáº¥u hÃ¬nh Docker Compose 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 version: \u0026#34;3.3\u0026#34; networks: loki: volumes: logs: services: loki: image: grafana/loki:latest ports: - \u0026#34;3100:3100\u0026#34; command: -config.file=/etc/loki/local-config.yaml networks: - loki grafana: environment: - GF_PATHS_PROVISIONING=/etc/grafana/provisioning - GF_AUTH_ANONYMOUS_ENABLED=true - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin - GF_FEATURE_TOGGLES_ENABLE=alertingSimplifiedRouting,alertingQueryAndExpressionsStepMode entrypoint: - sh - -euc - | mkdir -p /etc/grafana/provisioning/datasources cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/grafana/provisioning/datasources/ds.yaml apiVersion: 1 datasources: - name: Loki type: loki access: proxy orgId: 1 url: http://loki:3100 basicAuth: false isDefault: true version: 1 editable: false EOF /run.sh image: grafana/grafana:latest ports: - \u0026#34;3000:3000\u0026#34; networks: - loki # App demo sinh log app: image: busybox command: sh -c \u0026#34;while true; do echo \u0026#39;Hello World from demo app\u0026#39; \u0026gt;\u0026gt; /logs/app.log; sleep 2; done\u0026#34; volumes: - logs:/logs # Fluent Bit fluent-bit: image: fluent/fluent-bit:2.2 volumes: - ./fluent-bit-config:/fluent-bit/etc - logs:/logs:ro depends_on: - app - loki networks: - loki 3.3 Cáº¥u hÃ¬nh Fluent Bit fluent-bit.conf:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 [SERVICE] Flush 2 Log_Level info Parsers_File parsers.conf [INPUT] Name tail Path /logs/*.log Tag app.* DB /fluent-bit/tail.db Parser docker [FILTER] Name record_modifier Match * Record stream /logs/app.log Record source app [OUTPUT] Name loki Match * host loki port 3100 labels app=demo-app Ã nghÄ©a:\nFluent Bit tail file log, gáº¯n label app=demo-app, gá»­i vá» Loki.\n3.4 Cáº¥u hÃ¬nh Loki loki.yaml:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 auth_enabled: false server: http_listen_port: 3100 grpc_listen_port: 9096 log_level: debug grpc_server_max_concurrent_streams: 1000 common: instance_addr: 127.0.0.1 path_prefix: /tmp/loki storage: filesystem: chunks_directory: /tmp/loki/chunks rules_directory: /tmp/loki/rules replication_factor: 1 ring: kvstore: store: inmemory query_range: results_cache: cache: embedded_cache: enabled: true max_size_mb: 100 limits_config: metric_aggregation_enabled: true schema_config: configs: - from: 2020-10-24 store: tsdb object_store: filesystem schema: v13 index: prefix: index_ period: 24h pattern_ingester: enabled: true metric_aggregation: loki_address: localhost:3100 ruler: alertmanager_url: http://localhost:9093 frontend: encoding: protobuf # By default, Loki will send anonymous, but uniquely-identifiable usage and configuration # analytics to Grafana Labs. These statistics are sent to https://stats.grafana.org/ # # Statistics help us better understand how Loki is used, and they show us performance # levels for most users. This helps us prioritize features and documentation. # For more information on what\u0026#39;s sent, look at # https://github.com/grafana/loki/blob/main/pkg/analytics/stats.go # Refer to the buildReport method to see what goes into a report. # # If you would like to disable reporting, uncomment the following lines: #analytics: # reporting_enabled: false 3.5 Quan sÃ¡t log trong Grafana Truy cáº­p Grafana táº¡i http://localhost:3000 Chá»n Explore Chon Loki Query thá»­: 1 Expr: {app=\u0026#34;demo-app\u0026#34;} |= `` 4. Káº¿t luáº­n Trong bá»‘i cáº£nh chi phÃ­ háº¡ táº§ng luÃ´n lÃ  má»‘i quan tÃ¢m hÃ ng Ä‘áº§u, giáº£i phÃ¡p nÃ y mang láº¡i sá»± cÃ¢n báº±ng hiáº¿m cÃ³ giá»¯a hiá»‡u suáº¥t, chi phÃ­ vÃ  kháº£ nÄƒng má»Ÿ rá»™ng. NÃ³ khÃ´ng chá»‰ giÃºp Ä‘á»™i ngÅ© váº­n hÃ nh tháº¥y rÃµ hÆ¡n hoáº¡t Ä‘á»™ng cá»§a há»‡ thá»‘ng, mÃ  cÃ²n táº¡o ná»n táº£ng vá»¯ng vÃ ng cho cÃ¡c chiáº¿n lÆ°á»£c quan sÃ¡t sÃ¢u rá»™ng hÆ¡n sau nÃ y, nhÆ° alerting hoáº·c káº¿t há»£p metricâ€“logâ€“trace.\nNáº¿u má»¥c tiÃªu cá»§a báº¡n lÃ  xÃ¢y dá»±ng má»™t há»‡ thá»‘ng quan sÃ¡t log tinh gá»n, dá»… quáº£n trá»‹ vÃ  hiá»‡u quáº£, bá»™ Fluent Bit â€“ Loki â€“ Grafana xá»©ng Ä‘Ã¡ng náº±m trong danh sÃ¡ch Æ°u tiÃªn hÃ ng Ä‘áº§u.\n","date":"2025-11-21T00:00:00Z","permalink":"https://phongthien99.github.io/posts/log-observability-with-fluent-bit-loki-and-grafana/","title":"Log Observability with Fluent Bit, Loki and Grafana"},{"content":"1. Giá»›i thiá»‡u vá» Infrastructure as Code (IaC) Infrastructure as Code (IaC) lÃ  phÆ°Æ¡ng phÃ¡p quáº£n lÃ½ vÃ  triá»ƒn khai háº¡ táº§ng báº±ng cÃ¡ch mÃ´ táº£ chÃºng dÆ°á»›i dáº¡ng mÃ£ nguá»“n. Thay vÃ¬ thao tÃ¡c thá»§ cÃ´ng trÃªn giao diá»‡n cloud hoáº·c Ä‘Äƒng nháº­p vÃ o server Ä‘á»ƒ cáº¥u hÃ¬nh, má»i thá»© Ä‘Æ°á»£c mÃ´ táº£ báº±ng code vÃ  thá»±c thi tá»± Ä‘á»™ng.\nIaC biáº¿n háº¡ táº§ng thÃ nh má»™t pháº§n cá»§a codebase:\ncÃ³ version cÃ³ code review cÃ³ CI/CD cÃ³ kháº£ nÄƒng rollback cÃ³ thá»ƒ tÃ¡i sá»­ dá»¥ng vÃ  nhÃ¢n báº£n mÃ´i trÆ°á»ng Khi há»‡ thá»‘ng ngÃ y cÃ ng phá»©c táº¡p, IaC trá»Ÿ thÃ nh ná»n táº£ng quan trá»ng Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh á»•n Ä‘á»‹nh vÃ  tá»‘c Ä‘á»™ cá»§a DevOps/Platform Engineering.\n2. Lá»£i Ã­ch cá»§a IaC 2.1. Tá»± Ä‘á»™ng hÃ³a toÃ n diá»‡n Má»i bÆ°á»›c tá»« táº¡o háº¡ táº§ng Ä‘áº¿n cáº¥u hÃ¬nh á»©ng dá»¥ng Ä‘á»u cÃ³ thá»ƒ cháº¡y chá»‰ báº±ng má»™t lá»‡nh.\nGiáº£m thá»i gian triá»ƒn khai tá»« hÃ ng ngÃ y xuá»‘ng vÃ i phÃºt.\n2.2. Nháº¥t quÃ¡n giá»¯a cÃ¡c mÃ´i trÆ°á»ng Dev/Staging/Prod giá»‘ng nhau 100%.\nKhÃ´ng cÃ²n tÃ¬nh tráº¡ng â€œcháº¡y á»Ÿ mÃ¡y tao thÃ¬ Ä‘Æ°á»£câ€.\n2.3. Dá»… kiá»ƒm soÃ¡t \u0026amp; audit Do IaC náº±m trong Git:\nghi láº¡i lá»‹ch sá»­ thay Ä‘á»•i quy trÃ¬nh review rÃµ rÃ ng dá»… dÃ ng rollback 2.4. Giáº£m lá»—i con ngÆ°á»i Bá»›t thao tÃ¡c thá»§ cÃ´ng â†’ Ã­t cáº¥u hÃ¬nh sai â†’ Ã­t downtime.\n2.5. Má»Ÿ rá»™ng, tÃ¡i sá»­ dá»¥ng \u0026amp; chuáº©n hÃ³a Báº¡n cÃ³ thá»ƒ táº¡o module, role hoáº·c template Ä‘á»ƒ táº¡o thÃªm mÃ´i trÆ°á»ng má»›i nhanh chÃ³ng.\n3. CÃ¡c loáº¡i IaC chÃ­nh vÃ  cÃ¡c cÃ´ng cá»¥ tÆ°Æ¡ng á»©ng IaC trong thá»±c táº¿ luÃ´n xoay quanh hai nhÃ³m nhiá»‡m vá»¥ lá»›n nháº¥t:\n3.1. Infrastructure Provisioning ÄÃ¢y lÃ  nhÃ³m cÃ´ng cá»¥ dÃ¹ng Ä‘á»ƒ táº¡o, thay Ä‘á»•i vÃ  quáº£n lÃ½ tÃ i nguyÃªn háº¡ táº§ng:\nVM / Server VPC, Subnet, Security Group Database service (RDS, Aurora, Cloud SQLâ€¦) Load Balancer Kubernetes cluster Object storage, Messaging serviceâ€¦ Má»¥c tiÃªu: mÃ´ táº£ tráº¡ng thÃ¡i mong muá»‘n (desired state) vÃ  Ä‘á»ƒ tool thá»±c hiá»‡n.\nÄáº·c Ä‘iá»ƒm: Declarative (khai bÃ¡o tráº¡ng thÃ¡i) Quáº£n lÃ½ lifecycle (create â†’ update â†’ destroy) Dá»±a trÃªn state Ä‘á»ƒ Ä‘áº£m báº£o idempotent PhÃ¹ há»£p cho cloud-native infra VÃ­ dá»¥ cÃ´ng cá»¥: Terraform â€“ phá»• biáº¿n nháº¥t, cloud-agnostic AWS CloudFormation â€“ native cá»§a AWS Pulumi â€“ IaC dÃ¹ng TypeScript, Python, Go Azure Bicep, Google Deployment Manager 3.2. Configuration Management NhÃ³m cÃ´ng cá»¥ nÃ y dÃ¹ng Ä‘á»ƒ cáº¥u hÃ¬nh pháº§n má»m vÃ  mÃ´i trÆ°á»ng bÃªn trong server:\ncÃ i Ä‘áº·t package cáº¥u hÃ¬nh file khá»Ÿi táº¡o user, quyá»n deploy á»©ng dá»¥ng cáº¥u hÃ¬nh service (Nginx, MySQL, ClickHouse, Docker) quáº£n lÃ½ OS-level tasks Má»¥c tiÃªu: Ä‘iá»u khiá»ƒn mÃ¡y chá»§ á»Ÿ táº§ng há»‡ Ä‘iá»u hÃ nh vÃ  á»©ng dá»¥ng.\nÄáº·c Ä‘iá»ƒm: Chá»§ yáº¿u imperative (má»‡nh lá»‡nh tá»«ng bÆ°á»›c) Cháº¡y qua SSH hoáº·c agent PhÃ¹ há»£p cho config server vÃ  deploy app VÃ­ dá»¥ cÃ´ng cá»¥: Ansible â€“ phá»• biáº¿n nháº¥t, agentless Chef / Puppet â€“ dÃ¹ng agent SaltStack Ansible + SSH / Inventory dynamic Káº¿t há»£p hai loáº¡i IaC trong thá»±c táº¿ MÃ´ hÃ¬nh chuáº©n production:\n1 2 3 Terraform â†’ táº¡o háº¡ táº§ng â†“ Ansible â†’ cÃ i Ä‘áº·t \u0026amp; cáº¥u hÃ¬nh bÃªn trong server VÃ­ dá»¥ ráº¥t phá»• biáº¿n:\nTerraform táº¡o EC2 + Security Group â†’ Ansible cÃ i ClickHouse Terraform táº¡o Kubernetes cluster â†’ Helm deploy workload Terraform táº¡o RDS â†’ Ansible seed data hoáº·c cáº¥u hÃ¬nh á»©ng dá»¥ng káº¿t ná»‘i ÄÃ¢y lÃ  mÃ´ hÃ¬nh hybrid Ä‘Æ°á»£c háº§u háº¿t cÃ¡c team DevOps hiá»‡n nay sá»­ dá»¥ng.\n4. Káº¿t luáº­n Infrastructure as Code (IaC) ngÃ y nay khÃ´ng chá»‰ lÃ  má»™t ká»¹ thuáº­t mÃ  Ä‘Ã£ trá»Ÿ thÃ nh ná»n táº£ng cá»‘t lÃµi cá»§a cÃ¡ch váº­n hÃ nh háº¡ táº§ng hiá»‡n Ä‘áº¡i. Báº±ng viá»‡c mÃ´ táº£ toÃ n bá»™ mÃ´i trÆ°á»ng dÆ°á»›i dáº¡ng mÃ£ nguá»“n, IaC giÃºp Ä‘á»™i ngÅ© DevOps vÃ  Platform Engineering triá»ƒn khai há»‡ thá»‘ng nhanh hÆ¡n, chÃ­nh xÃ¡c hÆ¡n vÃ  Ã­t phá»¥ thuá»™c vÃ o thao tÃ¡c thá»§ cÃ´ng.\nKhi chia IaC thÃ nh hai nhÃ³m chÃ­nh â€” Infrastructure Provisioning vÃ  Configuration Management â€” chÃºng ta cÃ³ má»™t mÃ´ hÃ¬nh rÃµ rÃ ng vÃ  thá»±c tiá»…n Ä‘á»ƒ xÃ¢y dá»±ng pipeline tá»± Ä‘á»™ng hÃ³a. CÃ´ng cá»¥ Provisioning Ä‘áº£m báº£o háº¡ táº§ng cloud Ä‘Æ°á»£c táº¡o vÃ  quáº£n lÃ½ á»•n Ä‘á»‹nh theo state; trong khi Ä‘Ã³ cÃ´ng cá»¥ Configuration Management giÃºp cáº¥u hÃ¬nh mÃ¡y chá»§ vÃ  á»©ng dá»¥ng theo cÃ¡ch linh hoáº¡t vÃ  cÃ³ thá»ƒ láº·p láº¡i.\nSá»± káº¿t há»£p nÃ y táº¡o ra má»™t quy trÃ¬nh triá»ƒn khai máº¡nh máº½, cho phÃ©p tá»• chá»©c dá»… dÃ ng má»Ÿ rá»™ng, quáº£n lÃ½ nhiá»u mÃ´i trÆ°á»ng vÃ  giáº£m thiá»ƒu rá»§i ro cáº¥u hÃ¬nh sai lá»‡ch. IaC vÃ¬ váº­y trá»Ÿ thÃ nh chÃ¬a khÃ³a giÃºp doanh nghiá»‡p váº­n hÃ nh hiá»‡u quáº£ hÆ¡n, tÄƒng tá»‘c phÃ¡t triá»ƒn sáº£n pháº©m vÃ  xÃ¢y dá»±ng ná»n táº£ng ká»¹ thuáº­t á»•n Ä‘á»‹nh cho tÆ°Æ¡ng lai.\n","date":"2025-11-17T00:40:00+08:00","permalink":"https://phongthien99.github.io/posts/infrastructure-as-code-iac-automating-infrastructure-management/","title":"Infrastructure as Code (IaC): Automating Infrastructure Management"},{"content":"Feature-Centric Architecture with Clean Principle HÆ°á»›ng dáº«n tá»• chá»©c code theo feature vá»›i Clean Architecture Ä‘á»ƒ xÃ¢y dá»±ng á»©ng dá»¥ng dá»… báº£o trÃ¬ vÃ  má»Ÿ rá»™ng\n1. Äáº·t váº¥n Ä‘á» Trong cÃ¡c dá»± Ã¡n React/Next.js truyá»n thá»‘ng, code thÆ°á»ng Ä‘Æ°á»£c tá»• chá»©c theo technical layers nhÆ° components/, hooks/, services/, types/, utils/. Má»—i folder gom táº¥t cáº£ file cÃ¹ng loáº¡i, dáº«n Ä‘áº¿n nhiá»u váº¥n Ä‘á» khi dá»± Ã¡n lá»›n:\nKhÃ³ tÃ¬m kiáº¿m vÃ  Ä‘iá»u hÆ°á»›ng: Muá»‘n thay Ä‘á»•i má»™t feature, developer pháº£i nháº£y qua nhiá»u folder (UI, logic, API, types, utils), máº¥t thá»i gian vÃ  khÃ³ náº¯m tá»•ng thá»ƒ. Dependencies rá»‘i ráº¯m: Component import tá»« nhiá»u layer, khÃ³ xÃ¡c Ä‘á»‹nh áº£nh hÆ°á»Ÿng khi thay Ä‘á»•i, dá»… circular dependency vÃ  test phá»©c táº¡p. Code duplication \u0026amp; inconsistency: Logic giá»‘ng nhau nhÆ°ng khÃ¡c nhau giá»¯a cÃ¡c component, dáº«n Ä‘áº¿n bug, tá»‘n cÃ´ng sá»­a vÃ  test. Coupling giá»¯a features: Feature nÃ y phá»¥ thuá»™c nhiá»u feature khÃ¡c, khÃ³ tÃ¡ch riÃªng, khÃ³ reuse vÃ  tree-shaking kÃ©m hiá»‡u quáº£. KhÃ³ má»Ÿ rá»™ng \u0026amp; parallel development: Service chá»©a táº¥t cáº£ logic domain dáº«n Ä‘áº¿n Git conflict, khÃ³ phÃ¢n cÃ´ng task, file lá»›n gÃ¢y khÃ³ review. Äá»ƒ kháº¯c phá»¥c, cáº§n feature-based organization, tá»©c tá»• chá»©c code theo tá»«ng feature thay vÃ¬ loáº¡i file. CÃ¡ch nÃ y giÃºp code liÃªn quan gáº§n nhau, Ä‘á»™c láº­p, dá»… tÃ¬m, dá»… test, má»Ÿ rá»™ng nhanh vÃ  giáº£m bugs, cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ maintainability vÃ  kháº£ nÄƒng phÃ¡t triá»ƒn song song.\n2. Giáº£i phÃ¡p 2.1. Feature-Based Organization vá»›i Clean Architecture Thay vÃ¬ tá»• chá»©c theo technical layers, chÃºng ta tá»• chá»©c theo business features káº¿t há»£p vá»›i Clean Architecture principles:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 src/app/ â”œâ”€â”€ login/ # âœ… FEATURE: Login â”‚ â”œâ”€â”€ components/ # UI cá»§a feature â”‚ â”œâ”€â”€ hooks/ # Application logic â”‚ â”œâ”€â”€ context/ # Shared context â”‚ â”œâ”€â”€ entities/ # Domain models â”‚ â”œâ”€â”€ dto/ # Data transfer objects â”‚ â”œâ”€â”€ interfaces/ # Contracts â”‚ â”œâ”€â”€ usecases/ # Business logic â”‚ â”œâ”€â”€ repositories/ # Data access â”‚ â”œâ”€â”€ providers/ # Infrastructure â”‚ â””â”€â”€ page.tsx # Entry point â”‚ â”œâ”€â”€ signup/ # âœ… FEATURE: Signup 2.2. Kiáº¿n TrÃºc Tá»•ng Quan cá»§a má»—i feature graph TB subgraph \"Presentation Layer\" components[components/] pages[page.tsx] providers[providers/] end subgraph \"Application Layer\" hooks[hooks/] end subgraph \"Shared Context Layer\" context[context/] end subgraph \"Domain Layer\" entities[entities/] dto[dto/] interfaces[interfaces/] usecases[usecases/] end subgraph \"Infrastructure Layer\" repositories[repositories/] end pages --\u003e providers pages --\u003e components components --\u003e hooks components --\u003e usecases hooks --\u003e context providers --\u003e context context --\u003e interfaces hooks --\u003e entities hooks --\u003e dto repositories --\u003e interfaces repositories --\u003e entities repositories --\u003e dto providers --\u003e repositories usecases --\u003e dto style context fill:#FF1493,stroke:#C71585,stroke-width:4px style entities fill:#90EE90,stroke:#2ecc71,stroke-width:2px style dto fill:#90EE90,stroke:#2ecc71,stroke-width:2px style interfaces fill:#90EE90,stroke:#2ecc71,stroke-width:2px style usecases fill:#90EE90,stroke:#2ecc71,stroke-width:2px style repositories fill:#FFD700,stroke:#f39c12,stroke-width:2px style providers fill:#FFD700,stroke:#f39c12,stroke-width:2px style hooks fill:#DDA0DD,stroke:#9b59b6,stroke-width:2px style components fill:#74b9ff,stroke:#3498db,stroke-width:2px style pages fill:#74b9ff,stroke:#3498db,stroke-width:2px 2.3. NguyÃªn Táº¯c Thiáº¿t Káº¿ NguyÃªn táº¯c 1: Feature Isolation 1 2 3 4 5 // âœ… Má»—i feature lÃ  self-contained src/app/login/ - CÃ³ Ä‘áº§y Ä‘á»§ layers riÃªng - KhÃ´ng phá»¥ thuá»™c vÃ o features khÃ¡c - CÃ³ thá»ƒ extract thÃ nh package Ä‘á»™c láº­p NguyÃªn táº¯c 2: Layer Dependency Rule 1 2 3 4 Presentation â†’ Application â†’ Domain â† Infrastructure â†‘ KhÃ´ng phá»¥ thuá»™c vÃ o outer layers NguyÃªn táº¯c 3: Context Layer cho DI 1 2 3 4 hooks/ â”€â”€â”€â”€â”€â”€â” â”œâ”€â”€â†’ context/ â”€â”€â†’ interfaces/ providers/ â”€â”€â”˜ 3. Thá»±c hiá»‡n 3.1. Cáº¥u TrÃºc Chi Tiáº¿t Má»™t Feature Example: Login Feature 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 src/app/login/ â”‚ â”œâ”€â”€ components/ # PRESENTATION LAYER â”‚ â”œâ”€â”€ LoginForm.tsx # Main form component â”‚ â”œâ”€â”€ LoginButton.tsx # Reusable button â”‚ â””â”€â”€ SocialLoginButtons.tsx # Social auth buttons â”‚ â”œâ”€â”€ hooks/ # APPLICATION LAYER â”‚ â”œâ”€â”€ UseLogin.ts # Login logic hook â”‚ â”œâ”€â”€ useAuthRepository.ts # Repository access hook â”‚ â””â”€â”€ useLoginValidation.ts # Validation hook â”‚ â”œâ”€â”€ context/ # SHARED CONTEXT LAYER â”‚ â”œâ”€â”€ AuthContext.tsx # Context definition â”‚ â””â”€â”€ index.ts # Exports â”‚ â”œâ”€â”€ entities/ # DOMAIN LAYER - Models â”‚ â”œâ”€â”€ User.ts # User entity â”‚ â””â”€â”€ AuthSession.ts # Session entity â”‚ â”œâ”€â”€ dto/ # DOMAIN LAYER - DTOs â”‚ â””â”€â”€ LoginTypes.ts # Request/Response types â”‚ â”œâ”€â”€ interfaces/ # DOMAIN LAYER - Contracts â”‚ â”œâ”€â”€ IAuthRepository.ts # Repository interface â”‚ â”œâ”€â”€ IAuthenticator.ts # Authenticator interface â”‚ â”œâ”€â”€ ISessionManager.ts # Session manager interface â”‚ â””â”€â”€ index.ts # Exports â”‚ â”œâ”€â”€ usecases/ # DOMAIN LAYER - Business Logic â”‚ â””â”€â”€ LoginLogic.ts # Pure business functions â”‚ â”œâ”€â”€ repositories/ # INFRASTRUCTURE LAYER - Data Access â”‚ â”œâ”€â”€ ApiAuthRepository.ts # API implementation â”‚ â””â”€â”€ LocalStorageAuthRepository.ts # LocalStorage implementation â”‚ â”œâ”€â”€ providers/ # INFRASTRUCTURE LAYER - DI â”‚ â””â”€â”€ AuthProvider.tsx # Context provider â”‚ â”œâ”€â”€ page.tsx # Route entry point â”œâ”€â”€ index.ts # Public API exports â””â”€â”€ README.md # Feature documentation 3.2. Implementation Examples 3.2.1. Context Layer 1 2 3 4 5 6 7 8 9 10 11 12 13 // context/AuthContext.tsx \u0026#34;use client\u0026#34;; import { createContext } from \u0026#34;react\u0026#34;; import type { IAuthRepository } from \u0026#34;../interfaces/IAuthRepository\u0026#34;; /** * Auth Context - Shared between providers and hooks * TÃ¡ch biá»‡t coupling giá»¯a Infrastructure vÃ  Application layers */ export const AuthContext = createContext\u0026lt;IAuthRepository | null\u0026gt;(null); export type AuthContextValue = IAuthRepository | null; 3.2.2. Domain Layer - Entities 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 // entities/AuthSession.ts /** * AuthSession Entity * Rich domain model vá»›i business logic */ export class AuthSession { constructor( public readonly token: string, public readonly user: User, public readonly expiresAt: Date, public readonly refreshToken?: string, ) {} /** * Business logic: Check if expired */ isExpired(): boolean { return new Date() \u0026gt; this.expiresAt; } /** * Business logic: Check if needs refresh */ needsRefresh(): boolean { const thirtyMinutes = 30 * 60 * 1000; return (this.expiresAt.getTime() - Date.now()) \u0026lt; thirtyMinutes; } /** * Persistence helper */ save(): void { if (typeof window === \u0026#39;undefined\u0026#39;) return; localStorage.setItem(\u0026#39;auth_session\u0026#39;, JSON.stringify(this.serialize())); } private serialize() { return { token: this.token, user: { id: this.user.id, email: this.user.email, name: this.user.name }, expiresAt: this.expiresAt.toISOString(), refreshToken: this.refreshToken, }; } /** * Factory method */ static fromResponse(data: any): AuthSession { const user = new User(data.user.id, data.user.email, data.user.name); return new AuthSession( data.token, user, new Date(data.expiresAt), data.refreshToken ); } } âœ¨ Lá»£i Ã­ch:\nâœ… Encapsulate business logic trong entity âœ… Self-validating, self-contained âœ… Dá»… test (pure logic) âœ… TÃ¡i sá»­ dá»¥ng trong toÃ n feature 3.2.3. Infrastructure Layer - Repositories 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 // repositories/ApiAuthRepository.ts import { IAuthRepository } from \u0026#34;../interfaces/IAuthRepository\u0026#34;; import { LoginInput } from \u0026#34;../dto/LoginTypes\u0026#34;; import { AuthSession } from \u0026#34;../entities/AuthSession\u0026#34;; /** * API Implementation of AuthRepository * Isolated data access logic */ export class ApiAuthRepository implements IAuthRepository { constructor(private readonly baseUrl: string = \u0026#34;/api/auth\u0026#34;) {} async login(input: LoginInput): Promise\u0026lt;AuthSession\u0026gt; { const res = await fetch(`${this.baseUrl}/login`, { method: \u0026#34;POST\u0026#34;, headers: { \u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34; }, body: JSON.stringify(input), }); if (!res.ok) { throw new Error(\u0026#34;Login failed\u0026#34;); } const data = await res.json(); return AuthSession.fromResponse(data); } async logout(): Promise\u0026lt;void\u0026gt; { await fetch(`${this.baseUrl}/logout`, { method: \u0026#34;POST\u0026#34; }); AuthSession.clear(); } getCurrentSession(): AuthSession | null { return AuthSession.load(); } } âœ¨ Lá»£i Ã­ch:\nâœ… Implement interface tá»« Domain âœ… Dá»… swap implementations (API â†’ LocalStorage) âœ… Testable vá»›i mock repository 3.2.4. Infrastructure Layer - Provider (DI) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 // providers/AuthProvider.tsx \u0026#34;use client\u0026#34;; import { useMemo, type ReactNode } from \u0026#34;react\u0026#34;; import { AuthContext } from \u0026#34;../context/AuthContext\u0026#34;; import type { IAuthRepository } from \u0026#34;../interfaces/IAuthRepository\u0026#34;; import { ApiAuthRepository } from \u0026#34;../repositories/ApiAuthRepository\u0026#34;; import { LocalStorageAuthRepository } from \u0026#34;../repositories/LocalStorageAuthRepository\u0026#34;; type AuthRepositoryType = \u0026#34;api\u0026#34; | \u0026#34;localStorage\u0026#34;; interface AuthProviderProps { children: ReactNode; type?: AuthRepositoryType; repository?: IAuthRepository; // For testing } /** * Auth Provider - Dependency Injection Container * Provide repository implementation to the feature */ export function AuthProvider({ children, type, repository }: AuthProviderProps) { const repositoryInstance = useMemo\u0026lt;IAuthRepository\u0026gt;(() =\u0026gt; { if (repository) return repository; const repoType = type || getDefaultType(); return repoType === \u0026#34;localStorage\u0026#34; ? new LocalStorageAuthRepository() : new ApiAuthRepository(); }, [type, repository]); return ( \u0026lt;AuthContext.Provider value={repositoryInstance}\u0026gt; {children} \u0026lt;/AuthContext.Provider\u0026gt; ); } function getDefaultType(): AuthRepositoryType { return process.env.NODE_ENV === \u0026#34;production\u0026#34; ? \u0026#34;api\u0026#34; : \u0026#34;localStorage\u0026#34;; } âœ¨ Lá»£i Ã­ch:\nâœ… Centralized dependency wiring âœ… Runtime configuration (api vs localStorage) âœ… Easy testing (inject mock repository) 3.2.5. Application Layer - Hooks 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // hooks/useAuthRepository.ts \u0026#34;use client\u0026#34;; import { useContext } from \u0026#34;react\u0026#34;; import { AuthContext } from \u0026#34;../context/AuthContext\u0026#34;; import type { IAuthRepository } from \u0026#34;../interfaces/IAuthRepository\u0026#34;; /** * Hook to access AuthRepository from Context * Application layer sá»­ dá»¥ng Infrastructure qua interface */ export function useAuthRepository(): IAuthRepository { const context = useContext(AuthContext); if (!context) { throw new Error(\u0026#34;useAuthRepository must be used within AuthProvider\u0026#34;); } return context; } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // hooks/UseLogin.ts \u0026#34;use client\u0026#34;; import { useMutation } from \u0026#34;@tanstack/react-query\u0026#34;; import { LoginInput } from \u0026#34;../dto/LoginTypes\u0026#34;; import { AuthSession } from \u0026#34;../entities/AuthSession\u0026#34;; import { useAuthRepository } from \u0026#34;./useAuthRepository\u0026#34;; /** * Login Hook - Application Business Logic * Orchestrate use case flow */ export function useLogin() { const authRepository = useAuthRepository(); const mutation = useMutation\u0026lt;AuthSession, Error, LoginInput\u0026gt;({ mutationFn: async (input: LoginInput) =\u0026gt; { return await authRepository.login(input); }, }); return mutation; } âœ¨ Lá»£i Ã­ch:\nâœ… Reusable application logic âœ… Access infrastructure via interface âœ… Type-safe vá»›i generics 3.2.6. Presentation Layer - Components 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 // components/LoginForm.tsx \u0026#34;use client\u0026#34;; import { useState } from \u0026#34;react\u0026#34;; import { useRouter } from \u0026#34;next/navigation\u0026#34;; import { Button } from \u0026#34;@/components/ui/button\u0026#34;; import { Input } from \u0026#34;@/components/ui/input\u0026#34;; import { useLogin } from \u0026#34;../hooks/UseLogin\u0026#34;; import { validateLogin } from \u0026#34;../usecases/LoginLogic\u0026#34;; /** * LoginForm Component - Pure UI * Chá»‰ lo rendering vÃ  user interaction */ export function LoginForm() { const router = useRouter(); const { mutate: login, isPending, error } = useLogin(); const [email, setEmail] = useState(\u0026#34;\u0026#34;); const [password, setPassword] = useState(\u0026#34;\u0026#34;); const [validationError, setValidationError] = useState(\u0026#34;\u0026#34;); const handleSubmit = async (e: React.FormEvent) =\u0026gt; { e.preventDefault(); setValidationError(\u0026#34;\u0026#34;); // Validate at UI level const validation = validateLogin({ email, password }); if (!validation.success) { setValidationError(validation.error); return; } // Execute business logic via hook login(validation.data, { onSuccess: (session) =\u0026gt; { session.save(); router.push(\u0026#34;/dashboard\u0026#34;); }, onError: (err) =\u0026gt; { setValidationError(err.message); }, }); }; return ( \u0026lt;form onSubmit={handleSubmit}\u0026gt; {validationError \u0026amp;\u0026amp; ( \u0026lt;div className=\u0026#34;text-red-500 text-sm\u0026#34;\u0026gt;{validationError}\u0026lt;/div\u0026gt; )} \u0026lt;Input type=\u0026#34;email\u0026#34; value={email} onChange={(e) =\u0026gt; setEmail(e.target.value)} disabled={isPending} /\u0026gt; \u0026lt;Input type=\u0026#34;password\u0026#34; value={password} onChange={(e) =\u0026gt; setPassword(e.target.value)} disabled={isPending} /\u0026gt; \u0026lt;Button type=\u0026#34;submit\u0026#34; disabled={isPending}\u0026gt; {isPending ? \u0026#34;Logging in...\u0026#34; : \u0026#34;Login\u0026#34;} \u0026lt;/Button\u0026gt; \u0026lt;/form\u0026gt; ); } âœ¨ Lá»£i Ã­ch:\nâœ… Component chá»‰ lo UI/UX âœ… Business logic trong hooks âœ… Validation á»Ÿ UI level âœ… Dá»… test (mock hooks) 3.2.7. Entry Point - Page 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // page.tsx import { AuthProvider } from \u0026#34;./providers/AuthProvider\u0026#34;; import { LoginForm } from \u0026#34;./components/LoginForm\u0026#34;; /** * Login Page - Feature Entry Point * Setup providers vÃ  render UI */ export default function LoginPage() { return ( \u0026lt;AuthProvider type=\u0026#34;localStorage\u0026#34;\u0026gt; \u0026lt;div className=\u0026#34;min-h-screen flex items-center justify-center\u0026#34;\u0026gt; \u0026lt;LoginForm /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/AuthProvider\u0026gt; ); } 4. Káº¿t luáº­n Kiáº¿n trÃºc Feature-Based káº¿t há»£p Clean Architecture mang láº¡i nhiá»u lá»£i Ã­ch rÃµ rÃ ng cho cÃ¡c á»©ng dá»¥ng React hiá»‡n Ä‘áº¡i, Ä‘áº·c biá»‡t lÃ  cÃ¡c dá»± Ã¡n quy mÃ´ trung bÃ¬nh vÃ  lá»›n.\nLá»£i Ã­ch chÃ­nh: Learning Curve: Má»©c trung bÃ¬nh lÃºc Ä‘áº§u nhÆ°ng nhanh chÃ³ng giáº£m nhá» feature isolation vÃ  dependency rÃµ rÃ ng. Maintenance Cost: Tháº¥p, dá»… refactor, kiá»ƒm soÃ¡t technical debt hiá»‡u quáº£. Development / Total Cost: Tháº¥p, tÄƒng tá»‘c Ä‘á»™ thÃªm feature, fix bug vÃ  viáº¿t test. Testability vÃ  Reusability: Cao, domain thuáº§n, usecase vÃ  entity dá»… tÃ¡i sá»­ dá»¥ng. Scalability: Cao, dá»… má»Ÿ rá»™ng module hoáº·c deploy Ä‘á»™c láº­p, há»— trá»£ parallel development vÃ  giáº£m xung Ä‘á»™t team. NhÆ°á»£c Ä‘iá»ƒm cáº§n lÆ°u Ã½: Initial Setup Complexity: Ban Ä‘áº§u cáº§n sáº¯p xáº¿p folder, context vÃ  dependency, cÃ³ thá»ƒ tá»‘n thá»i gian chuáº©n bá»‹. Learning Curve: ThÃ nh viÃªn má»›i cáº§n 1-2 ngÃ y lÃ m quen vá»›i tá»• chá»©c feature vÃ  context pattern. Overhead cho dá»± Ã¡n nhá»: Vá»›i dá»± Ã¡n Ä‘Æ¡n giáº£n, cáº¥u trÃºc nÃ y cÃ³ thá»ƒ hÆ¡i â€œover-engineeredâ€, nhÆ°ng váº«n giá»¯ ká»· luáº­t code vÃ  dá»… báº£o trÃ¬ náº¿u dá»± Ã¡n má»Ÿ rá»™ng sau nÃ y. TÃ³m láº¡i:\nFeature-Based + Clean Architecture lÃ  má»™t giáº£i phÃ¡p cÃ¢n báº±ng giá»¯a kháº£ nÄƒng má»Ÿ rá»™ng, maintainability, testability vÃ  tá»‘c Ä‘á»™ phÃ¡t triá»ƒn dÃ i háº¡n. Máº·c dÃ¹ cÃ³ chi phÃ­ thiáº¿t láº­p ban Ä‘áº§u vÃ  Ä‘Æ°á»ng cong há»c táº­p vá»«a pháº£i, nhÆ°ng vá» lÃ¢u dÃ i, kiáº¿n trÃºc nÃ y giÃºp giáº£m chi phÃ­ báº£o trÃ¬, technical debt, vÃ  tÄƒng tÃ­nh á»•n Ä‘á»‹nh, kháº£ nÄƒng má»Ÿ rá»™ng, vÃ  nÄƒng suáº¥t nhÃ³m.\n","date":"2025-11-08T11:09:00+07:00","permalink":"https://phongthien99.github.io/posts/feature-centric-architecture-with-clean-principle/","title":"Feature-Centric Architecture with Clean Principle"},{"content":"Standardizing Adapter Lifecycle in Frameworks with the Template Method Pattern 1. Äáº·t váº¥n Ä‘á» Trong má»™t framework ná»n táº£ng, ta thÆ°á»ng cáº§n há»— trá»£ nhiá»u loáº¡i adapter khÃ¡c nhau â€” cháº³ng háº¡n HTTP, gRPC, Kafka, hay Cron.\nDÃ¹ má»¥c Ä‘Ã­ch cá»§a chÃºng khÃ¡c nhau (xá»­ lÃ½ request, tiÃªu thá»¥ message, lÃªn lá»‹ch jobâ€¦), nhÆ°ng táº¥t cáº£ Ä‘á»u cÃ³ chu trÃ¬nh vÃ²ng Ä‘á»i tÆ°Æ¡ng tá»±:\n1 Start â†’ ... â†’ Stop Cá»¥ thá»ƒ:\nMá»—i adapter cáº§n khá»Ÿi Ä‘á»™ng (OnStart) khi á»©ng dá»¥ng cháº¡y. VÃ  dá»«ng láº¡i (OnStop) khi á»©ng dá»¥ng shutdown. Uber Fx cung cáº¥p cÆ¡ cháº¿ fx.Lifecycle giÃºp Ä‘Äƒng kÃ½ cÃ¡c hook nÃ y:\n1 2 3 4 lc.Append(fx.Hook{ OnStart: func(ctx context.Context) error { ... }, OnStop: func(ctx context.Context) error { ... }, }) Tuy nhiÃªn, khi framework má»Ÿ rá»™ng Ä‘á»ƒ há»— trá»£ nhiá»u adapter, ta báº¯t Ä‘áº§u nháº­n tháº¥y má»™t váº¥n Ä‘á» kiáº¿n trÃºc phá»• biáº¿n:\nCÃ¡c adapter lÃ  nhá»¯ng thÃ nh pháº§n khÃ¡c nhau, nhÆ°ng láº¡i cÃ³ nhiá»u Ä‘iá»ƒm tÆ°Æ¡ng Ä‘á»“ng Ä‘Ã¡ng ká»ƒ\nmÃ  khÃ´ng cÃ³ cÆ¡ cháº¿ chá»©ng minh hoáº·c táº­n dá»¥ng Ä‘Æ°á»£c kháº£ nÄƒng tÃ¡i sá»­ dá»¥ng giao diá»‡n hay xá»­ lÃ½ chung.\nKáº¿t quáº£ lÃ :\nâŒ Má»—i adapter tá»± viáº¿t láº¡i lifecycle giá»‘ng nhau. âŒ Code láº·p láº¡i 60â€“70% (boilerplate Fx hook). âŒ Framework khÃ´ng cÃ³ khung chuáº©n Ä‘á»ƒ Ä‘iá»u phá»‘i adapter. âŒ Náº¿u muá»‘n thay Ä‘á»•i logic chung (vÃ­ dá»¥ thÃªm logging, metrics\u0026hellip;), pháº£i sá»­a á»Ÿ táº¥t cáº£ adapter. NÃ³i cÃ¡ch khÃ¡c, cÃ¡c adapter cÃ³ chung cáº¥u trÃºc hoáº¡t Ä‘á»™ng, nhÆ°ng framework chÆ°a náº¯m quyá»n Ä‘iá»u phá»‘i vÃ²ng Ä‘á»i,\nvÃ  Ä‘iá»u Ä‘Ã³ khiáº¿n viá»‡c má»Ÿ rá»™ng hoáº·c báº£o trÃ¬ tá»‘n ráº¥t nhiá»u effort.\nTÃ¬nh huá»‘ng nÃ y cÅ©ng phá»• biáº¿n trong cÃ¡c há»‡ thá»‘ng nhiá»u adapter â€” nÆ¡i tá»«ng nhÃ³m phÃ¡t triá»ƒn cÃ³ thá»ƒ tá»± Ä‘á»‹nh nghÄ©a lifecycle riÃªng,\nkhiáº¿n framework trá»Ÿ nÃªn rá»i ráº¡c, thiáº¿u tÃ­nh thá»‘ng nháº¥t, vÃ  khÃ³ chá»©ng minh kháº£ nÄƒng tÃ¡i sá»­ dá»¥ng.\n2. Giáº£i phÃ¡p: Template Method Pattern Template Method Pattern lÃ  máº«u thiáº¿t káº¿ cho phÃ©p:\nXÃ¡c Ä‘á»‹nh bá»™ khung (template) cá»§a má»™t quy trÃ¬nh trong lá»›p cha. Cho phÃ©p lá»›p con ghi Ä‘Ã¨ cÃ¡c bÆ°á»›c cá»¥ thá»ƒ mÃ  khÃ´ng thay Ä‘á»•i khung tá»•ng thá»ƒ. NÃ³i cÃ¡ch khÃ¡c: lá»›p cha quyáº¿t Ä‘á»‹nh â€œquy trÃ¬nh diá»…n ra tháº¿ nÃ oâ€,\ncÃ²n lá»›p con chá»‰ cáº§n mÃ´ táº£ â€œchi tiáº¿t tá»«ng bÆ°á»›câ€.\nÃp dá»¥ng vÃ o bÃ i toÃ¡n adapter:\nLá»›p cha (template) quy Ä‘á»‹nh vÃ²ng Ä‘á»i chuáº©n gá»“m OnStart vÃ  OnStop. CÃ¡c adapter con (HTTP, gRPC, Kafka, â€¦) chá»‰ cáº§n triá»ƒn khai logic riÃªng trong hai bÆ°á»›c Ä‘Ã³. Uber Fx (hoáº·c thÆ° viá»‡n tÆ°Æ¡ng tá»±) chá»‰ Ä‘Ã³ng vai trÃ² Ä‘iá»u phá»‘i lifecycle, chá»© khÃ´ng can thiá»‡p vÃ o cáº¥u trÃºc template. 3. Thá»±c hiá»‡n a. Äá»‹nh nghÄ©a interface lifecycle TrÆ°á»›c háº¿t, ta mÃ´ hÃ¬nh hÃ³a giao diá»‡n vÃ²ng Ä‘á»i chung cho má»i adapter:\n1 2 3 4 type AdapterLifecycle interface { OnStart(ctx context.Context) error OnStop(ctx context.Context) error } Táº¥t cáº£ adapter (HTTP, gRPC, Kafka, \u0026hellip;) Ä‘á»u tuÃ¢n theo giao diá»‡n nÃ y.\nb. XÃ¢y dá»±ng lá»›p template BaseAdapter Lá»›p nÃ y chá»‹u trÃ¡ch nhiá»‡m Ä‘á»‹nh nghÄ©a khung lifecycle chung,\nvÃ  tá»± Ä‘á»™ng Ä‘Äƒng kÃ½ vÃ o há»‡ thá»‘ng (vÃ­ dá»¥ Uber Fx):\n1 2 3 4 5 6 7 8 9 10 type BaseAdapter[T any] struct { Config T } func (b *BaseAdapter[T]) RegisterLifecycle(lc fx.Lifecycle, impl AdapterLifecycle) { lc.Append(fx.Hook{ OnStart: impl.OnStart, OnStop: impl.OnStop, }) } á» Ä‘Ã¢y:\nRegisterLifecycle() lÃ  template method â€“ quy Ä‘á»‹nh quy trÃ¬nh cá»‘ Ä‘á»‹nh cho má»i adapter. OnStart / OnStop lÃ  cÃ¡c bÆ°á»›c má»Ÿ rá»™ng mÃ  lá»›p con cÃ³ thá»ƒ tÃ¹y biáº¿n. fx.Lifecycle chá»‰ lÃ  cÆ¡ cháº¿ Ä‘iá»u phá»‘i, khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n cáº¥u trÃºc template. c. Cá»¥ thá»ƒ hÃ³a adapter â€“ Sub Class Má»—i adapter chá»‰ cáº§n káº¿ thá»«a BaseAdapter vÃ  Ä‘á»‹nh nghÄ©a logic riÃªng cá»§a mÃ¬nh:\n1 2 3 4 5 6 7 8 9 10 11 12 13 type HTTPAdapter struct { BaseAdapter[Config] } func (a *HTTPAdapter) OnStart(ctx context.Context) error { fmt.Println(\u0026#34;Starting HTTP server...\u0026#34;) return nil } func (a *HTTPAdapter) OnStop(ctx context.Context) error { fmt.Println(\u0026#34;Stopping HTTP server...\u0026#34;) return nil } VÃ  Ä‘Äƒng kÃ½ adapter thÃ´ng qua template:\n1 2 3 4 5 func ForRoot(cfg Config) fx.Option { return fx.Invoke(func(lc fx.Lifecycle, adapter *HTTPAdapter) { adapter.RegisterLifecycle(lc, adapter) }) } Káº¿t quáº£:\nToÃ n bá»™ adapter tuÃ¢n theo vÃ²ng Ä‘á»i chuáº©n. Chá»‰ cáº§n Ä‘á»‹nh nghÄ©a pháº§n riÃªng (OnStart/OnStop). KhÃ´ng cÃ²n pháº£i copy-paste code lifecycle. 4. Káº¿t luáº­n Viá»‡c sá»­ dá»¥ng Template Method Pattern giÃºp framework duy trÃ¬ :\nFramework layer náº¯m quyá»n Ä‘iá»u phá»‘i vÃ²ng Ä‘á»i (template). Adapter layer chá»‰ Ä‘á»‹nh nghÄ©a pháº§n thá»±c thi Ä‘áº·c thÃ¹. Logic chung (logging, metrics, tracing) cÃ³ thá»ƒ thÃªm má»™t láº§n, Ã¡p dá»¥ng cho toÃ n há»‡ thá»‘ng. Äiá»u nÃ y biáº¿n lifecycle trá»Ÿ thÃ nh má»™t pháº§n cÃ³ thá»ƒ kiá»ƒm soÃ¡t, má»Ÿ rá»™ng vÃ  báº£o trÃ¬ táº­p trung,\nthay vÃ¬ náº±m ráº£i rÃ¡c trong tá»«ng adapter cá»¥ thá»ƒ.\nKhi framework má»Ÿ rá»™ng vá»›i nhiá»u adapter khÃ¡c nhau, viá»‡c má»—i adapter tá»± triá»ƒn khai vÃ²ng Ä‘á»i riÃªng sáº½ nhanh chÃ³ng dáº«n Ä‘áº¿n trÃ¹ng láº·p, khÃ³ má»Ÿ rá»™ng vÃ  tá»‘n effort báº£o trÃ¬.\nBáº±ng cÃ¡ch Ã¡p dá»¥ng Template Method Pattern, ta chuáº©n hÃ³a Ä‘Æ°á»£c quy trÃ¬nh Start â†’ Stop,\ntÃ¡ch biá»‡t pháº§n cá»‘ Ä‘á»‹nh (template lifecycle) khá»i pháº§n tÃ¹y biáº¿n (logic adapter),\ngiÃºp framework:\nDá»… má»Ÿ rá»™ng thÃªm adapter má»›i. Giáº£m 60â€“70% code láº·p. Quáº£n lÃ½ lifecycle thá»‘ng nháº¥t. Giá»¯ cáº¥u trÃºc sáº¡ch, tuÃ¢n theo Clean Architecture. ","date":"2025-11-01T00:40:00+08:00","permalink":"https://phongthien99.github.io/posts/standardizing-adapter-lifecycle-in-frameworks-with-the-template-method-pattern/","title":"Standardizing Adapter Lifecycle in Frameworks with the Template Method Pattern"},{"content":"Äáº·t váº¥n Ä‘á» Trong phÃ¡t triá»ƒn á»©ng dá»¥ng web hiá»‡n Ä‘áº¡i, cÃ¡c há»‡ thá»‘ng phá»©c táº¡p thÆ°á»ng Ä‘Æ°á»£c chia thÃ nh nhiá»u module Ä‘á»™c láº­p. Tuy nhiÃªn, triá»ƒn khai toÃ n bá»™ á»©ng dá»¥ng dÆ°á»›i dáº¡ng mono frontend gÃ¢y khÃ³ khÄƒn trong viá»‡c má»Ÿ rá»™ng, báº£o trÃ¬ vÃ  tá»‘i Æ°u hiá»‡u nÄƒng. CÃ¡c thay Ä‘á»•i nhá» trong má»™t module cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng Ä‘áº¿n toÃ n bá»™ há»‡ thá»‘ng, Ä‘á»“ng thá»i viá»‡c táº£i táº¥t cáº£ module cho má»i ngÆ°á»i dÃ¹ng dáº«n Ä‘áº¿n lÃ£ng phÃ­ tÃ i nguyÃªn.\nMulti-Zone ra Ä‘á»i nháº±m giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» nÃ y báº±ng cÃ¡ch tÃ¡ch á»©ng dá»¥ng thÃ nh cÃ¡c khu vá»±c (zone) Ä‘á»™c láº­p, cho phÃ©p triá»ƒn khai, cáº­p nháº­t vÃ  váº­n hÃ nh tá»«ng zone mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c pháº§n cÃ²n láº¡i. Giáº£i phÃ¡p nÃ y giÃºp tá»‘i Æ°u tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng, tÄƒng kháº£ nÄƒng má»Ÿ rá»™ng, phÃ¢n tÃ¡ch trÃ¡ch nhiá»‡m rÃµ rÃ ng vÃ  há»— trá»£ phÃ¡t triá»ƒn, váº­n hÃ nh Ä‘á»™c láº­p giá»¯a cÃ¡c nhÃ³m.\nGiáº£i phÃ¡p vÃ  lá»±a chá»n cÃ´ng nghá»‡ Äá»ƒ Ä‘Ã¡p á»©ng yÃªu cáº§u xÃ¢y dá»±ng á»©ng dá»¥ng multi-zone, team lá»±a chá»n Next.js lÃ m framework chÃ­nh nhá» tÃ­nh phá»• biáº¿n, cá»™ng Ä‘á»“ng lá»›n vÃ  há»— trá»£ tá»‘t cho nhiá»u mÃ´ hÃ¬nh triá»ƒn khai. Next.js cung cáº¥p kháº£ nÄƒng SSR (Server-Side Rendering) vÃ  multi-zone, giÃºp tá»‘i Æ°u hiá»‡u nÄƒng vÃ  quáº£n lÃ½ routing linh hoáº¡t.\nTuy nhiÃªn, vá»›i yÃªu cáº§u triá»ƒn khai Ä‘á»™ng dá»±a trÃªn cáº¥u hÃ¬nh mÃ  khÃ´ng cáº§n build láº¡i vÃ  cÃ³ thá»ƒ sá»­ dá»¥ng Nginx hoáº·c server tÄ©nh Ä‘á»ƒ phá»¥c vá»¥ á»©ng dá»¥ng, viá»‡c chá»‰ dÃ¹ng Next.js sáº½ gáº·p háº¡n cháº¿ vÃ¬ multi-zone cá»§a Next.js máº·c Ä‘á»‹nh gáº¯n vá»›i SSR.\nÄá»ƒ giáº£i quyáº¿t, team quyáº¿t Ä‘á»‹nh tÃ­ch há»£p thÃªm Qiankun, má»™t framework micro frontend, giÃºp:\nTriá»ƒn khai cÃ¡c á»©ng dá»¥ng con Ä‘á»™c láº­p, cÃ³ thá»ƒ load dynamic theo cáº¥u hÃ¬nh runtime. Cho phÃ©p tÃ¡ch biá»‡t zone, triá»ƒn khai trÃªn server tÄ©nh hoáº·c Nginx mÃ  khÃ´ng cáº§n build láº¡i toÃ n bá»™ á»©ng dá»¥ng. Dá»… dÃ ng quáº£n lÃ½ routing vÃ  chia sáº» thÆ° viá»‡n giá»¯a cÃ¡c zone, Ä‘á»“ng thá»i giá»¯ Ä‘Æ°á»£c kháº£ nÄƒng má»Ÿ rá»™ng vÃ  báº£o trÃ¬. Giáº£i phÃ¡p Next.js + Qiankun + Nginx + Dynamic Config Äá»ƒ tÄƒng tÃ­nh linh hoáº¡t, há»‡ thá»‘ng káº¿t há»£p dynamic config thÃ´ng qua file env.js:\nFile env.js chá»©a thÃ´ng tin runtime cá»§a cÃ¡c micro app nhÆ° tÃªn, URL vÃ  entry point, cho phÃ©p shell app load cÃ¡c micro app theo cáº¥u hÃ¬nh mÃ  khÃ´ng cáº§n rebuild. Shell App (Next.js) Ä‘Ã³ng vai trÃ² khung chÃ­nh, quáº£n lÃ½ layout, routing vÃ  cÃ³ thá»ƒ sá»­ dá»¥ng SSR/SSG. Micro App triá»ƒn khai Ä‘á»™c láº­p, má»—i micro app lÃ  má»™t zone trong kiáº¿n trÃºc multi-zone. Qiankun chá»‹u trÃ¡ch nhiá»‡m load cÃ¡c micro app runtime, quáº£n lÃ½ sandbox, shared library vÃ  isolation giá»¯a cÃ¡c micro app. Nginx phá»¥c vá»¥ static files cá»§a shell app vÃ  micro app, Ä‘á»“ng thá»i cung cáº¥p cÆ¡ cháº¿ dynamic mapping thÃ´ng qua file config Ä‘á»ƒ triá»ƒn khai linh hoáº¡t theo mÃ´i trÆ°á»ng. Giáº£i phÃ¡p nÃ y Ä‘áº£m báº£o:\nDynamic deployment: ThÃªm, xÃ³a, hoáº·c cáº­p nháº­t micro app mÃ  khÃ´ng cáº§n rebuild shell app. Äá»™c láº­p triá»ƒn khai: Micro app build vÃ  deploy riÃªng, tÃ¡ch biá»‡t vá»›i shell app. Tá»‘i Æ°u resource vÃ  hiá»‡u nÄƒng: Nginx phá»¥c vá»¥ static files, giáº£m táº£i server Node. Dá»… quáº£n lÃ½ cáº¥u hÃ¬nh runtime: Cho phÃ©p triá»ƒn khai khÃ¡c nhau theo mÃ´i trÆ°á»ng (dev, staging, prod) báº±ng cÃ¡c file config riÃªng. Káº¿t luáº­n Káº¿t há»£p Next.js, Qiankun vÃ  Nginx vá»›i cÆ¡ cháº¿ dynamic config mang láº¡i giáº£i phÃ¡p linh hoáº¡t cho kiáº¿n trÃºc multi-zone.\nNext.js cung cáº¥p ná»n táº£ng máº¡nh máº½ vá»›i SSR/SSG, routing vÃ  quáº£n lÃ½ layout. Qiankun cho phÃ©p triá»ƒn khai micro frontend á»Ÿ cáº¥p á»©ng dá»¥ng/zone, load dynamic theo runtime, tÃ¡ch biá»‡t cÃ¡c module vÃ  chia sáº» thÆ° viá»‡n. Nginx Ä‘áº£m báº£o triá»ƒn khai static, nháº¹ nhÃ ng vÃ  linh hoáº¡t, káº¿t há»£p vá»›i file env.js Ä‘á»ƒ load cáº¥u hÃ¬nh runtime mÃ  khÃ´ng cáº§n build láº¡i shell app. Giáº£i phÃ¡p nÃ y giÃºp team phÃ¡t triá»ƒn Ä‘á»™c láº­p, dá»… báº£o trÃ¬, tá»‘i Æ°u tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng vÃ  quáº£n lÃ½ cáº¥u hÃ¬nh runtime hiá»‡u quáº£. ÄÃ¢y lÃ  hÆ°á»›ng Ä‘i phÃ¹ há»£p cho cÃ¡c dá»± Ã¡n lá»›n, cáº§n má»Ÿ rá»™ng theo tá»«ng module vÃ  triá»ƒn khai linh hoáº¡t trÃªn nhiá»u mÃ´i trÆ°á»ng, Ä‘á»“ng thá»i giáº£m thiá»ƒu rá»§i ro khi cáº­p nháº­t hoáº·c thay Ä‘á»•i tá»«ng pháº§n cá»§a há»‡ thá»‘ng.\n","date":"2025-10-26T23:09:00+07:00","permalink":"https://phongthien99.github.io/posts/multi-zone-in-modern-web-development-solution-with-next.js-qiankun-and-nginx/","title":"Multi-Zone in Modern Web Development: Solution with Next.js, Qiankun, and Nginx"},{"content":"Context Engineering â€“ A Method for Designing Efficient AI Agent Systems with SpecKit 1. Bá»‘i cáº£nh: VÃ¬ sao phÃ¡t triá»ƒn pháº§n má»m vá»›i AI Agent láº¡i khÃ³ Ä‘áº¿n váº­y? AI Agents nhÆ° Claude Code, GitHub Copilot, hay cÃ¡c LLM-based assistant Ä‘ang dáº§n trá»Ÿ thÃ nh Ä‘á»“ng Ä‘á»™i trong láº­p trÃ¬nh. Tuy nhiÃªn, náº¿u báº¡n tá»«ng lÃ m viá»‡c vá»›i chÃºng trong dá»± Ã¡n tháº­t, cÃ³ láº½ báº¡n Ä‘Ã£ gáº·p nhá»¯ng váº¥Ä‘á» quen thuá»™c:\nMáº¥t ngá»¯ cáº£nh (Context Loss): AI quÃªn kiáº¿n trÃºc, quy táº¯c coding, hoáº·c quyáº¿t Ä‘á»‹nh ká»¹ thuáº­t Ä‘Ã£ thá»‘ng nháº¥t.\nHallucination \u0026amp; sai lá»‡ch: AI gá»£i Ã½ sai cÃ´ng nghá»‡ (vÃ­ dá»¥: Ä‘á» xuáº¥t Redux dÃ¹ project Ä‘ang dÃ¹ng React Query).\nThiáº¿u truy váº¿t (Traceability): KhÃ´ng rÃµ vÃ¬ sao má»™t quyáº¿t Ä‘á»‹nh ká»¹ thuáº­t Ä‘Æ°á»£c Ä‘Æ°a ra.\nTá»‘n token (Token Inefficiency): Má»—i láº§n lÃ m viá»‡c láº¡i pháº£i \u0026ldquo;náº¡p\u0026rdquo; toÃ n bá»™ context â€” tá»‘n kÃ©m vÃ  cháº­m.\nTrong dá»± Ã¡n next-solid, nhÃ³m triá»ƒn khai 5 features. NhÆ°ng khi Ä‘áº¿n feature thá»© 3, AI Agent láº¡i quÃªn ráº±ng project dÃ¹ng @tanstack/react-query â€” vÃ  Ä‘á» xuáº¥t Redux. Lá»—i nhá», nhÆ°ng háº­u quáº£ lá»›n: máº¥t thá»i gian, sai hÆ°á»›ng, vÃ  giáº£m niá»m tin vÃ o AI.\nNguyÃªn nhÃ¢n?\nğŸ‘‰ KhÃ´ng cÃ³ há»‡ thá»‘ng quáº£n lÃ½ ngá»¯ cáº£nh cÃ³ cáº¥u trÃºc, truy váº¿t vÃ  tá»± kiá»ƒm chá»©ng.\n2. Giáº£i phÃ¡p: Context Engineering Context Engineering lÃ  má»™t phÆ°Æ¡ng phÃ¡p Ä‘á»ƒ thiáº¿t káº¿, quáº£n lÃ½, vÃ  duy trÃ¬ ngá»¯ cáº£nh (context) cho AI Agents má»™t cÃ¡ch cÃ³ há»‡ thá»‘ng.\nCÃ´ng thá»©c ná»n táº£ng:\n1 Context Engineering = Prompt Engineering + Knowledge Design + Memory Management + Reasoning Alignment Bá»‘n trá»¥ cá»™t cá»§a Context Engineering Prompt Engineering â€“ thiáº¿t káº¿ prompts cÃ³ cáº¥u trÃºc, reusable vÃ  cÃ³ validation gates.\nKnowledge Design â€“ tá»• chá»©c kiáº¿n thá»©c dá»± Ã¡n thÃ nh artifacts cÃ³ schema rÃµ rÃ ng.\nMemory Management â€“ lÆ°u trá»¯ vÃ  truy xuáº¥t context hiá»‡u quáº£, trÃ¡nh lÃ£ng phÃ­ token.\nReasoning Alignment â€“ Ä‘áº£m báº£o AI suy luáº­n Ä‘Ãºng hÆ°á»›ng vá»›i triáº¿t lÃ½ dá»± Ã¡n.\n3. SpecKit â€“ Framework hiá»‡n thá»±c hÃ³a Context Engineering Äá»ƒ Ã¡p dá»¥ng Context Engineering vÃ o thá»±c táº¿, chÃºng tÃ´i xÃ¢y dá»±ng SpecKit â€“ má»™t framework gá»“m cÃ¡c slash commands giÃºp AI lÃ m viá»‡c cÃ³ tá»• chá»©c vÃ  tá»± kiá»ƒm soÃ¡t hÆ¡n.\nCáº¥u trÃºc thÆ° má»¥c chÃ­nh: 1 2 3 4 5 6 7 8 9 .claude/commands/ â”œâ”€â”€ speckit.specify.md # Táº¡o spec tá»« mÃ´ táº£ tá»± nhiÃªn â”œâ”€â”€ speckit.clarify.md # LÃ m rÃµ yÃªu cáº§u mÆ¡ há»“ â”œâ”€â”€ speckit.plan.md # Láº­p káº¿ hoáº¡ch vÃ  technical design â”œâ”€â”€ speckit.tasks.md # Sinh tasks theo thá»© tá»± phá»¥ thuá»™c â”œâ”€â”€ speckit.implement.md # Triá»ƒn khai cÃ³ checkpoint â”œâ”€â”€ speckit.analyze.md # Kiá»ƒm tra consistency giá»¯a artifacts â”œâ”€â”€ speckit.checklist.md # Sinh checklist kiá»ƒm thá»­ â””â”€â”€ speckit.constitution.md # Bá»™ nguyÃªn táº¯c dá»± Ã¡n (memory layer) Workflow tá»•ng quÃ¡t 1 2 3 4 5 6 7 8 9 10 11 User mÃ´ táº£ â†’ /specify â†’ spec.md (+ checklist) â†“ /clarify â†’ resolved spec.md â†“ /plan â†’ plan.md + research.md + contracts/ â†“ /tasks â†’ tasks.md (theo dependencies) â†“ /analyze â†’ bÃ¡o cÃ¡o consistency â†“ /implement â†’ triá»ƒn khai + validation checkpoints 4. BÃªn trong Context Engineering â€“ CÃ¡ch SpecKit hiá»‡n thá»±c 4 trá»¥ cá»™t 1ï¸âƒ£ Prompt Engineering â€“ Prompts cÃ³ cáº¥u trÃºc, cÃ³ kiá»ƒm chá»©ng Má»—i slash command chá»‰ lÃ m má»™t nhiá»‡m vá»¥ duy nháº¥t.\nVÃ­ dá»¥ /specify chá»‰ táº¡o spec, /plan chá»‰ láº­p káº¿ hoáº¡ch. Äiá»u nÃ y giÃºp phÃ¢n tÃ¡ch trÃ¡ch nhiá»‡m rÃµ rÃ ng vÃ  dá»… kiá»ƒm soÃ¡t cháº¥t lÆ°á»£ng. SpecKit cÃ²n dÃ¹ng ká»¹ thuáº­t Progressive Disclosure â€“ chá»‰ náº¡p Ä‘Ãºng context cáº§n cho má»—i giai Ä‘oáº¡n.\nâ†’ Giáº£m 60â€“70% lÆ°á»£ng token tiÃªu thá»¥ má»—i vÃ²ng.\nCuá»‘i má»—i phase cÃ³ Validation Gates: checklist tá»± Ä‘á»™ng kiá»ƒm tra cháº¥t lÆ°á»£ng spec, completeness, readiness trÆ°á»›c khi qua bÆ°á»›c tiáº¿p theo.\n2ï¸âƒ£ Knowledge Design â€“ Kiáº¿n thá»©c cÃ³ cáº¥u trÃºc, cÃ³ schema SpecKit chia artifacts thÃ nh 3 táº§ng:\nTier 1 â€“ Project Memory: CLAUDE.md (AI context hiá»‡n táº¡i) + constitution.md (nguyÃªn táº¯c dá»± Ã¡n).\nTier 2 â€“ Feature Artifacts: má»—i feature cÃ³ spec.md, plan.md, tasks.md, research.md, contracts/, data-model.md.\nTier 3 â€“ Templates: lÆ°u schema chuáº©n cho má»i loáº¡i artifact.\nMá»i file Ä‘á»u tuÃ¢n theo schema Ä‘á»‹nh nghÄ©a trÆ°á»›c, giÃºp AI hiá»ƒu vÃ  truy xuáº¥t chÃ­nh xÃ¡c thay vÃ¬ pháº£i \u0026ldquo;Ä‘oÃ¡n\u0026rdquo;.\n3ï¸âƒ£ Memory Management â€“ LÆ°u trá»¯ vÃ  truy xuáº¥t hiá»‡u quáº£ SpecKit thiáº¿t káº¿ memory theo 4 cáº¥p Ä‘á»™:\nLevel Loáº¡i bá»™ nhá»› Vai trÃ² 1 Session Memory Táº¡m thá»i, phá»¥c vá»¥ conversation hiá»‡n táº¡i 2 Feature Memory LÆ°u tá»«ng feature, cÃ³ version control 3 Project Memory Ghi nháº­n state toÃ n dá»± Ã¡n 4 Template Memory Äáº£m báº£o consistency vÃ  reuse Nhá» Ä‘Ã³, AI chá»‰ cáº§n Ä‘á»c nhá»¯ng pháº§n liÃªn quan, khÃ´ng pháº£i \u0026ldquo;nuá»‘t\u0026rdquo; toÃ n bá»™ 5000 tokens cá»§a project má»—i láº§n.\n4ï¸âƒ£ Reasoning Alignment â€“ CÄƒn chá»‰nh suy luáº­n báº±ng \u0026ldquo;Constitution\u0026rdquo; SpecKit Ä‘á»‹nh nghÄ©a bá»™ nguyÃªn táº¯c trong file constitution.md.\nVÃ­ dá»¥:\n1 2 3 4 ## Principle VI: Clean Architecture with SOLID - 4 layers: Presentation, Application, Domain, Infrastructure - Repository pattern báº¯t buá»™c - Hooks chá»‰ phá»¥ thuá»™c interface, khÃ´ng phá»¥ thuá»™c implementation Má»—i láº§n AI lÃªn plan, SpecKit cháº¡y Constitution Check â€“ náº¿u cÃ³ vi pháº¡m, quy trÃ¬nh dá»«ng láº¡i ngay.\nVÃ­ dá»¥: feature 003 ban Ä‘áº§u dÃ¹ng Redux â†’ bá»‹ cháº·n vÃ¬ \u0026ldquo;Redux khÃ´ng náº±m trong approved dependencies\u0026rdquo;.\nKáº¿t quáº£: dÃ¹ng láº¡i React Query, Ä‘áº£m báº£o consistency.\n5. Káº¿t quáº£: Khi AI lÃ m viá»‡c nhÆ° má»™t ká»¹ sÆ° tháº­t Sau khi Ã¡p dá»¥ng Context Engineering vá»›i SpecKit:\nLá»£i Ã­ch MÃ´ táº£ Consistency 5 features cÃ¹ng tuÃ¢n theo Clean Architecture, khÃ´ng sai lá»‡ch. Traceability Má»i quyáº¿t Ä‘á»‹nh Ä‘á»u cÃ³ rationale rÃµ rÃ ng trong research.md. Quality 3 táº§ng validation â€“ tá»« ná»™i dung Ä‘áº¿n tiÃªu chÃ­ cháº¥p nháº­n. Efficiency Giáº£m token usage má»—i iteration. Scalability Dá»… má»Ÿ rá»™ng dá»± Ã¡n, dá»… cáº­p nháº­t principles vÃ  templates. 6. Káº¿t luáº­n AI Agents khÃ´ng chá»‰ cáº§n \u0026ldquo;prompt hay\u0026rdquo; â€“ mÃ  cáº§n context tá»‘t.\nVÃ  Ä‘á»ƒ cÃ³ context tá»‘t, chÃºng ta pháº£i ká»¹ sÆ° hÃ³a cÃ¡ch AI hiá»ƒu vÃ  ghi nhá»›.\nContext Engineering chÃ­nh lÃ  bÆ°á»›c tiáº¿n Ä‘Ã³.\nCÃ²n SpecKit lÃ  cÃ´ng cá»¥ Ä‘á»ƒ biáº¿n lÃ½ thuyáº¿t áº¥y thÃ nh hÃ nh Ä‘á»™ng â€” giÃºp AI phÃ¡t triá»ƒn pháº§n má»m má»™t cÃ¡ch cÃ³ cáº¥u trÃºc, cÃ³ ká»· luáº­t, vÃ  cÃ³ trÃ­ nhá»›.\nâœ³ï¸ TÃ³m láº¡i: Prompt Engineering giÃºp AI hiá»ƒu, nhÆ°ng Context Engineering giÃºp AI hÃ nh Ä‘á»™ng nháº¥t quÃ¡n.\n","date":"2025-10-18T00:00:00+08:00","permalink":"https://phongthien99.github.io/posts/context-engineering-a-method-for-designing-efficient-ai-agent-systems-with-speckit/","title":"Context Engineering â€“ A Method for Designing Efficient AI Agent Systems with SpecKit"},{"content":"Automated Versioning and Changelog Management for Helm Charts in a Monorepo with Release It 1. Äáº·t váº¥n Ä‘á» Trong cÃ¡c dá»± Ã¡n monorepo, nÆ¡i chá»©a nhiá»u Helm chart triá»ƒn khai cho tá»«ng service hoáº·c module khÃ¡c nhau (vÃ­ dá»¥: demo-umbrella-chart, whoami, api-gateway\u0026hellip;), viá»‡c quáº£n lÃ½ version vÃ  release cho tá»«ng chart riÃªng láº» thÆ°á»ng ráº¥t phá»©c táº¡p.\nNáº¿u thá»±c hiá»‡n thá»§ cÃ´ng, báº¡n sáº½ cáº§n:\nSá»­a version trong Chart.yaml. Sinh changelog. Táº¡o Git tag tÆ°Æ¡ng á»©ng. Äáº£m báº£o chart há»£p lá»‡ (helm lint). Vá»›i hÃ ng chá»¥c chart trong cÃ¹ng repo, viá»‡c nÃ y dá»… sai sÃ³t, tá»‘n thá»i gian, vÃ  khÃ³ tÃ­ch há»£p vÃ o pipeline CI/CD.\n2. Giáº£i phÃ¡p Sá»­ dá»¥ng cÃ´ng cá»¥ Release It Ä‘á»ƒ tá»± Ä‘á»™ng hÃ³a quy trÃ¬nh release cho tá»«ng chart Ä‘á»™c láº­p.\nMá»—i Helm chart sáº½ cÃ³:\nMá»™t file cáº¥u hÃ¬nh riÃªng .release-it.json (hoáº·c dÃ¹ng script sinh Ä‘á»™ng). Cáº¥u hÃ¬nh plugin Ä‘á»ƒ: Tá»± Ä‘á»™ng cáº­p nháº­t version trong Chart.yaml. Sinh changelog tá»± Ä‘á»™ng (CHANGELOG.md). Táº¡o tag Git riÃªng biá»‡t theo tÃªn chart. CÃ¡c hook Ä‘á»ƒ lint chart, commit file, vÃ  in log káº¿t quáº£. CÃ¡ch nÃ y giÃºp:\nMá»—i chart cÃ³ chu ká»³ release riÃªng biá»‡t. Dá»… má»Ÿ rá»™ng khi thÃªm chart má»›i. Dá»… tÃ­ch há»£p CI/CD (GitHub Actions, GitLab CI, Jenkins,â€¦). 3. Thá»±c hiá»‡n 3.1 Cáº¥u trÃºc thÆ° má»¥c monorepo 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 â”œâ”€â”€ demo-umbrella-chart â”‚ â”œâ”€â”€ CHANGELOG.md â”‚ â”œâ”€â”€ Chart.lock â”‚ â”œâ”€â”€ charts â”‚ â”‚ â”œâ”€â”€ mariadb-18.0.3.tgz â”‚ â”‚ â””â”€â”€ redis-19.0.2.tgz â”‚ â”œâ”€â”€ Chart.yaml â”‚ â”œâ”€â”€ templates â”‚ â””â”€â”€ values.yaml â”œâ”€â”€ whoami â”‚ â”œâ”€â”€ charts â”‚ â”œâ”€â”€ Chart.yaml â”‚ â”œâ”€â”€ templates â”‚ â””â”€â”€ values.yaml â”œâ”€â”€ RELEASE.md â”œâ”€â”€ package.json â”œâ”€â”€ pnpm-lock.yaml Má»—i thÆ° má»¥c con nhÆ° demo-umbrella-chart hay whoami Ä‘áº¡i diá»‡n cho má»™t Helm chart Ä‘á»™c láº­p.\n3.2 Cáº¥u hÃ¬nh release-it tá»•ng quÃ¡t cho tá»«ng chart Táº¡o file:\n\u0026lt;chart-name\u0026gt;/.release-it.json\nVÃ­ dá»¥:\ndemo-umbrella-chart/.release-it.json hoáº·c whoami/.release-it.json\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 { \u0026#34;npm\u0026#34;: { \u0026#34;publish\u0026#34;: false}, \u0026#34;git\u0026#34;: { \u0026#34;tagName\u0026#34;: \u0026#34;\u0026lt;chart-name\u0026gt;/v${version}\u0026#34;, \u0026#34;tagMatch\u0026#34;: \u0026#34;\u0026lt;chart-name\u0026gt;/v*\u0026#34;, \u0026#34;commitMessage\u0026#34;: \u0026#34;chore(\u0026lt;chart-name\u0026gt;): release v${version}\u0026#34;, \u0026#34;tagAnnotation\u0026#34;: \u0026#34;Release \u0026lt;chart-name\u0026gt; v${version}\u0026#34;, \u0026#34;getLatestTagFromAllRefs\u0026#34;: true, \u0026#34;requireCleanWorkingDir\u0026#34;: false, \u0026#34;preset\u0026#34;: \u0026#34;angular\u0026#34; }, \u0026#34;github\u0026#34;: { \u0026#34;release\u0026#34;: false, \u0026#34;releaseName\u0026#34;: \u0026#34;\u0026lt;chart-name\u0026gt; v${version}\u0026#34;, \u0026#34;releaseNotes\u0026#34;: \u0026#34;echo \u0026#39;See CHANGELOG.md for details\u0026#39;\u0026#34; }, \u0026#34;hooks\u0026#34;: { \u0026#34;before:init\u0026#34;: [ \u0026#34;echo \u0026#39;ğŸš€ Starting release for \u0026lt;chart-name\u0026gt;\u0026#39;\u0026#34;, \u0026#34;helm lint ./\u0026lt;chart-name\u0026gt;\u0026#34; ], \u0026#34;after:bump\u0026#34;: [ \u0026#34;git add ./\u0026lt;chart-name\u0026gt;/Chart.yaml\u0026#34; ], \u0026#34;after:git:release\u0026#34;: \u0026#34;echo \u0026#39;âœ… \u0026lt;chart-name\u0026gt; v${version} released successfully\u0026#39;\u0026#34; }, \u0026#34;plugins\u0026#34;: { \u0026#34;@release-it/bumper\u0026#34;: { \u0026#34;in\u0026#34;: { \u0026#34;file\u0026#34;: \u0026#34;./\u0026lt;chart-name\u0026gt;/Chart.yaml\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;version\u0026#34; }, \u0026#34;out\u0026#34;: { \u0026#34;file\u0026#34;: \u0026#34;./\u0026lt;chart-name\u0026gt;/Chart.yaml\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;version\u0026#34; } }, \u0026#34;@release-it/conventional-changelog\u0026#34;: { \u0026#34;preset\u0026#34;: \u0026#34;angular\u0026#34;, \u0026#34;infile\u0026#34;: \u0026#34;./\u0026lt;chart-name\u0026gt;/CHANGELOG.md\u0026#34;, \u0026#34;header\u0026#34;: \u0026#34;# Changelog\\n\\nAll notable changes to \u0026lt;chart-name\u0026gt; will be documented in this file.\u0026#34;, \u0026#34;gitRawCommitsOpts\u0026#34;: { \u0026#34;path\u0026#34;: \u0026#34;./\u0026lt;chart-name\u0026gt;\u0026#34; } } } } ğŸ”§ Ghi chÃº:\nThay \u0026lt;chart-name\u0026gt; báº±ng tÃªn tháº­t cá»§a chart (vd: demo-umbrella-chart, whoami). Má»—i chart cÃ³ thá»ƒ copy cáº¥u hÃ¬nh nÃ y vÃ  chá»‰ cáº§n Ä‘á»•i tÃªn lÃ  dÃ¹ng Ä‘Æ°á»£c. @release-it/bumper sáº½ tá»± Ä‘á»™ng sá»­a version trong Chart.yaml. @release-it/conventional-changelog táº¡o CHANGELOG.md dá»±a trÃªn commit Angular style. 3.3 Quy trÃ¬nh release Cháº¡y lá»‡nh sau cho chart cá»¥ thá»ƒ:\n1 2 npx release-it --config ./\u0026lt;chart-name\u0026gt;/.release-it.json VÃ­ dá»¥:\n1 npx release-it --config ./demo-umbrella-chart/.release-it.json Release It sáº½:\nLint chart (helm lint). Sinh CHANGELOG.md dá»±a trÃªn commit. TÄƒng version trong Chart.yaml. Commit vÃ  táº¡o tag demo-umbrella-chart/vX.Y.Z. Hiá»ƒn thá»‹ log hoÃ n táº¥t release. 4. Káº¿t luáº­n Viá»‡c Ã¡p dá»¥ng Release It cho tá»«ng Helm chart trong monorepo giÃºp:\nâœ… Chuáº©n hÃ³a quy trÃ¬nh release â€” má»i chart Ä‘á»u cÃ³ cáº¥u hÃ¬nh thá»‘ng nháº¥t.\nâœ… TÃ¡ch biá»‡t version control â€” má»—i chart cÃ³ tag riÃªng (\u0026lt;chart-name\u0026gt;/vX.Y.Z).\nâœ… Tá»± Ä‘á»™ng hÃ³a 100% â€” tá»« lint, version bump, Ä‘áº¿n changelog vÃ  tag Git.\nâœ… Dá»… má»Ÿ rá»™ng â€” chá»‰ cáº§n copy file cáº¥u hÃ¬nh, Ä‘á»•i \u0026lt;chart-name\u0026gt; lÃ  xong.\nâœ… Dá»… tÃ­ch há»£p CI/CD, Ä‘áº£m báº£o release luÃ´n á»•n Ä‘á»‹nh vÃ  láº·p láº¡i Ä‘Æ°á»£c.\n","date":"2025-10-12T00:40:00+08:00","permalink":"https://phongthien99.github.io/posts/automated-versioning-and-changelog-management-for-helm-charts-in-a-monorepo-with-release-it/","title":"Automated Versioning and Changelog Management for Helm Charts in a Monorepo with Release It"},{"content":"Evolutionary Architecture: Integrating C4 Model, ADR, and Version Control ğŸ§© 1. Äáº·t váº¥n Ä‘á» Trong vÃ²ng Ä‘á»i phÃ¡t triá»ƒn pháº§n má»m, kiáº¿n trÃºc luÃ´n thay Ä‘á»•i.\nMá»™t há»‡ thá»‘ng cÃ³ thá»ƒ:\nBáº¯t Ä‘áº§u tá»« monolith, Chuyá»ƒn sang microservices, Rá»“i tiáº¿n hÃ³a thÃ nh cloud-native vá»›i háº¡ táº§ng tá»± Ä‘á»™ng (IaC). Má»—i thay Ä‘á»•i Ä‘Ã³ Ä‘á»u lÃ  má»™t quyáº¿t Ä‘á»‹nh kiáº¿n trÃºc.\nNáº¿u khÃ´ng Ä‘Æ°á»£c ghi láº¡i vÃ  quáº£n lÃ½ cÃ³ há»‡ thá»‘ng, Ä‘á»™i ngÅ© sáº½ gáº·p cÃ¡c váº¥n Ä‘á» sau:\nKhÃ´ng rÃµ há»‡ thá»‘ng hiá»‡n táº¡i khÃ¡c gÃ¬ so vá»›i trÆ°á»›c Ä‘Ã¢y. KhÃ´ng biáº¿t vÃ¬ sao cÃ¡c quyáº¿t Ä‘á»‹nh kiáº¿n trÃºc Ä‘Æ°á»£c Ä‘Æ°a ra. KhÃ´ng thá»ƒ kiá»ƒm tra, khÃ´i phá»¥c hay audit lá»‹ch sá»­ kiáº¿n trÃºc. Äiá»u nÃ y dáº«n Ä‘áº¿n hiá»‡n tÆ°á»£ng â€œarchitecture driftâ€ â€” kiáº¿n trÃºc ban Ä‘áº§u dáº§n bá»‹ sai lá»‡ch so vá»›i Ä‘á»‹nh hÆ°á»›ng thiáº¿t káº¿.\nÄá»ƒ trÃ¡nh tÃ¬nh tráº¡ng Ä‘Ã³, giáº£i phÃ¡p lÃ  káº¿t há»£p:\nC4 Model â€“ mÃ´ táº£ kiáº¿n trÃºc trá»±c quan, ADR (Architecture Decision Record) â€“ ghi láº¡i lÃ½ do thay Ä‘á»•i, Version Control (Git) â€“ quáº£n lÃ½ lá»‹ch sá»­ tiáº¿n hÃ³a kiáº¿n trÃºc. âš™ï¸ 2. Giáº£i phÃ¡p: Há»‡ thá»‘ng quáº£n lÃ½ kiáº¿n trÃºc cÃ³ phiÃªn báº£n ğŸ”¹ 2.1. C4 Model â€“ Trá»±c quan hÃ³a kiáº¿n trÃºc á»Ÿ 4 cáº¥p Ä‘á»™ C4 Model, Ä‘Æ°á»£c giá»›i thiá»‡u bá»Ÿi Simon Brown, lÃ  má»™t cÃ¡ch tiáº¿p cáº­n mÃ´ hÃ¬nh hÃ³a kiáº¿n trÃºc giÃºp má»i ngÆ°á»i trong nhÃ³m â€” tá»« ká»¹ sÆ° Ä‘áº¿n quáº£n lÃ½ â€” Ä‘á»u cÃ³ thá»ƒ hiá»ƒu Ä‘Æ°á»£c há»‡ thá»‘ng á»Ÿ Ä‘Ãºng má»©c Ä‘á»™ chi tiáº¿t cáº§n thiáº¿t.\nTÃªn gá»i C4 xuáº¥t phÃ¡t tá»« bá»‘n cáº¥p Ä‘á»™ mÃ´ táº£ kiáº¿n trÃºc:\n1. System Context (Ngá»¯ cáº£nh há»‡ thá»‘ng) Má»¥c tiÃªu: MÃ´ táº£ há»‡ thá»‘ng Ä‘ang nÃ³i Ä‘áº¿n lÃ  gÃ¬ vÃ  nÃ³ tÆ°Æ¡ng tÃ¡c vá»›i ai hoáº·c há»‡ thá»‘ng nÃ o khÃ¡c. NgÆ°á»i Ä‘á»c: Quáº£n lÃ½ dá»± Ã¡n, Product Owner, Business Analyst, hoáº·c báº¥t ká»³ ai cáº§n hiá»ƒu tá»•ng thá»ƒ. Tráº£ lá»i cÃ¢u há»i: Há»‡ thá»‘ng cá»§a chÃºng ta phá»¥c vá»¥ ai vÃ  giao tiáº¿p vá»›i há»‡ thá»‘ng nÃ o? Thá»ƒ hiá»‡n: CÃ¡c tÃ¡c nhÃ¢n bÃªn ngoÃ i (ngÆ°á»i dÃ¹ng, há»‡ thá»‘ng khÃ¡c) vÃ  má»‘i quan há»‡ giá»¯a chÃºng vá»›i há»‡ thá»‘ng chÃ­nh. 2. Container (CÃ¡c khá»‘i triá»ƒn khai chÃ­nh) Má»¥c tiÃªu: MÃ´ táº£ há»‡ thá»‘ng Ä‘Æ°á»£c chia thÃ nh nhá»¯ng pháº§n lá»›n nÃ o â€” cháº³ng háº¡n nhÆ° web app, API service, database, queue, hoáº·c worker. NgÆ°á»i Ä‘á»c: Kiáº¿n trÃºc sÆ°, ká»¹ sÆ° DevOps, tech lead. Tráº£ lá»i cÃ¢u há»i: Há»‡ thá»‘ng gá»“m nhá»¯ng á»©ng dá»¥ng hay dá»‹ch vá»¥ nÃ o vÃ  chÃºng giao tiáº¿p ra sao? Thá»ƒ hiá»‡n: CÃ¡c container pháº§n má»m chÃ­nh, cÃ´ng nghá»‡ sá»­ dá»¥ng, vÃ  má»‘i quan há»‡ giá»¯a chÃºng. 3. Component (CÃ¡c thÃ nh pháº§n bÃªn trong container) Má»¥c tiÃªu: Cho biáº¿t cáº¥u trÃºc bÃªn trong cá»§a tá»«ng container, vÃ­ dá»¥ má»™t API cÃ³ nhá»¯ng module nÃ o (controller, service, repository, client\u0026hellip;). NgÆ°á»i Ä‘á»c: NhÃ  phÃ¡t triá»ƒn vÃ  kiáº¿n trÃºc sÆ° há»‡ thá»‘ng. Tráº£ lá»i cÃ¢u há»i: BÃªn trong má»™t service hoáº·c á»©ng dá»¥ng gá»“m nhá»¯ng pháº§n nÃ o vÃ  chÃºng Ä‘áº£m nhiá»‡m trÃ¡ch nhiá»‡m gÃ¬? 4. Code (Chi tiáº¿t á»Ÿ má»©c lá»›p hoáº·c hÃ m) Má»¥c tiÃªu: MÃ´ táº£ cáº¥u trÃºc chi tiáº¿t cá»§a code â€” cÃ¡ch cÃ¡c class, function hoáº·c package tÆ°Æ¡ng tÃ¡c. NgÆ°á»i Ä‘á»c: NhÃ  phÃ¡t triá»ƒn trá»±c tiáº¿p lÃ m viá»‡c vá»›i codebase. Tráº£ lá»i cÃ¢u há»i: Cáº¥u trÃºc code thá»±c táº¿ pháº£n Ã¡nh kiáº¿n trÃºc á»Ÿ má»©c nÃ o? Cáº¥p Ä‘á»™ Má»¥c tiÃªu NgÆ°á»i Ä‘á»c chÃ­nh Tráº£ lá»i cÃ¢u há»i System Context ToÃ n cáº£nh há»‡ thá»‘ng vÃ  má»‘i quan há»‡ bÃªn ngoÃ i PO, BA, Business Há»‡ thá»‘ng phá»¥c vá»¥ ai, tÆ°Æ¡ng tÃ¡c vá»›i ai Container PhÃ¢n rÃ£ há»‡ thá»‘ng thÃ nh cÃ¡c dá»‹ch vá»¥ chÃ­nh Architect, DevOps CÃ³ nhá»¯ng á»©ng dá»¥ng vÃ  cÃ´ng nghá»‡ nÃ o Component Cáº¥u trÃºc bÃªn trong má»™t container Developer, Architect CÃ³ nhá»¯ng module nÃ o vÃ  vai trÃ² ra sao Code Cáº¥u trÃºc chi tiáº¿t cá»§a code Developer Class, hÃ m, thÆ° viá»‡n tÆ°Æ¡ng tÃ¡c tháº¿ nÃ o ğŸ’¡ Khi mÃ´ hÃ¬nh Ä‘Æ°á»£c viáº¿t dÆ°á»›i dáº¡ng diagram as code (nhÆ° Mermaid hoáº·c Structurizr DSL), cÃ¡c file nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c version hÃ³a trong Git, giÃºp theo dÃµi vÃ  so sÃ¡nh dá»… dÃ ng giá»¯a cÃ¡c phiÃªn báº£n kiáº¿n trÃºc.\nğŸ”¹ 2.2. ADR â€“ Ghi láº¡i lÃ½ do cá»§a má»—i quyáº¿t Ä‘á»‹nh kiáº¿n trÃºc ADR (Architecture Decision Record) lÃ  cÃ¡ch ghi nháº­n vÃ¬ sao má»™t quyáº¿t Ä‘á»‹nh ká»¹ thuáº­t Ä‘Æ°á»£c Ä‘Æ°a ra táº¡i má»™t thá»i Ä‘iá»ƒm cá»¥ thá»ƒ.\nMá»—i ADR nÃªn tráº£ lá»i Ä‘Æ°á»£c ba cÃ¢u há»i:\nBá»‘i cáº£nh: Táº¡i sao cáº§n thay Ä‘á»•i? Quyáº¿t Ä‘á»‹nh: Giáº£i phÃ¡p Ä‘Æ°á»£c chá»n lÃ  gÃ¬? Há»‡ quáº£: TÃ¡c Ä‘á»™ng cá»§a quyáº¿t Ä‘á»‹nh nÃ y (tÃ­ch cá»±c hoáº·c tiÃªu cá»±c) lÃ  gÃ¬? VÃ­ dá»¥:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # 003 - Chuyá»ƒn tá»« REST sang Event-driven Architecture NgÃ y: 2025-07-01 Tráº¡ng thÃ¡i: Superseded by ADR-005 NgÆ°á»i Ä‘á» xuáº¥t: Giang Bá»‘i cáº£nh: REST API khÃ´ng Ä‘Ã¡p á»©ng khá»‘i lÆ°á»£ng giao dá»‹ch cao trong giá» cao Ä‘iá»ƒm. Quyáº¿t Ä‘á»‹nh: Chuyá»ƒn sang mÃ´ hÃ¬nh Event-driven sá»­ dá»¥ng SNS + SQS. Há»‡ quáº£: + TÄƒng throughput, giáº£m Ä‘á»™ trá»…. - TÄƒng Ä‘á»™ phá»©c táº¡p trong kiá»ƒm thá»­ vÃ  giÃ¡m sÃ¡t. Khi má»™t quyáº¿t Ä‘á»‹nh má»›i thay tháº¿ quyáº¿t Ä‘á»‹nh cÅ©, báº¡n chá»‰ cáº§n cáº­p nháº­t tráº¡ng thÃ¡i:\n1 Status: Superseded by ADR-005 ToÃ n bá»™ lá»‹ch sá»­ thay Ä‘á»•i Ä‘Æ°á»£c lÆ°u giá»¯ rÃµ rÃ ng vÃ  cÃ³ thá»ƒ tra cá»©u báº¥t ká»³ lÃºc nÃ o.\nğŸ”¹ 2.3. Version Control â€“ Theo dÃµi tiáº¿n hÃ³a kiáº¿n trÃºc LÆ°u C4 Model vÃ  ADR trong Git giÃºp quáº£n lÃ½ kiáº¿n trÃºc nhÆ° code:\nHÃ nh Ä‘á»™ng CÃ¡ch thá»±c hiá»‡n Xem láº¡i kiáº¿n trÃºc cÅ© git log docs/c4/container.mmd So sÃ¡nh giá»¯a hai phiÃªn báº£n git diff v1.2 v1.3 docs/adr/ Quay láº¡i kiáº¿n trÃºc cÅ© git checkout \u0026lt;commit-id\u0026gt; docs/c4/ Gáº¯n liÃªn káº¿t giá»¯a code vÃ  quyáº¿t Ä‘á»‹nh Commit message: feat(payment): implement SNS flow (ADR-003) Má»™t cáº¥u trÃºc dá»± Ã¡n cÃ³ thá»ƒ nhÆ° sau:\n1 2 3 4 5 6 7 8 9 10 11 main â”œâ”€â”€ docs/ â”‚ â”œâ”€â”€ c4/ â”‚ â”‚ â”œâ”€â”€ system-context.mmd â”‚ â”‚ â”œâ”€â”€ container.mmd â”‚ â”‚ â””â”€â”€ component.mmd â”‚ â””â”€â”€ adr/ â”‚ â”œâ”€â”€ 001-use-rest-api.md â”‚ â”œâ”€â”€ 002-use-postgresql.md â”‚ â””â”€â”€ 003-move-to-event-driven.md â””â”€â”€ src/ Má»—i commit nÃªn bao gá»“m thay Ä‘á»•i code + ADR + diagram, Ä‘áº£m báº£o ráº±ng kiáº¿n trÃºc, quyáº¿t Ä‘á»‹nh vÃ  hiá»‡n thá»±c luÃ´n Ä‘á»“ng bá»™.\nğŸ§ª 3. Thá»±c hÃ nh: Quy trÃ¬nh Ä‘á» xuáº¥t Khi cÃ³ thay Ä‘á»•i lá»›n:\nViáº¿t ADR mÃ´ táº£ lÃ½ do, cáº­p nháº­t C4 diagram tÆ°Æ¡ng á»©ng.\nCommit chuáº©n:\n1 2 git add docs/adr/004-use-step-functions.md docs/c4/container.mmd src/ git commit -m \u0026#34;ADR-004: Replace Lambda chain with Step Functions\u0026#34; Gáº¯n tag kiáº¿n trÃºc:\n1 git tag arch-v1.0 TÃ­ch há»£p CI/CD:\nTá»± Ä‘á»™ng render biá»ƒu Ä‘á»“, xuáº¥t ADR sang wiki hoáº·c documentation portal, vÃ  triá»ƒn khai tÃ i liá»‡u kiáº¿n trÃºc má»›i nháº¥t.\nğŸ§­ 4. Káº¿t luáº­n Khi káº¿t há»£p C4 Model, ADR, vÃ  Version Control, báº¡n táº¡o ra má»™t kiáº¿n trÃºc cÃ³ thá»ƒ sá»‘ng (living architecture) â€“ nÆ¡i mÃ :\nThÃ nh pháº§n Vai trÃ² ğŸ§© C4 Model GiÃºp hiá»ƒu kiáº¿n trÃºc hiá»‡n táº¡i ğŸ§¾ ADR Ghi láº¡i lÃ½ do vÃ  bá»‘i cáº£nh quyáº¿t Ä‘á»‹nh ğŸ•“ Version Control (Git) Theo dÃµi vÃ  khÃ´i phá»¥c lá»‹ch sá»­ thay Ä‘á»•i ğŸ” Code thay Ä‘á»•i â†’ Kiáº¿n trÃºc thay Ä‘á»•i â†’ Quyáº¿t Ä‘á»‹nh Ä‘Æ°á»£c ghi láº¡i â†’ Lá»‹ch sá»­ Ä‘Æ°á»£c báº£o tá»“n.\nNhá» Ä‘Ã³, Ä‘á»™i ngÅ© cÃ³ thá»ƒ:\nDá»… dÃ ng audit vÃ  review kiáº¿n trÃºc, GiÃºp ngÆ°á»i má»›i nhanh chÃ³ng hiá»ƒu lá»‹ch sá»­ ká»¹ thuáº­t, VÃ  Ä‘áº£m báº£o kiáº¿n trÃºc tiáº¿n hÃ³a cÃ³ kiá»ƒm soÃ¡t, thay vÃ¬ trÃ´i dáº¡t theo thá»i gian. ","date":"2025-10-04T00:40:00+08:00","permalink":"https://phongthien99.github.io/posts/evolutionary-architecture-integrating-c4-model-adr-and-version-control/","title":"Evolutionary Architecture: Integrating C4 Model, ADR, and Version Control"},{"content":"Hybrid Helm Chart: Combining Dependency Charts and Embedded Subcharts 1. Äáº·t váº¥n Ä‘á» Helm cho phÃ©p tá»• chá»©c chart thÃ nh nhiá»u thÃ nh pháº§n nhá», gá»i lÃ  subchart. CÃ³ hai cÃ¡ch phá»• biáº¿n Ä‘á»ƒ sá»­ dá»¥ng subchart:\nDependency Chart (theo tÃ i liá»‡u Helm): Khai bÃ¡o trong Chart.yaml â†’ dependencies. ÄÆ°á»£c táº£i vá» tá»« má»™t Helm repository hoáº·c OCI registry. VÃ­ dá»¥: Redis, PostgreSQL tá»« Bitnami. Embedded Subchart (subchart nhÃºng / ná»™i bá»™): Chart con Ä‘Æ°á»£c viáº¿t thá»§ cÃ´ng vÃ  Ä‘áº·t trá»±c tiáº¿p trong thÆ° má»¥c charts/ cá»§a chart chÃ­nh. DÃ¹ng Ä‘á»ƒ quáº£n lÃ½ dá»‹ch vá»¥ ná»™i bá»™ hoáº·c microservice riÃªng cá»§a á»©ng dá»¥ng. Trong thá»±c táº¿, nhiá»u dá»± Ã¡n vá»«a cáº§n táº­n dá»¥ng Dependency Chart (tÃ¡i sá»­ dá»¥ng chart cá»™ng Ä‘á»“ng chuáº©n), vá»«a cáº§n viáº¿t Embedded Subchart (dá»‹ch vá»¥ ná»™i bá»™ Ä‘áº·c thÃ¹).\nğŸ‘‰ Váº¥n Ä‘á» Ä‘áº·t ra: lÃ m sao káº¿t há»£p cáº£ Dependency Chart vÃ  Embedded Subchart trong má»™t release duy nháº¥t Ä‘á»ƒ triá»ƒn khai Ä‘á»“ng bá»™?\n2. Giáº£i phÃ¡p Sá»­ dá»¥ng mÃ´ hÃ¬nh Hybrid Helm Chart:\nChart chÃ­nh Ä‘Ã³ng vai trÃ² Umbrella chart. Káº¿t há»£p cáº£: Dependency Chart: khai bÃ¡o trong dependencies, fetch tá»« repo ngoÃ i. Embedded Subchart: viáº¿t thá»§ cÃ´ng vÃ  Ä‘áº·t trong charts/. Vá»›i mÃ´ hÃ¬nh nÃ y:\nTáº­n dá»¥ng Ä‘Æ°á»£c chart ngoÃ i (háº¡ táº§ng nhÆ° DB, Cache, MQ). Äá»“ng thá»i tá»• chá»©c dá»‹ch vá»¥ ná»™i bá»™ thÃ nh chart con, quáº£n lÃ½ dá»… dÃ ng. Táº¥t cáº£ Ä‘Æ°á»£c triá»ƒn khai táº­p trung trong má»™t release Helm. 3. Thá»±c hiá»‡n 3.1. Cáº¥u trÃºc thÆ° má»¥c vÃ­ dá»¥ 1 2 3 4 5 6 7 8 9 10 11 my-hybrid-app/ â”œâ”€â”€ Chart.yaml â”œâ”€â”€ values.yaml â”œâ”€â”€ charts/ â”‚ â”œâ”€â”€ redis-17.11.3.tgz # Dependency Chart (fetch tá»« Bitnami repo) â”‚ â””â”€â”€ api/ # Embedded Subchart (microservice ná»™i bá»™) â”‚ â”œâ”€â”€ Chart.yaml â”‚ â”œâ”€â”€ values.yaml â”‚ â””â”€â”€ templates/ â”‚ â”œâ”€â”€ deployment.yaml â”‚ â””â”€â”€ service.yaml redis â†’ Dependency Chart, fetch tá»« repo ngoÃ i. api â†’ Embedded Subchart, náº±m inline trong charts/. 3.2. Chart.yaml (chart chÃ­nh) 1 2 3 4 5 6 7 8 apiVersion: v2 name: my-hybrid-app version: 0.1.0 dependencies: - name: redis version: 17.11.3 repository: \u0026#34;https://charts.bitnami.com/bitnami\u0026#34; 3.3. values.yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 # Config cho Dependency Chart (redis) redis: architecture: standalone auth: enabled: false # Config cho Embedded Subchart (api) api: replicaCount: 2 image: myregistry/my-api:1.0.0 service: type: ClusterIP port: 8080 Theo Helm docs: khi deploy, Helm sáº½ merge values.yaml cá»§a chart chÃ­nh vá»›i subchart theo key (redis:, api:).\n3.4. Quy trÃ¬nh triá»ƒn khai BÆ°á»›c 1: Cáº­p nháº­t dependency Táº£i Dependency Chart tá»« repo ngoÃ i:\n1 helm dependency update ./my-hybrid-app BÆ°á»›c 2: ÄÃ³ng gÃ³i chart ÄÃ³ng gÃ³i chart chÃ­nh thÃ nh .tgz:\n1 helm package ./my-hybrid-app Káº¿t quáº£ táº¡o file:\n1 my-hybrid-app-0.1.0.tgz Trong package sáº½ cÃ³ cáº£ Dependency Chart (redis-17.11.3.tgz) vÃ  Embedded Subchart (charts/api/). LÆ°u Ã½: pháº£i cháº¡y helm dependency update trÆ°á»›c, náº¿u khÃ´ng Dependency Chart sáº½ thiáº¿u trong package. BÆ°á»›c 3: CÃ i Ä‘áº·t hoáº·c nÃ¢ng cáº¥p release Triá»ƒn khai trá»±c tiáº¿p tá»« source:\n1 helm upgrade --install my-hybrid ./my-hybrid-app -f values.yaml Hoáº·c tá»« package .tgz:\n1 helm upgrade --install my-hybrid my-hybrid-app-0.1.0.tgz -f values.yaml ğŸ‘‰ Kubernetes sáº½ triá»ƒn khai cáº£ Redis (Dependency Chart) vÃ  API (Embedded Subchart) chá»‰ trong má»™t release.\n4. Káº¿t luáº­n Hybrid Helm Chart lÃ  mÃ´ hÃ¬nh káº¿t há»£p cáº£ Dependency Chart (chart ngoÃ i tá»« repo/OCI) vÃ  Embedded Subchart (chart ná»™i bá»™ inline).\nGiáº£i quyáº¿t váº¥n Ä‘á»: tÃ¡i sá»­ dá»¥ng chart chuáº©n + triá»ƒn khai dá»‹ch vá»¥ custom. Æ¯u Ä‘iá»ƒm: quáº£n lÃ½ release táº­p trung, dá»… má»Ÿ rá»™ng, táº­n dá»¥ng chart cá»™ng Ä‘á»“ng mÃ  váº«n linh hoáº¡t. á»¨ng dá»¥ng: phÃ¹ há»£p cho há»‡ thá»‘ng microservices cÃ³ cáº£ háº¡ táº§ng chuáº©n (DB, cache, message broker) vÃ  nhiá»u service riÃªng. ","date":"2025-10-01T00:00:00Z","permalink":"https://phongthien99.github.io/posts/hybrid-helm-chart-combining-dependency-charts-and-embedded-subcharts/","title":"Hybrid Helm Chart: Combining Dependency Charts and Embedded Subcharts"},{"content":"Umbrella Chart in Kubernetes 1. Äáº·t váº¥n Ä‘á» Trong cÃ¡c á»©ng dá»¥ng Kubernetes hiá»‡n Ä‘áº¡i, má»™t dá»± Ã¡n thÆ°á»ng khÃ´ng chá»‰ bao gá»“m má»™t service Ä‘Æ¡n láº» mÃ  lÃ  táº­p há»£p nhiá»u thÃ nh pháº§n:\nWeb frontend Backend API Database Cache (Redis, Memcachedâ€¦) Message broker (RabbitMQ, Kafkaâ€¦) Khi triá»ƒn khai báº±ng Helm, náº¿u táº¡o má»™t chart riÃªng cho tá»«ng service, sáº½ gáº·p má»™t sá»‘ khÃ³ khÄƒn:\nPháº£i deploy tá»«ng chart riÃªng â†’ máº¥t thá»i gian, dá»… sai sÃ³t. Quáº£n lÃ½ cáº¥u hÃ¬nh chung (password, hostname, phiÃªn báº£n) khÃ³ khÄƒn. KhÃ´ng dá»… quáº£n lÃ½ dependency giá»¯a cÃ¡c service. Váº¥n Ä‘á» Ä‘áº·t ra:\nLÃ m sao gom nhiá»u Helm Chart con thÃ nh má»™t Ä‘Æ¡n vá»‹ triá»ƒn khai duy nháº¥t, Ä‘á»“ng bá»™, dá»… quáº£n lÃ½ cáº¥u hÃ¬nh?\n2. Giáº£i quyáº¿t: Umbrella Chart Umbrella Chart lÃ  Helm Chart â€œparentâ€ dÃ¹ng Ä‘á»ƒ gom nhiá»u Helm Chart con láº¡i thÃ nh má»™t gÃ³i triá»ƒn khai duy nháº¥t.\nÄáº·c Ä‘iá»ƒm chÃ­nh: Modularity (TÃ­nh module hÃ³a) Má»—i chart con lÃ  má»™t module riÃªng: MariaDB, Redis, Frontend. Umbrella chart gom láº¡i thÃ nh má»™t module cáº¥p cao. Abstraction (Trá»«u tÆ°á»£ng hÃ³a) Che giáº¥u chi tiáº¿t triá»ƒn khai cá»§a chart con. NgÆ°á»i dÃ¹ng chá»‰ cáº§n deploy umbrella chart vÃ  config cÃ¡c giÃ¡ trá»‹ chung. Encapsulation (ÄÃ³ng gÃ³i) Chart con cÃ³ templates vÃ  values riÃªng. Umbrella chart expose má»™t interface duy nháº¥t (values.yaml) Ä‘á»ƒ cáº¥u hÃ¬nh. Reusability (TÃ¡i sá»­ dá»¥ng) Chart con cÃ³ thá»ƒ dÃ¹ng láº¡i nhiá»u umbrella chart hoáº·c dá»± Ã¡n khÃ¡c. Parameterization (Tham sá»‘ hÃ³a) Forward values (import-values hoáº·c global) â†’ giá»‘ng truyá»n tham sá»‘ vÃ o hÃ m. VÃ­ dá»¥: password, replicas, image tag. 3. Thá»±c hÃ nh: Táº¡o Umbrella Chart BÆ°á»›c 1: Táº¡o Umbrella Chart 1 2 helm create my-umbrella rm -rf my-umbrella/templates/* BÆ°á»›c 2: Khai bÃ¡o dependency trong Chart.yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 apiVersion: v2 name: my-umbrella version: 0.1.0 dependencies: - name: mariadb version: 18.0.3 repository: \u0026#34;https://charts.bitnami.com/bitnami\u0026#34; import-values: - child: \u0026#34;\u0026#34; parent: mariadb - name: redis version: 19.0.2 repository: \u0026#34;https://charts.bitnami.com/bitnami\u0026#34; import-values: - child: \u0026#34;\u0026#34; parent: redis BÆ°á»›c 3: Config values.yaml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 mariadb: auth: rootPassword: \u0026#34;rootpass123\u0026#34; username: \u0026#34;myuser\u0026#34; password: \u0026#34;mypassword\u0026#34; database: \u0026#34;mydb\u0026#34; primary: persistence: enabled: false redis: auth: password: \u0026#34;redisSecret123\u0026#34; replica: replicaCount: 2 BÆ°á»›c 4: Update dependency 1 helm dependency update my-umbrella BÆ°á»›c 5: Render template hoáº·c deploy 1 2 helm template myapp ./my-umbrella helm install myapp ./my-umbrella Khi deploy, MariaDB vÃ  Redis sáº½ nháº­n config tá»« umbrella chart mÃ  khÃ´ng cáº§n chá»‰nh tá»«ng chart con. 4. Káº¿t luáº­n Umbrella Chart giÃºp: Quáº£n lÃ½ nhiá»u chart con trong má»™t release. Forward giÃ¡ trá»‹ chung dá»… dÃ ng. Triá»ƒn khai Ä‘á»“ng bá»™, giáº£m sai sÃ³t. Khi nÃ o nÃªn dÃ¹ng: á»¨ng dá»¥ng gá»“m nhiá»u service liÃªn quan. Muá»‘n deploy nhiá»u chart con Ä‘á»“ng thá»i. Muá»‘n maintain cáº¥u hÃ¬nh táº­p trung. ","date":"2025-09-27T00:00:00Z","permalink":"https://phongthien99.github.io/posts/umbrella-chart-in-kubernetes/","title":"Umbrella Chart in Kubernetes"},{"content":"Security and Artifact Management with Nexus Repository 1. Äáº·t váº¥n Ä‘á» Trong phÃ¡t triá»ƒn pháº§n má»m hiá»‡n Ä‘áº¡i, háº§u háº¿t dá»± Ã¡n Ä‘á»u phá»¥ thuá»™c vÃ o ráº¥t nhiá»u thÆ° viá»‡n bÃªn thá»© ba. Äiá»u nÃ y kÃ©o theo nhiá»u rá»§i ro:\nBáº£o máº­t Láº¥y dependency trá»±c tiáº¿p tá»« internet (Maven Central, npmjs.org, PyPI, â€¦) dá»… gáº·p package chá»©a mÃ£ Ä‘á»™c. KhÃ´ng cÃ³ kiá»ƒm soÃ¡t: báº¥t ká»³ ai cÅ©ng cÃ³ thá»ƒ thÃªm/sá»­ dá»¥ng artifact mÃ  khÃ´ng bá»‹ giÃ¡m sÃ¡t. Quáº£n lÃ½ artifact CÃ¡c gÃ³i ná»™i bá»™ (internal library, SDK) cáº§n má»™t nÆ¡i táº­p trung Ä‘á»ƒ chia sáº» trong team. Artifact version nhiá»u, dá»… trÃ¹ng láº·p hoáº·c tháº¥t láº¡c. CI/CD cáº§n nguá»“n tin cáº­y Ä‘á»ƒ láº¥y/gá»­i artifact, trÃ¡nh â€œmáº¥t gÃ³iâ€ hoáº·c â€œdÃ¹ng nháº§m versionâ€. ğŸ‘‰ VÃ¬ váº­y cáº§n má»™t trung tÃ¢m artifact táº­p trung, an toÃ n, dá»… quáº£n lÃ½.\n2. Giáº£i phÃ¡p: Nexus Repository Nexus Repository Manager (Nexus 3) lÃ  giáº£i phÃ¡p phá»• biáº¿n:\nBáº£o máº­t Há»— trá»£ xÃ¡c thá»±c ngÆ°á»i dÃ¹ng, phÃ¢n quyá»n chi tiáº¿t. Proxy external repository (Maven Central, npmjs.org, Docker Hub, â€¦) vÃ  cache láº¡i â†’ ngÄƒn gÃ³i Ä‘á»™c háº¡i, giáº£m phá»¥ thuá»™c internet. Quáº£n lÃ½ artifact táº­p trung LÆ°u trá»¯ artifact ná»™i bá»™ (hosted). Proxy repo bÃªn ngoÃ i (proxy). Gom nhiá»u repo thÃ nh má»™t entry duy nháº¥t cho developer dÃ¹ng (group). ChÃ­nh sÃ¡ch cleanup tá»± Ä‘á»™ng xoÃ¡ version cÅ©. TÃ­ch há»£p CI/CD Dá»… push/pull artifact trong Jenkins, GitLab CI, GitHub Actions. 3. Triá»ƒn khai Nexus báº±ng Docker 3.1. Cáº¥u hÃ¬nh docker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 services: nexus: image: sonatype/nexus3 container_name: nexus restart: always volumes: - \u0026#34;nexus-data:/sonatype-work\u0026#34; networks: default: aliases: - nexus-8081.remote - nexus-8085.remote volumes: nexus-data: {} networks: default: external: name: traefik-ingress ğŸ‘‰ Giáº£i thÃ­ch:\nVolumes nexus-data lÆ°u toÃ n bá»™ cáº¥u hÃ¬nh, artifact. Network alias giÃºp client gá»i Ä‘Æ°á»£c Nexus qua nexus-8081.remote. Náº¿u dÃ¹ng Traefik, cÃ³ thá»ƒ expose qua domain https://nexus.company.com. Cháº¡y dá»‹ch vá»¥:\n1 docker compose up -d ÄÄƒng nháº­p láº§n Ä‘áº§u: cat nexus-data/admin.password.\n4. Káº¿t ná»‘i Maven vá»›i Nexus (qua Proxy) Äá»ƒ má»i dependency Ä‘á»u Ä‘i qua Nexus thay vÃ¬ internet, cáº§n chá»‰nh file ~/.m2/settings.xml.\n4.1. File cáº¥u hÃ¬nh rÃºt gá»n 1 2 3 4 5 6 7 8 9 \u0026lt;settings\u0026gt; \u0026lt;mirrors\u0026gt; \u0026lt;mirror\u0026gt; \u0026lt;id\u0026gt;nexus\u0026lt;/id\u0026gt; \u0026lt;mirrorOf\u0026gt;*\u0026lt;/mirrorOf\u0026gt; \u0026lt;url\u0026gt;http://nexus-8081.remote:8080/repository/maven-public/\u0026lt;/url\u0026gt; \u0026lt;/mirror\u0026gt; \u0026lt;/mirrors\u0026gt; \u0026lt;/settings\u0026gt; ğŸ‘‰ Ã nghÄ©a:\nmirrorOf=\u0026quot;*\u0026quot;: táº¥t cáº£ repository Ä‘á»u Ä‘Æ°á»£c redirect qua Nexus. maven-public: lÃ  Group repo trong Nexus (gom Maven Central + repo ná»™i bá»™). Developer chá»‰ cáº§n 1 URL duy nháº¥t, khÃ´ng quan tÃ¢m repo ngoÃ i. 4.2. Example thá»­ nghiá»‡m pull artifact Táº¡o má»™t project Maven má»›i tá»« archetype:\n1 2 3 4 5 mvn archetype:generate \\ -DgroupId=com.demo \\ -DartifactId=nexus-test \\ -DarchetypeArtifactId=maven-archetype-quickstart \\ -DinteractiveMode=false ğŸ‘‰ Maven sáº½:\nGá»­i request dependency Ä‘áº¿n http://nexus-8081.remote:8080/repository/maven-public/. Nexus kiá»ƒm tra cache: Náº¿u cÃ³ sáºµn â†’ tráº£ vá» ngay. Náº¿u chÆ°a cÃ³ â†’ proxy ra Maven Central, táº£i artifact, cache láº¡i, rá»“i tráº£ vá». Láº§n sau build láº¡i, artifact sáº½ láº¥y trá»±c tiáº¿p tá»« cache trong Nexus, khÃ´ng ra internet ná»¯a.\n5. Káº¿t luáº­n Viá»‡c báº£o máº­t vÃ  quáº£n lÃ½ artifact lÃ  cá»±c ká»³ quan trá»ng khi há»‡ thá»‘ng phá»¥ thuá»™c nhiá»u package bÃªn ngoÃ i. Nexus Repository cung cáº¥p giáº£i phÃ¡p táº­p trung: Proxy \u0026amp; cache external repo â†’ an toÃ n, nhanh hÆ¡n. LÆ°u trá»¯ artifact ná»™i bá»™, dá»… quáº£n lÃ½ version. Há»— trá»£ phÃ¢n quyá»n \u0026amp; tÃ­ch há»£p tá»‘t vá»›i CI/CD. ğŸ‘‰ Vá»›i cáº¥u hÃ¬nh settings.xml rÃºt gá»n, team cÃ³ thá»ƒ ngay láº­p tá»©c chuyá»ƒn toÃ n bá»™ Maven build sang dÃ¹ng Nexus mÃ  khÃ´ng cáº§n thay Ä‘á»•i nhiá»u.\n","date":"2025-09-25T00:21:26Z","permalink":"https://phongthien99.github.io/posts/security-and-artifact-management-with-nexus-repository/","title":"Security and Artifact Management with Nexus Repository"},{"content":"Migrating Data from MySQL to PostgreSQL with Debezium CDC 1. Äáº·t váº¥n Ä‘á» Nhiá»u doanh nghiá»‡p báº¯t Ä‘áº§u vá»›i MySQL nhá» dá»… triá»ƒn khai vÃ  phá»• biáº¿n. Khi dá»¯ liá»‡u lá»›n hÆ¡n, PostgreSQL trá»Ÿ thÃ nh lá»±a chá»n Æ°u viá»‡t nhá» kháº£ nÄƒng má»Ÿ rá»™ng, chuáº©n SQL máº¡nh máº½ vÃ  tÃ­nh nÄƒng phong phÃº.\nThÃ¡ch thá»©c: LÃ m sao di chuyá»ƒn dá»¯ liá»‡u tá»« MySQL sang PostgreSQL mÃ  khÃ´ng áº£nh hÆ°á»Ÿng há»‡ thá»‘ng Ä‘ang hoáº¡t Ä‘á»™ng?\nDump \u0026amp; restore khÃ´ng kháº£ thi vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u lá»›n. Cáº§n Ä‘áº£m báº£o toÃ n váº¹n dá»¯ liá»‡u, Ä‘á»“ng bá»™ liÃªn tá»¥c, kiá»ƒm thá»­ trÆ°á»›c cutover. CDC (Change Data Capture) lÃ  giáº£i phÃ¡p, cho phÃ©p snapshot + Ä‘á»“ng bá»™ realtime.\n2. Giáº£i phÃ¡p Sá»­ dá»¥ng Debezium + Kafka + JDBC Sink Connector:\nSnapshot ban Ä‘áº§u: Debezium chá»¥p toÃ n bá»™ dá»¯ liá»‡u MySQL vÃ  push vÃ o Kafka topic â†’ PostgreSQL. CDC streaming: Debezium theo dÃµi binlog MySQL, push cÃ¡c thay Ä‘á»•i realtime sang PostgreSQL. Cutover: Chá»‰ cáº§n switch connection á»©ng dá»¥ng sang PostgreSQL, downtime gáº§n nhÆ° báº±ng 0. LÆ°u Ã½:\nSnapshot dá»¯ liá»‡u lá»›n cáº§n cáº¥u hÃ¬nh há»£p lÃ½ (snapshot.mode=initial). Chuáº©n hÃ³a schema giá»¯a MySQL vÃ  PostgreSQL (TINYINT(1) â†’ BOOLEAN, AUTO_INCREMENT â†’ SEQUENCE). 3. Thá»­ nghiá»‡m 3.1. Docker Compose 3.1.1 Kafka + Schema Registry + AKHQ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 version: \u0026#39;3.8\u0026#39; services: kafka: image: confluentinc/cp-kafka:7.6.0 container_name: kafka hostname: kafka networks: traefik-ingress: aliases: - kafka.remote ports: - 9093:9093 - 9092:9092 environment: KAFKA_PROCESS_ROLES: broker,controller KAFKA_NODE_ID: 1 KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093 KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka.remote:9092 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka.remote:9093 KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1 KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1 KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1 KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS: 0 CLUSTER_ID: yZmtfI8tQ1mNvY2dH0Ttng KAFKA_NUM_PARTITIONS: 3 KAFKA_DEFAULT_REPLICATION_FACTOR: 1 schema-registry: image: confluentinc/cp-schema-registry:7.0.1 container_name: schema-registry hostname: schema-registry networks: traefik-ingress: aliases: - schema-registry.remote environment: SCHEMA_REGISTRY_HOST_NAME: schema-registry.remote SCHEMA_REGISTRY_LISTENERS: http://0.0.0.0:8081 SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: PLAINTEXT://kafka.remote:9092 ports: - \u0026#34;8081:8081\u0026#34; akhq: image: tchiotludo/akhq:0.26.0 container_name: akhq hostname: akhq networks: traefik-ingress: aliases: - akhq.remote environment: AKHQ_CONFIGURATION: | akhq: server: access-log: true connections: kafka-cluster: properties: bootstrap.servers: \u0026#34;kafka.remote:9092\u0026#34; schema-registry: url: \u0026#34;http://schema-registry.remote:8081\u0026#34; ports: - \u0026#34;9082:8080\u0026#34; networks: traefik-ingress: external: true 3.1.2 Kafka Connect 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 version: \u0026#39;3.7\u0026#39; services: kafka-connect: image: debezium/connect:2.7.3.Final container_name: kafka-connect environment: BOOTSTRAP_SERVERS: \u0026#34;kafka.remote:9092\u0026#34; HOST_NAME: kafka-connect ADVERTISED_HOST_NAME: kafka-connect GROUP_ID: debezium-connect-cluster OFFSET_STORAGE_TOPIC: \u0026#34;debezium-connect-offsets\u0026#34; CONFIG_STORAGE_TOPIC: \u0026#34;debezium-connect-configs\u0026#34; STATUS_STORAGE_TOPIC: \u0026#34;debezium-connect-status\u0026#34; CONFIG_STORAGE_REPLICATION_FACTOR: 1 OFFSET_STORAGE_REPLICATION_FACTOR: 1 STATUS_STORAGE_REPLICATION_FACTOR: 1 CONNECT_PLUGIN_PATH: /kafka/connect networks: - traefik-ingress networks: traefik-ingress: external: true 3.1.3 MySQL \u0026amp; PostgreSQL 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 version: \u0026#39;3.8\u0026#39; services: mysql: image: mysql:8.0 command: --default-authentication-plugin=mysql_native_password --server-id=1 --log-bin=mysql-bin --binlog-format=ROW --binlog-row-image=FULL container_name: source-mysql environment: MYSQL_ROOT_PASSWORD: root MYSQL_DATABASE: appdb MYSQL_USER: appuser MYSQL_PASSWORD: apppass ports: - \u0026#34;3306:3306\u0026#34; restart: unless-stopped volumes: - mysql_data:/var/lib/mysql postgres: image: postgres:15 container_name: target-postgres environment: POSTGRES_USER: postgres POSTGRES_PASSWORD: postgres POSTGRES_DB: appdb restart: unless-stopped volumes: - postgres_data:/var/lib/postgresql/data volumes: mysql_data: postgres_data: networks: default: external: name: traefik-ingress 3.2. Táº¡o Connector vÃ  Sink Debezium / Kafka Connect cung cáº¥p REST API Ä‘á»ƒ táº¡o connector.\n3.2.1 Táº¡o Source Connector (MySQL â†’ Kafka) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 curl -X POST http://localhost:8083/connectors \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{ \u0026#34;name\u0026#34;: \u0026#34;mysql-source-json\u0026#34;, \u0026#34;config\u0026#34;: { \u0026#34;connector.class\u0026#34;: \u0026#34;io.debezium.connector.mysql.MySqlConnector\u0026#34;, \u0026#34;tasks.max\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;database.hostname\u0026#34;: \u0026#34;source-mysql\u0026#34;, \u0026#34;database.port\u0026#34;: \u0026#34;3306\u0026#34;, \u0026#34;database.user\u0026#34;: \u0026#34;appuser\u0026#34;, \u0026#34;database.password\u0026#34;: \u0026#34;apppass\u0026#34;, \u0026#34;database.server.id\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;topic.prefix\u0026#34;: \u0026#34;mysql-appdb\u0026#34;, \u0026#34;database.include.list\u0026#34;: \u0026#34;appdb\u0026#34;, \u0026#34;table.include.list\u0026#34;: \u0026#34;appdb.customers\u0026#34;, \u0026#34;snapshot.mode\u0026#34;: \u0026#34;initial\u0026#34;, \u0026#34;schema.history.internal.kafka.bootstrap.servers\u0026#34;: \u0026#34;kafka.remote:9092\u0026#34;, \u0026#34;schema.history.internal.kafka.topic\u0026#34;: \u0026#34;schema-changes.appdb\u0026#34;, \u0026#34;key.converter\u0026#34;: \u0026#34;org.apache.kafka.connect.json.JsonConverter\u0026#34;, \u0026#34;key.converter.schemas.enable\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;value.converter\u0026#34;: \u0026#34;org.apache.kafka.connect.json.JsonConverter\u0026#34;, \u0026#34;value.converter.schemas.enable\u0026#34;: \u0026#34;true\u0026#34; } }\u0026#39; 3.2.2 Táº¡o Sink Connector (Kafka â†’ PostgreSQL) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 curl -X POST http://localhost:8083/connectors \\ -H \u0026#34;Content-Type: application/json\u0026#34; \\ -d \u0026#39;{ \u0026#34;name\u0026#34;: \u0026#34;postgres-sink-json\u0026#34;, \u0026#34;config\u0026#34;: { \u0026#34;connector.class\u0026#34;: \u0026#34;io.debezium.connector.jdbc.JdbcSinkConnector\u0026#34;, \u0026#34;tasks.max\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;topics\u0026#34;: \u0026#34;mysql-appdb.appdb.customers\u0026#34;, \u0026#34;connection.url\u0026#34;: \u0026#34;jdbc:postgresql://postgres:5432/appdb\u0026#34;, \u0026#34;connection.username\u0026#34;: \u0026#34;postgres\u0026#34;, \u0026#34;connection.password\u0026#34;: \u0026#34;postgres\u0026#34;, \u0026#34;insert.mode\u0026#34;: \u0026#34;upsert\u0026#34;, \u0026#34;delete.enabled\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;primary.key.mode\u0026#34;: \u0026#34;record_key\u0026#34;, \u0026#34;primary.key.fields\u0026#34;: \u0026#34;id\u0026#34;, \u0026#34;schema.evolution\u0026#34;: \u0026#34;basic\u0026#34;, \u0026#34;table.name.format\u0026#34;: \u0026#34;customers_sink\u0026#34;, \u0026#34;key.converter\u0026#34;: \u0026#34;org.apache.kafka.connect.json.JsonConverter\u0026#34;, \u0026#34;key.converter.schemas.enable\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;value.converter\u0026#34;: \u0026#34;org.apache.kafka.connect.json.JsonConverter\u0026#34;, \u0026#34;value.converter.schemas.enable\u0026#34;: \u0026#34;true\u0026#34;, \u0026#34;transforms\u0026#34;: \u0026#34;unwrap\u0026#34;, \u0026#34;transforms.unwrap.type\u0026#34;: \u0026#34;io.debezium.transforms.ExtractNewRecordState\u0026#34;, \u0026#34;transforms.unwrap.drop.tombstones\u0026#34;: \u0026#34;false\u0026#34;, \u0026#34;transforms.unwrap.delete.handling.mode\u0026#34;: \u0026#34;rewrite\u0026#34; } }\u0026#39; Sau khi gá»i API, Debezium sáº½ báº¯t Ä‘áº§u snapshot dá»¯ liá»‡u vÃ  CDC streaming, Ä‘á»“ng bá»™ liÃªn tá»¥c tá»« MySQL sang PostgreSQL.\n1. ThÃªm dá»¯ liá»‡u má»›i (INSERT) 1 2 3 INSERT INTO customers (name, email) VALUES (\u0026#39;Charlie\u0026#39;, \u0026#39;charlie@example.com\u0026#39;), (\u0026#39;David\u0026#39;, \u0026#39;david@example.com\u0026#39;); Sau vÃ i giÃ¢y, kiá»ƒm tra PostgreSQL: 1 SELECT * FROM customers_sink; Báº¡n sáº½ tháº¥y 2 record má»›i Ä‘Æ°á»£c thÃªm vÃ o, Ä‘Ãºng vá»›i dá»¯ liá»‡u MySQL. 2. Cáº­p nháº­t dá»¯ liá»‡u (UPDATE) 1 2 3 UPDATE customers SET email = \u0026#39;alice.smith@example.com\u0026#39; WHERE name = \u0026#39;Alice\u0026#39;; Kiá»ƒm tra PostgreSQL: 1 SELECT * FROM customers_sink WHERE name = \u0026#39;Alice\u0026#39;; Email trong PostgreSQL cÅ©ng sáº½ Ä‘Æ°á»£c cáº­p nháº­t tÆ°Æ¡ng á»©ng. unwrap SMT Ä‘áº£m báº£o ráº±ng chá»‰ after state Ä‘Æ°á»£c ghi, khÃ´ng cáº§n xá»­ lÃ½ thá»§ cÃ´ng. 3. XÃ³a dá»¯ liá»‡u (DELETE) 1 DELETE FROM customers WHERE name = \u0026#39;Bob\u0026#39;; Kiá»ƒm tra PostgreSQL: 1 SELECT * FROM customers_sink; 4. Káº¿t luáº­n Downtime gáº§n nhÆ° báº±ng 0 nhá» snapshot + CDC. ToÃ n váº¹n dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘áº£m báº£o trong suá»‘t quÃ¡ trÃ¬nh di chuyá»ƒn. QuÃ¡ trÃ¬nh cutover chá»‰ lÃ  switch connection, khÃ´ng áº£nh hÆ°á»Ÿng ngÆ°á»i dÃ¹ng. ","date":"2025-09-21T00:00:00Z","permalink":"https://phongthien99.github.io/posts/migrating-data-from-mysql-to-postgresql-with-debezium-cdc/","title":"Migrating Data from MySQL to PostgreSQL with Debezium CDC"},{"content":"A Practical Guide to Avro and Schema Registry in Kafka 1. Äáº·t váº¥n Ä‘á» Trong há»‡ thá»‘ng event streaming vá»›i Kafka, dá»¯ liá»‡u Ä‘Æ°á»£c truyá»n dÆ°á»›i dáº¡ng message giá»¯a producer vÃ  consumer. Má»™t váº¥n Ä‘á» lá»›n xuáº¥t hiá»‡n khi dá»¯ liá»‡u thay Ä‘á»•i cáº¥u trÃºc (schema evolution):\nProducer thÃªm/bá»›t field trong message. Consumer cÅ© chÆ°a Ä‘Æ°á»£c nÃ¢ng cáº¥p ká»‹p thá»i. Nguy cÆ¡ consumer khÃ´ng Ä‘á»c Ä‘Æ°á»£c dá»¯ liá»‡u, gÃ¢y lá»—i toÃ n há»‡ thá»‘ng. VÃ­ dá»¥: Producer ban Ä‘áº§u gá»­i {id, name}, sau Ä‘Ã³ nÃ¢ng cáº¥p thÃªm email. Náº¿u consumer chÆ°a biáº¿t field má»›i thÃ¬ pháº£i lÃ m sao?\n2. CÃ¡ch giáº£i quyáº¿t 2.1. Avro lÃ  gÃ¬? Apache Avro lÃ  má»™t serialization framework mÃ£ nguá»“n má»Ÿ, tá»‘i Æ°u cho viá»‡c lÆ°u trá»¯ vÃ  truyá»n táº£i dá»¯ liá»‡u:\nDá»±a trÃªn schema: Ä‘á»‹nh nghÄ©a báº±ng JSON. Hiá»‡u nÄƒng cao: nhá»‹ phÃ¢n, nhá» gá»n hÆ¡n JSON/XML. Äa ngÃ´n ngá»¯: sinh code cho Java, Go, Python, C#â€¦ Há»— trá»£ schema evolution: thÃªm/bá»›t field váº«n Ä‘á»c Ä‘Æ°á»£c dá»¯ liá»‡u cÅ© náº¿u cÃ³ default. VÃ­ dá»¥ schema Avro:\n1 2 3 4 5 6 7 8 9 { \u0026#34;type\u0026#34;: \u0026#34;record\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;User\u0026#34;, \u0026#34;fields\u0026#34;: [ {\u0026#34;name\u0026#34;: \u0026#34;id\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;int\u0026#34;}, {\u0026#34;name\u0026#34;: \u0026#34;name\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;string\u0026#34;}, {\u0026#34;name\u0026#34;: \u0026#34;email\u0026#34;, \u0026#34;type\u0026#34;: [\u0026#34;null\u0026#34;,\u0026#34;string\u0026#34;], \u0026#34;default\u0026#34;: null} ] } 2.2. Lá»£i Ã­ch khi sá»­ dá»¥ng Avro trong Kafka Hiá»‡u nÄƒng \u0026amp; tiáº¿t kiá»‡m: dá»¯ liá»‡u nhá»‹ phÃ¢n gá»n nháº¹, giáº£m chi phÃ­ lÆ°u trá»¯ vÃ  bÄƒng thÃ´ng. Äáº£m báº£o tÃ­nh nháº¥t quÃ¡n: táº¥t cáº£ dá»¯ liá»‡u Ä‘á»u theo schema Ä‘Ã£ Ä‘á»‹nh nghÄ©a. Há»— trá»£ nÃ¢ng cáº¥p linh hoáº¡t: dá»… dÃ ng thÃªm/bá»›t field mÃ  khÃ´ng phÃ¡ vá»¡ há»‡ thá»‘ng. NgÃ´n ngá»¯ trung láº­p: dá»… dÃ ng tÃ­ch há»£p microservices viáº¿t báº±ng nhiá»u ngÃ´n ngá»¯ khÃ¡c nhau. Káº¿t há»£p Schema Registry: chá»‰ cáº§n gá»­i schema ID thay vÃ¬ toÃ n bá»™ schema, giÃºp quáº£n lÃ½ táº­p trung vÃ  version hÃ³a rÃµ rÃ ng. 2.3. Schema Registry Schema Registry lÃ  má»™t service trung tÃ¢m dÃ¹ng Ä‘á»ƒ:\nLÆ°u trá»¯ vÃ  quáº£n lÃ½ version schema. Äáº£m báº£o tÃ­nh tÆ°Æ¡ng thÃ­ch khi schema thay Ä‘á»•i. GiÃºp producer vÃ  consumer giao tiáº¿p an toÃ n thÃ´ng qua schema ID. 2.4. CÃ¡c cháº¿ Ä‘á»™ tÆ°Æ¡ng thÃ­ch (Compatibility Modes) Khi cáº­p nháº­t schema, Schema Registry sáº½ kiá»ƒm tra tÃ­nh tÆ°Æ¡ng thÃ­ch dá»±a trÃªn mode Ä‘Ã£ cáº¥u hÃ¬nh. CÃ³ 7 cháº¿ Ä‘á»™ chÃ­nh:\nCompatibility Type Changes allowed Check against which schemas Upgrade first BACKWARD Delete fields, Add optional fields Last version Consumers BACKWARD_TRANSITIVE Delete fields, Add optional fields All previous versions Consumers FORWARD Add fields, Delete optional fields Last version Producers FORWARD_TRANSITIVE Add fields, Delete optional fields All previous versions Producers FULL Add optional fields, Delete optional fields Last version Any order FULL_TRANSITIVE Add optional fields, Delete optional fields All previous versions Any order NONE Táº¥t cáº£ thay Ä‘á»•i Ä‘á»u Ä‘Æ°á»£c cháº¥p nháº­n KhÃ´ng kiá»ƒm tra Tuá»³ Ã nghÄ©a thá»±c táº¿: BACKWARD: phá»• biáº¿n nháº¥t trong streaming (consumer upgrade cháº­m hÆ¡n producer). BACKWARD_TRANSITIVE: an toÃ n hÆ¡n, Ä‘áº£m báº£o schema má»›i tÆ°Æ¡ng thÃ­ch vá»›i toÃ n bá»™ lá»‹ch sá»­ schema. FORWARD: phÃ¹ há»£p vá»›i batch/ETL (producer upgrade cháº­m hÆ¡n consumer). FULL vÃ  FULL_TRANSITIVE: dÃ¹ng khi há»‡ thá»‘ng yÃªu cáº§u tÆ°Æ¡ng thÃ­ch 2 chiá»u tuyá»‡t Ä‘á»‘i, upgrade producer hoáº·c consumer theo báº¥t ká»³ thá»© tá»± nÃ o. NONE: chá»‰ nÃªn dÃ¹ng trong dev/test, vÃ¬ dá»… gÃ¢y crash consumer. 3. Thá»±c hiá»‡n 3.1. Khá»Ÿi cháº¡y Kafka + Schema Registry VÃ­ dá»¥ Docker Compose:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 version: \u0026#39;2\u0026#39; services: kafka: image: \u0026#39;confluentinc/cp-kafka:7.6.0\u0026#39; container_name: kafka networks: dev-net: aliases: - kafka.remote ports: - \u0026#39;9092:9092\u0026#39; environment: KAFKA_PROCESS_ROLES: \u0026#39;broker,controller\u0026#39; KAFKA_NODE_ID: 1 KAFKA_LISTENERS: \u0026#39;PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093\u0026#39; KAFKA_ADVERTISED_LISTENERS: \u0026#39;PLAINTEXT://kafka.remote:9092\u0026#39; KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: \u0026#39;CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT\u0026#39; KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER KAFKA_CONTROLLER_QUORUM_VOTERS: \u0026#39;1@kafka.remote:9093\u0026#39; schema-registry: image: \u0026#39;confluentinc/cp-schema-registry:latest\u0026#39; environment: SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: \u0026#39;kafka:9092\u0026#39; SCHEMA_REGISTRY_HOST_NAME: schema-registry SCHEMA_REGISTRY_LISTENERS: \u0026#39;http://0.0.0.0:8081\u0026#39; 3.3. Code máº«u Golang Producer (gá»­i Avro message vá»›i schema ID) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 package main import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/segmentio/kafka-go\u0026#34; \u0026#34;github.com/riferrei/srclient\u0026#34; // Schema Registry client avro \u0026#34;github.com/hamba/avro/v2\u0026#34; ) func main() { // Táº¡o client schema registry client := srclient.CreateSchemaRegistryClient(\u0026#34;http://localhost:8081\u0026#34;) schema, err := client.GetLatestSchema(\u0026#34;user-value\u0026#34;) if err != nil { log.Fatal(err) } codec, err := avro.Parse(schema.Schema()) if err != nil { log.Fatal(err) } // Serialize dá»¯ liá»‡u user := map[string]interface{}{ \u0026#34;id\u0026#34;: 1, \u0026#34;name\u0026#34;: \u0026#34;Alice\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;alice@example.com\u0026#34;, } value, err := avro.Marshal(codec, user) if err != nil { log.Fatal(err) } // Prefix magic byte (0) + schema ID (4 bytes) encoded := make([]byte, 5+len(value)) encoded[0] = 0 encoded[1] = byte(schema.ID() \u0026gt;\u0026gt; 24) encoded[2] = byte(schema.ID() \u0026gt;\u0026gt; 16) encoded[3] = byte(schema.ID() \u0026gt;\u0026gt; 8) encoded[4] = byte(schema.ID()) copy(encoded[5:], value) // Kafka producer w := \u0026amp;kafka.Writer{ Addr: kafka.TCP(\u0026#34;localhost:9092\u0026#34;), Topic: \u0026#34;user-topic\u0026#34;, } err = w.WriteMessages(context.Background(), kafka.Message{Value: encoded}, ) if err != nil { log.Fatal(err) } fmt.Println(\u0026#34;Sent user:\u0026#34;, user) } Consumer (deserialize theo schema tá»« Registry) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 package main import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;github.com/segmentio/kafka-go\u0026#34; \u0026#34;github.com/riferrei/srclient\u0026#34; avro \u0026#34;github.com/hamba/avro/v2\u0026#34; ) func main() { client := srclient.CreateSchemaRegistryClient(\u0026#34;http://localhost:8081\u0026#34;) r := kafka.NewReader(kafka.ReaderConfig{ Brokers: []string{\u0026#34;localhost:9092\u0026#34;}, GroupID: \u0026#34;user-group\u0026#34;, Topic: \u0026#34;user-topic\u0026#34;, }) for { m, err := r.ReadMessage(context.Background()) if err != nil { log.Fatal(err) } schemaID := int(m.Value[1])\u0026lt;\u0026lt;24 | int(m.Value[2])\u0026lt;\u0026lt;16 | int(m.Value[3])\u0026lt;\u0026lt;8 | int(m.Value[4]) schema, err := client.GetSchema(schemaID) if err != nil { log.Fatal(err) } codec, err := avro.Parse(schema.Schema()) if err != nil { log.Fatal(err) } payload := m.Value[5:] var result map[string]interface{} if err := avro.Unmarshal(codec, payload, \u0026amp;result); err != nil { log.Fatal(err) } fmt.Println(\u0026#34;Received user:\u0026#34;, result) } } 4. Káº¿t luáº­n Viá»‡c káº¿t há»£p Avro + Schema Registry trong Kafka mang láº¡i nhiá»u lá»£i Ã­ch:\nAvro: serialization hiá»‡u quáº£, nhá» gá»n, há»— trá»£ schema evolution. Schema Registry: quáº£n lÃ½ schema táº­p trung, Ä‘áº£m báº£o compatibility. GiÃºp há»‡ thá»‘ng nÃ¢ng cáº¥p dáº§n dáº§n, khÃ´ng cáº§n update Ä‘á»“ng loáº¡t táº¥t cáº£ service. ğŸ‘‰ Lá»±a chá»n compatibility mode phÃ¹ há»£p lÃ  chÃ¬a khÃ³a:\nBACKWARD / BACKWARD_TRANSITIVE: event streaming, upgrade consumer cháº­m. FORWARD / FORWARD_TRANSITIVE: batch/ETL. FULL / FULL_TRANSITIVE: yÃªu cáº§u á»•n Ä‘á»‹nh tuyá»‡t Ä‘á»‘i. NONE: chá»‰ nÃªn dÃ¹ng trong dev/test. ","date":"2025-09-14T00:00:00Z","permalink":"https://phongthien99.github.io/posts/a-practical-guide-to-avro-and-schema-registry-in-kafka/","title":"A Practical Guide to Avro and Schema Registry in Kafka"},{"content":"Fake Domain trong Docker: Case Study vá»›i Kafka 1. Äáº·t váº¥n Ä‘á» Trong mÃ´i trÆ°á»ng development, chÃºng ta thÆ°á»ng cháº¡y nhiá»u service báº±ng Docker: database, message broker, APIâ€¦ Ä‘á»ƒ mÃ´ phá»ng gáº§n giá»‘ng production. CÃ¡c service nÃ y cáº§n káº¿t ná»‘i vá»›i nhau, Ä‘á»“ng thá»i developer cÅ©ng muá»‘n dÃ¹ng tool tá»« mÃ¡y host (mÃ¡y tháº­t) Ä‘á»ƒ test trá»±c tiáº¿p.\nVáº¥n Ä‘á» thÆ°á»ng gáº·p:\nNáº¿u container A gá»i container B báº±ng localhost, thÃ¬ localhost chá»‰ trá» tá»›i chÃ­nh container A, khÃ´ng pháº£i container B. Náº¿u dÃ¹ng tÃªn container (vÃ­ dá»¥ kafka), thÃ¬ trong Docker network hoáº¡t Ä‘á»™ng tá»‘t, nhÆ°ng tá»« mÃ¡y host thÃ¬ hostname nÃ y khÃ´ng resolve Ä‘Æ°á»£c. Náº¿u dÃ¹ng IP container, thÃ¬ má»—i láº§n restart container, IP cÃ³ thá»ƒ thay Ä‘á»•i â†’ config dá»… bá»‹ há»ng. Káº¿t quáº£ lÃ  developer thÆ°á»ng pháº£i duy trÃ¬ hai cáº¥u hÃ¬nh khÃ¡c nhau: má»™t cho client cháº¡y trong Docker network, má»™t cho client cháº¡y trÃªn host. ğŸ‘‰ Giáº£i phÃ¡p lÃ  sá»­ dá»¥ng fake domain alias:\nDocker cho phÃ©p gÃ¡n alias cho container trong network. CÃ¡c container cÃ¹ng network gá»i service qua alias nÃ y. TrÃªn host, ta Ã¡nh xáº¡ alias Ä‘Ã³ vá» 127.0.0.1 trong file /etc/hosts. Nhá» váº­y:\nContainer vÃ  host cÃ¹ng dÃ¹ng má»™t domain Ä‘á»ƒ káº¿t ná»‘i. Config Ä‘Æ°á»£c thá»‘ng nháº¥t, giáº£m lá»—i. Developer dev/test thuáº­n tiá»‡n hÆ¡n, khÃ´ng pháº£i chá»‰nh sá»­a config nhiá»u láº§n. 2. Case Study: Kafka trong Docker 2.1. Cáº¥u hÃ¬nh Kafka vá»›i fake domain alias VÃ­ dá»¥ trong docker-compose.yml:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 kafka: image: confluentinc/cp-kafka:7.6.0 container_name: kafka networks: dev-net: aliases: - kafka.remote # fake domain ports: - 9092:9092 environment: KAFKA_PROCESS_ROLES: broker,controller KAFKA_NODE_ID: 1 KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093 KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka.remote:9092 KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka.remote:9093 á» Ä‘Ã¢y:\nKafka quáº£ng bÃ¡ (advertise) Ä‘á»‹a chá»‰ kafka.remote:9092. Trong network dev-net, cÃ¡c container khÃ¡c cÃ³ thá»ƒ gá»i kafka.remote:9092 mÃ  khÃ´ng cáº§n IP. 2.2. Káº¿t ná»‘i tá»« mÃ¡y host MÃ¡y host khÃ´ng biáº¿t kafka.remote lÃ  gÃ¬, nÃªn náº¿u cháº¡y client Kafka tá»« host sáº½ bá»‹ lá»—i.\nGiáº£i phÃ¡p: thÃªm alias vÃ o /etc/hosts:\n1 127.0.0.1 kafka.remote Khi Ä‘Ã³:\nContainer trong network: gá»i Kafka báº±ng kafka.remote:9092. Host tháº­t: cÅ©ng gá»i Kafka báº±ng kafka.remote:9092. VÃ­ dá»¥:\n1 2 3 4 5 # Tá»« container khÃ¡c kafka-console-producer.sh --bootstrap-server kafka.remote:9092 --topic test # Tá»« host kafka-console-consumer.sh --bootstrap-server kafka.remote:9092 --topic test --from-beginning ğŸ‘‰ Cáº£ hai trÆ°á»ng há»£p Ä‘á»u dÃ¹ng chung config kafka.remote:9092.\n3. Káº¿t luáº­n Trong mÃ´i trÆ°á»ng dev, váº¥n Ä‘á» hostname giá»¯a container vÃ  host thÆ°á»ng gÃ¢y ráº¯c rá»‘i khi káº¿t ná»‘i Ä‘áº¿n cÃ¡c service nhÆ° Kafka. Sá»­ dá»¥ng fake domain alias lÃ  má»™t giáº£i phÃ¡p Ä‘Æ¡n giáº£n nhÆ°ng hiá»‡u quáº£:\nContainer vÃ  host dÃ¹ng cÃ¹ng má»™t domain. Config thá»‘ng nháº¥t, giáº£m lá»—i khi chuyá»ƒn Ä‘á»•i mÃ´i trÆ°á»ng. Dev/test thuáº­n tiá»‡n, gáº§n giá»‘ng vá»›i production (nÆ¡i thÆ°á»ng dÃ¹ng domain thay vÃ¬ IP). ÄÃ¢y lÃ  má»™t thá»§ thuáº­t nhá» nhÆ°ng cá»±c ká»³ há»¯u Ã­ch Ä‘á»ƒ giá»¯ cho mÃ´i trÆ°á»ng development gá»n gÃ ng, nháº¥t quÃ¡n vÃ  thÃ¢n thiá»‡n vá»›i developer.\n","date":"2025-09-11T10:17:00+08:00","permalink":"https://phongthien99.github.io/posts/fake-domain-trong-docker-case-study-v%E1%BB%9Bi-kafka/","title":"Fake Domain trong Docker: Case Study vá»›i Kafka"},{"content":"1. Äáº·t váº¥n Ä‘á» Trong cÃ¡c há»‡ thá»‘ng phÃ¢n tÃ¡n hiá»‡n Ä‘áº¡i, Kafka thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng nhÆ° má»™t ná»n táº£ng trung gian Ä‘á»ƒ xá»­ lÃ½ dá»¯ liá»‡u theo thá»i gian thá»±c. Khi triá»ƒn khai CDC (Change Data Capture) nháº±m Ä‘á»“ng bá»™ dá»¯ liá»‡u giá»¯a hai cÆ¡ sá»Ÿ dá»¯ liá»‡u, viá»‡c hiá»ƒu rÃµ cÃ¡c khÃ¡i niá»‡m Topic, Partition, Offset, Consumer Group vÃ  Key Message lÃ  cá»±c ká»³ quan trá»ng. Nhá»¯ng thÃ nh pháº§n nÃ y quyáº¿t Ä‘á»‹nh Ä‘áº¿n hiá»‡u nÄƒng, kháº£ nÄƒng má»Ÿ rá»™ng vÃ  tÃ­nh toÃ n váº¹n dá»¯ liá»‡u.\n2. Äá»‹nh nghÄ©a cÃ¡c khÃ¡i niá»‡m quan trá»ng 2.1 Kafka Topic LÃ  danh má»¥c (channel) nÆ¡i producer gá»­i message vÃ  consumer Ä‘á»c message. Má»—i topic Ä‘Æ°á»£c chia nhá» thÃ nh nhiá»u partition Ä‘á»ƒ há»— trá»£ song song (parallelism). 2.2 Partition Má»—i partition lÃ  má»™t log file append-only Ä‘Æ°á»£c lÆ°u trÃªn broker. Partition giÃºp Kafka scale: nhiá»u consumer cÃ³ thá»ƒ xá»­ lÃ½ song song dá»¯ liá»‡u tá»« nhiá»u partition khÃ¡c nhau. Message trong 1 partition Ä‘Æ°á»£c Ä‘áº£m báº£o thá»© tá»± (ordering). Tá»•ng throughput cá»§a topic = tá»•ng throughput cá»§a cÃ¡c partition. 2.3 Offset Offset lÃ  chá»‰ sá»‘ tuáº§n tá»± gáº¯n vá»›i má»—i message trong má»™t partition. VÃ­ dá»¥: Partition P0 cÃ³ message vá»›i offset 0,1,2â€¦ Consumer khi Ä‘á»c sáº½ ghi nhá»› offset Ä‘á»ƒ biáº¿t mÃ¬nh Ä‘Ã£ xá»­ lÃ½ Ä‘áº¿n Ä‘Ã¢u. 2.4 Consumer Group Consumer group = táº­p há»£p nhiá»u consumer cÃ¹ng Ä‘á»c 1 topic. Kafka phÃ¢n chia má»—i partition chá»‰ cho 1 consumer duy nháº¥t trong group. Náº¿u sá»‘ consumer = sá»‘ partition â†’ má»—i consumer Ä‘á»c 1 partition. Náº¿u sá»‘ consumer \u0026gt; sá»‘ partition â†’ cÃ³ consumer sáº½ idle (ngá»“i chÆ¡i). 2.5 Key trong message Kafka Key lÃ  giÃ¡ trá»‹ tÃ¹y chá»n gáº¯n vá»›i má»—i message. Kafka dÃ¹ng key Ä‘á»ƒ quyáº¿t Ä‘á»‹nh message sáº½ vÃ o partition nÃ o. CÃ¹ng key â†’ luÃ´n cÃ¹ng partition â†’ Ä‘áº£m báº£o thá»© tá»±. Key quan trá»ng khi cáº§n grouping theo entity (vd: user_id, order_id). 3. Case Study: CDC trong há»‡ thá»‘ng Order Service cá»§a E-commerce Giáº£ sá»­ má»™t há»‡ thá»‘ng Order Service trong E-commerce cáº§n Ä‘á»“ng bá»™ dá»¯ liá»‡u Ä‘Æ¡n hÃ ng tá»« Database A sang Database B qua Kafka:\nKhi Ä‘Æ¡n hÃ ng Ä‘Æ°á»£c táº¡o/cáº­p nháº­t/xÃ³a, Debezium sáº½ capture sá»± kiá»‡n vÃ  Ä‘áº©y vÃ o Kafka Topic orders. Key message = order_id â†’ Ä‘áº£m báº£o toÃ n bá»™ sá»± kiá»‡n liÃªn quan Ä‘áº¿n cÃ¹ng má»™t Ä‘Æ¡n hÃ ng Ä‘á»u náº±m trong cÃ¹ng má»™t partition. Consumer Group â€œDB-Syncâ€ (cháº¡y á»Ÿ Database B) sáº½ nháº­n dá»¯ liá»‡u vÃ  Ã¡p dá»¥ng thay Ä‘á»•i tÆ°Æ¡ng á»©ng. Lá»£i Ã­ch:\nÄáº£m báº£o tÃ­nh toÃ n váº¹n khi Ä‘á»“ng bá»™ dá»¯ liá»‡u. Há»— trá»£ scale-out báº±ng cÃ¡ch tÄƒng sá»‘ partition vÃ  sá»‘ consumer group. Váº«n giá»¯ Ä‘Æ°á»£c thá»© tá»± update cho cÃ¹ng má»™t báº£n ghi. 4. Biá»ƒu Ä‘á»“ minh há»a Quan há»‡ Topic - Partition - Consumer Group 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 @startuml title Quan há»‡ Topic - Partition - Consumer Group skinparam componentStyle rectangle skinparam shadowing false skinparam rectangle { BorderColor #555 RoundCorner 12 } rectangle \u0026#34;Topic: customers\u0026#34; as Topic { rectangle \u0026#34;Partition P0\\nOffsets: 0..n\u0026#34; as P0 rectangle \u0026#34;Partition P1\\nOffsets: 0..n\u0026#34; as P1 rectangle \u0026#34;Partition P2\\nOffsets: 0..n\u0026#34; as P2 } package \u0026#34;Consumer Group A\u0026#34; as CGA { rectangle \u0026#34;Consumer A1\u0026#34; as A1 rectangle \u0026#34;Consumer A2\u0026#34; as A2 } package \u0026#34;Consumer Group B\u0026#34; as CGB { rectangle \u0026#34;Consumer B1\u0026#34; as B1 rectangle \u0026#34;Consumer B2\u0026#34; as B2 rectangle \u0026#34;Consumer B3\u0026#34; as B3 } P0 -right-\u0026gt; A1 : read P1 -right-\u0026gt; A2 : read P2 -right-\u0026gt; A2 : read P0 -right-\u0026gt; B1 : read P1 -right-\u0026gt; B2 : read P2 -right-\u0026gt; B3 : read note bottom of Topic - Message cÃ³ **Key** (thÆ°á»ng = Primary Key/Unique Key) - Partition = hash(Key) % numPartitions - Ordering chá»‰ Ä‘Æ°á»£c Ä‘áº£m báº£o **trong 1 partition** end note note right of A2 Äiá»u kiá»‡n: - Má»—i partition chá»‰ cÃ³ 1 consumer **trong cÃ¹ng group** - Consumer \u0026gt; Partition â†’ consumer thá»«a khÃ´ng Ä‘á»c - Consumer \u0026lt; Partition â†’ consumer cÃ³ thá»ƒ Ä‘á»c nhiá»u partition end note @enduml Luá»“ng message CDC vá»›i Key vÃ  Offset 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 @startuml title Luá»“ng CDC: Producer -\u0026gt; Topic/Partition -\u0026gt; Consumer (vá»›i Key \u0026amp; Offset) actor App as Producer participant \u0026#34;Topic: customers\\nPartition P1\u0026#34; as P1 participant \u0026#34;Consumer A2\\n(Group A)\u0026#34; as A2 == Publish == Producer -\u0026gt; P1 : Produce message\\nKey = customer_id=123\\nValue = {... after ...} activate P1 P1 -\u0026gt; P1 : Ghi log append-only\\nAssign Offset = 1024 deactivate P1 note over P1 VÃ­ dá»¥: - Key: 123 -\u0026gt; hash(Key) -\u0026gt; P1 - Offset tÄƒng dáº§n: ...1023, **1024**, 1025... end note == Consume == P1 -\u0026gt; A2 : Deliver record @Offset=1024 activate A2 A2 -\u0026gt; A2 : Xá»­ lÃ½ \u0026amp; commit offset=1024 deactivate A2 == Tiáº¿p theo == Producer -\u0026gt; P1 : Key=123 (update tiáº¿p)\\n-\u0026gt; váº«n vÃ o P1 activate P1 P1 -\u0026gt; P1 : Offset=1025 deactivate P1 P1 -\u0026gt; A2 : Deliver @Offset=1025 A2 -\u0026gt; A2 : Commit offset=1025 note right of A2 Consumer nhá»› offset (commit) -\u0026gt; restart váº«n tiáº¿p tá»¥c tá»« 1026 end note @enduml 5. Káº¿t luáº­n Trong CDC vá»›i Kafka:\nKey message Ä‘Ã³ng vai trÃ² then chá»‘t trong viá»‡c Ä‘áº£m báº£o dá»¯ liá»‡u cÃ¹ng báº£n ghi Ä‘Æ°á»£c xá»­ lÃ½ tuáº§n tá»±. Partition quyáº¿t Ä‘á»‹nh kháº£ nÄƒng song song. Consumer Group Ä‘áº£m báº£o tÃ­nh cÃ¢n báº±ng táº£i vÃ  má»Ÿ rá»™ng quy mÃ´. Offset lÃ  cÆ¡ cháº¿ quan trá»ng giÃºp consumer cÃ³ thá»ƒ tiáº¿p tá»¥c Ä‘á»c tá»« Ä‘Ãºng vá»‹ trÃ­ khi xáº£y ra restart. Äiá»u kiá»‡n quan trá»ng: sá»‘ lÆ°á»£ng consumer trong group khÃ´ng nÃªn vÆ°á»£t quÃ¡ sá»‘ partition, vÃ  key cáº§n Ä‘Æ°á»£c chá»n Ä‘Ãºng (primary/unique key) Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n. Viá»‡c thiáº¿t káº¿ Ä‘Ãºng sá»‘ lÆ°á»£ng partition, cÆ¡ cháº¿ consumer group, vÃ  key trong message lÃ  ná»n táº£ng cho má»™t há»‡ thá»‘ng CDC Ä‘Ã¡ng tin cáº­y vÃ  hiá»‡u quáº£.\n","date":"2025-08-30T10:17:00+08:00","permalink":"https://phongthien99.github.io/posts/kafka-topic-partition-offset-consumer-group-and-message-key-in-change-data-capture-cdc/","title":"Kafka Topic, Partition, Offset, Consumer Group, and Message Key in Change Data Capture (CDC)"},{"content":"1. Äáº·t váº¥n Ä‘á» Trong cÃ¡c dá»± Ã¡n Golang lá»›n, thÆ°á»ng gáº·p tÃ¬nh huá»‘ng:\nModule má»›i cáº§n sá»­ dá»¥ng má»™t struct hoáº·c interface Ä‘Ã£ tá»“n táº¡i trong module cÅ©. Náº¿u import trá»±c tiáº¿p module cÅ©: module má»›i sáº½ phá»¥ thuá»™c máº¡nh vÃ o module cÅ© â†’ tight coupling, khÃ³ báº£o trÃ¬. Náº¿u di chuyá»ƒn struct/interface vÃ o shared module: pháº£i sá»­a code cÅ© â†’ dá»… gÃ¢y rá»§i ro phÃ¡ vá»¡ logic Ä‘Ã£ á»•n Ä‘á»‹nh. CÃ¢u há»i Ä‘áº·t ra:\nLÃ m sao Ä‘á»ƒ module má»›i dÃ¹ng láº¡i struct vÃ  interface cá»§a module cÅ© thÃ´ng qua má»™t shared module, mÃ  khÃ´ng thay Ä‘á»•i code cÅ©, Ä‘á»“ng thá»i giáº£m phá»©c táº¡p vÃ  dá»… maintain?\n2. Giáº£i phÃ¡p: Type Alias trong Shared Module Golang há»— trá»£ type alias, cho phÃ©p táº¡o bÃ­ danh cho struct hoáº·c interface tá»« module cÅ©. Káº¿t há»£p vá»›i shared module, ta cÃ³ thá»ƒ giáº£i quyáº¿t váº¥n Ä‘á»:\n1 2 3 4 5 6 7 8 9 10 // shared/types.go package shared import oldmodule \u0026#34;project/module_old\u0026#34; // Alias cho struct type User = oldmodule.User // Alias cho interface type UserRepository = oldmodule.UserRepository Module má»›i chá»‰ cáº§n import shared: 1 2 3 4 5 6 7 import \u0026#34;project/shared\u0026#34; func UseSharedTypes(repo shared.UserRepository) { var u shared.User u.Name = \u0026#34;Alice\u0026#34; repo.Save(u) // Gá»i phÆ°Æ¡ng thá»©c qua interface alias } Lá»£i Ã­ch: Module má»›i khÃ´ng cáº§n biáº¿t module cÅ©. Code cÅ© khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng. Náº¿u struct/interface gá»‘c thay Ä‘á»•i tÃªn hoáº·c di chuyá»ƒn, chá»‰ cáº§n cáº­p nháº­t alias trong shared module. CÃ³ thá»ƒ má»Ÿ rá»™ng báº±ng wrapper function:\n1 2 3 func NewUser(name string) shared.User { return shared.User{Name: name} } GiÃºp module má»›i thÃªm logic khá»Ÿi táº¡o object mÃ  khÃ´ng sá»­a module cÅ©. 3. Giáº£n hÃ³a sá»± phá»©c táº¡p Sá»­ dá»¥ng alias cho struct vÃ  interface giÃºp:\nGiáº£m phá»¥ thuá»™c trá»±c tiáº¿p giá»¯a module má»›i vÃ  module cÅ© â†’ trÃ¡nh tight coupling. Dá»… dÃ ng refactor hoáº·c má»Ÿ rá»™ng â†’ thay Ä‘á»•i struct/interface gá»‘c chá»‰ cáº§n sá»­a alias trong shared module. Chuáº©n hÃ³a truy cáº­p cÃ¡c type chung â†’ developer dá»… nhÃ¬n, maintain hÆ¡n. Giáº£m code láº·p láº¡i, trÃ¡nh copy/paste struct hoáº·c interface. Nhá» Ä‘Ã³, module má»›i cÃ³ thá»ƒ dÃ¹ng láº¡i cáº£ struct láº«n interface cÅ© má»™t cÃ¡ch an toÃ n, rÃµ rÃ ng vÃ  linh hoáº¡t.\n4. TuÃ¢n thá»§ vÃ  vi pháº¡m nguyÃªn táº¯c TuÃ¢n thá»§:\nDRY (Don\u0026rsquo;t Repeat Yourself): TrÃ¡nh copy struct/interface, tÃ¡i sá»­ dá»¥ng thÃ´ng qua alias. Encapsulation \u0026amp; Separation of Concerns: Module má»›i khÃ´ng cáº§n biáº¿t chi tiáº¿t module cÅ©. Maintainability: Thay Ä‘á»•i struct/interface gá»‘c khÃ´ng phÃ¡ vá»¡ module má»›i. CÃ³ thá»ƒ vi pháº¡m:\nLeak abstraction: Alias quÃ¡ nhiá»u hoáº·c khÃ´ng rÃµ rÃ ng â†’ dá»… nháº§m láº«n giá»¯a alias vÃ  struct/interface gá»‘c. Single Responsibility Principle (SRP): Shared module chá»©a quÃ¡ nhiá»u alias â†’ module trá»Ÿ nÃªn â€œquÃ¡ táº£iâ€. Overuse: Láº¡m dá»¥ng alias cho má»i struct/interface â†’ giáº£m readability, khÃ³ trace code. 5. Káº¿t luáº­n Sá»­ dá»¥ng type alias trong shared module cho cáº£ struct vÃ  interface lÃ  má»™t giáº£i phÃ¡p hiá»‡u quáº£ Ä‘á»ƒ:\nCho phÃ©p module má»›i sá»­ dá»¥ng struct vÃ  interface cá»§a module cÅ© mÃ  khÃ´ng phÃ¡ vá»¡ code hiá»‡n táº¡i. Giáº£m sá»± phá»©c táº¡p trong quáº£n lÃ½ module, chuáº©n hÃ³a Ä‘iá»ƒm truy cáº­p cÃ¡c type chung. Duy trÃ¬ tÃ­nh maintainable vÃ  má»Ÿ rá»™ng Ä‘Æ°á»£c dá»± Ã¡n, Ä‘á»“ng thá»i tuÃ¢n thá»§ nhiá»u nguyÃªn táº¯c cÆ¡ báº£n cá»§a láº­p trÃ¬nh module. ","date":"2025-08-24T01:17:00+08:00","permalink":"https://phongthien99.github.io/posts/golang-module-design-simplifying-struct-and-interface-reuse/","title":"Golang Module Design: Simplifying Struct and Interface Reuse"},{"content":"From Manual to Automated: Enhancing Nginx Test Workflows Problem Statement Trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn vÃ  váº­n hÃ nh há»‡ thá»‘ng sá»­ dá»¥ng Nginx lÃ m reverse proxy, viá»‡c thÃªm, sá»­a hoáº·c xÃ³a cÃ¡c cáº¥u hÃ¬nh location, rewrite, hoáº·c proxy_pass cÃ³ thá»ƒ:\náº¢nh hÆ°á»Ÿng khÃ´ng mong muá»‘n Ä‘áº¿n cÃ¡c routing khÃ¡c (vÃ­ dá»¥: route /admin/ bá»‹ cháº·n khi thÃªm /admin/api) GÃ¢y lá»—i áº©n khÃ³ phÃ¡t hiá»‡n do trÃ¹ng khá»›p thá»© tá»± location hoáº·c rewrite khÃ´ng Ä‘Ãºng nhÆ° mong Ä‘á»£i Thiáº¿u cÃ´ng cá»¥ kiá»ƒm thá»­ tá»± Ä‘á»™ng nÃªn viá»‡c Ä‘áº£m báº£o tÃ­nh Ä‘Ãºng Ä‘áº¯n phá»¥ thuá»™c nhiá»u vÃ o manual test hoáº·c sáº£n pháº©m tháº­t Há»‡ quáº£:\nRegression: thay Ä‘á»•i má»™t route áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c route khÃ¡c Solution Äá»ƒ giáº£i quyáº¿t nhá»¯ng váº¥n Ä‘á» trÃªn, chÃºng ta cáº§n má»™t bá»™ test tá»± Ä‘á»™ng máº¡nh máº½ Ä‘á»ƒ kiá»ƒm thá»­ routing cá»§a Nginx. Má»¥c tiÃªu lÃ  Ä‘áº£m báº£o cÃ¡c routing má»›i khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c route hiá»‡n cÃ³, Ä‘á»“ng thá»i cÃ³ thá»ƒ diá»…n giáº£i vÃ  in ra cÃ¢y routing logic giÃºp kiá»ƒm tra Ä‘á»™ Æ°u tiÃªn vÃ  khá»›p location má»™t cÃ¡ch chÃ­nh xÃ¡c. Bá»™ test nÃ y cÅ©ng pháº£i tÃ¡i sá»­ dá»¥ng Ä‘Æ°á»£c cho nhiá»u phiÃªn báº£n cáº¥u hÃ¬nh Nginx khÃ¡c nhau trong cÃ¡c quy trÃ¬nh CI/CD, staging, hoáº·c kiá»ƒm tra pull request.\nÄá» xuáº¥t ká»¹ thuáº­t:\nSá»­ dá»¥ng testcontainers káº¿t há»£p Ginkgo/Gomega: ÄÃ¢y lÃ  sá»± káº¿t há»£p lÃ½ tÆ°á»Ÿng Ä‘á»ƒ mÃ´ phá»ng há»‡ thá»‘ng Nginx vá»›i cáº¥u hÃ¬nh cá»¥ thá»ƒ. Má»—i test case sáº½ khá»Ÿi táº¡o má»™t Nginx container vá»›i file nginx.conf tÆ°Æ¡ng á»©ng, gá»­i cÃ¡c HTTP request vÃ  kiá»ƒm tra response cÃ³ Ä‘Ãºng nhÆ° ká»³ vá»ng. XÃ¢y dá»±ng bá»™ test matrix (routing path â†’ backend mong muá»‘n): CÃ¡ch tiáº¿p cáº­n nÃ y giÃºp dá»… dÃ ng má»Ÿ rá»™ng khi cÃ³ thÃªm route má»›i, Ä‘á»“ng thá»i kiá»ƒm tra hiá»‡u quáº£ cÃ¡c trÆ°á»ng há»£p xung Ä‘á»™t, rewrite sai, hoáº·c khá»›p sai thá»© tá»±. Implementation Äá»‹nh nghÄ©a routing vÃ  Test Case Routing cáº§n test:\n1 2 3 4 5 6 7 8 9 10 11 12 server { listen 80; location /web { proxy_pass http://whoami.com; } location /api/ { rewrite ^/api/(.*)$ /$1 break; proxy_pass http://whoami.com; } } Báº£ng Test Case:\nTest Case ID Input URL Expected URI nháº­n táº¡i backend Ghi chÃº TC001 /web GET /web proxy_pass giá»¯ nguyÃªn URI TC002 /api/demo GET /demo rewrite + proxy_pass TC003 /api/test/x GET /test/x rewrite sÃ¢u hÆ¡n TC004 /api/ GET / rewrite /api/ â†’ / MÃ£ nguá»“n Ginkgo test: nginx_test.go 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 package nginx_test import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;testing\u0026#34; \u0026#34;time\u0026#34; . \u0026#34;github.com/onsi/ginkgo/v2\u0026#34; . \u0026#34;github.com/onsi/gomega\u0026#34; \u0026#34;github.com/testcontainers/testcontainers-go\u0026#34; \u0026#34;github.com/testcontainers/testcontainers-go/network\u0026#34; \u0026#34;github.com/testcontainers/testcontainers-go/wait\u0026#34; ) var ( ctx context.Context net *testcontainers.DockerNetwork whoamiC testcontainers.Container nginxC testcontainers.Container ) var _ = BeforeSuite(func() { log.Print(\u0026#34;Setting up test environment...\u0026#34;) ctx = context.Background() // Táº¡o Docker network dÃ¹ng chung var err error net, err = network.New(ctx) Expect(err).NotTo(HaveOccurred()) // Táº¡o container whoami whoamiReq := testcontainers.ContainerRequest{ Image: \u0026#34;traefik/whoami:latest\u0026#34;, Name: \u0026#34;whoami\u0026#34;, Hostname: \u0026#34;whoami.com\u0026#34;, ExposedPorts: []string{\u0026#34;80/tcp\u0026#34;}, Networks: []string{net.Name}, WaitingFor: wait.ForHTTP(\u0026#34;/\u0026#34;).WithPort(\u0026#34;80/tcp\u0026#34;).WithStartupTimeout(10 * time.Second), } whoamiC, err = testcontainers.GenericContainer(ctx, testcontainers.GenericContainerRequest{ ContainerRequest: whoamiReq, Started: true, }) Expect(err).NotTo(HaveOccurred()) // Táº¡o container nginx nginxReq := testcontainers.ContainerRequest{ Image: \u0026#34;nginx:latest\u0026#34;, ExposedPorts: []string{\u0026#34;80/tcp\u0026#34;}, Networks: []string{net.Name}, WaitingFor: wait.ForHTTP(\u0026#34;/\u0026#34;).WithPort(\u0026#34;80/tcp\u0026#34;).WithStartupTimeout(10 * time.Second), Files: []testcontainers.ContainerFile{ { HostFilePath: \u0026#34;nginx.conf\u0026#34;, // ÄÆ°á»ng dáº«n Ä‘áº¿n file cáº¥u hÃ¬nh nginx trÃªn mÃ¡y local ContainerFilePath: \u0026#34;/etc/nginx/nginx.conf\u0026#34;, FileMode: 0644, }, }, } nginxC, err = testcontainers.GenericContainer(ctx, testcontainers.GenericContainerRequest{ ContainerRequest: nginxReq, Started: true, }) Expect(err).NotTo(HaveOccurred()) }) var _ = Describe(\u0026#34;Nginx Reverse Proxy to Whoami\u0026#34;, func() { testCases := []struct { name string path string expectedURI string expectSuccess bool }{ {\u0026#34;proxy_pass without rewrite\u0026#34;, \u0026#34;/web\u0026#34;, \u0026#34;GET /web\u0026#34;, true}, {\u0026#34;rewrite + proxy_pass 1\u0026#34;, \u0026#34;/api/demo\u0026#34;, \u0026#34;GET /demo\u0026#34;, true}, {\u0026#34;rewrite + proxy_pass 2\u0026#34;, \u0026#34;/api/test/x\u0026#34;, \u0026#34;GET /test/x\u0026#34;, true}, {\u0026#34;rewrite + proxy_pass root\u0026#34;, \u0026#34;/api/\u0026#34;, \u0026#34;GET /\u0026#34;, true}, } for _, tc := range testCases { tc := tc // capture range variable It(fmt.Sprintf(\u0026#34;should handle route %s â†’ %s\u0026#34;, tc.path, tc.expectedURI), func() { host, _ := nginxC.Host(ctx) port, _ := nginxC.MappedPort(ctx, \u0026#34;80\u0026#34;) url := fmt.Sprintf(\u0026#34;http://%s:%s%s\u0026#34;, host, port.Port(), tc.path) resp, err := http.Get(url) Expect(err).NotTo(HaveOccurred()) defer resp.Body.Close() body, _ := io.ReadAll(resp.Body) log.Printf(\u0026#34;Response for %s: %s\u0026#34;, tc.path, string(body)) if tc.expectSuccess { Expect(resp.StatusCode).To(Equal(200)) Expect(string(body)).To(ContainSubstring(tc.expectedURI)) Expect(string(body)).To(ContainSubstring(\u0026#34;Hostname: whoami.com\u0026#34;)) } else { Expect(string(body)).NotTo(ContainSubstring(\u0026#34;Hostname: whoami.com\u0026#34;)) } }) } }) var _ = AfterSuite(func() { log.Print(\u0026#34;Tearing down test environment...\u0026#34;) if whoamiC != nil { whoamiC.Terminate(ctx) } if nginxC != nil { nginxC.Terminate(ctx) } if net != nil { net.Remove(ctx) } }) func TestNginx(t *testing.T) { RegisterFailHandler(Fail) RunSpecs(t, \u0026#34;Nginx Suite\u0026#34;) } Äá»ƒ cháº¡y bá»™ test nÃ y, báº¡n chá»‰ cáº§n lÆ°u cáº¥u hÃ¬nh Nginx vÃ o file nginx.conf cÃ¹ng cáº¥p vá»›i file nginx_test.go vÃ  cháº¡y lá»‡nh trong terminal:\n1 go test -v Conclusion Viá»‡c kiá»ƒm thá»­ cáº¥u hÃ¬nh Nginx má»™t cÃ¡ch tá»± Ä‘á»™ng lÃ  má»™t bÆ°á»›c tiáº¿n quan trá»ng trong viá»‡c Ä‘áº£m báº£o sá»± á»•n Ä‘á»‹nh vÃ  chÃ­nh xÃ¡c cá»§a há»‡ thá»‘ng. Báº±ng cÃ¡ch káº¿t há»£p Testcontainers vÃ  Ginkgo/Gomega, chÃºng ta Ä‘Ã£ xÃ¢y dá»±ng Ä‘Æ°á»£c má»™t bá»™ khung máº¡nh máº½, cho phÃ©p:\nTá»± Ä‘á»™ng hÃ³a kiá»ƒm thá»­: Giáº£m thiá»ƒu Ä‘Ã¡ng ká»ƒ rá»§i ro gÃ¢y ra bá»Ÿi cÃ¡c thay Ä‘á»•i cáº¥u hÃ¬nh thá»§ cÃ´ng. PhÃ¡t hiá»‡n sá»›m lá»—i: CÃ¡c váº¥n Ä‘á» vá» routing, rewrite, hoáº·c xung Ä‘á»™t cáº¥u hÃ¬nh sáº½ Ä‘Æ°á»£c nháº­n diá»‡n ngay trong giai Ä‘oáº¡n phÃ¡t triá»ƒn hoáº·c CI/CD. Kiá»ƒm soÃ¡t phá»©c táº¡p: GiÃºp quáº£n lÃ½ hiá»‡u quáº£ hÆ¡n cÃ¡c cáº¥u hÃ¬nh Nginx ngÃ y cÃ ng phá»©c táº¡p, Ä‘áº·c biá»‡t trong cÃ¡c há»‡ thá»‘ng microservices. ","date":"2025-07-18T00:00:00Z","permalink":"https://phongthien99.github.io/posts/from-manual-to-automated-enhancing-nginx-test-workflows/","title":"From Manual to Automated: Enhancing Nginx Test Workflows"},{"content":"Sharing JS Code Made Easy with pnpm Workspaces \u0026amp; Git Submodules ğŸ¯ Äáº·t Váº¥n Äá»: HÃ£y tÆ°á»Ÿng tÆ°á»£ng báº¡n cÃ³ nhiá»u dá»± Ã¡n front-end (vÃ­ dá»¥: má»™t á»©ng dá»¥ng web chÃ­nh, má»™t cá»•ng admin, má»™t landing page riÃªng) vÃ  nhiá»u dá»± Ã¡n back-end (API Gateway, microservices). Táº¥t cáº£ nhá»¯ng dá»± Ã¡n nÃ y Ä‘á»u cáº§n dÃ¹ng chung má»™t sá»‘ thÃ nh pháº§n nhÆ°:\nUI Components: CÃ¡c thÃ nh pháº§n giao diá»‡n tÃ¡i sá»­ dá»¥ng (button, modal, form inputâ€¦). Utility Functions: CÃ¡c hÃ m tiá»‡n Ã­ch (validation, format ngÃ y giá», helpers gá»i APIâ€¦). Type Definitions: CÃ¡c Ä‘á»‹nh nghÄ©a kiá»ƒu TypeScript chung (interfaces, enumsâ€¦). Business Logic: CÃ¡c module xá»­ lÃ½ nghiá»‡p vá»¥ lÃµi. Náº¿u khÃ´ng cÃ³ chiáº¿n lÆ°á»£c quáº£n lÃ½ tá»‘t, báº¡n sáº½ gáº·p pháº£i nhá»¯ng váº¥n Ä‘á» sau:\nSao chÃ©p mÃ£ nguá»“n (Code Duplication): Pháº£i copy-paste code giá»¯a nhiá»u dá»± Ã¡n. Khi sá»­a bug hay update logic, pháº£i sá»­a nhiá»u nÆ¡i, dá»… sÃ³t hoáº·c gÃ¢y lá»—i má»›i. KhÃ³ khÄƒn khi cáº­p nháº­t (Difficult Updates): Má»—i láº§n cáº§n cáº­p nháº­t thÆ° viá»‡n chung, pháº£i update thá»§ cÃ´ng tá»«ng dá»± Ã¡n, dá»… quÃªn vÃ  dá»… phÃ¡ vá»¡. Quáº£n lÃ½ phiÃªn báº£n phá»©c táº¡p (Version Management): LÃ m sao Ä‘áº£m báº£o táº¥t cáº£ dá»± Ã¡n cháº¡y á»•n Ä‘á»‹nh vá»›i cÃ¡c version phÃ¹ há»£p? ğŸ’¡ Giáº£i PhÃ¡p: Káº¿t Há»£p pnpm workspace vÃ  git submodule Äá»ƒ giáº£i quyáº¿t triá»‡t Ä‘á»ƒ, chÃºng ta cÃ³ thá»ƒ káº¿t há»£p pnpm workspace vÃ  git submodule.\nğŸŸ¢ pnpm workspace Cho phÃ©p quáº£n lÃ½ nhiá»u package (dá»± Ã¡n con hoáº·c thÆ° viá»‡n) trong cÃ¹ng má»™t repo hoáº·c cÃ¡c folder con. ğŸ”µ git submodule Cho phÃ©p nhÃºng má»™t repository Git khÃ¡c vÃ o nhÆ° má»™t thÆ° má»¥c con, nhÆ°ng váº«n giá»¯ commit vÃ  lá»‹ch sá»­ riÃªng. Báº¡n cÃ³ thá»ƒ lock tá»«ng dá»± Ã¡n vÃ o má»™t commit cá»¥ thá»ƒ cá»§a shared lib. TÃ¡ch biá»‡t rÃµ rÃ ng trÃ¡ch nhiá»‡m giá»¯a repo chÃ­nh vÃ  repo thÆ° viá»‡n. âš™ï¸ CÆ¡ Cháº¿ Hoáº¡t Äá»™ng Táº¡o repo riÃªng cho shared libraries, vÃ­ dá»¥: shared-libs. Trong má»—i dá»± Ã¡n chÃ­nh, thÃªm shared-libs lÃ m submodule náº¿u cáº§n dÃ¹ng . Cáº¥u hÃ¬nh pnpm workspace Ä‘á»ƒ nháº­n diá»‡n cÃ¡c package con bÃªn trong shared-libs. CÃ¡c dá»± Ã¡n sá»­ dá»¥ng thÆ° viá»‡n báº±ng cÃ¡ch khai bÃ¡o trá»±c tiáº¿p trong package.json. ğŸš€ Thá»±c Hiá»‡n Chi Tiáº¿t BÆ°á»›c 1ï¸âƒ£: ThÃªm shared-libs vÃ o dá»± Ã¡n chÃ­nh báº±ng git submodule 1 2 3 git submodule add https://github.com/your-org/shared-libs lib/shared-libs git submodule update --init --recursive ğŸ“ Sau bÆ°á»›c nÃ y, thÆ° má»¥c lib/shared-libs chá»©a toÃ n bá»™ mÃ£ nguá»“n thÆ° viá»‡n dÃ¹ng chung.\nBÆ°á»›c 2ï¸âƒ£: Cáº¥u hÃ¬nh pnpm workspace Táº¡i thÆ° má»¥c gá»‘c dá»± Ã¡n chÃ­nh, thÃªm file pnpm-workspace.yaml (hoáº·c chá»‰nh sá»­a náº¿u Ä‘Ã£ cÃ³):\n1 2 3 packages: - \u0026#39;lib/shared-libs/packages/*\u0026#39; âœ… pnpm sáº½ tá»± nháº­n diá»‡n cÃ¡c package bÃªn trong lib/shared-libs/packages nhÆ° cÃ¡c package ná»™i bá»™.\nBÆ°á»›c 3ï¸âƒ£: Khai bÃ¡o dependency trong package.json Má»Ÿ file package.json cá»§a dá»± Ã¡n chÃ­nh, chá»‰nh dependencies (hoáº·c devDependencies) nhÆ° sau:\n1 2 3 4 5 6 7 8 9 10 { \u0026#34;name\u0026#34;: \u0026#34;web-app\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;private\u0026#34;: true, \u0026#34;dependencies\u0026#34;: { \u0026#34;@shared/utils\u0026#34;: \u0026#34;workspace:*\u0026#34;, \u0026#34;@shared/ui-components\u0026#34;: \u0026#34;workspace:*\u0026#34; } } ğŸ”¥ DÃ²ng \u0026ldquo;workspace:*\u0026rdquo; cÃ³ nghÄ©a: pnpm sáº½ liÃªn káº¿t trá»±c tiáº¿p package ná»™i bá»™ (khÃ´ng dÃ¹ng báº£n publish trÃªn npm), tiá»‡n cho phÃ¡t triá»ƒn song song.\nBÆ°á»›c 4ï¸âƒ£: CÃ i Ä‘áº·t Sau khi chá»‰nh xong package.json, cháº¡y:\n1 2 pnpm install BÆ°á»›c 5ï¸âƒ£: LÃ m viá»‡c vá»›i submodule Clone dá»± Ã¡n má»›i 1 2 3 4 git clone \u0026lt;your-main-project-url\u0026gt; git submodule update --init --recursive pnpm install Khi cáº§n cáº­p nháº­t shared-libs 1 2 3 4 5 cd lib/shared-libs git pull origin main cd ../.. git add lib/shared-libs git commit -m \u0026#34;Update shared-libs to latest commit\u0026#34; ğŸ› ï¸ Má»™t sá»‘ lá»‡nh há»¯u Ã­ch vá»›i git submodule Lá»‡nh Má»¥c Ä‘Ã­ch git submodule Liá»‡t kÃª submodule hiá»‡n cÃ³ git submodule update --init Khá»Ÿi táº¡o vÃ  Ä‘á»“ng bá»™ submodule sau khi clone git submodule add \u0026lt;repo\u0026gt; \u0026lt;path\u0026gt; ThÃªm submodule má»›i cd lib/shared-libs \u0026amp;\u0026amp; git pull Láº¥y version má»›i nháº¥t cá»§a submodule git add lib/shared-libs \u0026amp;\u0026amp; git commit Commit thay Ä‘á»•i submodule ğŸ Káº¿t Luáº­n ğŸ’¥ Lá»£i Ãch Khi Káº¿t Há»£p âœ… Giáº£m trÃ¹ng láº·p mÃ£ nguá»“n â€” khÃ´ng cÃ²n copy-paste.\nâœ… Quáº£n lÃ½ dependency chÃ­nh xÃ¡c â€” má»—i dá»± Ã¡n lock commit submodule riÃªng, khÃ´ng bá»‹ vá»¡.\nâœ… PhÃ¡t triá»ƒn nhanh \u0026amp; debug dá»… â€” sá»­a code shared-libs, dá»± Ã¡n chÃ­nh tháº¥y ngay.\nâœ… Quáº£n lÃ½ phiÃªn báº£n rÃµ rÃ ng â€” submodule tÃ¡ch biá»‡t, chá»§ Ä‘á»™ng cáº­p nháº­t.\nViá»‡c káº¿t há»£p pnpm workspace vÃ  git submodule mang Ä‘áº¿n má»™t giáº£i phÃ¡p cá»±c ká»³ máº¡nh máº½ vÃ  thá»±c dá»¥ng Ä‘á»ƒ quáº£n lÃ½ thÆ° viá»‡n dÃ¹ng chung giá»¯a nhiá»u dá»± Ã¡n JavaScript/TypeScript.\nâœ… KhÃ´ng chá»‰ giÃºp giáº£m rá»§i ro, tiáº¿t kiá»‡m thá»i gian, mÃ  cÃ²n tá»‘i Æ°u chi phÃ­ build, test vÃ  deploy.\nDÃ¹ cÃ³ thá»ƒ cáº§n thÃªm chÃºt cÃ´ng sá»©c ban Ä‘áº§u Ä‘á»ƒ thiáº¿t láº­p, nhÆ°ng vá» lÃ¢u dÃ i Ä‘Ã¢y lÃ  giáº£i phÃ¡p ráº¥t Ä‘Ã¡ng giÃ¡ cho nhá»¯ng há»‡ thá»‘ng lá»›n, nhiá»u repo, nhiá»u nhÃ³m cÃ¹ng phÃ¡t triá»ƒn.\n","date":"2025-07-13T00:00:00Z","permalink":"https://phongthien99.github.io/posts/sharing-js-code-made-easy-with-pnpm-workspaces-git-submodules/","title":"Sharing JS Code Made Easy with pnpm Workspaces \u0026 Git Submodules"},{"content":"Streamlining Deployment with GitLab CI/CD ğŸ§© 1. Äáº·t Váº¥n Äá» Trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn pháº§n má»m, viá»‡c kiá»ƒm thá»­ vÃ  debug nhanh cÃ¡c job CI/CD lÃ  ráº¥t quan trá»ng. Tuy nhiÃªn, GitLab CI/CD thÆ°á»ng gáº·p má»™t sá»‘ váº¥n Ä‘á» khi test local báº±ng gitlab-runner exec:\nâŒ gitlab-runner exec khÃ´ng há»— trá»£ include: hoáº·c extends: tá»« file ngoÃ i âŒ Pipeline thá»±c táº¿ quÃ¡ phá»©c táº¡p, chá»©a nhiá»u mÃ´i trÆ°á»ng nhÆ° dev, prod, staging âŒ KhÃ´ng dá»… test nhanh tá»«ng job do pháº£i khai bÃ¡o phÃ¢n tÃ¡n, phá»¥ thuá»™c nhiá»u nÆ¡i ğŸ’¡ 2. Giáº£i PhÃ¡p Váº¥n Ä‘á» Giáº£i phÃ¡p KhÃ´ng test local Ä‘Æ°á»£c Gom job + biáº¿n vÃ o 1 file duy nháº¥t Ä‘á»ƒ test Quáº£n lÃ½ nhiá»u mÃ´i trÆ°á»ng Má»—i mÃ´i trÆ°á»ng tÃ¡ch riÃªng vars-*.yml TÃ¡i sá»­ dá»¥ng script DÃ¹ng .job-base lÃ m template job Giá»¯ file .gitlab-ci.yml gá»n Chá»‰ include file tá»•ng .ci/include.yml ğŸ› ï¸ 3. Thá»±c Hiá»‡n ğŸ“ 3.1. Cáº¥u trÃºc thÆ° má»¥c 1 2 3 4 5 6 7 8 9 10 11 .gitlab-ci.yml .ci/ â”œâ”€ job-template.yml â”œâ”€ vars-local.yml â”œâ”€ vars-dev.yml â”œâ”€ vars-prod.yml â”œâ”€ workflow-dev.yml â”œâ”€ workflow-prod.yml â”œâ”€ include.yml ğŸ“ Ghi chÃº: ChÃºng ta tÃ¡ch cáº¥u hÃ¬nh CI/CD thÃ nh cÃ¡c thÃ nh pháº§n nhá» gá»n vÃ  rÃµ rÃ ng:\nTemplate dÃ¹ng chung Biáº¿n theo tá»«ng mÃ´i trÆ°á»ng Workflow cá»¥ thá»ƒ cho tá»«ng mÃ´i trÆ°á»ng File gom tá»•ng cho cháº¡y thá»±c táº¿ \u0026amp; cháº¡y local ğŸ§± 3.2. Äá»‹nh nghÄ©a job template .ci/job-template.yml 1 2 3 4 5 6 7 8 9 10 .job-base: stage: test tags: - dind script: - echo \u0026#34;ENV=$ENV\u0026#34; - echo \u0026#34;API_URL=$API_URL\u0026#34; variables: ENV: \u0026#34;local\u0026#34; API_URL: \u0026#34;http://localhost:3000\u0026#34; ğŸ“Œ Ghi chÃº: ÄÃ¢y lÃ  template chÃ­nh, Ä‘á»‹nh nghÄ©a cÃ¡c bÆ°á»›c vÃ  biáº¿n máº·c Ä‘á»‹nh.\nMá»i job thá»±c táº¿ sáº½ extends tá»« .job-base.\nâš™ï¸ 3.3. Biáº¿n mÃ´i trÆ°á»ng .ci/vars-dev.yml 1 2 3 4 .variables-dev: variables: ENV: \u0026#34;dev\u0026#34; API_URL: \u0026#34;https://api.dev.example.com\u0026#34; .ci/vars-local.yml 1 2 3 4 .variables-local: variables: ENV: \u0026#34;local\u0026#34; API_URL: \u0026#34;http://localhost:3000\u0026#34; .ci/vars-prod.yml 1 2 3 4 .variables-prod: variables: ENV: \u0026#34;prod\u0026#34; API_URL: \u0026#34;https://api.prod.example.com\u0026#34; ğŸ“Œ Ghi chÃº: TÃ¡ch biáº¿n theo tá»«ng mÃ´i trÆ°á»ng giÃºp:\nKhÃ´ng bá»‹ nháº§m biáº¿n khi deploy Dá»… test tá»«ng mÃ´i trÆ°á»ng Ä‘á»™c láº­p Linh hoáº¡t má»Ÿ rá»™ng vá» sau (thÃªm qa, uat, v.v.) ğŸ” 3.4. Äá»‹nh nghÄ©a cÃ¡c job .ci/workflow-dev.yml 1 2 job-dev: extends: [.job-base, .variables-dev] .ci/workflow-prod.yml 1 2 job-prod: extends: [.job-base, .variables-prod] ğŸ“Œ Ghi chÃº: Má»—i job Ä‘Æ°á»£c build báº±ng cÃ¡ch káº¿ thá»«a job-base vÃ  biáº¿n riÃªng mÃ´i trÆ°á»ng.\nGiÃºp cáº¥u hÃ¬nh Ä‘Æ¡n giáº£n, khÃ´ng láº·p láº¡i.\nğŸ“¦ 3.5. File include.yml 1 2 3 4 5 6 include: - local: \u0026#34;.ci/job-template.yml\u0026#34; - local: \u0026#34;.ci/vars-dev.yml\u0026#34; - local: \u0026#34;.ci/vars-prod.yml\u0026#34; - local: \u0026#34;.ci/workflow-dev.yml\u0026#34; - local: \u0026#34;.ci/workflow-prod.yml\u0026#34; ğŸ“Œ Ghi chÃº: Gom táº¥t cáº£ file cáº§n thiáº¿t cho pipeline GitLab CI cháº¡y thá»±c táº¿ trÃªn server.\nFile .gitlab-ci.yml chá»‰ cáº§n include file nÃ y lÃ  Ä‘á»§.\nğŸ§ª 3.7. Cháº¡y test local 1 2 gitlab-runner exec shell .job-base --cicd-config-file .ci/job-template.yml ğŸ› ï¸ Ghi chÃº:\nLá»‡nh nÃ y sáº½ cháº¡y job .job-base báº±ng cáº¥u hÃ¬nh trong file .ci/job-template.yml.\nCÃ³ thá»ƒ chá»‰nh sá»­a nhanh script, biáº¿n, v.v. Ä‘á»ƒ test mÃ  khÃ´ng áº£nh hÆ°á»Ÿng pipeline tháº­t.\nâœ… 4. Káº¿t Luáº­n âœ… Æ¯u Ä‘iá»ƒm Ä‘áº¡t Ä‘Æ°á»£c âœ”ï¸ Dá»… test local: â†’ Test Ä‘Æ°á»£c tá»«ng job thÃ´ng qua giÃ¡ trá»‹ cá»§a biáº¿n mÃ´i trÆ°á»ng (variable). âœ”ï¸ Quáº£n lÃ½ mÃ´i trÆ°á»ng rÃµ rÃ ng: â†’ Má»—i mÃ´i trÆ°á»ng (dev, staging, prod,\u0026hellip;) cÃ³ file biáº¿n riÃªng (vars-*.yml). âœ”ï¸ Dá»… báº£o trÃ¬ \u0026amp; má»Ÿ rá»™ng: â†’ DÃ¹ng job-base nhÆ° template Ä‘á»ƒ trÃ¡nh láº·p láº¡i, dá»… má»Ÿ rá»™ng khi thÃªm job má»›i. âœ”ï¸ CI gá»n nháº¹: â†’ File .gitlab-ci.yml chÃ­nh chá»‰ cáº§n include má»™t file tá»•ng há»£p. ğŸ”§ NguyÃªn lÃ½ ká»¹ thuáº­t pháº§n má»m \u0026amp; á»¨ng dá»¥ng trong GitLab CI/CD Function/Module Reuse (TÃ¡i sá»­ dá»¥ng hÃ m/module): â†’ job-base hoáº¡t Ä‘á»™ng nhÆ° má»™t hÃ m dÃ¹ng láº¡i, cÃ¡c job chá»‰ cáº§n extends Ä‘á»ƒ káº¿ thá»«a cáº¥u trÃºc. Encapsulation (ÄÃ³ng gÃ³i): â†’ Biáº¿n mÃ´i trÆ°á»ng Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i theo tá»«ng mÃ´i trÆ°á»ng riÃªng biá»‡t (vars-dev.yml, vars-prod.yml), giÃºp trÃ¡nh rÃ² rá»‰ hoáº·c ghi Ä‘Ã¨ sai lá»‡ch. Composition over Inheritance (ThÃ nh pháº§n hÆ¡n káº¿ thá»«a): â†’ Káº¿t há»£p job-base + file biáº¿n (.variables-*) cho phÃ©p tÃ¡i sá»­ dá»¥ng linh hoáº¡t hÆ¡n lÃ  copy/paste hoáº·c káº¿ thá»«a toÃ n bá»™ job. Separation of Concerns (PhÃ¢n tÃ¡ch trÃ¡ch nhiá»‡m): â†’ TÃ¡ch biá»‡t tá»«ng thÃ nh pháº§n CI/CD: Template job (job-template.yml) Biáº¿n mÃ´i trÆ°á»ng (vars-*.yml) Luá»“ng chÃ­nh (.gitlab-ci.yml) â†’ Má»—i file chá»‰ Ä‘áº£m nháº­n má»™t vai trÃ² duy nháº¥t, dá»… Ä‘á»c vÃ  dá»… debug. Unit Test / Test Ä‘á»™c láº­p hÃ m: â†’ CÃ³ thá»ƒ test tá»«ng job Ä‘á»™c láº­p trong job-template.yml nhÆ° cÃ¡ch viáº¿t vÃ  test unit test trong láº­p trÃ¬nh. ","date":"2025-06-21T01:00:00Z","permalink":"https://phongthien99.github.io/posts/streamlining-deployment-with-gitlab-ci/cd/","title":"Streamlining Deployment with GitLab CI/CD"},{"content":"Guide to Running GitLab Runner Locally for Building and Testing CI/CD Pipelines Äáº·t Váº¥n Äá» Trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn pháº§n má»m, viá»‡c kiá»ƒm thá»­ vÃ  triá»ƒn khai á»©ng dá»¥ng thÆ°á»ng xuyÃªn lÃ  Ä‘iá»u khÃ´ng thá»ƒ thiáº¿u. Tuy nhiÃªn, viá»‡c Ä‘á»£i pipeline CI/CD cháº¡y trÃªn GitLab server cÃ³ thá»ƒ máº¥t thá»i gian, Ä‘áº·c biá»‡t khi cáº§n thá»­ nghiá»‡m nhanh cÃ¡c thay Ä‘á»•i nhá» trong cáº¥u hÃ¬nh hoáº·c script. Äiá»u nÃ y lÃ m giáº£m hiá»‡u quáº£ lÃ m viá»‡c vÃ  gÃ¢y khÃ³ khÄƒn trong viá»‡c debug.\nGiáº£i PhÃ¡p Cháº¡y GitLab Runner ngay trÃªn mÃ¡y local lÃ  má»™t giáº£i phÃ¡p hiá»‡u quáº£. Äiá»u nÃ y cho phÃ©p báº¡n kiá»ƒm thá»­ cÃ¡c job CI/CD má»™t cÃ¡ch nhanh chÃ³ng mÃ  khÃ´ng cáº§n push code lÃªn GitLab, tá»« Ä‘Ã³ tiáº¿t kiá»‡m thá»i gian vÃ  giáº£m thiá»ƒu rá»§i ro phÃ¡t sinh khi deploy lÃªn mÃ´i trÆ°á»ng tháº­t.\nThá»±c Hiá»‡n BÆ°á»›c 1: CÃ i Äáº·t GitLab Runner Äá»‘i vá»›i há»‡ Ä‘iá»u hÃ nh Ubuntu, báº¡n cÃ³ thá»ƒ cÃ i Ä‘áº·t GitLab Runner báº±ng cÃ¡ch cháº¡y:\n1 2 3 curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash sudo apt-get install gitlab-runner=15.11.1 âš ï¸ LÆ°u Ã½: Báº¡n cÃ³ thá»ƒ chá»n phiÃªn báº£n má»›i nháº¥t hoáº·c giá»¯ cá»‘ Ä‘á»‹nh má»™t phiÃªn báº£n á»•n Ä‘á»‹nh tÃ¹y theo yÃªu cáº§u dá»± Ã¡n.\nBÆ°á»›c 2: Viáº¿t File gitlab-ci.yaml ÄÃ¢y lÃ  file Ä‘á»‹nh nghÄ©a pipeline. DÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ má»™t job Ä‘Æ¡n giáº£n dÃ¹ng Ä‘á»ƒ build Docker image:\n1 2 3 4 5 6 7 8 9 10 image: docker:dind stages: - build build-image: stage: build tags: - shel script: - echo \u0026#34;Build image\u0026#34; BÆ°á»›c 4: Cháº¡y GitLab Runner Local Khi Ä‘Ã£ cÃ³ Ä‘áº§y Ä‘á»§ file cáº¥u hÃ¬nh, báº¡n chá»‰ cáº§n cháº¡y lá»‡nh sau Ä‘á»ƒ thá»±c thi pipeline ngay trÃªn mÃ¡y:\n1 2 gitlab-runner exec docker build-image Lá»‡nh nÃ y sáº½ cháº¡y job build-image báº±ng executor docker â€“ tá»©c lÃ  trá»±c tiáº¿p trÃªn mÃ´i trÆ°á»ng mÃ¡y báº¡n, khÃ´ng cáº§n Ä‘Äƒng kÃ½ runner hay káº¿t ná»‘i vá»›i GitLab server.\nKáº¿t Luáº­n Viá»‡c cháº¡y GitLab Runner cá»¥c bá»™ lÃ  má»™t cÃ´ng cá»¥ cá»±c ká»³ há»¯u Ã­ch trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn pháº§n má»m hiá»‡n Ä‘áº¡i. NÃ³ giÃºp báº¡n kiá»ƒm thá»­ nhanh pipeline, tiáº¿t kiá»‡m thá»i gian debug, Ä‘áº£m báº£o cáº¥u hÃ¬nh chÃ­nh xÃ¡c trÆ°á»›c khi Ä‘Æ°a code lÃªn mÃ´i trÆ°á»ng CI/CD chÃ­nh thá»©c. HÃ£y táº­n dá»¥ng tÃ­nh nÄƒng nÃ y Ä‘á»ƒ tá»‘i Æ°u hÃ³a quy trÃ¬nh phÃ¡t triá»ƒn vÃ  nÃ¢ng cao cháº¥t lÆ°á»£ng pháº§n má»m cá»§a báº¡n.\n","date":"2025-06-21T00:00:00Z","permalink":"https://phongthien99.github.io/posts/guide-to-running-gitlab-runner-locally-for-building-and-testing-ci/cd-pipelines/","title":"Guide to Running GitLab Runner Locally for Building and Testing CI/CD Pipelines"},{"content":"Hosting a Debian Repository on S3 using Reprepro and AWS CLI I. Äáº·t váº¥n Ä‘á» Trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn pháº§n má»m, Ä‘áº·c biá»‡t vá»›i há»‡ thá»‘ng backend hoáº·c háº¡ táº§ng Ä‘Ã³ng gÃ³i ná»™i bá»™, viá»‡c phÃ¡t hÃ nh cÃ¡c gÃ³i .deb nhanh chÃ³ng vÃ  cÃ³ thá»ƒ truy cáº­p qua apt lÃ  má»™t lá»£i tháº¿ ráº¥t lá»›n. Tuy nhiÃªn, viá»‡c dá»±ng háº¡ táº§ng riÃªng (nhÆ° NGINX, APT server\u0026hellip;) cÃ³ thá»ƒ phá»©c táº¡p, tá»‘n chi phÃ­ vÃ  khÃ´ng dá»… má»Ÿ rá»™ng.\nMá»™t giáº£i phÃ¡p hiá»‡u quáº£, Ä‘Æ¡n giáº£n hÆ¡n lÃ : host repository Debian trá»±c tiáº¿p trÃªn Amazon S3 vÃ  sá»­ dá»¥ng reprepro Ä‘á»ƒ quáº£n lÃ½ metadata.\nII. CÃ¡ch giáº£i quyáº¿t ChÃºng ta sáº½ xÃ¢y dá»±ng má»™t quy trÃ¬nh:\nTáº¡o repo Debian chuáº©n báº±ng reprepro. Cáº­p nháº­t cÃ¡c gÃ³i .deb vÃ o repo. Äá»“ng bá»™ repo lÃªn Amazon S3. Sinh ra file .list Ä‘á»ƒ client dá»… cáº¥u hÃ¬nh apt. CÃ´ng cá»¥ sá»­ dá»¥ng: CÃ´ng cá»¥ Vai trÃ² reprepro Táº¡o \u0026amp; quáº£n lÃ½ cáº¥u trÃºc Debian repo (conf/, pool/, dists/) aws s3 sync Äá»“ng bá»™ thÆ° má»¥c repo lÃªn Amazon S3 Shell Script Tá»± Ä‘á»™ng hÃ³a cÃ¡c bÆ°á»›c thÃªm gÃ³i, build metadata, vÃ  Ä‘á»“ng bá»™ hÃ³a III. Thá»±c hiá»‡n 1. update-repo.sh â€“ ThÃªm .deb vÃ o repository âœ… Nhiá»‡m vá»¥: Kiá»ƒm tra vÃ  táº¡o cáº¥u hÃ¬nh conf/distributions náº¿u chÆ°a cÃ³. ThÃªm gÃ³i .deb vÃ o Ä‘Ãºng codename báº±ng reprepro. ğŸ§© Ná»™i dung chÃ­nh: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 #!/bin/bash set -e REPO_DIR=\u0026#34;${REPO_DIR:-./repo}\u0026#34; # ThÆ° má»¥c chá»©a repo DEB_FILE=\u0026#34;$1\u0026#34; # File .deb Ä‘áº§u vÃ o DIST=\u0026#34;$2\u0026#34; # Codename (vd: v1.0) ARCH=\u0026#34;${ARCH:-amd64}\u0026#34; COMPONENT=\u0026#34;${COMPONENT:-main}\u0026#34; if [[ -z \u0026#34;$DEB_FILE\u0026#34; || -z \u0026#34;$DIST\u0026#34; ]]; then echo \u0026#34;Usage: $0 path/to/package.deb \u0026lt;codename\u0026gt;\u0026#34; exit 1 fi if [[ ! -f \u0026#34;$DEB_FILE\u0026#34; ]]; then echo \u0026#34;âŒ File not exist: $DEB_FILE\u0026#34; exit 2 fi mkdir -p \u0026#34;$REPO_DIR/conf\u0026#34; DIST_FILE=\u0026#34;$REPO_DIR/conf/distributions\u0026#34; if ! grep -q \u0026#34;Codename: $DIST\u0026#34; \u0026#34;$DIST_FILE\u0026#34; 2\u0026gt;/dev/null; then echo \u0026#34;â• Adding new codename: $DIST\u0026#34; cat \u0026gt;\u0026gt; \u0026#34;$DIST_FILE\u0026#34; \u0026lt;\u0026lt;EOF Origin: LocalCompany Label: LocalRepo Codename: $DIST Architectures: $ARCH Components: $COMPONENT Description: Auto-generated distribution $DIST EOF fi echo \u0026#34;ğŸ“¦ Adding package: $DEB_FILE â†’ codename: $DIST\u0026#34; reprepro -b \u0026#34;$REPO_DIR\u0026#34; includedeb \u0026#34;$DIST\u0026#34; \u0026#34;$DEB_FILE\u0026#34; echo \u0026#34;âœ… Completed!\u0026#34; ğŸ› ï¸ CÃ¡ch cháº¡y: 1 2 ./update-repo.sh ./incoming/myapp_1.0.0.deb v1.0 2. generate-sources-list.sh â€“ Táº¡o file sources.list cho client âœ… Nhiá»‡m vá»¥: Duyá»‡t file conf/distributions Ä‘á»ƒ láº¥y danh sÃ¡ch cÃ¡c Codename vÃ  Component. Sinh ra dÃ²ng cáº¥u hÃ¬nh repo chuáº©n cho apt. ğŸ§© Ná»™i dung chÃ­nh: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #!/bin/bash REPO_URL=${1:-\u0026#34;http://localhost/repo\u0026#34;} # URL repo OUTPUT=${2:-\u0026#34;localrepo.list\u0026#34;} # TÃªn file output DISTRIBUTIONS_FILE=\u0026#34;repo/conf/distributions\u0026#34; \u0026gt; \u0026#34;$OUTPUT\u0026#34; # Clear file grep -E \u0026#39;^Codename:\u0026#39; \u0026#34;$DISTRIBUTIONS_FILE\u0026#34; | awk \u0026#39;{print $2}\u0026#39; | while read -r codename; do component=$(grep -A 10 \u0026#34;Codename: $codename\u0026#34; \u0026#34;$DISTRIBUTIONS_FILE\u0026#34; | grep -E \u0026#39;^Components:\u0026#39; | awk \u0026#39;{$1=\u0026#34;\u0026#34;; print $0}\u0026#39; | xargs -n1 | sort -u | xargs) if [[ -n \u0026#34;$component\u0026#34; ]]; then echo \u0026#34;deb [trusted=yes,arch=amd64] $REPO_URL $codename $component\u0026#34; \u0026gt;\u0026gt; \u0026#34;$OUTPUT\u0026#34; else echo \u0026#34;âš ï¸ Warning: No components found for Codename: $codename\u0026#34; fi done echo \u0026#34;âœ… File $OUTPUT created:\u0026#34; cat \u0026#34;$OUTPUT\u0026#34; ğŸ› ï¸ CÃ¡ch cháº¡y: 1 2 ./generate-sources-list.sh https://my-s3-bucket.s3.amazonaws.com/repo my-repo.list File output my-repo.list cÃ³ dáº¡ng:\n1 2 deb [trusted=yes,arch=amd64] https://my-s3-bucket.s3.amazonaws.com/repo v1.0 main 3. publish.sh â€“ Äá»“ng bá»™ hÃ³a toÃ n bá»™ repo lÃªn S3 âœ… Nhiá»‡m vá»¥: Láº¥y cáº¥u hÃ¬nh tá»« S3 vá» local. Duyá»‡t vÃ  thÃªm táº¥t cáº£ file .deb hiá»‡n cÃ³ vÃ o repo. XÃ³a repo/db Ä‘á»ƒ trÃ¡nh sync dá»¯ liá»‡u cache khÃ´ng cáº§n thiáº¿t. Sync toÃ n bá»™ repo lÃªn S3. Táº¡o file .list vÃ  upload nÃ³ lÃªn S3. ğŸ§© Ná»™i dung chÃ­nh: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #!/bin/bash set -e S3_BUCKET=\u0026#34;$1\u0026#34; REPO_NAME=\u0026#34;$2\u0026#34; VERSION=\u0026#34;$3\u0026#34; PUBLIC_HOST_URL=\u0026#34;$4\u0026#34; if [[ -z \u0026#34;$S3_BUCKET\u0026#34; || -z \u0026#34;$REPO_NAME\u0026#34; || -z \u0026#34;$VERSION\u0026#34; || -z \u0026#34;$PUBLIC_HOST_URL\u0026#34; ]]; then echo \u0026#34;Usage: $0 \u0026lt;S3_BUCKET\u0026gt; \u0026lt;REPO_NAME\u0026gt; \u0026lt;VERSION\u0026gt; \u0026lt;PUBLIC_HOST_URL\u0026gt;\u0026#34; exit 1 fi aws s3 sync s3://$S3_BUCKET/repo/conf ./repo/conf --exact-timestamps for file in ./*.deb; do ./update-repo.sh \u0026#34;$file\u0026#34; \u0026#34;$VERSION\u0026#34; done rm -rf ./repo/db aws s3 sync ./repo s3://$S3_BUCKET/repo ./generate-sources-list.sh \u0026#34;$PUBLIC_HOST_URL\u0026#34; \u0026#34;$REPO_NAME.list\u0026#34; aws s3 cp ./$REPO_NAME.list s3://$S3_BUCKET/source/$REPO_NAME.list ğŸ› ï¸ CÃ¡ch cháº¡y: 1 ./publish.sh my-s3-bucket my-repo v1.0 https://my-s3-bucket.s3.amazonaws.com/repo 4. Thá»­ nghiÃªm Client cÃ³ thá»ƒ cáº¥u hÃ¬nh APT nhÆ° sau:\n1 2 3 sudo curl -o /etc/apt/sources.list.d/my-repo.list https://my-s3-bucket.s3.amazonaws.com/source/my-repo.list sudo apt update V. Káº¿t luáº­n Viá»‡c sá»­ dá»¥ng reprepro káº¿t há»£p vá»›i S3 lÃ  má»™t giáº£i phÃ¡p:\nNháº¹, Ä‘Æ¡n giáº£n KhÃ´ng cáº§n web server Dá»… tÃ­ch há»£p CI/CD ","date":"2025-06-14T00:00:00Z","permalink":"https://phongthien99.github.io/posts/hosting-a-debian-repository-on-s3-using-reprepro-and-aws-cli/","title":"Hosting a Debian Repository on S3 using Reprepro and AWS CLI"},{"content":"Äáº·t Váº¥n Äá» Khi lÃ m viá»‡c vá»›i cÃ¡c há»‡ thá»‘ng lá»›n sá»­ dá»¥ng MongoDB, viá»‡c quáº£n lÃ½ migration dá»¯ liá»‡u (táº¡o collection, thÃªm field, thay Ä‘á»•i schema logic\u0026hellip;) thÆ°á»ng khÃ´ng Ä‘Æ°á»£c quan tÃ¢m Ä‘Ãºng má»©c. Äiá»u nÃ y dáº«n Ä‘áº¿n:\nDá»¯ liá»‡u thiáº¿u Ä‘á»“ng nháº¥t giá»¯a cÃ¡c mÃ´i trÆ°á»ng. KhÃ³ rollback hoáº·c kiá»ƒm soÃ¡t phiÃªn báº£n dá»¯ liá»‡u. KhÃ´ng theo ká»‹p tá»‘c Ä‘á»™ phÃ¡t triá»ƒn CI/CD khi cáº§n thay Ä‘á»•i schema thÆ°á»ng xuyÃªn. CÃ¡ch Giáº£i Quyáº¿t Flyway gáº§n Ä‘Ã¢y Ä‘Ã£ há»— trá»£ MongoDB thÃ´ng qua cÃ¡c JavaScript-based migration. DÃ¹ MongoDB lÃ  NoSQL, ta váº«n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c thao tÃ¡c migration dÆ°á»›i dáº¡ng .js file (giá»‘ng shell script cá»§a MongoDB) vÃ  quáº£n lÃ½ báº±ng Flyway nhÆ°:\nGhi log migration vÃ o collection. Cháº¡y tuáº§n tá»± tá»«ng script. Cho phÃ©p rollback báº±ng cÃ¡ch viáº¿t script ngÆ°á»£c láº¡i. Trong bÃ i viáº¿t nÃ y, ta sáº½ triá»ƒn khai Flyway sá»­ dá»¥ng Docker Ä‘á»ƒ migrate MongoDB.\nThá»±c Hiá»‡n 1. Cáº¥u TrÃºc ThÆ° Má»¥c 1 2 3 4 5 6 â”œâ”€â”€ docker-compose.yml â”œâ”€â”€ config.cfg # Cáº¥u hÃ¬nh Flyway â””â”€â”€ migrations/ â”œâ”€â”€ V1__init_collection.js â””â”€â”€ V2__add_index.js 2. Ná»™i Dung docker-compose.yml 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 version: \u0026#39;3.8\u0026#39; services: flyway: image: redgate/flyway entrypoint: [\u0026#34;\u0026#34;] command: \u0026gt; sh -c \u0026#34;flyway migrate \u0026amp;\u0026amp; flyway info\u0026#34; volumes: - ./migrations:/migrations - ./config.cfg:/flyway/conf/flyway.conf # environment: # - FLYWAY_NATIVE_CONNECTORS=true networks: - traefik-ingress volumes: flyway_data: networks: traefik-ingress: external: true # Sá»­ dá»¥ng máº¡ng traefik Ä‘Ã£ Ä‘Æ°á»£c táº¡o sáºµn LÆ°u Ã½: entrypoint: [\u0026quot;\u0026quot;] Ä‘á»ƒ bá» entrypoint máº·c Ä‘á»‹nh trong image redgate/flyway.\n3. Cáº¥u HÃ¬nh config.cfg 1 2 3 4 5 6 7 8 flyway.url=xxx flyway.user=xxx flyway.password=xxx flyway.schemas=xxx flyway.baselineOnMigrate=true flyway.sqlMigrationSuffixes=.js flyway.locations=filesystem:/migrations Flyway sáº½ tÃ¬m cÃ¡c file .js trong thÆ° má»¥c /migrations vÃ  cháº¡y theo thá»© tá»± V1__\u0026hellip;, V2__\u0026hellip;,\u0026hellip;\n4. VÃ­ Dá»¥ Migration Script migrations/V1__init_collection.js\n1 2 3 4 5 db.createCollection(\u0026#34;videos\u0026#34;); db.videos.insertOne({ title: \u0026#34;Flyway Introduction\u0026#34;, uploaded_at: new Date() }); migrations/V2__add_index.js\n1 db.videos.createIndex({ title: 1 }, { unique: true }); 5. Cháº¡y Migration 1 docker compose up Flyway sáº½:\nKáº¿t ná»‘i tá»›i MongoDB . TÃ¬m vÃ  cháº¡y cÃ¡c file .js chÆ°a Ä‘Æ°á»£c Ã¡p dá»¥ng. Log thÃ´ng tin migration (tÃªn file, thá»i gian, tráº¡ng thÃ¡i). Káº¿t Luáº­n Viá»‡c sá»­ dá»¥ng Flyway vá»›i MongoDB lÃ  má»™t bÆ°á»›c tiáº¿n giÃºp chuáº©n hÃ³a viá»‡c migration dá»¯ liá»‡u NoSQL, vá»‘n trÆ°á»›c Ä‘Ã¢y chá»§ yáº¿u lÃ  thá»§ cÃ´ng. Vá»›i Flyway, báº¡n cÃ³ thá»ƒ:\nâœ… Kiá»ƒm soÃ¡t Ä‘Æ°á»£c lá»‹ch sá»­ migration\nâœ… Dá»… dÃ ng tÃ­ch há»£p vÃ o CI/CD pipelines\nâœ… Giáº£m thiá»ƒu rá»§i ro khi deploy schema/data changes\nViá»‡c cháº¡y Flyway qua Docker cÃ²n giÃºp mÃ´i trÆ°á»ng dev/test dá»… dÃ ng tiáº¿p cáº­n vÃ  cáº¥u hÃ¬nh nháº¥t quÃ¡n. Vá»›i nhá»¯ng há»‡ thá»‘ng cáº§n tÃ­nh á»•n Ä‘á»‹nh vÃ  cÃ³ quy trÃ¬nh release cháº·t cháº½, Ä‘Ã¢y lÃ  lá»±a chá»n nÃªn cÃ¢n nháº¯c.\n","date":"2025-06-08T00:00:00Z","permalink":"https://phongthien99.github.io/posts/migration-mongodb-with-flyway/","title":"Migration MongoDB With Flyway"},{"content":"Effective Management of Multiple Kubernetes Environments with Helmfile 1. Äáº·t Váº¥n Äá» Khi sá»­ dá»¥ng Helm Ä‘á»ƒ triá»ƒn khai á»©ng dá»¥ng lÃªn Kubernetes, báº¡n sáº½ sá»›m nháº­n ra má»™t sá»‘ váº¥n Ä‘á» phá»• biáº¿n:\nğŸ” Cáº§n quáº£n lÃ½ nhiá»u chart cho cÃ¡c dá»‹ch vá»¥ khÃ¡c nhau. ğŸŒ Cáº§n giá»¯ cáº¥u hÃ¬nh nháº¥t quÃ¡n giá»¯a cÃ¡c mÃ´i trÆ°á»ng (dev, staging, production). âš™ï¸ Cáº§n kháº£ nÄƒng diff trÆ°á»›c khi deploy, cáº­p nháº­t Ä‘á»“ng loáº¡t dá»… kiá»ƒm soÃ¡t. Viá»‡c dÃ¹ng Helm thuáº§n (helm install, helm upgrade) cho tá»«ng chart ráº¥t thá»§ cÃ´ng, dá»… lá»—i vÃ  khÃ³ má»Ÿ rá»™ng khi team hoáº·c dá»± Ã¡n lá»›n lÃªn.\n2. Giáº£i PhÃ¡p: Helmfile â€“ Helm For The Real World Helmfile lÃ  má»™t cÃ´ng cá»¥ mÃ£ nguá»“n má»Ÿ giÃºp báº¡n quáº£n lÃ½ nhiá»u Helm chart má»™t cÃ¡ch cÃ³ tá»• chá»©c vÃ  nháº¥t quÃ¡n giá»¯a cÃ¡c mÃ´i trÆ°á»ng.\nğŸ” TÃ­nh nÄƒng ná»•i báº­t: ğŸ“¦ Triá»ƒn khai nhiá»u Helm chart vá»›i má»™t file YAML duy nháº¥t. ğŸŒ Há»— trá»£ Ä‘a mÃ´i trÆ°á»ng (dev, staging, production, v.v.). ğŸ”„ TÃ­ch há»£p sáºµn diff, template, sync, apply â€” cá»±c ká»³ tiá»‡n cho CI/CD vÃ  GitOps. ğŸ§  Há»— trá»£ biáº¿n Ä‘á»™ng (env), template Go, káº¿ thá»«a giÃ¡ trá»‹ cáº¥u hÃ¬nh, dá»… tÃ¡i sá»­ dá»¥ng. 3. Hiá»‡n Thá»±c HÃ³a: CÃ i Äáº·t VÃ  Sá»­ Dá»¥ng Helmfile ğŸ”§ Script CÃ i Äáº·t Helmfile Má»›i Nháº¥t 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #!/bin/bash set -e # Láº¥y phiÃªn báº£n má»›i nháº¥t tá»« GitHub API LATEST_VERSION=$(curl -s https://api.github.com/repos/helmfile/helmfile/releases/latest | grep \u0026#39;\u0026#34;tag_name\u0026#34;:\u0026#39; | sed -E \u0026#39;s/.*\u0026#34;([^\u0026#34;]+)\u0026#34;.*/\\1/\u0026#39;) echo \u0026#34;PhiÃªn báº£n helmfile má»›i nháº¥t: $LATEST_VERSION\u0026#34; # Táº¡o tÃªn file táº£i vá» FILE_TAR=\u0026#34;helmfile_${LATEST_VERSION#v}_linux_amd64.tar.gz\u0026#34; # URL táº£i vá» DOWNLOAD_URL=\u0026#34;https://github.com/helmfile/helmfile/releases/download/${LATEST_VERSION}/${FILE_TAR}\u0026#34; echo \u0026#34;URL táº£i vá»: $DOWNLOAD_URL\u0026#34; # Táº£i file tar.gz curl -LO \u0026#34;$DOWNLOAD_URL\u0026#34; # Giáº£i nÃ©n tar -xzf \u0026#34;$FILE_TAR\u0026#34; # Cáº¥p quyá»n thá»±c thi vÃ  di chuyá»ƒn chmod +x helmfile sudo mv helmfile /usr/local/bin/ # XÃ³a file tar.gz rm \u0026#34;$FILE_TAR\u0026#34; # Kiá»ƒm tra phiÃªn báº£n echo \u0026#34;CÃ i Ä‘áº·t thÃ nh cÃ´ng. PhiÃªn báº£n helmfile hiá»‡n táº¡i:\u0026#34; helmfile --version ğŸ“ Cáº¥u TrÃºc ThÆ° Má»¥c Helmfile Nhiá»u MÃ´i TrÆ°á»ng 1 2 3 4 5 6 7 8 9 10 11 12 . â”œâ”€â”€ helmfile.yaml â”œâ”€â”€ environments/ â”‚ â”œâ”€â”€ dev.yaml â”‚ â”œâ”€â”€ staging.yaml â”‚ â””â”€â”€ production.yaml â”œâ”€â”€ values/ â”‚ â””â”€â”€ shared-values.yaml â””â”€â”€ charts/ â”œâ”€â”€ redis/ â””â”€â”€ my-app/ 4. Triá»ƒn Khai Nhiá»u MÃ´i TrÆ°á»ng Vá»›i Helmfile ğŸ§© helmfile.yaml Máº«u 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 environments: dev: values: - environments/dev.yaml staging: values: - environments/staging.yaml production: values: - environments/production.yaml --- releases: - name: redis namespace: {{ .Environment.Name }} chart: charts/redis values: - values/shared-values.yaml - name: my-app namespace: {{ .Environment.Name }} chart: charts/my-app needs: - redis values: - values/shared-values.yaml - environments/{{ .Environment.Name }}.yaml ğŸ“Œ LÆ°u Ã½: dÃ¹ng \u0026mdash; Ä‘á»ƒ phÃ¢n tÃ¡ch environments: vÃ  releases: Ä‘Ãºng cÃº phÃ¡p Helmfile.\nğŸ“„ VÃ­ Dá»¥ File environments/dev.yaml 1 2 3 4 replicaCount: 1 image: tag: dev-latest ğŸš€ Lá»‡nh Triá»ƒn Khai Theo MÃ´i TrÆ°á»ng 1 2 3 4 5 bash CopyEdit helmfile -e dev apply # Triá»ƒn khai mÃ´i trÆ°á»ng dev helmfile -e staging diff # Xem diff mÃ´i trÆ°á»ng staging helmfile -e production apply # Triá»ƒn khai production 5. Káº¿t Luáº­n Helmfile lÃ  trá»£ thá»§ Ä‘áº¯c lá»±c náº¿u báº¡n Ä‘ang triá»ƒn khai á»©ng dá»¥ng vá»›i nhiá»u dá»‹ch vá»¥ vÃ  mÃ´i trÆ°á»ng:\nâœ… Giáº£m rá»§i ro khi deploy thá»§ cÃ´ng âœ… Quáº£n lÃ½ mÃ´i trÆ°á»ng rÃµ rÃ ng, tÃ¡ch biá»‡t âœ… TÃ­ch há»£p CI/CD dá»… dÃ ng âœ… Há»— trá»£ Ä‘áº§y Ä‘á»§ triáº¿t lÃ½ GitOps ","date":"2025-06-01T00:00:00Z","permalink":"https://phongthien99.github.io/posts/effective-management-of-multiple-kubernetes-environments-with-helmfile/","title":"Effective Management of Multiple Kubernetes Environments with Helmfile"},{"content":"Guide to Installing and Deploying Helm Chart from a Git Repository Trong bÃ i viáº¿t nÃ y, chÃºng ta sáº½ tÃ¬m hiá»ƒu cÃ¡ch sá»­ dá»¥ng plugin helm-git Ä‘á»ƒ cÃ i Ä‘áº·t vÃ  triá»ƒn khai Helm chart trá»±c tiáº¿p tá»« Git repository. CÃ¡ch lÃ m nÃ y giÃºp báº¡n linh hoáº¡t hÆ¡n trong viá»‡c quáº£n lÃ½ cÃ¡c chart, Ä‘áº·c biá»‡t khi cáº§n triá»ƒn khai tá»« nguá»“n Git riÃªng thay vÃ¬ Helm repository thÃ´ng thÆ°á»ng. BÃ i viáº¿t sáº½ hÆ°á»›ng dáº«n tá»« bÆ°á»›c cÃ i Ä‘áº·t plugin, thÃªm Git repo, chá»‰ Ä‘á»‹nh phiÃªn báº£n chart vá»›i ref, cho Ä‘áº¿n cÃ¡ch sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n @charts/....\nğŸ”§ BÆ°á»›c 1: CÃ i Äáº·t Plugin helm-git Plugin helm-git giÃºp Helm xá»­ lÃ½ Git repository nhÆ° má»™t nguá»“n Helm chart. Äá»ƒ cÃ i Ä‘áº·t, cháº¡y lá»‡nh sau:\n1 2 helm plugin install https://github.com/aslafy-z/helm-git --version 1.3.0 ğŸ’¡ Náº¿u plugin Ä‘Ã£ Ä‘Æ°á»£c cÃ i trÆ°á»›c Ä‘Ã³, báº¡n cÃ³ thá»ƒ thÃªm \u0026ndash;force Ä‘á»ƒ cÃ i láº¡i:\n1 2 helm plugin install https://github.com/aslafy-z/helm-git --version 1.3.0 --force ğŸ—‚ï¸ BÆ°á»›c 2: ThÃªm Helm Repository Tá»« Git TrÆ°á»›c khi thÃªm repo má»›i, báº¡n nÃªn xÃ³a repo cÅ© náº¿u cáº§n Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t:\n1 2 helm repo remove cert-manager || true ThÃªm repository Helm tá»« Git báº±ng cÃº phÃ¡p:\n1 2 helm repo add cert-manager git+https://github.com/jetstack/cert-manager@deploy/charts?ref=v0.6.2 âœ… Giáº£i ThÃ­ch Tham Sá»‘: @deploy/charts: Chá»‰ Ä‘á»‹nh Ä‘Æ°á»ng dáº«n Ä‘áº¿n thÆ° má»¥c chart con trong repo Git. ref=v0.6.2: Chá»‰ Ä‘á»‹nh phiÃªn báº£n cá»¥ thá»ƒ â€” cÃ³ thá»ƒ lÃ  tag, branch hoáº·c commit hash. ğŸš€ BÆ°á»›c 3: CÃ i Äáº·t hoáº·c Cáº­p Nháº­t Helm Chart Giá» báº¡n cÃ³ thá»ƒ triá»ƒn khai chart tá»« repo Git báº±ng lá»‡nh:\n1 2 3 4 5 helm upgrade --install cert-manager cert-manager/cert-manager \\ -f prod-values.yaml \\ -n cert-manager \\ --create-namespace ğŸ” Giáº£i ThÃ­ch Tham Sá»‘: upgrade --install: CÃ i Ä‘áº·t náº¿u chÆ°a cÃ³, hoáº·c nÃ¢ng cáº¥p náº¿u Ä‘Ã£ tá»“n táº¡i. f prod-values.yaml: Sá»­ dá»¥ng file cáº¥u hÃ¬nh cho mÃ´i trÆ°á»ng production. n cert-manager: Cháº¡y trong namespace cert-manager. -create-namespace: Táº¡o namespace náº¿u chÆ°a tá»“n táº¡i. âœ… Káº¿t Luáº­n Plugin helm-git má»Ÿ rá»™ng kháº£ nÄƒng triá»ƒn khai Helm chart tá»« Git, giÃºp báº¡n dá»… dÃ ng kiá»ƒm soÃ¡t phiÃªn báº£n, Ä‘áº·c biá»‡t khi cáº§n thá»­ nghiá»‡m cÃ¡c phiÃªn báº£n cá»¥ thá»ƒ hoáº·c chÆ°a Ä‘Æ°á»£c publish lÃªn Helm repo. Viá»‡c sá»­ dá»¥ng tham sá»‘ ref vÃ  chá»‰ Ä‘á»‹nh Ä‘Æ°á»ng dáº«n chart con (@...) giÃºp báº¡n triá»ƒn khai chÃ­nh xÃ¡c phiÃªn báº£n mong muá»‘n má»™t cÃ¡ch an toÃ n vÃ  linh hoáº¡t.\n","date":"2025-04-30T10:40:00+08:00","permalink":"https://phongthien99.github.io/posts/guide-to-installing-and-deploying-helm-chart-from-a-git-repository/","title":"Guide to Installing and Deploying Helm Chart from a Git Repository"},{"content":"Lightweight and Fast Real-Time Log Viewer Äáº·t Váº¥n Äá» Trong quÃ¡ trÃ¬nh váº­n hÃ nh há»‡ thá»‘ng, viá»‡c nhanh chÃ³ng tra cá»©u log Ä‘á»ƒ xÃ¡c Ä‘á»‹nh lá»—i hoáº·c xÃ¡c minh cÃ¡c sá»± kiá»‡n lÃ  cá»±c ká»³ quan trá»ng\nThÃ´ng thÆ°á»ng, chÃºng ta hay sá»­ dá»¥ng cÃ¡c lá»‡nh nhÆ°:\n1 2 3 tail -f /var/log/server.log | grep -E \u0026#34;ERROR|WARN\u0026#34; grep -i \u0026#34;timeout\u0026#34; /var/log/server.log grep -E \u0026#34;ERROR|WARN\u0026#34; /var/log/server.log Tuy nhiÃªn, cÃ¡ch lÃ m nÃ y tá»“n táº¡i nhiá»u háº¡n cháº¿:\nPháº£i SSH vÃ o server. Pháº£i thao tÃ¡c thá»§ cÃ´ng, máº¥t thá»i gian. KhÃ³ theo dÃµi realtime vá»›i nhiá»u server hoáº·c nhiá»u file log. Háº¡n cháº¿ kháº£ nÄƒng lá»c, tÃ¬m kiáº¿m nÃ¢ng cao hoáº·c lÆ°u trá»¯ káº¿t quáº£. Giáº£i PhÃ¡p XÃ¢y dá»±ng má»™t há»‡ thá»‘ng xem log trá»±c tiáº¿p tá»« trÃ¬nh duyá»‡t, há»— trá»£:\nTÃ¬m kiáº¿m tá»« khÃ³a nhanh chÃ³ng. Lá»c log nÃ¢ng cao. Xem realtime trÃªn nhiá»u file log. CÃ´ng Nghá»‡ Sá»­ Dá»¥ng Promtail: Thu tháº­p log tá»« file há»‡ thá»‘ng. VictoriaLogs: LÆ°u trá»¯ vÃ  phá»¥c vá»¥ truy váº¥n log vá»›i hiá»‡u suáº¥t cao. HÆ°á»›ng Dáº«n Triá»ƒn Khai Chi Tiáº¿t Há»‡ thá»‘ng triá»ƒn khai trÃªn mÃ´i trÆ°á»ng Ubuntu Ä‘á»ƒ theo dÃµi log cá»§a Sigma Media Server, vá»›i cÃ¡c file log cÃ³ pattern: /var/log/sigma-machine/now.*\n1. CÃ i Äáº·t vÃ  Cáº¥u HÃ¬nh VictoriaLogs BÆ°á»›c 1: Táº£i vÃ  CÃ i Äáº·t VictoriaLogs 1 2 3 4 5 wget https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v1.21.0-victorialogs/victoria-logs-linux-amd64-v1.21.0-victorialogs.tar.gz tar -xzf victoria-logs-linux-amd64-v1.21.0-victorialogs.tar.gz chmod +x victoria-logs-prod sudo mv victoria-logs-prod /usr/local/bin/victoria-logs sudo mkdir /var/lib/victorialogs-data BÆ°á»›c 2: Táº¡o service cho VictoriaLogs Táº¡o file /etc/systemd/system/victorialogs.service vá»›i ná»™i dung:\n1 2 3 4 5 6 7 8 9 10 11 12 13 [Unit] Description=VictoriaLogs Service After=network.target [Service] User=root Group=root ExecStart=/usr/local/bin/victoria-logs --storageDataPath=/var/lib/victorialogs-data Restart=always RestartSec=5 [Install] WantedBy=multi-user.target BÆ°á»›c 3: Khá»Ÿi Äá»™ng VictoriaLogs 1 2 3 sudo systemctl daemon-reload sudo systemctl enable victorialogs sudo systemctl start victorialogs VictoriaLogs sáº½ láº¯ng nghe trÃªn port 9428, lÆ°u dá»¯ liá»‡u táº¡i /var/lib/victorialogs-data.\n2. CÃ i Äáº·t vÃ  Cáº¥u HÃ¬nh Promtail BÆ°á»›c 1: Táº£i vÃ  CÃ i Äáº·t Promtail 1 2 3 4 wget https://github.com/grafana/loki/releases/latest/download/promtail-linux-amd64.zip unzip promtail-linux-amd64.zip chmod +x promtail-linux-amd64 sudo mv promtail-linux-amd64 /usr/local/bin/promtail BÆ°á»›c 2: Táº¡o File Cáº¥u HÃ¬nh Promtail Táº¡o thÆ° má»¥c vÃ  file cáº¥u hÃ¬nh:\n1 2 mkdir -p /etc/promtail touch /etc/promtail/promtal-config.yaml Ná»™i dung /etc/promtail/promtail-config.yaml:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 server: http_listen_port: 9080 grpc_listen_port: 0 positions: filename: /tmp/positions.yaml clients: - url: http://localhost:9428/insert/loki/api/v1/push scrape_configs: - job_name: sigma_media_server_logs static_configs: - targets: - localhost labels: job: sigma __path__: /var/log/sigma-machine/now.* BÆ°á»›c 3: Táº¡o service cho Promtail Táº¡o file /etc/systemd/system/promtail.service vá»›i ná»™i dung:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 [Unit] Description=Promtail Service After=network.target [Service] User=root Group=root ExecStart=/usr/local/bin/promtail -config.file=/etc/promtail/promtail-config.yaml Restart=always RestartSec=5 [Install] WantedBy=multi-user.target BÆ°á»›c 4: Khá»Ÿi Äá»™ng Promtail 1 2 3 4 sudo systemctl daemon-reload sudo systemctl enable promtail sudo systemctl start promtail Xem vÃ  Truy Váº¥n Log Qua TrÃ¬nh Duyá»‡t Giá» Ä‘Ã¢y, báº¡n cÃ³ thá»ƒ má»Ÿ trÃ¬nh duyá»‡t vÃ  truy cáº­p Ä‘á»‹a chá»‰:\n1 2 http://localhost:9428 Má»™t sá»‘ vÃ­ dá»¥ truy váº¥n log:\nTÃ¬m kiáº¿m log vá»›i tá»« khÃ³a: 1 2 {filename=\u0026#34;/var/log/sigma-machine/now.sys\u0026#34;} |~ \u0026#34;(?i)dataDir\u0026#34; Giáº£i thÃ­ch:\n|~ dÃ¹ng Ä‘á»ƒ lá»c theo regex. (?i) trong regex lÃ  báº­t cháº¿ Ä‘á»™ ignore case (khÃ´ng phÃ¢n biá»‡t hoa thÆ°á»ng). \u0026quot;dataDir\u0026quot; lÃ  tá»« khÃ³a báº¡n tÃ¬m. Káº¿t Luáº­n Vá»›i giáº£i phÃ¡p nÃ y, báº¡n cÃ³ thá»ƒ:\nTruy cáº­p log má»i lÃºc, má»i nÆ¡i mÃ  khÃ´ng cáº§n SSH vÃ o server. TÃ¬m kiáº¿m vÃ  lá»c log nhanh chÃ³ng. Theo dÃµi realtime nhiá»u file log tá»« server. Dá»… dÃ ng má»Ÿ rá»™ng vÃ  tÃ­ch há»£p vá»›i cÃ¡c há»‡ thá»‘ng phÃ¢n tÃ­ch log hoáº·c cáº£nh bÃ¡o chuyÃªn sÃ¢u trong tÆ°Æ¡ng lai. ","date":"2025-04-27T12:40:00+08:00","permalink":"https://phongthien99.github.io/posts/lightweight-and-fast-real-time-log-viewer/","title":"Lightweight and Fast Real-Time Log Viewer"},{"content":"Deploying Sigma Media Server with Ansible Trong bÃ i viáº¿t nÃ y, chÃºng ta sáº½ cÃ¹ng nhau triá»ƒn khai Sigma Media Server lÃªn mÃ¡y chá»§ tá»« xa thÃ´ng qua Ansible â€” cÃ´ng cá»¥ tá»± Ä‘á»™ng hÃ³a cáº¥u hÃ¬nh vÃ  triá»ƒn khai pháº§n má»m phá»• biáº¿n. Báº±ng cÃ¡ch sá»­ dá»¥ng Ansible, báº¡n cÃ³ thá»ƒ tá»± Ä‘á»™ng hÃ³a quÃ¡ trÃ¬nh cÃ i Ä‘áº·t vÃ  cáº¥u hÃ¬nh pháº§n má»m trÃªn nhiá»u mÃ¡y chá»§, giÃºp tiáº¿t kiá»‡m thá»i gian vÃ  giáº£m thiá»ƒu lá»—i.\n1. Cáº¥u TrÃºc Dá»± Ãn Dá»± Ã¡n Ä‘Æ°á»£c tá»• chá»©c theo chuáº©n Ansible Role, giÃºp mÃ£ dá»… báº£o trÃ¬ vÃ  má»Ÿ rá»™ng. Cáº¥u trÃºc thÆ° má»¥c cá»§a dá»± Ã¡n nhÆ° sau:\n1 2 3 4 5 6 7 8 9 10 devops â”œâ”€â”€ inventory.ini â”œâ”€â”€ playbook.yml â””â”€â”€ roles â””â”€â”€ sigma/ â”œâ”€â”€ handlers/ â”‚ â””â”€â”€ main.yml â””â”€â”€ tasks/ â””â”€â”€ main.yml inventory.ini: Äá»‹nh nghÄ©a cÃ¡c mÃ¡y chá»§ má»¥c tiÃªu vÃ  thÃ´ng tin káº¿t ná»‘i. playbook.yml: Playbook chÃ­nh chá»©a cÃ¡c bÆ°á»›c triá»ƒn khai. roles/sigma/handlers/main.yml: Äá»‹nh nghÄ©a cÃ¡c hÃ nh Ä‘á»™ng cáº§n thá»±c hiá»‡n sau khi cÃ³ thay Ä‘á»•i. roles/sigma/tasks/main.yml: CÃ¡c task thá»±c thi nhÆ° cÃ i Ä‘áº·t pháº§n má»m, cáº¥u hÃ¬nh há»‡ thá»‘ng. 2. File inventory.ini ÄÃ¢y lÃ  nÆ¡i khai bÃ¡o mÃ¡y chá»§ Ä‘Ã­ch (target host), nÆ¡i mÃ  Ansible sáº½ thá»±c hiá»‡n cÃ¡c thao tÃ¡c tá»« xa. Ná»™i dung file inventory.ini nhÆ° sau:\n1 2 3 [sigma_servers] 172.16.60.123 ansible_user=dev ansible_password= ansible_become=true ansible_user: tÃ i khoáº£n Ä‘Äƒng nháº­p tá»« xa. ansible_password: máº­t kháº©u Ä‘Äƒng nháº­p. ansible_become: cho phÃ©p nÃ¢ng quyá»n sudo náº¿u cáº§n. 3. File playbook.yml Playbook chÃ­nh mÃ´ táº£ quÃ¡ trÃ¬nh triá»ƒn khai, bao gá»“m cÃ¡c tÃ¡c vá»¥ tá»« viá»‡c cÃ i Ä‘áº·t pháº§n má»m cho Ä‘áº¿n khá»Ÿi Ä‘á»™ng dá»‹ch vá»¥. Ná»™i dung file playbook.yml nhÆ° sau:\n1 2 3 4 5 6 - name: Deploy Sigma Media Server hosts: sigma_servers become: yes roles: - sigma Playbook nÃ y sáº½ Ã¡p dá»¥ng toÃ n bá»™ vai trÃ² sigma lÃªn nhÃ³m mÃ¡y chá»§ sigma_servers.\n4. TÃ¡c vá»¥ triá»ƒn khai (roles/sigma/tasks/main.yml) Trong pháº§n nÃ y, cÃ¡c tÃ¡c vá»¥ chÃ­nh Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a Ä‘á»ƒ cÃ i Ä‘áº·t Sigma Media Server vÃ  thá»±c hiá»‡n cÃ¡c thao tÃ¡c cáº§n thiáº¿t nhÆ° thÃªm repository, cÃ i Ä‘áº·t gÃ³i pháº§n má»m, vÃ  ghi nháº­n phiÃªn báº£n.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 --- - name: Download Sigma software repository configuration file get_url: url: https://repo.sigma.video/debian/sigma-media-server.list dest: /etc/apt/sources.list.d/sigma-media-server.list mode: \u0026#39;0644\u0026#39; - name: Update apt package list apt: update_cache: yes cache_valid_time: 3600 - name: Install Sigma Media Server apt: name: sigma-media-server state: present changed_when: true notify: - Start Sigma Media Server service - Query Sigma Media Server API - Show version running - name: Create certificate directory if not exists file: path: /etc/pki/tls/certs state: directory mode: \u0026#39;0755\u0026#39; - name: Copy CA certificates copy: src: /etc/ssl/certs/ca-certificates.crt dest: /etc/pki/tls/certs/ca-bundle.crt mode: \u0026#39;0644\u0026#39; backup: yes - name: Get installed version of Sigma Media Server command: dpkg -s sigma-media-server register: sigma_version_info changed_when: false - name: Log version debug: msg: \u0026gt;- sigma-media-server: {{ sigma_version_info.stdout_lines | select(\u0026#39;search\u0026#39;, \u0026#39;^Version:\u0026#39;) | map(\u0026#39;regex_replace\u0026#39;, \u0026#39;^Version \\\\s*\u0026#39;, \u0026#39;\u0026#39;) | first }} TÃ³m lÆ°á»£c cÃ¡c bÆ°á»›c:\nThÃªm repo Sigma vÃ o há»‡ thá»‘ng. Cáº­p nháº­t danh sÃ¡ch gÃ³i (apt update). CÃ i Ä‘áº·t sigma-media-server. Kiá»ƒm tra vÃ  copy CA vÃ o thÆ° má»¥c phá»¥c vá»¥ cho há»‡ thá»‘ng. Ghi nháº­n phiÃªn báº£n cá»§a pháº§n má»m Sigma Ä‘Ã£ cÃ i Ä‘áº·t. 5. Handler khá»Ÿi Ä‘á»™ng vÃ  kiá»ƒm tra (roles/sigma/handlers/main.yml) Sau khi cÃ¡c task cÃ³ thay Ä‘á»•i, handler sáº½ thá»±c hiá»‡n cÃ¡c hÃ nh Ä‘á»™ng nhÆ° khá»Ÿi Ä‘á»™ng láº¡i dá»‹ch vá»¥ vÃ  kiá»ƒm tra tráº¡ng thÃ¡i API cá»§a Sigma. Ná»™i dung file handlers/main.yml nhÆ° sau:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 - name: Start Sigma Media Server service systemd: name: sigma-media-server state: started enabled: true - name: Query Sigma Media Server API uri: url: http://localhost:9999 method: GET return_content: yes status_code: 200 register: sigma_api_response retries: 5 delay: 2 until: sigma_api_response.status == 200 - name: Show version running debug: msg: \u0026#34;Sigma Media Server run version: {{ sigma_api_response.json.version }}\u0026#34; Má»‘i Quan Há»‡ Giá»¯a notify vÃ  handler Trong Ansible, notify vÃ  handler cÃ³ má»‘i quan há»‡ máº­t thiáº¿t, há»— trá»£ quÃ¡ trÃ¬nh tá»± Ä‘á»™ng hÃ³a má»™t cÃ¡ch hiá»‡u quáº£.\nnotify lÃ  thuá»™c tÃ­nh trong cÃ¡c task, dÃ¹ng Ä‘á»ƒ thÃ´ng bÃ¡o cho Ansible khi cÃ³ thay Ä‘á»•i. Khi má»™t task thay Ä‘á»•i tráº¡ng thÃ¡i (vÃ­ dá»¥: cÃ i Ä‘áº·t thÃ nh cÃ´ng), nÃ³ sáº½ \u0026ldquo;thÃ´ng bÃ¡o\u0026rdquo; cho cÃ¡c handler Ä‘Ã£ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trong pháº§n notify cá»§a task. handler lÃ  cÃ¡c tÃ¡c vá»¥ Ä‘áº·c biá»‡t Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong pháº§n handlers. ChÃºng chá»‰ Ä‘Æ°á»£c thá»±c thi khi cÃ³ sá»± \u0026ldquo;thÃ´ng bÃ¡o\u0026rdquo; tá»« task. Handler thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c thao tÃ¡c nhÆ° khá»Ÿi Ä‘á»™ng láº¡i dá»‹ch vá»¥, kiá»ƒm tra tráº¡ng thÃ¡i há»‡ thá»‘ng, hoáº·c cÃ¡c hÃ nh Ä‘á»™ng bá»• sung khÃ¡c mÃ  chá»‰ cáº§n thá»±c thi khi cÃ³ thay Ä‘á»•i. VÃ­ dá»¥ trong bÃ i viáº¿t:\nKhi task cÃ i Ä‘áº·t sigma-media-server thÃ nh cÃ´ng, cÃ¡c handler sáº½ Ä‘Æ°á»£c thÃ´ng bÃ¡o vÃ  thá»±c thi: Start Sigma Media Server service: Khá»Ÿi Ä‘á»™ng dá»‹ch vá»¥ Sigma. Query Sigma Media Server API: Kiá»ƒm tra xem API cá»§a Sigma cÃ³ Ä‘ang hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c khÃ´ng. Show version running: In ra phiÃªn báº£n cá»§a Sigma Media Server hiá»‡n Ä‘ang cháº¡y. Nhá» vÃ o cÆ¡ cháº¿ notify vÃ  handler, cÃ¡c tÃ¡c vá»¥ bá»• sung chá»‰ Ä‘Æ°á»£c thá»±c thi khi cÃ³ sá»± thay Ä‘á»•i thá»±c sá»±, giÃºp tiáº¿t kiá»‡m tÃ i nguyÃªn vÃ  giáº£m thiá»ƒu viá»‡c thá»±c thi khÃ´ng cáº§n thiáº¿t.\n6. Triá»ƒn Khai Thá»±c Táº¿ Sau khi cáº¥u hÃ¬nh xong, báº¡n cÃ³ thá»ƒ cháº¡y lá»‡nh dÆ°á»›i Ä‘Ã¢y Ä‘á»ƒ triá»ƒn khai:\n1 ansible-playbook -i inventory.ini playbook.yml --ask-pass --ask-become-pass - i inventory.ini: Chá»‰ Ä‘á»‹nh tá»‡p inventory chá»©a thÃ´ng tin mÃ¡y chá»§ Ä‘Ã­ch. playbook.yml: Chá»‰ Ä‘á»‹nh tá»‡p playbook chá»©a cÃ¡c task cáº§n thá»±c hiá»‡n. -ask-pass: YÃªu cáº§u nháº­p máº­t kháº©u Ä‘á»ƒ káº¿t ná»‘i SSH Ä‘áº¿n mÃ¡y chá»§ Ä‘Ã­ch. -ask-become-pass: YÃªu cáº§u nháº­p máº­t kháº©u sudo Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ yÃªu cáº§u quyá»n quáº£n trá»‹. Náº¿u thiáº¿t láº­p Ä‘Ãºng, há»‡ thá»‘ng sáº½ cÃ i Ä‘áº·t vÃ  khá»Ÿi Ä‘á»™ng Sigma Media Server, Ä‘á»“ng thá»i in ra phiÃªn báº£n Ä‘ang cháº¡y.\nKáº¿t Luáº­n Vá»›i viá»‡c Ä‘Ã³ng gÃ³i cáº¥u hÃ¬nh Ansible thÃ nh role sigma, báº¡n cÃ³ thá»ƒ dá»… dÃ ng:\nTá»± Ä‘á»™ng hÃ³a triá»ƒn khai trÃªn nhiá»u mÃ¡y chá»§. Kiá»ƒm tra tráº¡ng thÃ¡i hoáº¡t Ä‘á»™ng dá»‹ch vá»¥. Ghi láº¡i version nháº±m phá»¥c vá»¥ giÃ¡m sÃ¡t vÃ  audit. ","date":"2025-04-20T12:40:00+08:00","permalink":"https://phongthien99.github.io/posts/deploying-sigma-media-server-with-ansible/","title":"Deploying Sigma Media Server with Ansible"},{"content":"Monkey Patch In TypeScript Trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn á»©ng dá»¥ng, Ä‘Ã´i lÃºc báº¡n muá»‘n thÃªm má»™t method má»›i vÃ o class cÃ³ sáºµn â€“ Ä‘áº·c biá»‡t khi class Ä‘Ã³ Ä‘áº¿n tá»« thÆ° viá»‡n bÃªn ngoÃ i hoáº·c framework, vÃ  báº¡n khÃ´ng thá»ƒ sá»­a trá»±c tiáº¿p mÃ£ nguá»“n gá»‘c.\nGiáº£i phÃ¡p? ğŸ‘‰ Monkey patch.\nTuy nhiÃªn, monkey patch náº¿u dÃ¹ng khÃ´ng cáº©n tháº­n dá»… gÃ¢y ra:\nGhi Ä‘Ã¨ nháº§m method GÃ¢y xung Ä‘á»™t trong nhiá»u nÆ¡i cÃ¹ng patch KhÃ³ trace bug vÃ¬ method \u0026ldquo;tá»± nhiÃªn mÃ  cÃ³\u0026rdquo; Trong bÃ i viáº¿t nÃ y, mÃ¬nh sáº½ hÆ°á»›ng dáº«n cÃ¡ch monkey patch má»™t cÃ¡ch cÃ³ kiá»ƒm soÃ¡t, rÃµ rÃ ng, vÃ  tÆ°Æ¡ng thÃ­ch TypeScript.\nâ“ Monkey Patch LÃ  GÃ¬? Monkey patch lÃ  ká»¹ thuáº­t cho phÃ©p bá»• sung hoáº·c ghi Ä‘Ã¨ method vÃ o prototype cá»§a class Ä‘ang tá»“n táº¡i.\nVÃ­ dá»¥:\n1 2 3 4 UserService.prototype.countActiveUsers = function () { return 42; }; CÃ¡ch nÃ y Ä‘Æ¡n giáº£n nhÆ°ng rá»§i ro cao. Váº­y nÃªn, ta sáº½ xÃ¢y dá»±ng má»™t tiá»‡n Ã­ch nhá» Ä‘á»ƒ lÃ m viá»‡c nÃ y an toÃ n hÆ¡n.\nğŸ§± Táº¡o HÃ m patchService() â€“ Monkey Patch CÃ³ Kiá»ƒm SoÃ¡t 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 // patchService.ts type PatchMap\u0026lt;T\u0026gt; = { [K in keyof Partial\u0026lt;T\u0026gt;]: T[K]; }; const globalPatchFlag = Symbol.for(\u0026#39;__patched_methods__\u0026#39;); export function patchService\u0026lt;T extends object\u0026gt;( target: { prototype: T }, methods: PatchMap\u0026lt;T\u0026gt;, ) { if (!(target.prototype as any)[globalPatchFlag]) { (target.prototype as any)[globalPatchFlag] = new Set\u0026lt;string\u0026gt;(); } const patched: Set\u0026lt;string\u0026gt; = (target.prototype as any)[globalPatchFlag]; for (const [key, fn] of Object.entries(methods)) { if (patched.has(key)) { console.warn(`[patchService] Bá» qua vÃ¬ Ä‘Ã£ patch: ${key}`); continue; } if (typeof fn === \u0026#39;function\u0026#39;) { if (key in target.prototype) { console.warn(`[patchService] Ghi Ä‘Ã¨ method Ä‘Ã£ cÃ³: ${key}`); } (target.prototype as any)[key] = fn; patched.add(key); } } } ğŸ“¦ Äá»‹nh NghÄ©a Class Gá»‘c UserService 1 2 3 4 5 6 7 8 9 // user.service.ts export class UserService { private name = \u0026#39;DemoService\u0026#39;; sayHello() { return `Hello from ${this.name}`; } } ğŸ”§ ThÃªm Method Má»›i Báº±ng Patch 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // user-patch.ts import { patchService } from \u0026#39;./patchService\u0026#39;; import { UserService } from \u0026#39;./user.service\u0026#39;; // Má»Ÿ rá»™ng interface vá»›i TypeScript declare module \u0026#39;./user.service\u0026#39; { interface UserService { countActiveUsers(): Promise\u0026lt;number\u0026gt;; } } // Patch method má»›i patchService(UserService, { async countActiveUsers(this: UserService): Promise\u0026lt;number\u0026gt; { return 42; // Tráº£ vá» sá»‘ cá»‘ Ä‘á»‹nh cho demo }, }); ğŸš€ Cháº¡y Thá»­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 // main.ts import \u0026#39;./user-patch\u0026#39;; import { UserService } from \u0026#39;./user.service\u0026#39;; async function main() { const service = new UserService(); console.log(service.sayHello()); // âœ… method gá»‘c const count = await service.countActiveUsers(); // âœ… method má»›i console.log(\u0026#39;Sá»‘ user active:\u0026#39;, count); // Káº¿t quáº£: Sá»‘ user active: 42 } main(); âœ… Káº¿t Quáº£ Khi Cháº¡y 1 2 3 Hello from DemoService Sá»‘ user active: 42 âœ¨ Lá»£i Ãch Khi DÃ¹ng patchService() TÃ­nh nÄƒng Lá»£i Ã­ch ğŸ§  Gáº¯n cá» Ä‘Ã£ patch TrÃ¡nh patch láº·p láº¡i ğŸ§¾ CÃ³ log rÃµ rÃ ng Dá»… debug ğŸ”’ Kiá»ƒm soÃ¡t ghi Ä‘Ã¨ Giáº£m rá»§i ro ğŸ§© Há»— trá»£ interface má»Ÿ rá»™ng TÆ°Æ¡ng thÃ­ch hoÃ n toÃ n TypeScript ğŸ“Œ Káº¿t Luáº­n Monkey patch khÃ´ng pháº£i lÃ  ká»¹ thuáº­t nÃªn láº¡m dá»¥ng, nhÆ°ng khi dÃ¹ng Ä‘Ãºng cÃ¡ch, báº¡n cÃ³ thá»ƒ má»Ÿ rá»™ng há»‡ thá»‘ng mÃ  khÃ´ng cáº§n sá»­a class gá»‘c. Vá»›i patchService(), báº¡n cÃ³ thá»ƒ:\nBá»• sung method má»™t cÃ¡ch rÃµ rÃ ng Kiá»ƒm soÃ¡t vÃ  háº¡n cháº¿ xung Ä‘á»™t Viáº¿t TypeScript chuáº©n, dá»… maintain vá» sau HÃ£y xem monkey patch nhÆ° má»™t con dao sáº¯c â€“ dÃ¹ng Ä‘Ãºng lÃºc, Ä‘Ãºng chá»—, sáº½ cá»±c ká»³ há»¯u dá»¥ng.\n","date":"2025-04-06T00:00:00+08:00","permalink":"https://phongthien99.github.io/posts/monkey-patch-in-typescript/","title":"Monkey Patch In TypeScript"},{"content":"Implementing i18n in NestJS Using In-Memory Storage 1. Giá»›i thiá»‡u Quá»‘c táº¿ hÃ³a (i18n) lÃ  má»™t pháº§n quan trá»ng trong viá»‡c phÃ¡t triá»ƒn á»©ng dá»¥ng Ä‘a ngÃ´n ngá»¯. Trong bÃ i viáº¿t nÃ y, chÃºng ta sáº½ tÃ¬m hiá»ƒu cÃ¡ch triá»ƒn khai i18n trong NestJS sá»­ dá»¥ng in-memory storage thay vÃ¬ táº£i dá»¯ liá»‡u tá»« file JSON hoáº·c database.\n2. CÃ i Ä‘áº·t NestJS vÃ  cÃ¡c thÆ° viá»‡n cáº§n thiáº¿t TrÆ°á»›c tiÃªn, báº¡n cáº§n cÃ³ má»™t dá»± Ã¡n NestJS. Náº¿u chÆ°a cÃ³, báº¡n cÃ³ thá»ƒ táº¡o má»›i báº±ng lá»‡nh:\n1 2 npx @nestjs/cli new my-nestjs-app cd my-nestjs-app CÃ i Ä‘áº·t thÆ° viá»‡n nestjs-i18n Ä‘á»ƒ há»— trá»£ i18n:\n1 npm install --save @nestjs/i18n 3. Cáº¥u hÃ¬nh i18n vá»›i In-Memory Storage 3.1. Táº¡o I18nMemoryLoader ChÃºng ta sáº½ táº¡o má»™t loader Ä‘á»ƒ lÆ°u trá»¯ báº£n dá»‹ch trong bá»™ nhá»›:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 import { Inject } from \u0026#39;@nestjs/common\u0026#39;; import { I18N_LOADER_OPTIONS, I18nLoader, I18nTranslation } from \u0026#39;nestjs-i18n\u0026#39;; export class I18nMemoryLoader extends I18nLoader { private readonly _translations: I18nTranslation; private readonly _languages: string[]; constructor( @Inject(I18N_LOADER_OPTIONS) private options: any, ) { super(); const mergeI18n = (...objects) =\u0026gt; { return objects.reduce((acc, obj) =\u0026gt; { Object.keys(obj).forEach((lang) =\u0026gt; { acc[lang] = { ...(acc[lang] || {}), ...obj[lang] }; }); return acc; }, {}); }; this._translations = mergeI18n(...options.translations); this._languages = Object.keys(this._translations); } async load(): Promise\u0026lt;I18nTranslation\u0026gt; { return this._translations; } async languages(): Promise\u0026lt;string[]\u0026gt; { return this._languages; } } 3.2. Táº¡o I18nMemoryModule ChÃºng ta sáº½ táº¡o má»™t module Ä‘á»ƒ sá»­ dá»¥ng loader nÃ y vÃ  há»— trá»£ thÃªm báº£n dá»‹ch tá»« tá»«ng module riÃªng:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 import { DynamicModule, Module } from \u0026#39;@nestjs/common\u0026#39;; import { I18nAsyncOptions, I18nModule, I18nTranslation } from \u0026#39;nestjs-i18n\u0026#39;; import { I18nMemoryLoader } from \u0026#39;./i18n-memory\u0026#39;; const I18nTranslationFactory = \u0026#39;I18nTranslationFactory\u0026#39;; @Module({}) export class I18nMemoryModule { private static translations: I18nTranslation[] = []; static forRootAsync(options: I18nAsyncOptions): DynamicModule { options.inject = [I18nTranslationFactory]; options.loader = I18nMemoryLoader; return { module: I18nMemoryModule, imports: [I18nModule.forRootAsync(options)], }; } static forFeature(translation: I18nTranslation): DynamicModule { I18nMemoryModule.translations.push(translation); return { module: I18nMemoryModule, global: true, providers: [ { provide: I18nTranslationFactory, useFactory: () =\u0026gt; I18nMemoryModule.translations, }, ], exports: [I18nTranslationFactory], }; } } 3.3. ÄÄƒng kÃ½ module trong AppModule ThÃªm I18nMemoryModule vÃ o module chÃ­nh:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import { Module } from \u0026#39;@nestjs/common\u0026#39;; import { I18nMemoryModule } from \u0026#39;./i18n-memory.module\u0026#39;; import { QueryResolver, AcceptLanguageResolver } from \u0026#39;nestjs-i18n\u0026#39;; @Module({ imports: [ I18nMemoryModule.forRootAsync({ useFactory: (translationsFactory: I18nTranslation[]) =\u0026gt; ({ fallbackLanguage: \u0026#39;en\u0026#39;, loaderOptions: { translations: translationsFactory, }, }), resolvers: [ { use: QueryResolver, options: [\u0026#39;lang\u0026#39;] }, AcceptLanguageResolver, ], }), ], }) export class AppModule {} 3.4. ThÃªm báº£n dá»‹ch tá»« má»—i module riÃªng Má»—i module cÃ³ thá»ƒ sá»­ dá»¥ng forFeature Ä‘á»ƒ thÃªm báº£n dá»‹ch riÃªng cá»§a nÃ³:\n1 2 3 4 5 6 7 8 9 10 11 12 import { Module } from \u0026#39;@nestjs/common\u0026#39;; import { I18nMemoryModule } from \u0026#39;../i18n-memory.module\u0026#39;; const userTranslations = { en: { user: \u0026#39;User\u0026#39; }, vi: { user: \u0026#39;NgÆ°á»i dÃ¹ng\u0026#39; }, }; @Module({ imports: [I18nMemoryModule.forFeature(userTranslations)], }) export class UserModule {} 3.5. Sá»­ dá»¥ng i18n trong controller Táº¡o má»™t controller Ä‘á»ƒ sá»­ dá»¥ng i18n:\n1 2 3 4 5 6 7 8 9 10 11 12 import { Controller, Get, Headers } from \u0026#39;@nestjs/common\u0026#39;; import { I18nService } from \u0026#39;nestjs-i18n\u0026#39;; @Controller(\u0026#39;i18n\u0026#39;) export class I18nController { constructor() {} @Get(\u0026#39;translate\u0026#39;) translate(@I18n() i18n: I18nContext): string { return await i18n.t(\u0026#39;user\u0026#39;); } } 4. Kiá»ƒm tra API Cháº¡y á»©ng dá»¥ng báº±ng lá»‡nh:\n1 npm run start Gá»i API Ä‘á»ƒ kiá»ƒm tra:\n1 curl -H \u0026#34;Accept-Language: vi-VN\u0026#34; \u0026#34;http://localhost:3000/i18n/translate\u0026#34; Káº¿t quáº£:\n1 \u0026#34;NgÆ°á»i dÃ¹ng\u0026#34; 5. Káº¿t luáº­n ChÃºng ta Ä‘Ã£ triá»ƒn khai thÃ nh cÃ´ng i18n trong NestJS sá»­ dá»¥ng in-memory storage. NgoÃ i ra, chÃºng ta cÃ³ thá»ƒ thÃªm báº£n dá»‹ch tá»« tá»«ng module riÃªng báº±ng forFeature, giÃºp há»‡ thá»‘ng linh hoáº¡t hÆ¡n mÃ  khÃ´ng cáº§n táº£i láº¡i toÃ n bá»™ á»©ng dá»¥ng.\n","date":"2025-04-05T10:17:00+08:00","permalink":"https://phongthien99.github.io/posts/implementing-i18n-in-nestjs-using-in-memory-storage/","title":"Implementing i18n in NestJS Using In-Memory Storage"},{"content":"Context-Aware Request Logger with Async Context for NestJS 1. The Problem Má»™t há»‡ thá»‘ng logging tá»‘t khÃ´ng chá»‰ ghi nháº­n sá»± kiá»‡n mÃ  cÃ²n cung cáº¥p Ä‘á»§ thÃ´ng tin Ä‘á»ƒ phÃ¢n tÃ­ch vÃ  truy váº¿t lá»—i. Trong NestJS, viá»‡c sá»­ dá»¥ng context-aware logger giÃºp gáº¯n káº¿t dá»¯ liá»‡u nhÆ° requestId, userAgent hoáº·c thÃ´ng tin ngÆ°á»i dÃ¹ng vÃ o má»—i log, Ä‘áº£m báº£o kháº£ nÄƒng theo dÃµi vÃ  nhÃ³m cÃ¡c request cá»¥ thá»ƒ má»™t cÃ¡ch hiá»‡u quáº£.\nTheo nguyÃªn táº¯c 12-Factor App, logging Ä‘Ã³ng vai trÃ² quan trá»ng trong giÃ¡m sÃ¡t vÃ  duy trÃ¬ á»©ng dá»¥ng. Cá»¥ thá»ƒ:\ná»¨ng dá»¥ng nÃªn ghi log á»Ÿ dáº¡ng vÄƒn báº£n Ä‘Æ¡n giáº£n (stdout / stderr). KhÃ´ng lÆ°u trá»¯ log trong á»©ng dá»¥ng, mÃ  Ä‘á»ƒ mÃ´i trÆ°á»ng váº­n hÃ nh xá»­ lÃ½. Má»—i log cáº§n cÃ³ Ä‘á»§ ngá»¯ cáº£nh Ä‘á»ƒ dá»… dÃ ng truy váº¿t. 2. The Solution Sá»­ dá»¥ng async_hooks Ä‘á»ƒ gÃ¡n ngá»¯ cáº£nh .async_hooks lÃ  má»™t module trong Node.js giÃºp theo dÃµi vÃ²ng Ä‘á»i cá»§a cÃ¡c tÃ¡c vá»¥ báº¥t Ä‘á»“ng bá»™ nhÆ° Promise, setTimeout, HTTP request. Má»™t trong nhá»¯ng á»©ng dá»¥ng quan trá»ng cá»§a nÃ³ lÃ  quáº£n lÃ½ ngá»¯ cáº£nh request, Ä‘áº·c biá»‡t há»¯u Ã­ch khi logging hoáº·c theo dÃµi truy váº¿t lá»—i.\nTrong NestJS, cÃ³ thá»ƒ sá»­ dá»¥ngasync_hooks thÃ´ng qua AsyncLocalStorage Ä‘á»ƒ gÃ¡n vÃ  duy trÃ¬ dá»¯ liá»‡u theo tá»«ng request mÃ  khÃ´ng cáº§n truyá»n thá»§ cÃ´ng. Äiá»u nÃ y giÃºp:\nTá»± Ä‘á»™ng gÃ¡n requestId vÃ o logger, há»— trá»£ truy váº¿t request dá»… dÃ ng. LÆ°u thÃ´ng tin ngÆ°á»i dÃ¹ng trong vÃ²ng Ä‘á»i request, khÃ´ng cáº§n global state. Duy trÃ¬ trace ID Ä‘á»ƒ debugging há»‡ thá»‘ng phÃ¢n tÃ¡n. CÃ¡ch triá»ƒn khai phá»• biáº¿n lÃ  dÃ¹ng Middleware Ä‘á»ƒ khá»Ÿi táº¡o ngá»¯ cáº£nh request, káº¿t há»£p vá»›i Custom Logger Ä‘á»ƒ tá»± Ä‘á»™ng láº¥y thÃ´ng tin tá»« AsyncLocalStorage.\n3. Implement TrÆ°á»›c tiÃªn, hÃ£y cÃ i Ä‘áº·t NestJS vÃ  cÃ¡c thÆ° viá»‡n cáº§n thiáº¿t:\n1 npm install @nestjs/common @nestjs/core @nestjs/platform-express uuid 1. LoggerStorageService (LÆ°u trá»¯ ngá»¯ cáº£nh logging) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 ts CopyEdit import { Injectable } from \u0026#39;@nestjs/common\u0026#39;; import { AsyncLocalStorage } from \u0026#39;async_hooks\u0026#39;; @Injectable() export class LoggerStorageService { private readonly _storage: AsyncLocalStorage\u0026lt;Record\u0026lt;string, any\u0026gt;\u0026gt;; constructor() { this._storage = new AsyncLocalStorage\u0026lt;Record\u0026lt;string, any\u0026gt;\u0026gt;(); } getStore(): Record\u0026lt;string, any\u0026gt; | undefined { return this._storage.getStore(); } run(store: Record\u0026lt;string, any\u0026gt;, callback: () =\u0026gt; any) { return this._storage.run(store, callback); } } AsyncLocalStorage giÃºp lÆ°u trá»¯ ngá»¯ cáº£nh cá»§a má»—i request má»™t cÃ¡ch riÃªng biá»‡t. getStore() láº¥y dá»¯ liá»‡u hiá»‡n táº¡i trong ngá»¯ cáº£nh báº¥t Ä‘á»“ng bá»™. run(store, callback) thiáº¿t láº­p má»™t ngá»¯ cáº£nh má»›i vÃ  thá»±c thi callback bÃªn trong nÃ³. 2. GestLogger (Logger cÃ³ ngá»¯ cáº£nh) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 import { Injectable, Logger, LoggerService } from \u0026#39;@nestjs/common\u0026#39;; import { LoggerStorageService } from \u0026#39;./storage.service\u0026#39;; export class GestLogger implements LoggerService { private readonly _logger: Logger; constructor( private readonly _storageService: LoggerStorageService, context?: string, options?: { timestamp?: boolean }, ) { this._logger = new Logger(context, options); } contextDetail(...fields: string[]): string { const context = this._storageService.getStore(); if (!context) return \u0026#39;\u0026#39;; // If fields are specified, only include those fields if (fields \u0026amp;\u0026amp; fields.length \u0026gt; 0) { return fields .filter((field) =\u0026gt; field in context) .map((field) =\u0026gt; `[${field}:${context[field]}]`) .join(\u0026#39;\u0026#39;); } // Otherwise include all fields return Object.entries(context) .map(([key, value]) =\u0026gt; `[${key}:${value}]`) .join(\u0026#39;\u0026#39;); } log(message: any, ...optionalParams: any[]): void { this._logger.log(message, ...optionalParams); } error(message: any, stack?: string, ...optionalParams: any[]): void { this._logger.error(message, ...optionalParams); } warn(message: any, ...optionalParams: any[]): void { this._logger.warn(message, ...optionalParams); } debug(message: any, ...optionalParams: any[]): void { this._logger.debug(message, ...optionalParams); } verbose(message: any, ...optionalParams: any[]): void { this._logger.verbose(message, ...optionalParams); } } @Injectable() export class GestLoggerFactory { constructor(private readonly _storageService: LoggerStorageService) {} create(context?: string, options?: { timestamp?: boolean }): GestLogger { return new GestLogger(this._storageService, context, options); } } contextDetail(): Láº¥y thÃ´ng tin tá»« AsyncLocalStorage vÃ  Ä‘á»‹nh dáº¡ng dÆ°á»›i dáº¡ng [key:value]. 3. GestLoggerFactory (Factory Ä‘á»ƒ táº¡o logger) 1 2 3 4 5 6 7 8 9 @Injectable() export class GestLoggerFactory { constructor(private readonly _storageService: LoggerStorageService) {} create(context?: string, options?: { timestamp?: boolean }): GestLogger { return new GestLogger(this._storageService, context, options); } } Factory Pattern giÃºp táº¡o cÃ¡c instance cá»§a GestLogger. 4. GestLoggerModule (Module Logging) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 import { Global, MiddlewareConsumer, Module, DynamicModule, } from \u0026#39;@nestjs/common\u0026#39;; import { GestLoggerFactory } from \u0026#39;./logger.service\u0026#39;; import { LoggerStorageService } from \u0026#39;./storage.service\u0026#39;; import { HttpContextMiddlewareFactory } from \u0026#39;../middleware/http-context.middleware\u0026#39;; import { v4 as uuidv4 } from \u0026#39;uuid\u0026#39;; export interface LoggerModuleAsyncOptions { httpMiddleware?: { enabled?: boolean; getContext?: (req: any, res: any) =\u0026gt; any; }; } @Global() @Module({}) export class GestLoggerModule { private static _options: LoggerModuleAsyncOptions; static forRoot(options: LoggerModuleAsyncOptions): DynamicModule { this._options = options; return { module: GestLoggerModule, providers: [GestLoggerFactory, LoggerStorageService], exports: [GestLoggerFactory, LoggerStorageService], }; } configure(consumer: MiddlewareConsumer) { const enabled = GestLoggerModule._options?.httpMiddleware?.enabled ?? true; if (!enabled) return; const getContext = GestLoggerModule._options?.httpMiddleware?.getContext || ((req, res) =\u0026gt; ({ requestId: req.headers[\u0026#39;x-request-id\u0026#39;] || uuidv4(), userAgent: req.headers[\u0026#39;user-agent\u0026#39;] || null, })); consumer.apply(HttpContextMiddlewareFactory(getContext)).forRoutes(\u0026#39;*\u0026#39;); } } forRoot() cáº¥u hÃ¬nh module vá»›i middleware tÃ¹y chá»‰nh. configure() tá»± Ä‘á»™ng thÃªm requestId vÃ o má»—i request. 5. Sá»­ dá»¥ng trong AppModule 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 ts CopyEdit import { Module } from \u0026#39;@nestjs/common\u0026#39;; import { GestLoggerModule } from \u0026#39;./logger/logger.module\u0026#39;; import { AppService } from \u0026#39;./app.service\u0026#39;; @Module({ imports: [ GestLoggerModule.forRoot({ httpMiddleware: { enabled: true, getContext: (req, res) =\u0026gt; ({ requestId: req.headers[\u0026#39;x-request-id\u0026#39;] || uuidv4(), userAgent: req.headers[\u0026#39;user-agent\u0026#39;] || null, }), }, }), ], providers: [AppService], }) export class AppModule {} Import GestLoggerModule vÃ o á»©ng dá»¥ng chÃ­nh. KÃ­ch hoáº¡t middleware tá»± Ä‘á»™ng thÃªm requestId. 6. Sá»­ dá»¥ng trong AppService 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import { Injectable } from \u0026#39;@nestjs/common\u0026#39;; import { GestLoggerFactory } from \u0026#39;./logger/logger.service\u0026#39;; import { GestLogger } from \u0026#39;./logger/gest-logger\u0026#39;; @Injectable() export class AppService { private _logger: GestLogger; constructor(private readonly gestLoggerFactory: GestLoggerFactory) { this._logger = gestLoggerFactory.create(AppService.name); } getHello(): string { this._logger.log(`${this._logger.contextDetail(\u0026#39;requestId\u0026#39;)} Hello World!`); return \u0026#39;Hello World!\u0026#39;; } } this._logger.log() sáº½ tá»± Ä‘á»™ng kÃ¨m theo requestId tá»« AsyncLocalStorage. Káº¿t quáº£:\n1 [Nest] 800395 - 22/03/2025, 03:28:44 LOG [AppService] [requestId:c003fca7-4d48-4ce3-ae3d-979a693eaf0d] Hello World! 4. The conclusion Vá»›i viá»‡c sá»­ dá»¥ng async_hooks vÃ  AsyncLocalStorage, chÃºng ta cÃ³ thá»ƒ duy trÃ¬ ngá»¯ cáº£nh logging xuyÃªn suá»‘t cÃ¡c request trong NestJS. Äiá»u nÃ y giÃºp viá»‡c debug trá»Ÿ nÃªn dá»… dÃ ng hÆ¡n vÃ  tÄƒng cÆ°á»ng kháº£ nÄƒng theo dÃµi request trong há»‡ thá»‘ng.\n","date":"2025-03-22T10:17:00+08:00","permalink":"https://phongthien99.github.io/posts/context-aware-request-logger-with-async-context-for-nestjs/","title":"Context-Aware Request Logger with Async Context for NestJS"},{"content":"Efficient Configuration Management in NestJS 1. Problem Trong NestJS, náº¿u báº¡n Ä‘ang sá»­ dá»¥ng cáº¥u hÃ¬nh theo mÃ´i trÆ°á»ng nhÆ°ng láº¡i load vÃ o má»™t biáº¿n global vÃ  import kháº¯p nÆ¡i, thÃ¬ sáº½ gáº·p cÃ¡c váº¥n Ä‘á» sau:\nKhÃ³ kiá»ƒm soÃ¡t vÃ  quáº£n lÃ½: Biáº¿n global cÃ³ thá»ƒ bá»‹ thay Ä‘á»•i hoáº·c Ä‘Æ°á»£c sá»­ dá»¥ng khÃ´ng nháº¥t quÃ¡n trong nhiá»u module. KhÃ³ tÃ¡i sá»­ dá»¥ng module: Náº¿u module phá»¥ thuá»™c trá»±c tiáº¿p vÃ o biáº¿n global, viá»‡c tÃ¡i sá»­ dá»¥ng module Ä‘Ã³ á»Ÿ nÆ¡i khÃ¡c sáº½ khÃ³ khÄƒn hoáº·c khÃ´ng thá»ƒ thay Ä‘á»•i config má»™t cÃ¡ch linh hoáº¡t. KhÃ³ kiá»ƒm thá»­ (testability kÃ©m): Khi config Ä‘Æ°á»£c load trá»±c tiáº¿p tá»« biáº¿n global, viá»‡c mock dá»¯ liá»‡u trong unit test trá»Ÿ nÃªn phá»©c táº¡p, áº£nh hÆ°á»Ÿng Ä‘áº¿n kháº£ nÄƒng kiá»ƒm thá»­ vÃ  báº£o trÃ¬ code. Äá»ƒ giáº£i quyáº¿t nhá»¯ng váº¥n Ä‘á» trÃªn, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng mÃ´ hÃ¬nh forRoot vÃ  forRootAsync Ä‘á»ƒ quáº£n lÃ½ config má»™t cÃ¡ch linh hoáº¡t vÃ  dá»… kiá»ƒm soÃ¡t hÆ¡n.\n2. Solution BÆ°á»›c 1: Khá»Ÿi táº¡o AppModule theo dáº¡ng forRoot Thay vÃ¬ sá»­ dá»¥ng biáº¿n global, ta cÃ³ thá»ƒ truyá»n config qua forRoot, giÃºp module cÃ³ thá»ƒ nháº­n cáº¥u hÃ¬nh tá»« bÃªn ngoÃ i.\napp.module.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 import { DynamicModule, Module } from \u0026#39;@nestjs/common\u0026#39;; import { AppController } from \u0026#39;./app.controller\u0026#39;; import { AppService } from \u0026#39;./app.service\u0026#39;; @Module({}) export class AppModule { static forRoot(config: Record\u0026lt;string, any\u0026gt;): DynamicModule { return { module: AppModule, providers: [], controllers: [], }; } } main.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 const loadConfig = () =\u0026gt; { return { http: { port: 5000, }, }; }; const conf = loadConfig(); async function bootstrap(config: Record\u0026lt;string, any\u0026gt;) { const app = await NestFactory.create(AppModule.forRoot(config)); await app.listen(config.http.port, () =\u0026gt; { console.log(`Listening on port ${config.http.port}`); }); } bootstrap(conf); CÃ¡ch lÃ m nÃ y giÃºp chÃºng ta quáº£n lÃ½ cáº¥u hÃ¬nh táº­p trung vÃ  dá»… dÃ ng thay Ä‘á»•i.\nBÆ°á»›c 2: Sá»­ dá»¥ng ConfigModule cá»§a NestJS NestJS cÃ³ sáºµn @nestjs/config, giÃºp quáº£n lÃ½ cáº¥u hÃ¬nh theo mÃ´i trÆ°á»ng dá»… dÃ ng hÆ¡n.\napp.module.ts (cáº­p nháº­t thÃªm ConfigModule) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 import { DynamicModule, Module } from \u0026#39;@nestjs/common\u0026#39;; import { ConfigModule } from \u0026#39;@nestjs/config\u0026#39;; @Module({}) export class AppModule { static forRoot(config: Record\u0026lt;string, any\u0026gt;): DynamicModule { return { module: AppModule, imports: [ ConfigModule.forRoot({ isGlobal: true, // Äáº£m báº£o module cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng á»Ÿ báº¥t ká»³ Ä‘Ã¢u load: [() =\u0026gt; config], // Load config tá»« biáº¿n config }), ], }; } } Viá»‡c sá»­ dá»¥ng ConfigModule giÃºp dá»… dÃ ng inject config vÃ o báº¥t ká»³ module nÃ o trong á»©ng dá»¥ng mÃ  khÃ´ng cáº§n dÃ¹ng biáº¿n global.\nBÆ°á»›c 3: Sá»­ dá»¥ng forRootAsync Ä‘á»ƒ inject config vÃ o tá»«ng module Náº¿u má»™t module cáº§n sá»­ dá»¥ng biáº¿n mÃ´i trÆ°á»ng, ta nÃªn inject thÃ´ng qua dependency injection thay vÃ¬ sá»­ dá»¥ng biáº¿n global trá»±c tiáº¿p.\nsome.module.ts 1 2 3 4 5 6 7 8 9 10 11 import { DynamicModule, Module, Provider } from \u0026#39;@nestjs/common\u0026#39;; @Module({}) export class SomeModule { static forRootAsync(...configProviders: Provider[]): DynamicModule { return { module: SomeModule, providers: [...configProviders], }; } } Báº±ng cÃ¡ch nÃ y, chÃºng ta cÃ³ thá»ƒ truyá»n config vÃ o tá»«ng module má»™t cÃ¡ch linh hoáº¡t vÃ  kiá»ƒm soÃ¡t tá»‘t hÆ¡n.\nCáº­p nháº­t app.module.ts 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 import { ConfigModule, ConfigService } from \u0026#39;@nestjs/config\u0026#39;; import { SomeModule } from \u0026#39;./some.module\u0026#39;; @Module({}) export class AppModule { static forRoot(config: Record\u0026lt;string, any\u0026gt;): DynamicModule { return { module: AppModule, imports: [ ConfigModule.forRoot({ isGlobal: true, // Äáº£m báº£o module cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng á»Ÿ báº¥t ká»³ Ä‘Ã¢u load: [() =\u0026gt; config], // Load config tá»« biáº¿n config }), SomeModule.forRootAsync({ provide: \u0026#39;DATABASE_HOST\u0026#39;, useFactory: (configService: ConfigService) =\u0026gt; configService.get\u0026lt;string\u0026gt;(\u0026#39;mongo.host\u0026#39;), inject: [ConfigService], }), ], }; } } Sá»­ dá»¥ng forRootAsync giÃºp module tá»± Ä‘á»™ng láº¥y Ä‘Æ°á»£c config phÃ¹ há»£p mÃ  khÃ´ng phá»¥ thuá»™c vÃ o biáº¿n global, lÃ m tÄƒng tÃ­nh linh hoáº¡t vÃ  dá»… báº£o trÃ¬.\n3. Conclusion Viá»‡c quáº£n lÃ½ cáº¥u hÃ¬nh trong NestJS má»™t cÃ¡ch khoa há»c sáº½ giÃºp á»©ng dá»¥ng dá»… má»Ÿ rá»™ng, báº£o trÃ¬ vÃ  kiá»ƒm thá»­ hÆ¡n. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ Ä‘iá»ƒm quan trá»ng:\nTrÃ¡nh sá»­ dá»¥ng biáº¿n global Ä‘á»ƒ lÆ°u trá»¯ config, vÃ¬ nÃ³ gÃ¢y khÃ³ khÄƒn trong kiá»ƒm soÃ¡t vÃ  tÃ¡i sá»­ dá»¥ng module. Sá»­ dá»¥ng forRoot hoáº·c forRootAsync Ä‘á»ƒ truyá»n config vÃ o module thay vÃ¬ hardcode giÃ¡ trá»‹. Táº­n dá»¥ng ConfigModule cá»§a NestJS Ä‘á»ƒ quáº£n lÃ½ biáº¿n mÃ´i trÆ°á»ng má»™t cÃ¡ch chuyÃªn nghiá»‡p. Sá»­ dá»¥ng forRootAsync Ä‘á»ƒ inject config vÃ o tá»«ng module giÃºp module linh hoáº¡t vÃ  dá»… dÃ ng kiá»ƒm thá»­ hÆ¡n. Báº±ng cÃ¡ch lÃ m theo phÆ°Æ¡ng phÃ¡p trÃªn, báº¡n sáº½ cÃ³ má»™t há»‡ thá»‘ng quáº£n lÃ½ config tá»‘t hÆ¡n, giÃºp á»©ng dá»¥ng cá»§a báº¡n trá»Ÿ nÃªn bá»n vá»¯ng vÃ  dá»… dÃ ng phÃ¡t triá»ƒn vá» sau.\n","date":"2025-03-15T10:17:00+08:00","permalink":"https://phongthien99.github.io/posts/efficient-configuration-management-in-nestjs/","title":"Efficient Configuration Management in NestJS"},{"content":"Unit Testing the Controller Layer in Web Applications Unit test lÃ  má»™t pháº§n quan trá»ng trong phÃ¡t triá»ƒn pháº§n má»m, giÃºp Ä‘áº£m báº£o tá»«ng thÃ nh pháº§n nhá» cá»§a há»‡ thá»‘ng hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c. Trong á»©ng dá»¥ng web, controller xá»­ lÃ½ request vÃ  response, gá»i service Ä‘á»ƒ láº¥y dá»¯ liá»‡u, kiá»ƒm tra Ä‘áº§u vÃ o, vÃ  tráº£ vá» mÃ£ tráº¡ng thÃ¡i HTTP phÃ¹ há»£p. Viáº¿t unit test cho controller giÃºp phÃ¡t hiá»‡n lá»—i sá»›m vÃ  Ä‘áº£m báº£o logic hoáº¡t Ä‘á»™ng Ä‘Ãºng.\n1. Lá»£i Ã­ch cá»§a unit test cho controller XÃ¡c minh logic xá»­ lÃ½ trong controller hoáº¡t Ä‘á»™ng Ä‘Ãºng. PhÃ¡t hiá»‡n lá»—i sá»›m trÆ°á»›c khi triá»ƒn khai. TÄƒng Ä‘á»™ tin cáº­y cho á»©ng dá»¥ng. CÃ´ láº­p lá»—i dá»… dÃ ng báº±ng cÃ¡ch sá»­ dá»¥ng mock service. 2. XÃ¡c Ä‘á»‹nh pháº¡m vi test há»£p lÃ½ Chá»‰ kiá»ƒm tra logic trong controller, khÃ´ng test service hoáº·c database. Kiá»ƒm tra cÃ¡c trÆ°á»ng há»£p quan trá»ng, gá»“m cáº£ thÃ nh cÃ´ng vÃ  tháº¥t báº¡i. Viáº¿t test tá»‘i giáº£n nhÆ°ng Ä‘áº§y Ä‘á»§. DÃ¹ng mock service Ä‘á»ƒ cÃ´ láº­p controller. 2.1. Thiáº¿t láº­p mÃ´i trÆ°á»ng VÃ­ dá»¥, má»™t á»©ng dá»¥ng Go dÃ¹ng echo framework cÃ³ controller nhÆ° sau:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 package example import ( \u0026#34;net/http\u0026#34; \u0026#34;strconv\u0026#34; \u0026#34;github.com/labstack/echo/v4\u0026#34; ) type User struct { Id int `json:\u0026#34;id\u0026#34;` Name string `json:\u0026#34;name\u0026#34;` } type IUserService interface { GetUserId(id int) (*User, error) } type IExampleController interface { GetUser() } type exampleController struct { router *echo.Group service IUserService } func NewExampleController(router *echo.Group, service IUserService) IExampleController { return \u0026amp;exampleController{ router: router.Group(\u0026#34;/example\u0026#34;), service: service, } } func (e *exampleController) GetUser() { e.router.GET(\u0026#34;/:id\u0026#34;, func(c echo.Context) error { id := c.Param(\u0026#34;id\u0026#34;) idInt, err := strconv.Atoi(id) if err != nil { return c.JSON(http.StatusBadRequest, map[string]string{\u0026#34;error\u0026#34;: \u0026#34;Invalid user ID\u0026#34;}) } user, err := e.service.GetUserId(idInt) if err != nil { return c.JSON(http.StatusInternalServerError, map[string]string{\u0026#34;error\u0026#34;: err.Error()}) } return c.JSON(http.StatusOK, user) }) } 2.2. Viáº¿t unit test 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 package example_test import ( \u0026#34;example/transport/http/example\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;net/http/httptest\u0026#34; \u0026#34;testing\u0026#34; \u0026#34;github.com/labstack/echo/v4\u0026#34; . \u0026#34;github.com/onsi/ginkgo/v2\u0026#34; . \u0026#34;github.com/onsi/gomega\u0026#34; \u0026#34;github.com/stretchr/testify/mock\u0026#34; ) type MockUserService struct { mock.Mock } func (m *MockUserService) GetUserId(id int) (*example.User, error) { args := m.Called(id) if args.Error(1) != nil { return nil, args.Error(1) } return args.Get(0).(*example.User), nil } var _ = Describe(\u0026#34;ExampleController\u0026#34;, func() { var ( e *echo.Echo rec *httptest.ResponseRecorder mockService *MockUserService controller example.IExampleController ) BeforeEach(func() { e = echo.New() rec = httptest.NewRecorder() mockService = new(MockUserService) controller = example.NewExampleController(e.Group(\u0026#34;\u0026#34;), mockService) controller.GetUser() }) Describe(\u0026#34;GetUser\u0026#34;, func() { Context(\u0026#34;when the user ID is valid\u0026#34;, func() { It(\u0026#34;should return the user\u0026#34;, func() { user := \u0026amp;example.User{Id: 1, Name: \u0026#34;John Doe\u0026#34;} mockService.On(\u0026#34;GetUserId\u0026#34;, 1).Return(user, nil) req := httptest.NewRequest(http.MethodGet, \u0026#34;/example/1\u0026#34;, nil) e.ServeHTTP(rec, req) Expect(rec.Code).To(Equal(http.StatusOK)) Expect(rec.Body.String()).To(ContainSubstring(\u0026#34;John Doe\u0026#34;)) }) }) Context(\u0026#34;when the user ID is invalid\u0026#34;, func() { It(\u0026#34;should return a bad request error\u0026#34;, func() { req := httptest.NewRequest(http.MethodGet, \u0026#34;/example/invalid\u0026#34;, nil) e.ServeHTTP(rec, req) Expect(rec.Code).To(Equal(http.StatusBadRequest)) Expect(rec.Body.String()).To(ContainSubstring(\u0026#34;Invalid user ID\u0026#34;)) }) }) Context(\u0026#34;when the service returns an error\u0026#34;, func() { It(\u0026#34;should return an internal server error\u0026#34;, func() { mockService.On(\u0026#34;GetUserId\u0026#34;, 1).Return(nil, echo.NewHTTPError(http.StatusInternalServerError, \u0026#34;Service error\u0026#34;)) req := httptest.NewRequest(http.MethodGet, \u0026#34;/example/1\u0026#34;, nil) e.ServeHTTP(rec, req) Expect(rec.Code).To(Equal(http.StatusInternalServerError)) Expect(rec.Body.String()).To(ContainSubstring(\u0026#34;Service error\u0026#34;)) }) }) }) }) func TestService(t *testing.T) { RegisterFailHandler(Fail) RunSpecs(t, \u0026#34;Example Suite\u0026#34;) } 3. Káº¿t luáº­n Viáº¿t unit test cho controller giÃºp Ä‘áº£m báº£o logic xá»­ lÃ½ Ä‘Ãºng, phÃ¡t hiá»‡n lá»—i sá»›m vÃ  dá»… dÃ ng báº£o trÃ¬. Báº±ng cÃ¡ch sá»­ dá»¥ng mocking, ta cÃ³ thá»ƒ cÃ´ láº­p controller khá»i cÃ¡c thÃ nh pháº§n khÃ¡c. Viá»‡c tá»‘i Æ°u sá»‘ lÆ°á»£ng test case giÃºp tiáº¿t kiá»‡m thá»i gian mÃ  váº«n Ä‘áº£m báº£o cháº¥t lÆ°á»£ng. Sá»­ dá»¥ng framework nhÆ° ginkgo vÃ  gomega giÃºp test dá»… Ä‘á»c vÃ  duy trÃ¬ hÆ¡n.\n","date":"2025-02-21T23:17:00+08:00","permalink":"https://phongthien99.github.io/posts/unit-testing-the-controller-layer-in-web-applications/","title":"Unit Testing the Controller Layer in Web Applications"},{"content":"Understanding and applying the SOLID Principles in Programming Trong láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng (OOP), SOLID lÃ  táº­p há»£p nÄƒm nguyÃªn lÃ½ giÃºp viáº¿t mÃ£ nguá»“n dá»… báº£o trÃ¬, má»Ÿ rá»™ng vÃ  trÃ¡nh nhá»¯ng váº¥n Ä‘á» phá»• biáº¿n nhÆ° mÃ£ láº·p (code duplication) hoáº·c liÃªn káº¿t cháº·t cháº½ (tight coupling). SOLID lÃ  viáº¿t táº¯t cá»§a:\nSingle Responsibility Principle (NguyÃªn lÃ½ trÃ¡ch nhiá»‡m duy nháº¥t) Open/Closed Principle (NguyÃªn lÃ½ má»Ÿ/Ä‘Ã³ng) Liskov Substitution Principle (NguyÃªn lÃ½ thay tháº¿ Liskov) Interface Segregation Principle (NguyÃªn lÃ½ phÃ¢n tÃ¡ch giao diá»‡n) Dependency Inversion Principle (NguyÃªn lÃ½ Ä‘áº£o ngÆ°á»£c phá»¥ thuá»™c) HÃ£y cÃ¹ng tÃ¬m hiá»ƒu chi tiáº¿t tá»«ng nguyÃªn lÃ½ vÃ  cÃ¡ch Ã¡p dá»¥ng chÃºng trong thá»±c táº¿.\n1. NguyÃªn LÃ½ TrÃ¡ch Nhiá»‡m Duy Nháº¥t (Single Responsibility Principle - SRP) Äá»‹nh nghÄ©a: Má»—i lá»›p chá»‰ nÃªn cÃ³ má»™t lÃ½ do Ä‘á»ƒ thay Ä‘á»•i, tá»©c lÃ  chá»‰ Ä‘áº£m nháº­n má»™t nhiá»‡m vá»¥ duy nháº¥t.\nVÃ­ dá»¥ sai: Má»™t lá»›p xá»­ lÃ½ cáº£ logic nghiá»‡p vá»¥ vÃ  giao tiáº¿p vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u:\n1 2 3 4 5 6 7 8 9 type Report struct {} func (r *Report) Generate() string { return \u0026#34;BÃ¡o cÃ¡o doanh thu thÃ¡ng\u0026#34; } func (r *Report) SaveToFile() { fmt.Println(\u0026#34;LÆ°u bÃ¡o cÃ¡o vÃ o file\u0026#34;) } CÃ¡ch cáº£i thiá»‡n: Chia thÃ nh hai lá»›p, má»™t lá»›p chá»‹u trÃ¡ch nhiá»‡m táº¡o bÃ¡o cÃ¡o vÃ  má»™t lá»›p khÃ¡c lo lÆ°u trá»¯:\n1 2 3 4 5 6 7 8 9 10 11 type Report struct {} func (r *Report) Generate() string { return \u0026#34;BÃ¡o cÃ¡o doanh thu thÃ¡ng\u0026#34; } type ReportStorage struct {} func (s *ReportStorage) SaveToFile(report string) { fmt.Println(\u0026#34;LÆ°u bÃ¡o cÃ¡o vÃ o file\u0026#34;) } á»¨ng dá»¥ng trong kiáº¿n trÃºc pháº§n má»m:\nKhi xÃ¢y dá»±ng á»©ng dá»¥ng, chÃºng ta cÃ³ thá»ƒ Ã¡p dá»¥ng nguyÃªn lÃ½ SRP báº±ng cÃ¡ch phÃ¢n chia cÃ¡c táº§ng nhÆ° Controller, Service, Repository, Model:\nController: Chá»‰ xá»­ lÃ½ yÃªu cáº§u HTTP vÃ  gá»i Ä‘áº¿n Service. Service: Chá»©a logic nghiá»‡p vá»¥, khÃ´ng liÃªn quan Ä‘áº¿n dá»¯ liá»‡u trá»±c tiáº¿p. Repository: Chá»‹u trÃ¡ch nhiá»‡m truy xuáº¥t dá»¯ liá»‡u tá»« cÆ¡ sá»Ÿ dá»¯ liá»‡u. Model: Chá»‰ Ä‘áº¡i diá»‡n cho dá»¯ liá»‡u, khÃ´ng chá»©a logic nghiá»‡p vá»¥ hoáº·c truy váº¥n. Äiá»u nÃ y giÃºp mÃ£ nguá»“n dá»… báº£o trÃ¬, thay Ä‘á»•i má»™t táº§ng mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c táº§ng khÃ¡c.\n2. NguyÃªn LÃ½ Má»Ÿ/ÄÃ³ng (Open/Closed Principle - OCP) Äá»‹nh nghÄ©a: Má»™t module nÃªn má»Ÿ Ä‘á»ƒ má»Ÿ rá»™ng nhÆ°ng Ä‘Ã³ng Ä‘á»ƒ chá»‰nh sá»­a, tá»©c lÃ  cÃ³ thá»ƒ thÃªm tÃ­nh nÄƒng má»›i mÃ  khÃ´ng thay Ä‘á»•i mÃ£ nguá»“n hiá»‡n cÃ³.\nVÃ­ dá»¥ sai:\n1 2 3 4 5 6 7 8 func CalculateBonus(role string, salary float64) float64 { if role == \u0026#34;Manager\u0026#34; { return salary * 0.2 } else if role == \u0026#34;Employee\u0026#34; { return salary * 0.1 } return 0 } Má»—i láº§n thÃªm loáº¡i nhÃ¢n viÃªn má»›i, chÃºng ta pháº£i sá»­a Ä‘á»•i hÃ m CalculateBonus.\nCÃ¡ch cáº£i thiá»‡n: Sá»­ dá»¥ng Strategy Pattern Ä‘á»ƒ má»Ÿ rá»™ng:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 type BonusCalculator interface { CalculateBonus(salary float64) float64 } type ManagerBonus struct {} func (m ManagerBonus) CalculateBonus(salary float64) float64 { return salary * 0.2 } type EmployeeBonus struct {} func (e EmployeeBonus) CalculateBonus(salary float64) float64 { return salary * 0.1 } type Context struct { bonusCalculator BonusCalculator } func (c *Context) SetStrategy(b BonusCalculator) { c.bonusCalculator = b } func (c *Context) ExecuteStrategy(salary float64) float64 { return c.bonusCalculator.CalculateBonus(salary) } BÃ¢y giá», chÃºng ta cÃ³ thá»ƒ dá»… dÃ ng thÃªm loáº¡i nhÃ¢n viÃªn má»›i mÃ  khÃ´ng cáº§n thay Ä‘á»•i hÃ m CalculateBonus.\n3. NguyÃªn LÃ½ Thay Tháº¿ Liskov (Liskov Substitution Principle - LSP) Äá»‹nh nghÄ©a: CÃ¡c lá»›p con cÃ³ thá»ƒ thay tháº¿ lá»›p cha mÃ  khÃ´ng lÃ m thay Ä‘á»•i hÃ nh vi mong Ä‘á»£i cá»§a chÆ°Æ¡ng trÃ¬nh.\nVÃ­ dá»¥ sai:\n1 2 3 4 5 6 7 8 type Bird struct {} func (b Bird) Fly() { fmt.Println(\u0026#34;Chim bay trÃªn trá»i\u0026#34;) } type Penguin struct { Bird } Chim cÃ¡nh cá»¥t khÃ´ng thá»ƒ bay, nhÆ°ng káº¿ thá»«a Bird khiáº¿n nÃ³ cÃ³ phÆ°Æ¡ng thá»©c Fly(), dáº«n Ä‘áº¿n lá»—i.\nCÃ¡ch cáº£i thiá»‡n:\nCÃ¡ch 1: Sá»­ dá»¥ng Interface Ä‘á»ƒ nhÃ³m hÃ nh vi thay vÃ¬ káº¿ thá»«a trá»±c tiáº¿p\n1 2 3 4 5 6 7 8 9 10 11 12 13 type Bird interface { Move() } type FlyingBird struct{} func (f FlyingBird) Move() { fmt.Println(\u0026#34;Bay trÃªn trá»i\u0026#34;) } type Penguin struct{} func (p Penguin) Move() { fmt.Println(\u0026#34;Äi bá»™ trÃªn bÄƒng\u0026#34;) } TÃ¡ch hÃ nh vi di chuyá»ƒn thÃ nh má»™t interface chung Ä‘á»ƒ cÃ¡c loÃ i chim cÃ³ thá»ƒ triá»ƒn khai theo Ä‘Ãºng Ä‘áº·c Ä‘iá»ƒm cá»§a chÃºng.\nCÃ¡ch 2: DÃ¹ng Composition Thay VÃ¬ Káº¿ Thá»«a\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 type Mover interface { Move() } type CanFly struct{} func (f CanFly) Move() { fmt.Println(\u0026#34;Bay trÃªn trá»i\u0026#34;) } type CanWalk struct{} func (w CanWalk) Move() { fmt.Println(\u0026#34;Äi bá»™ trÃªn bÄƒng\u0026#34;) } type Sparrow struct { Mover } type Penguin struct { Mover } Sá»­ dá»¥ng composition giÃºp phÃ¢n tÃ¡ch rÃµ hÃ nh vi Fly vÃ  Walk, trÃ¡nh káº¿ thá»«a sai vÃ  giÃºp má»Ÿ rá»™ng dá»… dÃ ng.\nNote: Khi thiáº¿t káº¿ há»‡ thá»‘ng, cáº§n xÃ¡c Ä‘á»‹nh rÃµ liá»‡u lá»›p má»›i cÃ³ thá»±c sá»± lÃ  con cá»§a lá»›p cÅ© hay chá»‰ lÃ  má»™t lá»›p má»›i hoÃ n toÃ n vá»›i cÃ¡c hÃ nh vi khÃ¡c biá»‡t. Äiá»u nÃ y giÃºp trÃ¡nh viá»‡c káº¿ thá»«a sai vÃ  Ä‘áº£m báº£o tuÃ¢n thá»§ nguyÃªn lÃ½ Liskov.\n4. NguyÃªn LÃ½ PhÃ¢n TÃ¡ch Giao Diá»‡n (Interface Segregation Principle - ISP) Äá»‹nh nghÄ©a: Má»™t interface lá»›n khÃ´ng nÃªn Ã©p cÃ¡c lá»›p triá»ƒn khai nhá»¯ng phÆ°Æ¡ng thá»©c mÃ  chÃºng khÃ´ng sá»­ dá»¥ng.\nVÃ­ dá»¥ sai:\n1 2 3 4 type Worker interface { Work() Eat() } Robot khÃ´ng cáº§n phÆ°Æ¡ng thá»©c Eat(), nhÆ°ng váº«n pháº£i triá»ƒn khai nÃ³.\nCÃ¡ch cáº£i thiá»‡n:\n1 2 3 4 5 6 7 type Workable interface { Work() } type Eatable interface { Eat() } Robot chá»‰ cáº§n triá»ƒn khai Workable, cÃ²n con ngÆ°á»i triá»ƒn khai cáº£ Workable vÃ  Eatable.\n5. NguyÃªn LÃ½ Äáº£o NgÆ°á»£c Phá»¥ Thuá»™c (Dependency Inversion Principle - DIP) Äá»‹nh nghÄ©a: CÃ¡c module cáº¥p cao khÃ´ng nÃªn phá»¥ thuá»™c vÃ o module cáº¥p tháº¥p, cáº£ hai nÃªn phá»¥ thuá»™c vÃ o abstraction(interface).\nVÃ­ dá»¥ sai:\n1 2 3 4 5 6 7 8 9 10 11 12 type MySQLDatabase struct {} func (db MySQLDatabase) SaveData(data string) { fmt.Println(\u0026#34;LÆ°u dá»¯ liá»‡u vÃ o MySQL\u0026#34;) } type Service struct { db MySQLDatabase } func (s Service) Store(data string) { s.db.SaveData(data) } Service bá»‹ phá»¥ thuá»™c vÃ o MySQL, gÃ¢y khÃ³ khÄƒn khi chuyá»ƒn sang PostgreSQL.\nCÃ¡ch cáº£i thiá»‡n:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 type Database interface { SaveData(data string) } type MySQLDatabase struct {} func (db MySQLDatabase) SaveData(data string) { fmt.Println(\u0026#34;LÆ°u dá»¯ liá»‡u vÃ o MySQL\u0026#34;) } type Service struct { db Database } func (s Service) Store(data string) { s.db.SaveData(data) } BÃ¢y giá» cÃ³ thá»ƒ dá»… dÃ ng thay tháº¿ MySQL báº±ng má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u khÃ¡c.\nKáº¿t Luáº­n Viá»‡c Ã¡p dá»¥ng SOLID giÃºp mÃ£ nguá»“n dá»… báº£o trÃ¬, má»Ÿ rá»™ng vÃ  tÃ¡i sá»­ dá»¥ng hÆ¡n. Khi thiáº¿t káº¿ há»‡ thá»‘ng, hÃ£y luÃ´n nghÄ© vá» cÃ¡c nguyÃªn lÃ½ nÃ y Ä‘á»ƒ trÃ¡nh nhá»¯ng váº¥n Ä‘á» vá» kiáº¿n trÃºc vÃ  Ä‘áº£m báº£o code cháº¥t lÆ°á»£ng cao.\n","date":"2025-02-08T01:17:00+08:00","permalink":"https://phongthien99.github.io/posts/understanding-and-applying-the-solid-principles-in-programming/","title":"Understanding and Applying the SOLID Principles in Programming"},{"content":"Comparing Decorator Pattern and Proxy Pattern in Programming Giá»›i thiá»‡u Trong láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng, Decorator Pattern vÃ  Proxy Pattern Ä‘á»u lÃ  nhá»¯ng máº«u thiáº¿t káº¿ thuá»™c nhÃ³m Structural Pattern (máº«u thiáº¿t káº¿ cáº¥u trÃºc). Tuy nhiÃªn, chÃºng cÃ³ má»¥c Ä‘Ã­ch sá»­ dá»¥ng khÃ¡c nhau. Náº¿u báº¡n Ä‘ang phÃ¢n vÃ¢n khi nÃ o nÃªn dÃ¹ng Decorator vÃ  khi nÃ o nÃªn dÃ¹ng Proxy, bÃ i viáº¿t nÃ y sáº½ giÃºp báº¡n hiá»ƒu rÃµ hÆ¡n.\n1. Äá»‹nh nghÄ©a vÃ  Má»¥c Ä‘Ã­ch Decorator Pattern â€“ Má»Ÿ rá»™ng hÃ nh vi cá»§a Ä‘á»‘i tÆ°á»£ng má»™t cÃ¡ch linh hoáº¡t Decorator Pattern cho phÃ©p báº¡n thÃªm hoáº·c thay Ä‘á»•i hÃ nh vi cá»§a má»™t Ä‘á»‘i tÆ°á»£ng mÃ  khÃ´ng cáº§n chá»‰nh sá»­a mÃ£ nguá»“n cá»§a nÃ³. Äiá»u nÃ y Ä‘áº·c biá»‡t há»¯u Ã­ch khi báº¡n muá»‘n má»Ÿ rá»™ng tÃ­nh nÄƒng mÃ  khÃ´ng lÃ m thay Ä‘á»•i cáº¥u trÃºc bÃªn trong.\ná»¨ng dá»¥ng thá»±c táº¿:\nThÃªm logging, caching cho má»™t class mÃ  khÃ´ng sá»­a Ä‘á»•i class gá»‘c. Má»Ÿ rá»™ng UI component trong cÃ¡c framework frontend nhÆ° React hoáº·c Vue. Proxy Pattern â€“ Kiá»ƒm soÃ¡t truy cáº­p Ä‘áº¿n Ä‘á»‘i tÆ°á»£ng tháº­t Proxy Pattern cung cáº¥p má»™t lá»›p thay tháº¿ Ä‘á»ƒ kiá»ƒm soÃ¡t cÃ¡ch truy cáº­p vÃ o má»™t Ä‘á»‘i tÆ°á»£ng. Má»¥c Ä‘Ã­ch chÃ­nh lÃ  báº£o vá»‡, caching, hoáº·c lazy loading Ä‘á»‘i tÆ°á»£ng thá»±c.\ná»¨ng dá»¥ng thá»±c táº¿:\nLazy loading hÃ¬nh áº£nh trong UI. Proxy database Ä‘á»ƒ kiá»ƒm soÃ¡t quyá»n truy cáº­p. Remote Proxy Ä‘á»ƒ gá»i API tá»« xa. 2. So sÃ¡nh chi tiáº¿t TiÃªu chÃ­ Decorator Pattern Proxy Pattern Má»¥c Ä‘Ã­ch ThÃªm hoáº·c má»Ÿ rá»™ng chá»©c nÄƒng mÃ  khÃ´ng thay Ä‘á»•i code gá»‘c. Kiá»ƒm soÃ¡t quyá»n truy cáº­p, caching, lazy-loading. CÃ¡ch hoáº¡t Ä‘á»™ng GÃ³i (wrap) Ä‘á»‘i tÆ°á»£ng ban Ä‘áº§u báº±ng má»™t lá»›p má»›i. Cung cáº¥p má»™t Ä‘á»‘i tÆ°á»£ng thay tháº¿ Ä‘á»ƒ kiá»ƒm soÃ¡t truy cáº­p. TÃ­nh nÄƒng chÃ­nh - Cho phÃ©p má»Ÿ rá»™ng hÃ nh vi linh hoáº¡t. - CÃ³ thá»ƒ káº¿t há»£p nhiá»u decorator. - CÃ³ thá»ƒ cháº·n truy cáº­p, lazy load Ä‘á»‘i tÆ°á»£ng tháº­t. - DÃ¹ng Ä‘á»ƒ báº£o vá»‡ tÃ i nguyÃªn. VÃ­ dá»¥ thá»±c táº¿ - ThÃªm logging, caching, thay Ä‘á»•i giao diá»‡n UI. - Proxy database, API Gateway, Virtual Proxy. 3. VÃ­ dá»¥ minh há»a trong Go Decorator Pattern â€“ ThÃªm SMS Notification vÃ o há»‡ thá»‘ng Email 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 package main import ( \u0026#34;fmt\u0026#34; ) // Interface gá»‘c type Notifier interface { Send(msg string) } // Cáº¥u trÃºc gá»‘c type EmailNotifier struct{} func (e *EmailNotifier) Send(msg string) { fmt.Println(\u0026#34;Sending Email:\u0026#34;, msg) } // Decorator thÃªm chá»©c nÄƒng SMS type SMSDecorator struct { Notifier Notifier } func (s *SMSDecorator) Send(msg string) { s.Notifier.Send(msg) // Gá»i chá»©c nÄƒng gá»‘c fmt.Println(\u0026#34;Sending SMS:\u0026#34;, msg) } func main() { email := \u0026amp;EmailNotifier{} notifier := \u0026amp;SMSDecorator{Notifier: email} notifier.Send(\u0026#34;Hello, Robin!\u0026#34;) // Gá»­i cáº£ email vÃ  SMS } Proxy Pattern â€“ Kiá»ƒm soÃ¡t quyá»n truy cáº­p vÃ o Server 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 package main import ( \u0026#34;fmt\u0026#34; ) // Interface gá»‘c type Server interface { HandleRequest(url string) } // Äá»‘i tÆ°á»£ng thá»±c type RealServer struct{} func (r *RealServer) HandleRequest(url string) { fmt.Println(\u0026#34;Real server processing:\u0026#34;, url) } // Proxy kiá»ƒm soÃ¡t quyá»n truy cáº­p type ProxyServer struct { realServer *RealServer } func (p *ProxyServer) HandleRequest(url string) { if url == \u0026#34;/restricted\u0026#34; { fmt.Println(\u0026#34;Access Denied!\u0026#34;) return } p.realServer.HandleRequest(url) // Gá»i server tháº­t náº¿u Ä‘Æ°á»£c phÃ©p } func main() { proxy := \u0026amp;ProxyServer{realServer: \u0026amp;RealServer{}} proxy.HandleRequest(\u0026#34;/public\u0026#34;) proxy.HandleRequest(\u0026#34;/restricted\u0026#34;) } 4. Khi nÃ o nÃªn sá»­ dá»¥ng? Sá»­ dá»¥ng Decorator khi báº¡n muá»‘n má»Ÿ rá»™ng hÃ nh vi cá»§a má»™t Ä‘á»‘i tÆ°á»£ng mÃ  khÃ´ng thay Ä‘á»•i mÃ£ nguá»“n.\nVÃ­ dá»¥: ThÃªm logging, caching, hoáº·c Ä‘á»‹nh dáº¡ng láº¡i dá»¯ liá»‡u Ä‘áº§u ra. Sá»­ dá»¥ng Proxy khi báº¡n muá»‘n kiá»ƒm soÃ¡t cÃ¡ch truy cáº­p vÃ o má»™t Ä‘á»‘i tÆ°á»£ng.\nVÃ­ dá»¥: Cháº·n truy cáº­p tÃ i nguyÃªn, proxy cho API, hoáº·c lazy-load Ä‘á»‘i tÆ°á»£ng náº·ng. 5. Káº¿t luáº­n Decorator Pattern vÃ  Proxy Pattern Ä‘á»u lÃ  nhá»¯ng cÃ´ng cá»¥ há»¯u Ã­ch trong láº­p trÃ¬nh, nhÆ°ng chÃºng phá»¥c vá»¥ nhá»¯ng má»¥c Ä‘Ã­ch khÃ¡c nhau:\nDecorator Pattern giÃºp má»Ÿ rá»™ng hÃ nh vi cá»§a má»™t Ä‘á»‘i tÆ°á»£ng má»™t cÃ¡ch linh hoáº¡t. Proxy Pattern giÃºp kiá»ƒm soÃ¡t cÃ¡ch truy cáº­p vÃ o Ä‘á»‘i tÆ°á»£ng thá»±c. TÃ¹y vÃ o yÃªu cáº§u cá»§a dá»± Ã¡n mÃ  báº¡n cÃ³ thá»ƒ chá»n máº«u thiáº¿t káº¿ phÃ¹ há»£p nháº¥t! ğŸš€\n","date":"2025-02-02T00:40:00+08:00","permalink":"https://phongthien99.github.io/posts/comparing-decorator-pattern-and-proxy-pattern-in-programming/","title":"Comparing Decorator Pattern and Proxy Pattern in Programming"},{"content":"Fundamental Characteristics of OOP in Rust Rust lÃ  má»™t ngÃ´n ngá»¯ láº­p trÃ¬nh máº¡nh máº½ vÃ  an toÃ n, Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ mang láº¡i hiá»‡u suáº¥t cao vÃ  kiá»ƒm soÃ¡t bá»™ nhá»› máº¡nh máº½ mÃ  khÃ´ng cáº§n sá»± trá»£ giÃºp cá»§a garbage collector. Máº·c dÃ¹ Rust khÃ´ng pháº£i lÃ  má»™t ngÃ´n ngá»¯ hoÃ n toÃ n hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng (OOP), nhÆ°ng nÃ³ váº«n há»— trá»£ cÃ¡c tÃ­nh nÄƒng cá»§a OOP thÃ´ng qua cÃ¡c khÃ¡i niá»‡m nhÆ° struct, trait vÃ  ownership. Trong bÃ i viáº¿t nÃ y, chÃºng ta sáº½ khÃ¡m phÃ¡ bá»‘n tÃ­nh cháº¥t cÆ¡ báº£n cá»§a láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng trong Rust.\n1. Encapsulation (ÄÃ³ng gÃ³i) ÄÃ³ng gÃ³i lÃ  má»™t trong nhá»¯ng tÃ­nh cháº¥t cá»‘t lÃµi cá»§a láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng, cho phÃ©p áº©n Ä‘i chi tiáº¿t ná»™i bá»™ cá»§a Ä‘á»‘i tÆ°á»£ng vÃ  chá»‰ cung cáº¥p cÃ¡c phÆ°Æ¡ng thá»©c hoáº·c giao diá»‡n cÃ´ng khai Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i Ä‘á»‘i tÆ°á»£ng Ä‘Ã³. Trong Rust, Ä‘iá»u nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n thÃ´ng qua visibility modifiers vÃ  sá»± káº¿t há»£p giá»¯a struct vÃ  impl.\nVisibility modifiers: Rust sá»­ dá»¥ng cÃ¡c tá»« khÃ³a nhÆ° pub Ä‘á»ƒ kiá»ƒm soÃ¡t pháº¡m vi truy cáº­p cá»§a cÃ¡c trÆ°á»ng vÃ  phÆ°Æ¡ng thá»©c. Máº·c Ä‘á»‹nh, cÃ¡c trÆ°á»ng trong struct lÃ  private vÃ  chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p tá»« bÃªn trong module nÆ¡i chÃºng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a. Impl blocks: Cung cáº¥p cÃ¡ch triá»ƒn khai cÃ¡c phÆ°Æ¡ng thá»©c Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 struct Person { name: String, age: u32, } impl Person { // PhÆ°Æ¡ng thá»©c táº¡o má»›i Ä‘á»‘i tÆ°á»£ng Person pub fn new(name: String, age: u32) -\u0026gt; Self { Person { name, age } } // PhÆ°Æ¡ng thá»©c cÃ´ng khai Ä‘á»ƒ láº¥y tÃªn pub fn get_name(\u0026amp;self) -\u0026gt; \u0026amp;str { \u0026amp;self.name } // PhÆ°Æ¡ng thá»©c cÃ´ng khai Ä‘á»ƒ tÄƒng tuá»•i pub fn increment_age(\u0026amp;mut self) { self.age += 1; } // PhÆ°Æ¡ng thá»©c riÃªng tÆ° Ä‘á»ƒ kiá»ƒm tra náº¿u tuá»•i vÆ°á»£t quÃ¡ giÃ¡ trá»‹ cá»¥ thá»ƒ fn is_eligible_for_discount(\u0026amp;self) -\u0026gt; bool { self.age \u0026gt; 60 } } fn main() { let mut person = Person::new(\u0026#34;Alice\u0026#34;.to_string(), 30); // Truy cáº­p thÃ´ng qua phÆ°Æ¡ng thá»©c cÃ´ng khai println!(\u0026#34;Name: {}\u0026#34;, person.get_name()); person.increment_age(); // KhÃ´ng thá»ƒ truy cáº­p trá»±c tiáº¿p trÆ°á»ng hoáº·c phÆ°Æ¡ng thá»©c riÃªng tÆ° // person.age = 40; // Lá»—i: private field // println!(\u0026#34;{}\u0026#34;, person.is_eligible_for_discount()); // Lá»—i: private method } á» Ä‘Ã¢y, cÃ¡c trÆ°á»ng cá»§a Person Ä‘Æ°á»£c áº©n vÃ  chá»‰ cÃ³ thá»ƒ truy cáº­p thÃ´ng qua cÃ¡c phÆ°Æ¡ng thá»©c Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong impl.\n2. Inheritance (Káº¿ thá»«a) Máº·c dÃ¹ Rust khÃ´ng há»— trá»£ káº¿ thá»«a theo kiá»ƒu truyá»n thá»‘ng cá»§a OOP (nhÆ° trong Java hay C++), nhÆ°ng chÃºng ta váº«n cÃ³ thá»ƒ mÃ´ phá»ng tÃ­nh káº¿ thá»«a báº±ng cÃ¡ch sá»­ dá»¥ng Deref. Deref cho phÃ©p chÃºng ta chuyá»ƒn hÆ°á»›ng cÃ¡c phÆ°Æ¡ng thá»©c vÃ  thuá»™c tÃ­nh cá»§a má»™t Ä‘á»‘i tÆ°á»£ng sang Ä‘á»‘i tÆ°á»£ng khÃ¡c, táº¡o ra má»™t cÃ¡ch tiáº¿p cáº­n linh hoáº¡t Ä‘á»ƒ mÃ´ phá»ng káº¿ thá»«a.\nÄáº§u tiÃªn, chÃºng ta Ä‘á»‹nh nghÄ©a má»™t cáº¥u trÃºc Person, Ä‘áº¡i diá»‡n cho má»™t ngÆ°á»i vá»›i trÆ°á»ng name vÃ  má»™t phÆ°Æ¡ng thá»©c greet Ä‘á»ƒ tráº£ vá» lá»i chÃ o.\n1 2 3 4 5 6 7 8 9 10 11 rust Copy code struct Person { name: String, } impl Person { fn greet(\u0026amp;self) -\u0026gt; String { format!(\u0026#34;Hello, {}\u0026#34;, self.name) } } Cáº¥u trÃºc Person cÃ³ má»™t trÆ°á»ng name vÃ  má»™t phÆ°Æ¡ng thá»©c greet Ä‘á»ƒ in ra lá»i chÃ o vá»›i tÃªn cá»§a ngÆ°á»i Ä‘Ã³.\nTiáº¿p theo, chÃºng ta táº¡o má»™t cáº¥u trÃºc Employee, trong Ä‘Ã³ bao gá»“m má»™t trÆ°á»ng person kiá»ƒu Person. ChÃºng ta sáº½ sá»­ dá»¥ng Deref Ä‘á»ƒ cho phÃ©p Employee sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c cá»§a Person.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 use std::ops::Deref; struct Employee { person: Person, job_title: String, } impl Deref for Employee { type Target = Person; fn deref(\u0026amp;self) -\u0026gt; \u0026amp;Self::Target { \u0026amp;self.person } } fn main() { let employee = Employee { person: Person { name: \u0026#34;Alice\u0026#34;.to_string(), }, job_title: \u0026#34;Engineer\u0026#34;.to_string(), }; // Sá»­ dá»¥ng phÆ°Æ¡ng thá»©c greet tá»« Employee println!(\u0026#34;{}\u0026#34;, employee.greet()); } á» Ä‘Ã¢y, chÃºng ta triá»ƒn khai Deref cho Employee Ä‘á»ƒ chuyá»ƒn hÆ°á»›ng cÃ¡c lá»i gá»i Ä‘áº¿n Ä‘á»‘i tÆ°á»£ng Person. Äiá»u nÃ y cÃ³ nghÄ©a lÃ , khi chÃºng ta gá»i cÃ¡c phÆ°Æ¡ng thá»©c nhÆ° greet() tá»« Employee, Rust sáº½ tá»± Ä‘á»™ng gá»i phÆ°Æ¡ng thá»©c Ä‘Ã³ trÃªn Ä‘á»‘i tÆ°á»£ng Person bÃªn tro\n3. Polymorphism (Äa hÃ¬nh) Polymorphism trong OOP cho phÃ©p cÃ¡c Ä‘á»‘i tÆ°á»£ng khÃ¡c nhau cÃ³ thá»ƒ sá»­ dá»¥ng chung má»™t giao diá»‡n mÃ  khÃ´ng cáº§n pháº£i biáº¿t loáº¡i cá»¥ thá»ƒ cá»§a Ä‘á»‘i tÆ°á»£ng. Trong Rust, polymorphism Ä‘Æ°á»£c thá»±c hiá»‡n thÃ´ng qua trait objects vÃ  dynamic dispatch.\nDÆ°á»›i Ä‘Ã¢y lÃ  vÃ­ dá»¥ vá» Ä‘a hÃ¬nh trong Rust:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 trait Speak { fn speak(\u0026amp;self); } struct Dog; struct Cat; impl Speak for Dog { fn speak(\u0026amp;self) { println!(\u0026#34;Woof!\u0026#34;); } } impl Speak for Cat { fn speak(\u0026amp;self) { println!(\u0026#34;Meow!\u0026#34;); } } fn make_speak(speaker: \u0026amp;dyn Speak) { speaker.speak(); } fn main() { let dog = Dog; let cat = Cat; make_speak(\u0026amp;dog); // Prints \u0026#34;Woof!\u0026#34; make_speak(\u0026amp;cat); // Prints \u0026#34;Meow!\u0026#34; } á» Ä‘Ã¢y, make_speak cÃ³ thá»ƒ nháº­n báº¥t ká»³ Ä‘á»‘i tÆ°á»£ng nÃ o thá»±c hiá»‡n trait Speak, cho phÃ©p Ä‘a hÃ¬nh hoáº¡t Ä‘á»™ng mÃ  khÃ´ng cáº§n biáº¿t trÆ°á»›c loáº¡i Ä‘á»‘i tÆ°á»£ng.\n4. Abstraction (Trá»«u tÆ°á»£ng hÃ³a) Trá»«u tÆ°á»£ng hÃ³a giÃºp áº©n cÃ¡c chi tiáº¿t cÃ i Ä‘áº·t vÃ  chá»‰ lá»™ ra giao diá»‡n cáº§n thiáº¿t. Rust há»— trá»£ trá»«u tÆ°á»£ng hÃ³a thÃ´ng qua viá»‡c sá»­ dá»¥ng trait vÃ  cÃ¡c kiá»ƒu dá»¯ liá»‡u nhÆ° Option vÃ  Result, cho phÃ©p xá»­ lÃ½ cÃ¡c tÃ¬nh huá»‘ng mÃ  khÃ´ng cáº§n pháº£i biáº¿t chi tiáº¿t cÃ i Ä‘áº·t.\nVÃ­ dá»¥ vá» trá»«u tÆ°á»£ng hÃ³a vá»›i trait:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 trait Draw { fn draw(\u0026amp;self); } struct Circle; struct Square; impl Draw for Circle { fn draw(\u0026amp;self) { println!(\u0026#34;Drawing a circle\u0026#34;); } } impl Draw for Square { fn draw(\u0026amp;self) { println!(\u0026#34;Drawing a square\u0026#34;); } } fn draw_all(shapes: \u0026amp;Vec\u0026lt;Box\u0026lt;dyn Draw\u0026gt;\u0026gt;) { for shape in shapes { shape.draw(); } } fn main() { let circle = Circle; let square = Square; // Bá»c cÃ¡c Ä‘á»‘i tÆ°á»£ng trong Box\u0026lt;dyn Draw\u0026gt; Ä‘á»ƒ sá»­ dá»¥ng tÃ­nh Ä‘a hÃ¬nh let shapes: Vec\u0026lt;Box\u0026lt;dyn Draw\u0026gt;\u0026gt; = vec![Box::new(circle), Box::new(square)]; // VÃ²ng láº·p qua cÃ¡c Ä‘á»‘i tÆ°á»£ng vÃ  gá»i hÃ m `draw` draw_all(\u0026amp;shapes); } Trong vÃ­ dá»¥ nÃ y, cÃ¡c chi tiáº¿t triá»ƒn khai cá»¥ thá»ƒ nhÆ° cÃ¡ch váº½ hÃ¬nh trÃ²n hay hÃ¬nh vuÃ´ng Ä‘Æ°á»£c áº©n Ä‘i. Thay vÃ o Ä‘Ã³, ta chá»‰ lÃ m viá»‡c vá»›i giao diá»‡n draw, giÃºp mÃ£ nguá»“n trá»Ÿ nÃªn rÃµ rÃ ng vÃ  dá»… báº£o trÃ¬. ThÃ´ng qua viá»‡c bá»c Ä‘á»‘i tÆ°á»£ng trong Box\u0026lt;dyn Draw\u0026gt;, chÃºng ta cÃ³ thá»ƒ lÆ°u trá»¯ vÃ  xá»­ lÃ½ cÃ¡c kiá»ƒu dá»¯ liá»‡u khÃ¡c nhau sá»­ dá»¥ng cÃ¹ng má»™t giao diá»‡n chung mÃ  khÃ´ng cáº§n quan tÃ¢m Ä‘áº¿n kiá»ƒu cá»¥ thá»ƒ.\nKáº¿t luáº­n Rust cung cáº¥p Ä‘áº§y Ä‘á»§ cÃ¡c tÃ­nh cháº¥t cá»§a láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng thÃ´ng qua cÃ¡c cáº¥u trÃºc nhÆ° struct, trait vÃ  cÃ¡c tÃ­nh nÄƒng máº¡nh máº½ cá»§a há»‡ thá»‘ng kiá»ƒu. Máº·c dÃ¹ Rust khÃ´ng hoÃ n toÃ n hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng nhÆ° má»™t sá»‘ ngÃ´n ngá»¯ khÃ¡c, nhÆ°ng nhá»¯ng khÃ¡i niá»‡m trÃªn giÃºp chÃºng ta xÃ¢y dá»±ng cÃ¡c chÆ°Æ¡ng trÃ¬nh dá»… báº£o trÃ¬, tÃ¡i sá»­ dá»¥ng vÃ  má»Ÿ rá»™ng. Náº¿u báº¡n muá»‘n lÃ m viá»‡c vá»›i OOP trong Rust, cÃ¡c tÃ­nh nÄƒng nÃ y cung cáº¥p sá»± linh hoáº¡t Ä‘á»ƒ giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» láº­p trÃ¬nh vá»›i phong cÃ¡ch OOP trong khi váº«n giá»¯ Ä‘Æ°á»£c cÃ¡c lá»£i Ã­ch cá»§a Rust vá» hiá»‡u suáº¥t vÃ  an toÃ n bá»™ nhá»›.\n","date":"2024-12-12T01:17:00+08:00","permalink":"https://phongthien99.github.io/posts/fundamental-characteristics-of-oop-in-rust/","title":"Fundamental Characteristics of OOP in Rust"},{"content":"Live Reload for Go Applications in Docker Compose 1. Váº¥n Äá» Khi phÃ¡t triá»ƒn á»©ng dá»¥ng Go, viá»‡c pháº£i dá»«ng á»©ng dá»¥ng, biÃªn dá»‹ch láº¡i, vÃ  khá»Ÿi Ä‘á»™ng láº¡i má»—i khi thay Ä‘á»•i mÃ£ nguá»“n lÃ  má»™t quy trÃ¬nh tá»‘n thá»i gian vÃ  lÃ m giÃ¡n Ä‘oáº¡n luá»“ng lÃ m viá»‡c. Váº­y lÃ m tháº¿ nÃ o Ä‘á»ƒ giáº£m thiá»ƒu cÃ´ng Ä‘oáº¡n nÃ y vÃ  cáº£i thiá»‡n hiá»‡u quáº£ phÃ¡t triá»ƒn? Giáº£i phÃ¡p chÃ­nh lÃ  live reload, cho phÃ©p á»©ng dá»¥ng tá»± Ä‘á»™ng cáº­p nháº­t mÃ  khÃ´ng cáº§n thao tÃ¡c thá»§ cÃ´ng.\n2. Giáº£i PhÃ¡p Live reload giÃºp tá»± Ä‘á»™ng phÃ¡t hiá»‡n thay Ä‘á»•i trong mÃ£ nguá»“n, biÃªn dá»‹ch vÃ  khá»Ÿi Ä‘á»™ng láº¡i á»©ng dá»¥ng. Trong Go, má»™t cÃ´ng cá»¥ phá»• biáº¿n há»— trá»£ tÃ­nh nÄƒng nÃ y lÃ  Air. Air Ä‘Æ¡n giáº£n, máº¡nh máº½, vÃ  dá»… tÃ­ch há»£p, giÃºp láº­p trÃ¬nh viÃªn tiáº¿t kiá»‡m thá»i gian.\n3. CÃ¡ch Thá»±c Hiá»‡n BÆ°á»›c 1: Táº¡o á»©ng dá»¥ng máº«u Táº¡o má»™t á»©ng dá»¥ng Go Ä‘Æ¡n giáº£n Ä‘á»ƒ thá»­ nghiá»‡m:\n1 2 3 mkdir air-example \u0026amp;\u0026amp; cd ./ go mod init example/air touch main.go ThÃªm Ä‘oáº¡n mÃ£ sau vÃ o file main.go:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;net/http\u0026#34; ) func helloHandler(w http.ResponseWriter, r *http.Request) { fmt.Fprintf(w, \u0026#34;Hello, World!\u0026#34;) } func main() { http.HandleFunc(\u0026#34;/\u0026#34;, helloHandler) fmt.Println(\u0026#34;Starting server at port 8080\u0026#34;) if err := http.ListenAndServe(\u0026#34;:8080\u0026#34;, nil); err != nil { fmt.Println(err) } } BÆ°á»›c 2: TÃ­ch há»£p Air vÃ o Docker Cáº¥u hÃ¬nh Dockerfile.dev vá»›i Air Ä‘á»ƒ há»— trá»£ live reload:\n1 2 3 4 5 6 7 8 9 10 11 12 # Stage 1: Base image FROM golang:1.22.3 as base # Stage 2: Development environment FROM base as dev # CÃ i Ä‘áº·t Air RUN curl -sSfL https://raw.githubusercontent.com/cosmtrek/air/master/install.sh | sh -s -- -b $(go env GOPATH)/bin # Lá»‡nh máº·c Ä‘á»‹nh Ä‘á»ƒ cháº¡y Air CMD [\u0026#34;air\u0026#34;] BÆ°á»›c 3: Cáº¥u hÃ¬nh Docker-Compose Káº¿t há»£p Air vá»›i Docker Compose Ä‘á»ƒ tá»± Ä‘á»™ng táº£i láº¡i á»©ng dá»¥ng:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 version: \u0026#34;3.9\u0026#34; services: demo-air: container_name: air-demo build: context: . target: dev working_dir: /opt/app command: air --build.cmd \u0026#34;go build -o build/app main.go\u0026#34; --build.bin \u0026#34;build/app\u0026#34; volumes: - ./:/opt/app networks: - app-network networks: app-network: external: true Giáº£i thÃ­ch:\ncommand: Cháº¡y Air vá»›i tham sá»‘ tÃ¹y chá»‰nh Ä‘á»ƒ build vÃ  cháº¡y á»©ng dá»¥ng. volumes: Mount mÃ£ nguá»“n tá»« mÃ¡y vÃ o container Ä‘á»ƒ theo dÃµi thay Ä‘á»•i. networks: Táº¡o hoáº·c sá»­ dá»¥ng máº¡ng Docker Ä‘á»ƒ káº¿t ná»‘i cÃ¡c container. BÆ°á»›c 4: Cháº¡y á»¨ng Dá»¥ng Khá»Ÿi Ä‘á»™ng á»©ng dá»¥ng vá»›i lá»‡nh:\n1 docker-compose up Má»—i khi thay Ä‘á»•i mÃ£ nguá»“n trong thÆ° má»¥c dá»± Ã¡n, Air sáº½ tá»± Ä‘á»™ng phÃ¡t hiá»‡n vÃ  táº£i láº¡i á»©ng dá»¥ng.\n4. Káº¿t Luáº­n Sá»­ dá»¥ng Air cÃ¹ng Docker-Compose giÃºp tá»‘i Æ°u hÃ³a quÃ¡ trÃ¬nh phÃ¡t triá»ƒn á»©ng dá»¥ng Go. Quy trÃ¬nh live reload giÃºp giáº£m thiá»ƒu thao tÃ¡c thá»§ cÃ´ng, tÄƒng tá»‘c Ä‘á»™ phÃ¡t triá»ƒn vÃ  mang láº¡i tráº£i nghiá»‡m lÃ m viá»‡c liá»n máº¡ch.\n","date":"2024-11-28T01:17:00+08:00","permalink":"https://phongthien99.github.io/posts/live-reload-for-go-applications-in-docker-compose/","title":"Live Reload for Go Applications in Docker Compose"},{"content":"Development environment with Docker and Nginx Äáº·t Váº¥n Äá» Viá»‡c phÃ¡t triá»ƒn cá»¥c bá»™ vá»›i Docker Ä‘Ã£ trá»Ÿ thÃ nh má»™t phÆ°Æ¡ng phÃ¡p phá»• biáº¿n trong quy trÃ¬nh phÃ¡t triá»ƒn pháº§n má»m hiá»‡n Ä‘áº¡i. Viá»‡c khá»Ÿi táº¡o container vÃ  Ã¡nh xáº¡ cÃ¡c cá»•ng lÃ  bÆ°á»›c cÆ¡ báº£n Ä‘á»ƒ báº¯t Ä‘áº§u cÃ´ng viá»‡c. Tuy nhiÃªn, khi lÃ m viá»‡c vá»›i nhiá»u dá»± Ã¡n Ä‘á»“ng thá»i, viá»‡c xung Ä‘á»™t cá»•ng giá»¯a cÃ¡c container trÃªn cÃ¹ng má»™t mÃ¡y chá»§ Docker cÃ³ thá»ƒ gÃ¢y khÃ³ khÄƒn. Äiá»u nÃ y lÃ m giáº£m hiá»‡u quáº£ cÃ´ng viá»‡c vÃ  khiáº¿n báº¡n khÃ³ quáº£n lÃ½ cÃ¡c cá»•ng Ä‘ang sá»­ dá»¥ng.\nGiáº£i PhÃ¡p Má»™t giáº£i phÃ¡p Ä‘Æ¡n giáº£n lÃ  sá»­ dá»¥ng reverse proxy cá»¥c bá»™ Ä‘á»ƒ quáº£n lÃ½ cÃ¡c dá»± Ã¡n. Nginx lÃ  má»™t lá»±a chá»n lÃ½ tÆ°á»Ÿng Ä‘á»ƒ Ä‘á»‹nh tuyáº¿n vÃ  quáº£n lÃ½ cÃ¡c dá»± Ã¡n qua cÃ¡c tÃªn miá»n, giÃºp giáº£m thiá»ƒu xung Ä‘á»™t cá»•ng vÃ  tÄƒng tÃ­nh linh hoáº¡t khi phÃ¡t triá»ƒn.\nCÃ¡ch Thá»±c Hiá»‡n BÆ°á»›c 1: Táº¡o Máº¡ng Docker TrÆ°á»›c khi triá»ƒn khai reverse proxy, báº¡n cáº§n táº¡o má»™t máº¡ng Docker Ä‘á»ƒ cÃ¡c dá»‹ch vá»¥ cÃ³ thá»ƒ giao tiáº¿p vá»›i nhau.\n1 docker network create traefik-ingress BÆ°á»›c 2: CÃ i Äáº·t Nginx ChÃºng ta sáº½ sá»­ dá»¥ng Docker Compose Ä‘á»ƒ cÃ i Ä‘áº·t Nginx cÃ¹ng vá»›i cÃ¡c dá»‹ch vá»¥ thá»­ nghiá»‡m. DÆ°á»›i Ä‘Ã¢y lÃ  cáº¥u hÃ¬nh docker-compose.yml Ä‘á»ƒ cÃ i Ä‘áº·t Nginx vÃ  cÃ¡c dá»‹ch vá»¥ máº«u:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 services: nginx: image: docker.io/bitnami/nginx:1.23 ports: - \u0026#39;8085:5001\u0026#39; # Ãnh xáº¡ cá»•ng ngoÃ i vÃ o cá»•ng dá»‹ch vá»¥ bÃªn trong volumes: - ./nginx.conf:/opt/bitnami/nginx/conf/server_blocks/my_server_block.conf # Cáº¥u hÃ¬nh Nginx tÃ¹y chá»‰nh networks: - traefik-ingress origin-01: container_name: origin-01 image: traefik/whoami command: - --port=8080 - --name=origin-01 networks: - traefik-ingress origin-02: container_name: origin-02 image: traefik/whoami command: - --port=8080 - --name=origin-02 networks: - traefik-ingress networks: traefik-ingress: external: true BÆ°á»›c 3: Cáº¥u HÃ¬nh Nginx Cáº¥u hÃ¬nh Nginx cáº§n Ä‘á»‹nh tuyáº¿n lÆ°u lÆ°á»£ng truy cáº­p dá»±a trÃªn tÃªn miá»n. DÆ°á»›i Ä‘Ã¢y lÃ  cáº¥u hÃ¬nh Nginx giÃºp chuyá»ƒn tiáº¿p yÃªu cáº§u tá»›i cÃ¡c container tÆ°Æ¡ng á»©ng.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 server { listen 5001; listen [::]:5001; location / { # Sá»­ dá»¥ng DNS resolver cá»§a Docker resolver 127.0.0.11; # Äá»‹nh tuyáº¿n theo tÃªn miá»n if ($host ~* ^([a-zA-Z0-9\\-]+)-([0-9]+)\\.lh$) { proxy_pass http://$1:$2; break; } # Tráº£ vá» lá»—i náº¿u tÃªn miá»n khÃ´ng há»£p lá»‡ return 404 \u0026#34;Domain not found\u0026#34;; } } Trong cáº¥u hÃ¬nh Nginx nÃ y:\nNginx sáº½ láº¯ng nghe trÃªn cá»•ng 5001 vÃ  chuyá»ƒn tiáº¿p yÃªu cáº§u tá»›i cÃ¡c dá»‹ch vá»¥ nhÆ° origin-01 hoáº·c origin-02 dá»±a trÃªn tÃªn miá»n phá»¥ (vÃ­ dá»¥: origin-01.lh). DNS resolver 127.0.0.11 lÃ  DNS ná»™i bá»™ cá»§a Docker, giÃºp Nginx cÃ³ thá»ƒ nháº­n diá»‡n vÃ  Ä‘á»‹nh tuyáº¿n cÃ¡c yÃªu cáº§u tá»›i cÃ¡c container. BÆ°á»›c 4: Khá»Ÿi Cháº¡y Dá»‹ch Vá»¥ Sau khi Ä‘Ã£ cáº¥u hÃ¬nh docker-compose.yml vÃ  nginx.conf, báº¡n cÃ³ thá»ƒ khá»Ÿi cháº¡y dá»‹ch vá»¥ báº±ng lá»‡nh:\n1 2 docker-compose up -d Lá»‡nh nÃ y sáº½ khá»Ÿi Ä‘á»™ng Nginx nhÆ° má»™t reverse proxy, cÃ¹ng vá»›i cÃ¡c dá»‹ch vá»¥ origin-01 vÃ  origin-02, má»—i dá»‹ch vá»¥ cháº¡y trÃªn cá»•ng riÃªng nhÆ°ng Ä‘á»u Ä‘Æ°á»£c truy cáº­p qua Nginx.\nBÆ°á»›c 5: Kiá»ƒm Tra Thá»±c Táº¿ Äá»ƒ kiá»ƒm tra, báº¡n cáº§n thÃªm tÃªn miá»n giáº£ vÃ o tá»‡p /etc/hosts:\n1 2 127.0.0.1 origin-01-8080.lh Sau Ä‘Ã³, báº¡n cÃ³ thá»ƒ thá»­ truy cáº­p dá»‹ch vá»¥ báº±ng lá»‡nh curl:\n1 2 curl http://origin-01-8080.lh:8085/test Káº¿t Luáº­n Viá»‡c sá»­ dá»¥ng Nginx lÃ m reverse proxy cá»¥c bá»™ giÃºp báº¡n dá»… dÃ ng quáº£n lÃ½ cÃ¡c container Docker mÃ  khÃ´ng gáº·p pháº£i xung Ä‘á»™t cá»•ng. Vá»›i phÆ°Æ¡ng phÃ¡p Ä‘á»‹nh tuyáº¿n theo tÃªn miá»n, báº¡n cÃ³ thá»ƒ truy cáº­p nhiá»u dá»‹ch vá»¥ khÃ¡c nhau thÃ´ng qua má»™t cá»•ng duy nháº¥t. Giáº£i phÃ¡p nÃ y Ä‘Æ¡n giáº£n hÃ³a mÃ´i trÆ°á»ng phÃ¡t triá»ƒn, Ä‘áº·c biá»‡t khi lÃ m viá»‡c vá»›i nhiá»u dá»± Ã¡n cáº§n sá»± tÃ¡ch biá»‡t nhÆ°ng láº¡i chia sáº» cÃ¹ng má»™t mÃ¡y chá»§ Docker.\n","date":"2024-11-23T23:40:00+07:00","permalink":"https://phongthien99.github.io/posts/development-environment-with-docker-and-nginx/","title":"Development environment with Docker and Nginx"},{"content":"Effective Code Quality Management with SonarSource: A Solution for Tackling Technical Debt in Software Development Äáº·t váº¥n Ä‘á» Trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn pháº§n má»m, cÃ³ nhá»¯ng giai Ä‘oáº¡n dá»± Ã¡n cháº¡y vá»›i tá»‘c Ä‘á»™ \u0026ldquo;nhÆ° Äƒn cÆ°á»›p\u0026rdquo;, khi cÃ¡c nhÃ  phÃ¡t triá»ƒn buá»™c pháº£i táº­p trung giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» trÆ°á»›c máº¯t mÃ  khÃ´ng cÃ³ thá»i gian tuÃ¢n thá»§ cÃ¡c tiÃªu chuáº©n cháº¥t lÆ°á»£ng. Äiá»u nÃ y dáº«n Ä‘áº¿n mÃ£ nguá»“n cÃ³ thá»ƒ trá»Ÿ nÃªn lá»™n xá»™n, thiáº¿u cáº¥u trÃºc vÃ  khÃ³ báº£o trÃ¬ â€“ táº¡o thÃ nh má»™t \u0026ldquo;Ä‘á»‘ng rÃ¡c\u0026rdquo; chá»©a cÃ¡c Ä‘oáº¡n mÃ£ lá»—i, khÃ´ng nháº¥t quÃ¡n, vÃ  tiá»m áº©n nhiá»u rá»§i ro báº£o máº­t.\nNhá»¯ng giáº£i phÃ¡p táº¡m thá»i nÃ y cÃ³ thá»ƒ giÃºp dá»± Ã¡n tiáº¿n triá»ƒn trong ngáº¯n háº¡n, nhÆ°ng vá» lÃ¢u dÃ i sáº½ lÃ m tÄƒng ná»£ ká»¹ thuáº­t, khiáº¿n mÃ£ trá»Ÿ nÃªn cá»“ng ká»nh vÃ  khÃ³ báº£o trÃ¬. ChÃ­nh vÃ¬ váº­y, cáº§n má»™t cÃ´ng cá»¥ Ä‘á»ƒ phÃ¢n tÃ­ch vÃ  quáº£n lÃ½ cháº¥t lÆ°á»£ng mÃ£, giÃºp phÃ¡t hiá»‡n vÃ  xá»­ lÃ½ cÃ¡c váº¥n Ä‘á» nÃ y ká»‹p thá»i, nháº±m duy trÃ¬ tÃ­nh á»•n Ä‘á»‹nh vÃ  bá»n vá»¯ng cho dá»± Ã¡n.\nGiáº£i phÃ¡p SonarSource lÃ  má»™t cÃ´ng cá»¥ phÃ¢n tÃ­ch mÃ£ nguá»“n máº¡nh máº½, giÃºp Ä‘á»™i ngÅ© phÃ¡t triá»ƒn kiá»ƒm soÃ¡t cháº¥t lÆ°á»£ng mÃ£ má»™t cÃ¡ch toÃ n diá»‡n. NÃ³ khÃ´ng chá»‰ phÃ¡t hiá»‡n \u0026ldquo;Ä‘á»‘ng rÃ¡c\u0026rdquo; áº©n trong mÃ£ nguá»“n mÃ  cÃ²n cung cáº¥p cÃ¡c giáº£i phÃ¡p cá»¥ thá»ƒ Ä‘á»ƒ dá»n dáº¹p má»™t cÃ¡ch há»‡ thá»‘ng. Sá»­ dá»¥ng SonarSource giÃºp giáº£m thiá»ƒu ná»£ ká»¹ thuáº­t, duy trÃ¬ hiá»‡u suáº¥t mÃ£ á»•n Ä‘á»‹nh, vÃ  giáº£m thiá»ƒu rá»§i ro báº£o máº­t, ngay cáº£ khi dá»± Ã¡n pháº£i phÃ¡t triá»ƒn nhanh chÃ³ng trong nhá»¯ng thá»i Ä‘iá»ƒm gáº¥p gÃ¡p.\nThá»±c hiá»‡n DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡c bÆ°á»›c Ä‘á»ƒ triá»ƒn khai SonarSource thá»±c nghiá»‡m thÃ´ng qua Docker Compose:\nBÆ°á»›c 1: Táº¡o file Docker Compose File Docker Compose cáº¥u hÃ¬nh cÃ¡c dá»‹ch vá»¥ chÃ­nh nhÆ° sau:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 yaml Copy code services: sonarqube: image: sonarqube:community read_only: true volumes: - sonarqube_data:/opt/sonarqube/data - sonarqube_extensions:/opt/sonarqube/extensions - sonarqube_logs:/opt/sonarqube/logs - sonarqube_temp:/opt/sonarqube/temp ports: - \u0026#34;9000:9000\u0026#34; volumes: sonarqube_data: sonarqube_extensions: sonarqube_logs: sonarqube_temp: BÆ°á»›c 2: ÄÄƒng nháº­p vÃ o SonarQube Truy cáº­p giao diá»‡n SonarQube qua http://localhost:9000. ÄÄƒng nháº­p báº±ng tÃ i khoáº£n admin hoáº·c tÃ i khoáº£n cÃ¡ nhÃ¢n cá»§a báº¡n. BÆ°á»›c 3: Táº¡o Project Má»›i Chá»n Projects vÃ  nháº¥p vÃ o Create Project. Báº¡n cÃ³ thá»ƒ chá»n táº¡o dá»± Ã¡n tá»« má»™t repository (GitHub, GitLab, Bitbucket) hoáº·c táº¡o thá»§ cÃ´ng. BÆ°á»›c 4: Cáº¥u hÃ¬nh Project Nháº­p tÃªn vÃ  key duy nháº¥t cho project. Náº¿u sá»­ dá»¥ng SonarCloud, báº¡n cÃ³ thá»ƒ chá»n hoáº·c táº¡o tá»• chá»©c Ä‘á»ƒ quáº£n lÃ½. BÆ°á»›c 5: Táº¡o Token XÃ¡c Thá»±c Táº¡o token Ä‘á»ƒ thá»±c hiá»‡n quÃ¡ trÃ¬nh quÃ©t mÃ£. LÆ°u token nÃ y Ä‘á»ƒ dÃ¹ng trong cÃ¡c bÆ°á»›c sau. BÆ°á»›c 6: Cáº¥u hÃ¬nh cÃ´ng cá»¥ phÃ¢n tÃ­ch mÃ£ Táº¡o file sonar-project.properties trong project cá»§a báº¡n:\n1 2 sonar.projectKey=\u0026lt;\u0026lt;key Ä‘Ã£ táº¡o á»Ÿ project\u0026gt;\u0026gt; Sau Ä‘Ã³, cháº¡y lá»‡nh quÃ©t mÃ£ báº±ng cÃ¡ch sá»­ dá»¥ng Docker:\n1 2 docker run --rm --net=host -e SONAR_HOST_URL=\u0026#34;http://localhost:9000\u0026#34; -e SONAR_TOKEN=\u0026#34;\u0026lt;\u0026lt;token Ä‘Ã£ táº¡o á»Ÿ project\u0026gt;\u0026gt;\u0026#34; -e SONAR_PROJECT_KEY=\u0026#34;key Ä‘Ã£ táº¡o á»Ÿ project\u0026#34; -v \u0026#34;$(pwd):/usr/src\u0026#34; sonarsource/sonar-scanner-cli Káº¿t luáº­n SonarSource lÃ  má»™t cÃ´ng cá»¥ máº¡nh máº½ giÃºp cÃ¡c Ä‘á»™i phÃ¡t triá»ƒn pháº§n má»m duy trÃ¬ cháº¥t lÆ°á»£ng mÃ£ nguá»“n ngay cáº£ trong nhá»¯ng giai Ä‘oáº¡n phÃ¡t triá»ƒn kháº©n trÆ°Æ¡ng. Báº±ng cÃ¡ch tÃ­ch há»£p SonarSource vÃ o quy trÃ¬nh phÃ¡t triá»ƒn, chÃºng ta cÃ³ thá»ƒ phÃ¡t hiá»‡n sá»›m cÃ¡c váº¥n Ä‘á» vá» mÃ£, tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t vÃ  giáº£m thiá»ƒu rá»§i ro báº£o máº­t. Káº¿t quáº£ lÃ  mÃ£ nguá»“n trá»Ÿ nÃªn dá»… quáº£n lÃ½ hÆ¡n, giáº£m bá»›t ná»£ ká»¹ thuáº­t vÃ  Ä‘áº£m báº£o dá»± Ã¡n cÃ³ thá»ƒ phÃ¡t triá»ƒn bá»n vá»¯ng hÆ¡n vá» lÃ¢u dÃ i.\n","date":"2024-10-12T01:17:00+08:00","permalink":"https://phongthien99.github.io/posts/effective-code-quality-management-with-sonarsource-a-solution-for-tackling-technical-debt-in-software-development/","title":"Effective Code Quality Management with SonarSource: A Solution for Tackling Technical Debt in Software Development"},{"content":"Log Monitoring for Sigma Media Server Using Promtail, Loki, and Grafana Äáº·t váº¥n Ä‘á» Trong quÃ¡ trÃ¬nh váº­n hÃ nh Sigma Media Server, viá»‡c kiá»ƒm tra log lÃ  má»™t nhiá»‡m vá»¥ quan trá»ng Ä‘á»ƒ Ä‘áº£m báº£o há»‡ thá»‘ng hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh. Tuy nhiÃªn, cÃ¡c log nÃ y thÆ°á»ng Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i thÆ° má»¥c /var/log/sigma-machine, vÃ  viá»‡c pháº£i thÆ°á»ng xuyÃªn truy cáº­p vÃ o thÆ° má»¥c, sá»­ dá»¥ng lá»‡nh cat hoáº·c tail Ä‘á»ƒ theo dÃµi log khÃ´ng chá»‰ tá»‘n thá»i gian mÃ  cÃ²n gÃ¢y khÃ³ khÄƒn khi cáº§n giÃ¡m sÃ¡t liÃªn tá»¥c vÃ  xá»­ lÃ½ log tá»« nhiá»u dá»‹ch vá»¥ khÃ¡c nhau. Äiá»u nÃ y Ä‘áº·t ra nhu cáº§u cho má»™t giáº£i phÃ¡p giÃ¡m sÃ¡t log táº­p trung, giÃºp theo dÃµi vÃ  phÃ¢n tÃ­ch log nhanh chÃ³ng, hiá»‡u quáº£ hÆ¡n.\nGiáº£i phÃ¡p Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» giÃ¡m sÃ¡t log cá»§a Sigma Media Server má»™t cÃ¡ch hiá»‡u quáº£, chÃºng ta sáº½ triá»ƒn khai má»™t log monitoring stack gá»“m ba thÃ nh pháº§n chÃ­nh: Promtail, Loki, vÃ  Grafana.\nPromtail: ÄÃ¢y lÃ  agent dÃ¹ng Ä‘á»ƒ thu tháº­p log tá»« Sigma Media Server. Promtail sáº½ Ä‘á»c cÃ¡c file log táº¡i Ä‘Æ°á»ng dáº«n /var/log/sigma-machine/, sau Ä‘Ã³ chuyá»ƒn chÃºng Ä‘áº¿n Loki Ä‘á»ƒ lÆ°u trá»¯ vÃ  xá»­ lÃ½. Viá»‡c nÃ y giÃºp tá»± Ä‘á»™ng hÃ³a quÃ¡ trÃ¬nh láº¥y log, khÃ´ng cáº§n truy cáº­p thá»§ cÃ´ng vÃ o thÆ° má»¥c log ná»¯a. Loki: Loki lÃ  há»‡ thá»‘ng lÆ°u trá»¯ log Ä‘Æ°á»£c thiáº¿t káº¿ tá»‘i Æ°u cho viá»‡c lÆ°u trá»¯ vÃ  truy váº¥n dá»¯ liá»‡u log. Vá»›i kiáº¿n trÃºc nháº¹ vÃ  tÃ­ch há»£p tá»‘t vá»›i Promtail, Loki cho phÃ©p lÆ°u trá»¯ log má»™t cÃ¡ch cÃ³ tá»• chá»©c vÃ  hiá»‡u quáº£. Dá»¯ liá»‡u log tá»« nhiá»u dá»‹ch vá»¥ khÃ¡c nhau trong Sigma Media Server sáº½ Ä‘Æ°á»£c lÆ°u táº¡i má»™t nÆ¡i, dá»… dÃ ng quáº£n lÃ½ vÃ  truy váº¥n. Grafana: Äá»ƒ trá»±c quan hÃ³a log, Grafana sáº½ káº¿t ná»‘i vá»›i Loki nhÆ° má»™t nguá»“n dá»¯ liá»‡u. Tá»« Ä‘Ã¢y, báº¡n cÃ³ thá»ƒ táº¡o cÃ¡c dashboard tÃ¹y chá»‰nh Ä‘á»ƒ theo dÃµi log theo thá»i gian thá»±c, thiáº¿t láº­p cáº£nh bÃ¡o, vÃ  phÃ¢n tÃ­ch log má»™t cÃ¡ch nhanh chÃ³ng. Grafana cung cáº¥p giao diá»‡n trá»±c quan giÃºp dá»… dÃ ng tÃ¬m kiáº¿m, lá»c vÃ  giÃ¡m sÃ¡t log mÃ  khÃ´ng cáº§n lá»‡nh dÃ²ng lá»‡nh phá»©c táº¡p Thá»±c hiá»‡n Triá»ƒn khai thá»±c nghiá»‡m qua docker-compose\nBÆ°á»›c 1: Táº¡o file Docker Compose File Docker Compose cáº¥u hÃ¬nh cÃ¡c dá»‹ch vá»¥ chÃ­nh gá»“m Sigma Media Server, Promtail, Loki vÃ  Grafana:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 version: \u0026#34;3.8\u0026#34; services: server-01: image: registry.gviet.vn:5000/sigma-livestream/sigma-media-server:4.1.35 privileged: true user: root volumes: - var-log:/var/log/sigma-machine:rw networks: - traefik-ingress promtail: image: grafana/promtail:2.8.2 volumes: - ./promtail-config.yml:/etc/promtail/promtail-config.yml - var-log:/var/log/sigma-media-server-01:ro - var-log-02:/var/log/sigma-media-server-02:ro command: -config.file=/etc/promtail/promtail-config.yml networks: - traefik-ingress depends_on: - loki loki: image: grafana/loki:2.8.2 volumes: - ./loki-config.yml:/etc/loki/local-config.yaml command: -config.file=/etc/loki/local-config.yaml networks: - traefik-ingress grafana: image: grafana/grafana ports: - 3000:3000 networks: - traefik-ingress volumes: var-log: networks: traefik-ingress: external: true BÆ°á»›c 2: Cáº¥u hÃ¬nh Promtail Promtail Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘á»ƒ thu tháº­p log tá»« cÃ¡c file cá»¥ thá»ƒ cá»§a Sigma Media Server:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 server: http_listen_port: 9080 grpc_listen_port: 0 positions: filename: /tmp/positions.yaml clients: - url: http://loki:3100/loki/api/v1/push scrape_configs: - job_name: log-service-01 static_configs: - targets: - localhost labels: container_name: sigma-media-server-01 __path__: /var/log/sigma-media-server-01/now.* - targets: - localhost labels: container_name: sigma-media-server-02 __path__: /var/log/sigma-media-server-02/now.* BÆ°á»›c 3: Cáº¥u hÃ¬nh Loki Loki sáº½ lÆ°u trá»¯ vÃ  quáº£n lÃ½ log, Ä‘Æ°á»£c cáº¥u hÃ¬nh nhÆ° sau:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 auth_enabled: false server: http_listen_port: 3100 grpc_listen_port: 9096 common: instance_addr: 127.0.0.1 path_prefix: /tmp/loki storage: filesystem: chunks_directory: /tmp/loki/chunks rules_directory: /tmp/loki/rules replication_factor: 1 ring: kvstore: store: inmemory query_range: results_cache: cache: embedded_cache: enabled: true max_size_mb: 100 schema_config: configs: - from: 2024-10-01 store: tsdb object_store: filesystem schema: v12 index: prefix: index_ period: 24h BÆ°á»›c 5: Cáº¥u HÃ¬nh Grafana Truy cáº­p Grafana táº¡i http://localhost:3000 trÃªn trÃ¬nh duyá»‡t. ÄÄƒng nháº­p vá»›i thÃ´ng tin máº·c Ä‘á»‹nh: Username: admin Password: admin Sau khi Ä‘Äƒng nháº­p, thÃªm Loki lÃ m data source: VÃ o Configuration \u0026gt; Data Sources \u0026gt; Add data source. Chá»n Loki. Trong pháº§n URL, nháº­p http://loki:3100. Nháº¥n Save \u0026amp; Test Ä‘á»ƒ xÃ¡c minh káº¿t ná»‘i. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng json model nÃ y Ä‘á»ƒ sá»­ dá»¥ng:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 { \u0026#34;annotations\u0026#34;: { \u0026#34;list\u0026#34;: [ { \u0026#34;builtIn\u0026#34;: 1, \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;datasource\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;grafana\u0026#34; }, \u0026#34;enable\u0026#34;: true, \u0026#34;hide\u0026#34;: true, \u0026#34;iconColor\u0026#34;: \u0026#34;rgba(0, 211, 255, 1)\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Annotations \u0026amp; Alerts\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;dashboard\u0026#34; } ] }, \u0026#34;description\u0026#34;: \u0026#34;Universal and flexible dashboard for logging\u0026#34;, \u0026#34;editable\u0026#34;: true, \u0026#34;fiscalYearStartMonth\u0026#34;: 0, \u0026#34;gnetId\u0026#34;: 18042, \u0026#34;graphTooltip\u0026#34;: 0, \u0026#34;id\u0026#34;: 3, \u0026#34;links\u0026#34;: [], \u0026#34;panels\u0026#34;: [ { \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, \u0026#34;description\u0026#34;: \u0026#34;Live logs is a like \u0026#39;tail -f\u0026#39; in a real time\u0026#34;, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 9, \u0026#34;w\u0026#34;: 24, \u0026#34;x\u0026#34;: 0, \u0026#34;y\u0026#34;: 0 }, \u0026#34;id\u0026#34;: 6, \u0026#34;options\u0026#34;: { \u0026#34;dedupStrategy\u0026#34;: \u0026#34;none\u0026#34;, \u0026#34;enableLogDetails\u0026#34;: true, \u0026#34;prettifyLogMessage\u0026#34;: false, \u0026#34;showCommonLabels\u0026#34;: false, \u0026#34;showLabels\u0026#34;: true, \u0026#34;showTime\u0026#34;: false, \u0026#34;sortOrder\u0026#34;: \u0026#34;Descending\u0026#34;, \u0026#34;wrapLogMessage\u0026#34;: false }, \u0026#34;targets\u0026#34;: [ { \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, \u0026#34;editorMode\u0026#34;: \u0026#34;code\u0026#34;, \u0026#34;expr\u0026#34;: \u0026#34;{filename=\\\u0026#34;/var/log/${container_name}/now.debug\\\u0026#34;}\u0026#34;, \u0026#34;hide\u0026#34;: false, \u0026#34;queryType\u0026#34;: \u0026#34;range\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;title\u0026#34;: \u0026#34;Debug log\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;logs\u0026#34; }, { \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, \u0026#34;description\u0026#34;: \u0026#34;Live logs is a like \u0026#39;tail -f\u0026#39; in a real time\u0026#34;, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 9, \u0026#34;w\u0026#34;: 24, \u0026#34;x\u0026#34;: 0, \u0026#34;y\u0026#34;: 9 }, \u0026#34;id\u0026#34;: 4, \u0026#34;options\u0026#34;: { \u0026#34;dedupStrategy\u0026#34;: \u0026#34;none\u0026#34;, \u0026#34;enableLogDetails\u0026#34;: true, \u0026#34;prettifyLogMessage\u0026#34;: false, \u0026#34;showCommonLabels\u0026#34;: false, \u0026#34;showLabels\u0026#34;: true, \u0026#34;showTime\u0026#34;: false, \u0026#34;sortOrder\u0026#34;: \u0026#34;Descending\u0026#34;, \u0026#34;wrapLogMessage\u0026#34;: false }, \u0026#34;targets\u0026#34;: [ { \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, \u0026#34;editorMode\u0026#34;: \u0026#34;code\u0026#34;, \u0026#34;expr\u0026#34;: \u0026#34;{filename=\\\u0026#34;/var/log/${container_name}/now.nginx\\\u0026#34;}\u0026#34;, \u0026#34;hide\u0026#34;: false, \u0026#34;queryType\u0026#34;: \u0026#34;range\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;title\u0026#34;: \u0026#34;Nginx log\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;logs\u0026#34; }, { \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, \u0026#34;description\u0026#34;: \u0026#34;Live logs is a like \u0026#39;tail -f\u0026#39; in a real time\u0026#34;, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 9, \u0026#34;w\u0026#34;: 24, \u0026#34;x\u0026#34;: 0, \u0026#34;y\u0026#34;: 18 }, \u0026#34;id\u0026#34;: 3, \u0026#34;options\u0026#34;: { \u0026#34;dedupStrategy\u0026#34;: \u0026#34;none\u0026#34;, \u0026#34;enableLogDetails\u0026#34;: true, \u0026#34;prettifyLogMessage\u0026#34;: false, \u0026#34;showCommonLabels\u0026#34;: false, \u0026#34;showLabels\u0026#34;: true, \u0026#34;showTime\u0026#34;: false, \u0026#34;sortOrder\u0026#34;: \u0026#34;Descending\u0026#34;, \u0026#34;wrapLogMessage\u0026#34;: false }, \u0026#34;targets\u0026#34;: [ { \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, \u0026#34;editorMode\u0026#34;: \u0026#34;code\u0026#34;, \u0026#34;expr\u0026#34;: \u0026#34;{filename=~\\\u0026#34;/var/log/${container_name}/now\\\\\\\\.origin\\\u0026#34;}\u0026#34;, \u0026#34;hide\u0026#34;: false, \u0026#34;queryType\u0026#34;: \u0026#34;range\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;title\u0026#34;: \u0026#34;Origin log\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;logs\u0026#34; }, { \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, \u0026#34;description\u0026#34;: \u0026#34;Live logs is a like \u0026#39;tail -f\u0026#39; in a real time\u0026#34;, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 9, \u0026#34;w\u0026#34;: 24, \u0026#34;x\u0026#34;: 0, \u0026#34;y\u0026#34;: 27 }, \u0026#34;id\u0026#34;: 5, \u0026#34;options\u0026#34;: { \u0026#34;dedupStrategy\u0026#34;: \u0026#34;none\u0026#34;, \u0026#34;enableLogDetails\u0026#34;: true, \u0026#34;prettifyLogMessage\u0026#34;: false, \u0026#34;showCommonLabels\u0026#34;: false, \u0026#34;showLabels\u0026#34;: true, \u0026#34;showTime\u0026#34;: false, \u0026#34;sortOrder\u0026#34;: \u0026#34;Descending\u0026#34;, \u0026#34;wrapLogMessage\u0026#34;: false }, \u0026#34;targets\u0026#34;: [ { \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, \u0026#34;editorMode\u0026#34;: \u0026#34;code\u0026#34;, \u0026#34;expr\u0026#34;: \u0026#34;{filename=\\\u0026#34;/var/log/${container_name}/now.srs\\\u0026#34;}\u0026#34;, \u0026#34;hide\u0026#34;: false, \u0026#34;queryType\u0026#34;: \u0026#34;range\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;title\u0026#34;: \u0026#34;Srs log\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;logs\u0026#34; }, { \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, \u0026#34;description\u0026#34;: \u0026#34;Live logs is a like \u0026#39;tail -f\u0026#39; in a real time\u0026#34;, \u0026#34;gridPos\u0026#34;: { \u0026#34;h\u0026#34;: 9, \u0026#34;w\u0026#34;: 24, \u0026#34;x\u0026#34;: 0, \u0026#34;y\u0026#34;: 36 }, \u0026#34;id\u0026#34;: 2, \u0026#34;options\u0026#34;: { \u0026#34;dedupStrategy\u0026#34;: \u0026#34;none\u0026#34;, \u0026#34;enableLogDetails\u0026#34;: true, \u0026#34;prettifyLogMessage\u0026#34;: false, \u0026#34;showCommonLabels\u0026#34;: false, \u0026#34;showLabels\u0026#34;: true, \u0026#34;showTime\u0026#34;: false, \u0026#34;sortOrder\u0026#34;: \u0026#34;Descending\u0026#34;, \u0026#34;wrapLogMessage\u0026#34;: false }, \u0026#34;targets\u0026#34;: [ { \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, \u0026#34;editorMode\u0026#34;: \u0026#34;code\u0026#34;, \u0026#34;expr\u0026#34;: \u0026#34;{filename=~\\\u0026#34;/var/log/${container_name}/now\\\\\\\\.portal-local\\\u0026#34;}\u0026#34;, \u0026#34;hide\u0026#34;: false, \u0026#34;queryType\u0026#34;: \u0026#34;range\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;A\u0026#34; } ], \u0026#34;title\u0026#34;: \u0026#34;Portal log\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;logs\u0026#34; } ], \u0026#34;refresh\u0026#34;: \u0026#34;10s\u0026#34;, \u0026#34;schemaVersion\u0026#34;: 39, \u0026#34;tags\u0026#34;: [], \u0026#34;templating\u0026#34;: { \u0026#34;list\u0026#34;: [ { \u0026#34;current\u0026#34;: { \u0026#34;isNone\u0026#34;: true, \u0026#34;selected\u0026#34;: false, \u0026#34;text\u0026#34;: \u0026#34;None\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, \u0026#34;definition\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;hide\u0026#34;: 0, \u0026#34;includeAll\u0026#34;: false, \u0026#34;label\u0026#34;: \u0026#34;Container\u0026#34;, \u0026#34;multi\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;container_name\u0026#34;, \u0026#34;options\u0026#34;: [], \u0026#34;query\u0026#34;: { \u0026#34;label\u0026#34;: \u0026#34;container_name\u0026#34;, \u0026#34;refId\u0026#34;: \u0026#34;LokiVariableQueryEditor-VariableQuery\u0026#34;, \u0026#34;stream\u0026#34;: \u0026#34;{container_name=~\\\u0026#34;.+\\\u0026#34;}\u0026#34;, \u0026#34;type\u0026#34;: 1 }, \u0026#34;refresh\u0026#34;: 1, \u0026#34;regex\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;skipUrlSync\u0026#34;: false, \u0026#34;sort\u0026#34;: 0, \u0026#34;tagValuesQuery\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;tagsQuery\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;query\u0026#34;, \u0026#34;useTags\u0026#34;: false }, { \u0026#34;current\u0026#34;: { \u0026#34;selected\u0026#34;: false, \u0026#34;text\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;hide\u0026#34;: 0, \u0026#34;name\u0026#34;: \u0026#34;search\u0026#34;, \u0026#34;options\u0026#34;: [ { \u0026#34;selected\u0026#34;: true, \u0026#34;text\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;\u0026#34; } ], \u0026#34;query\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;skipUrlSync\u0026#34;: false, \u0026#34;type\u0026#34;: \u0026#34;textbox\u0026#34; } ] }, \u0026#34;time\u0026#34;: { \u0026#34;from\u0026#34;: \u0026#34;now-15m\u0026#34;, \u0026#34;to\u0026#34;: \u0026#34;now\u0026#34; }, \u0026#34;timepicker\u0026#34;: { \u0026#34;refresh_intervals\u0026#34;: [ \u0026#34;10s\u0026#34;, \u0026#34;30s\u0026#34;, \u0026#34;1m\u0026#34;, \u0026#34;5m\u0026#34;, \u0026#34;15m\u0026#34;, \u0026#34;30m\u0026#34;, \u0026#34;1h\u0026#34;, \u0026#34;2h\u0026#34;, \u0026#34;1d\u0026#34; ] }, \u0026#34;timezone\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;Monitor sigma server\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;cdzv1t37ajzeoc\u0026#34;, \u0026#34;version\u0026#34;: 15, \u0026#34;weekStart\u0026#34;: \u0026#34;\u0026#34; } Thay Ä‘á»•i cÃ¡c uid cá»§a datasource tÆ°Æ¡ng á»©ng\n1 2 3 4 \u0026#34;datasource\u0026#34;: { \u0026#34;type\u0026#34;: \u0026#34;loki\u0026#34;, \u0026#34;uid\u0026#34;: \u0026#34;adzuilqytpp1cc\u0026#34; }, Káº¿t luáº­n Viá»‡c sá»­ dá»¥ng stack Promtail-Loki-Grafana giÃºp giÃ¡m sÃ¡t log cá»§a Sigma Media Server má»™t cÃ¡ch táº­p trung, hiá»‡u quáº£ vÃ  trá»±c quan. NÃ³ giáº£i quyáº¿t Ä‘Æ°á»£c bÃ i toÃ¡n theo dÃµi log tá»« nhiá»u dá»‹ch vá»¥ khÃ¡c nhau mÃ  khÃ´ng cáº§n thao tÃ¡c thá»§ cÃ´ng phá»©c táº¡p\n","date":"2024-10-05T12:40:00+08:00","permalink":"https://phongthien99.github.io/posts/log-monitoring-for-sigma-media-server-using-promtail-loki-and-grafana/","title":"Log Monitoring for Sigma Media Server Using Promtail, Loki, and Grafana"},{"content":"Mastering Dynamic Base Path Management in Dockerized Vue 3 + Vite Äáº·t váº¥n Ä‘á» Trong phÃ¡t triá»ƒn á»©ng dá»¥ng web hiá»‡n Ä‘áº¡i, viá»‡c thiáº¿t láº­p Ä‘Æ°á»ng dáº«n build Ä‘á»™ng (dynamic build path) lÃ  má»™t yáº¿u tá»‘ quan trá»ng Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh linh hoáº¡t vÃ  kháº£ nÄƒng má»Ÿ rá»™ng cá»§a á»©ng dá»¥ng. Äá»‘i vá»›i cÃ¡c á»©ng dá»¥ng Vue 3 sá»­ dá»¥ng Vite, viá»‡c quáº£n lÃ½ Ä‘Æ°á»ng dáº«n build khÃ´ng chá»‰ áº£nh hÆ°á»Ÿng Ä‘áº¿n viá»‡c truy cáº­p tÃ i nguyÃªn mÃ  cÃ²n quyáº¿t Ä‘á»‹nh cÃ¡ch mÃ  á»©ng dá»¥ng tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c dá»‹ch vá»¥ khÃ¡c, nhÆ° API.\nMá»™t trong nhá»¯ng thÃ¡ch thá»©c lá»›n lÃ  viá»‡c thay Ä‘á»•i base path cá»§a á»©ng dá»¥ng trong cÃ¡c mÃ´i trÆ°á»ng khÃ¡c nhau mÃ  khÃ´ng cáº§n pháº£i rebuild láº¡i toÃ n bá»™. Khi á»©ng dá»¥ng Ä‘Æ°á»£c triá»ƒn khai trong cÃ¡c mÃ´i trÆ°á»ng nhÆ° development, staging hoáº·c production, yÃªu cáº§u vá» base path cÃ³ thá»ƒ khÃ¡c nhau, vÃ  viá»‡c khÃ´ng cÃ³ cÆ¡ cháº¿ Ä‘á»ƒ Ä‘iá»u chá»‰nh chÃºng má»™t cÃ¡ch linh hoáº¡t cÃ³ thá»ƒ dáº«n Ä‘áº¿n:\nKhÃ³ khÄƒn trong triá»ƒn khai: Cáº§n pháº£i duy trÃ¬ nhiá»u cáº¥u hÃ¬nh hoáº·c báº£n build riÃªng cho tá»«ng mÃ´i trÆ°á»ng, gÃ¢y tá»‘n thá»i gian vÃ  cÃ´ng sá»©c. Giáº£i PhÃ¡p Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» dynamic base path trong Vue 3 + Vite, chÃºng ta káº¿t há»£p ba ká»¹ thuáº­t chÃ­nh:\n1. Dynamic Environment Variables Sá»­ dá»¥ng file nhÆ° /env.js Ä‘á»ƒ chá»©a cÃ¡c biáº¿n mÃ´i trÆ°á»ng (vÃ­ dá»¥: BASE_PATH, API_ENDPOINT). Táº£i cÃ¡c biáº¿n nÃ y vÃ o á»©ng dá»¥ng táº¡i runtime thÃ´ng qua Ä‘oáº¡n script trong index.html. 2. Nginx Configuration Generation Sá»­ dá»¥ng script hoáº·c template engine Ä‘á»ƒ tá»± Ä‘á»™ng sinh file cáº¥u hÃ¬nh nginx dá»±a trÃªn cÃ¡c biáº¿n mÃ´i trÆ°á»ng hiá»‡n táº¡i. Ãp dá»¥ng cÃ¡c thay Ä‘á»•i base path Ä‘á»™ng trong cáº¥u hÃ¬nh nginx Ä‘á»ƒ tÆ°Æ¡ng thÃ­ch vá»›i cÃ¡c mÃ´i trÆ°á»ng khÃ¡c nhau. 3. Táº¡o Template Cho index.html Sinh index.html cuá»‘i cÃ¹ng dá»±a trÃªn template vÃ  cÃ¡c biáº¿n mÃ´i trÆ°á»ng táº¡i runtime. Viá»‡c káº¿t há»£p cÃ¡c ká»¹ thuáº­t nÃ y giÃºp thay Ä‘á»•i base path linh hoáº¡t mÃ  khÃ´ng cáº§n build láº¡i á»©ng dá»¥ng, Ä‘áº£m báº£o kháº£ nÄƒng thÃ­ch á»©ng vÃ  tá»‘i Æ°u hÃ³a quÃ¡ trÃ¬nh triá»ƒn khai.\nThá»±c hiá»‡n Thá»±c hiá»‡n trÃªn project github.com/wei-zone/vue3-quick-start.git\nBÆ°á»›c 1: Chá»‰nh sá»­a file index.html ThÃªm Ä‘oáº¡n script Ä‘á»ƒ táº£i env.js tá»« BASE_PATH vÃ o trong tháº» \u0026lt;head\u0026gt; cá»§a file index.html. 1 2 3 4 5 6 7 8 9 10 11 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- ThÃªm Ä‘oáº¡n nÃ y vÃ o --\u0026gt; \u0026lt;script src=\u0026#34;${BASE_PATH}/env.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; BÆ°á»›c 2: Táº¡o file env.template.js trong thÆ° má»¥c public Táº¡o file env.template.js Ä‘á»ƒ Ä‘á»‹nh nghÄ©a biáº¿n BASE_PATH vÃ  cÃ¡c biáº¿n mÃ´i trÆ°á»ng khÃ¡c náº¿u cáº§n. 1 2 3 4 5 6 (function(window) { window.env = { BASE_PATH: \u0026#39;${BASE_PATH}\u0026#39; // Biáº¿n mÃ´i trÆ°á»ng sáº½ Ä‘Æ°á»£c thay tháº¿ khi build }; })(this); BÆ°á»›c 3: CÃ i Ä‘áº·t vÃ  cáº¥u hÃ¬nh vite-plugin-dynamic-base CÃ i Ä‘áº·t thÆ° viá»‡n vite-plugin-dynamic-base vÃ o devDependencies. 1 2 pnpm add vite-plugin-dynamic-base --save-dev Cáº¥u hÃ¬nh plugin vite-plugin-dynamic-base trong file vite.config.ts: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 import { defineConfig } from \u0026#39;vite\u0026#39;; import vue from \u0026#39;@vitejs/plugin-vue\u0026#39;; import { dynamicBase } from \u0026#39;vite-plugin-dynamic-base\u0026#39;; export default defineConfig({ plugins: [ vue(), dynamicBase({ publicPath: \u0026#39;window.env.BASE_PATH\u0026#39;, // Sá»­ dá»¥ng biáº¿n BASE_PATH tá»« env.js transformIndexHtml: true, // Biáº¿n Ä‘á»•i file index.html Ä‘á»ƒ sá»­ dá»¥ng BASE_PATH }), ], }); Thá»±c hiá»‡n build dá»± Ã¡n: 1 2 3 bash Copy code pnpm build BÆ°á»›c 4: Táº¡o file nginx.template.conf Táº¡o file nginx.template.conf Ä‘á»ƒ cáº¥u hÃ¬nh Nginx vá»›i BASE_PATH Ä‘á»™ng. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 nginx Copy code user nginx; worker_processes 1; error_log /var/log/nginx/error.log warn; pid /var/run/nginx.pid; events { worker_connections 1024; } http { include /etc/nginx/mime.types; default_type application/octet-stream; log_format main \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34;\u0026#39;; access_log /var/log/nginx/access.log main; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; location ${BASE_PATH} { # Sá»­ dá»¥ng BASE_PATH Ä‘Æ°á»£c thay tháº¿ khi cháº¡y script alias /app/; # ThÆ° má»¥c chá»©a file build cá»§a á»©ng dá»¥ng Vue index index.html; try_files $uri $uri/ /index.html; # Há»— trá»£ cho SPA } error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } } BÆ°á»›c 5: Táº¡o script gen-template.sh Ä‘á»ƒ sinh file tá»« cÃ¡c template Táº¡o script gen-template.sh Ä‘á»ƒ thay tháº¿ cÃ¡c biáº¿n mÃ´i trÆ°á»ng trong file template. 1 2 3 4 5 6 7 8 9 10 11 #!/bin/bash # Thay tháº¿ biáº¿n trong env.template.js vÃ  táº¡o file env.js envsubst \u0026lt; /app/env.template.js \u0026gt; /app/env.js # Thay tháº¿ biáº¿n trong index.html vÃ  ghi Ä‘Ã¨ láº¡i file envsubst \u0026lt; /app/index.html | tee /app/index.html \u0026gt; /dev/null # Thay tháº¿ biáº¿n trong nginx.template.conf vÃ  táº¡o file nginx.conf envsubst \u0026lt; /nginx.template.conf \u0026gt; /etc/nginx/nginx.conf BÆ°á»›c 6: Cáº¥u hÃ¬nh docker-compose.yml Ä‘á»ƒ cháº¡y thá»­ Cáº¥u hÃ¬nh file docker-compose.yml Ä‘á»ƒ cháº¡y Nginx vá»›i BASE_PATH Ä‘Ã£ Ä‘Æ°á»£c thay tháº¿. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 version: \u0026#39;3.8\u0026#39; services: nginx: image: nginx:latest ports: - \u0026#34;8086:80\u0026#34; # Má»Ÿ cá»•ng 8086 Ä‘á»ƒ truy cáº­p Nginx tá»« bÃªn ngoÃ i command: [\u0026#34;/bin/sh\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;/init.sh \u0026amp;\u0026amp; nginx-debug -g \u0026#39;daemon off;\u0026#39;\u0026#34;] environment: - BASE_PATH=/test-app # Biáº¿n mÃ´i trÆ°á»ng sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng trong script gen-template.sh volumes: - ./nginx.template.conf:/nginx.template.conf # Ãnh xáº¡ file nginx.template.conf vÃ o container - ./dist:/app # ThÆ° má»¥c chá»©a file build cá»§a á»©ng dá»¥ng Vue - ./gen-template.sh:/init.sh # Ãnh xáº¡ file script init.sh vÃ o container Káº¿t luáº­n Thiáº¿t láº­p dynamic build path cho Vue 3 vá»›i Vite giÃºp Ä‘iá»u chá»‰nh cáº¥u hÃ¬nh á»©ng dá»¥ng linh hoáº¡t mÃ  khÃ´ng cáº§n rebuild. Giáº£i phÃ¡p nÃ y tá»‘i Æ°u hÃ³a triá»ƒn khai, giáº£m thiá»ƒu sai sÃ³t vÃ  dá»… dÃ ng thÃ­ch á»©ng vá»›i thay Ä‘á»•i mÃ´i trÆ°á»ng.\nTÃ i liá»‡u tham kháº£o Read Dynamic Environment Variables in Angular\n","date":"2024-09-21T12:40:00+08:00","permalink":"https://phongthien99.github.io/posts/mastering-dynamic-base-path-management-in-dockerized-vue-3--vite/","title":"Mastering Dynamic Base Path Management in Dockerized Vue 3 + Vite"},{"content":"Guide to Using Uberfx and Ginkgo for Building Unit Testing Workflow in Go Äáº·t váº¥n Ä‘á» Äá»ƒ Ä‘áº£m báº£o cháº¥t lÆ°á»£ng mÃ£ nguá»“n trong phÃ¡t triá»ƒn pháº§n má»m, unit testing lÃ  má»™t yáº¿u tá»‘ khÃ´ng thá»ƒ thiáº¿u. Viá»‡c viáº¿t vÃ  tá»• chá»©c cÃ¡c bÃ i kiá»ƒm tra Ä‘Æ¡n vá»‹ má»™t cÃ¡ch hiá»‡u quáº£ lÃ  Ä‘iá»u quan trá»ng, Ä‘áº·c biá»‡t khi lÃ m viá»‡c vá»›i cÃ¡c á»©ng dá»¥ng phá»©c táº¡p. Tuy nhiÃªn, viá»‡c nÃ y thÆ°á»ng gáº·p khÃ³ khÄƒn trong viá»‡c quáº£n lÃ½ cÃ¡c phá»¥ thuá»™c vÃ  duy trÃ¬ cáº¥u trÃºc kiá»ƒm tra rÃµ rÃ ng..\nGiáº£i phÃ¡p Khi lÃ m viá»‡c vá»›i Go, viá»‡c káº¿t há»£p Uberfx (framework DI) vÃ  Ginkgo (thÆ° viá»‡n BDD) cung cáº¥p má»™t phÆ°Æ¡ng phÃ¡p hiá»‡u quáº£ Ä‘á»ƒ giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» trÃªn. Uberfx giÃºp quáº£n lÃ½ cÃ¡c phá»¥ thuá»™c cá»§a á»©ng dá»¥ng, trong khi Ginkgo há»— trá»£ viáº¿t cÃ¡c bÃ i kiá»ƒm tra Ä‘Æ¡n vá»‹ theo cÃ¡ch dá»… Ä‘á»c vÃ  rÃµ rÃ ng.\nBÃ i viáº¿t nÃ y sáº½ hÆ°á»›ng dáº«n báº¡n cÃ¡ch sá»­ dá»¥ng Uberfx Ä‘á»ƒ quáº£n lÃ½ phá»¥ thuá»™c vÃ  Ginkgo Ä‘á»ƒ viáº¿t cÃ¡c bÃ i kiá»ƒm tra, nháº±m xÃ¢y dá»±ng má»™t quy trÃ¬nh phÃ¡t triá»ƒn máº¡nh máº½ vÃ  dá»… báº£o trÃ¬.\nThá»±c hiá»‡n BÆ°á»›c 1: Táº¡o module vá»›i Uberfx 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 package example import ( \u0026#34;errors\u0026#34; \u0026#34;sync\u0026#34; \u0026#34;go.uber.org/fx\u0026#34; ) type User struct { ID int `json:\u0026#34;id\u0026#34;` Name string `json:\u0026#34;name\u0026#34;` Email string `json:\u0026#34;email\u0026#34;` } type UserService interface { Create(user *User) (*User, error) Get(id int) (*User, error) Update(id int, user *User) (*User, error) Delete(id int) error } type userService struct { users map[int]*User lock sync.RWMutex idSeq int } func NewUserService() UserService { return \u0026amp;userService{ users: make(map[int]*User), idSeq: 1, } } func (s *userService) Create(user *User) (*User, error) { s.lock.Lock() defer s.lock.Unlock() user.ID = s.idSeq s.idSeq++ s.users[user.ID] = user return user, nil } func (s *userService) Get(id int) (*User, error) { s.lock.RLock() defer s.lock.RUnlock() user, ok := s.users[id] if !ok { return nil, errors.New(\u0026#34;user not found\u0026#34;) } return user, nil } func (s *userService) Update(id int, updatedUser *User) (*User, error) { s.lock.Lock() defer s.lock.Unlock() user, ok := s.users[id] if !ok { return nil, errors.New(\u0026#34;user not found\u0026#34;) } user.Name = updatedUser.Name user.Email = updatedUser.Email return user, nil } func (s *userService) Delete(id int) error { s.lock.Lock() defer s.lock.Unlock() if _, ok := s.users[id]; !ok { return errors.New(\u0026#34;user not found\u0026#34;) } delete(s.users, id) return nil } func Module() fx.Option { var Module = fx.Provide(NewUserService) return Module } Giáº£i thÃ­ch\nModule() fx.Option: HÃ m nÃ y sá»­ dá»¥ng fx.Provide cá»§a Uberfx Ä‘á»ƒ cung cáº¥p má»™t thá»ƒ hiá»‡n cá»§a userService nhÆ° lÃ  má»™t dá»‹ch vá»¥ cho cÃ¡c pháº§n khÃ¡c cá»§a á»©ng dá»¥ng. ÄÃ¢y lÃ  cÃ¡ch Ä‘á»ƒ Uberfx quáº£n lÃ½ vÃ  cung cáº¥p dá»‹ch vá»¥ thÃ´ng qua DI. CÃ¡ch Hoáº¡t Äá»™ng\nKhá»Ÿi táº¡o: Khi á»©ng dá»¥ng khá»Ÿi Ä‘á»™ng, Module() sáº½ Ä‘Æ°á»£c gá»i Ä‘á»ƒ cung cáº¥p userService qua Uberfx. Äiá»u nÃ y cho phÃ©p cÃ¡c pháº§n khÃ¡c cá»§a á»©ng dá»¥ng cÃ³ thá»ƒ yÃªu cáº§u dá»‹ch vá»¥ nÃ y mÃ  khÃ´ng cáº§n pháº£i khá»Ÿi táº¡o nÃ³ trá»±c tiáº¿p. Quáº£n lÃ½ NgÆ°á»i DÃ¹ng: CÃ¡c phÆ°Æ¡ng thá»©c trong userService cho phÃ©p táº¡o, láº¥y, cáº­p nháº­t vÃ  xÃ³a ngÆ°á»i dÃ¹ng trong má»™t báº£n Ä‘á»“, vá»›i sá»± Ä‘á»“ng bá»™ hÃ³a cáº§n thiáº¿t Ä‘á»ƒ xá»­ lÃ½ nhiá»u yÃªu cáº§u Ä‘á»“ng thá»i. Dependency Injection: Uberfx sáº½ quáº£n lÃ½ viá»‡c cung cáº¥p vÃ  chia sáº» userService trong toÃ n bá»™ á»©ng dá»¥ng, giÃºp cáº£i thiá»‡n cáº¥u trÃºc mÃ£ vÃ  quáº£n lÃ½ cÃ¡c phá»¥ thuá»™c. BÆ°á»›c 2: Viáº¿t testcase vá»›i ginkgo 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 package example_test import ( \u0026#34;context\u0026#34; \u0026#34;testing\u0026#34; \u0026#34;unit-test-example/module/example\u0026#34; model \u0026#34;unit-test-example/module/example\u0026#34; service \u0026#34;unit-test-example/module/example\u0026#34; . \u0026#34;github.com/onsi/ginkgo/v2\u0026#34; . \u0026#34;github.com/onsi/gomega\u0026#34; \u0026#34;go.uber.org/fx\u0026#34; ) var _ = Describe(\u0026#34;UserService with Fx\u0026#34;, func() { var ( userService service.UserService ) BeforeEach(func() { // Create a new Fx application to initialize dependencies app := fx.New( example.Module(), // Register the UserService module fx.Populate(\u0026amp;userService), // Automatically inject UserService into the variable ) // Start the Fx application and ensure it starts without errors Expect(app.Start(context.Background())).To(Succeed()) }) AfterEach(func() { // Stop the Fx application after each test to release resources app := fx.New() Expect(app.Stop(context.TODO())).To(Succeed()) }) Describe(\u0026#34;UserService\u0026#34;, func() { It(\u0026#34;should not be nil\u0026#34;, func() { Expect(userService).NotTo(BeNil()) }) }) Describe(\u0026#34;Create User\u0026#34;, func() { It(\u0026#34;should create a new user successfully\u0026#34;, func() { // Define a new user user := \u0026amp;model.User{Name: \u0026#34;John Doe\u0026#34;, Email: \u0026#34;john@example.com\u0026#34;} // Call the Create method from UserService createdUser, err := userService.Create(user) // Verify that there are no errors Expect(err).To(BeNil()) // Verify that the created user has the expected values Expect(createdUser.ID).To(Equal(1)) Expect(createdUser.Name).To(Equal(\u0026#34;John Doe\u0026#34;)) Expect(createdUser.Email).To(Equal(\u0026#34;john@example.com\u0026#34;)) }) }) // Additional test cases for Get, Update, and Delete can be added similarly }) func TestService(t *testing.T) { RegisterFailHandler(Fail) RunSpecs(t, \u0026#34;UserService Suite\u0026#34;) } Giáº£i thÃ­ch\nfunc TestService(t *testing.T): ÄÃ¢y lÃ  hÃ m Ä‘iá»ƒm vÃ o (entry point) cho cÃ¡c bÃ i kiá»ƒm tra trong Go. Khi báº¡n cháº¡y lá»‡nh go test, Go sáº½ tÃ¬m cÃ¡c hÃ m cÃ³ tÃªn báº¯t Ä‘áº§u báº±ng Test vÃ  thá»±c thi chÃºng. HÃ m TestService lÃ  má»™t hÃ m Ä‘áº·c biá»‡t Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ khá»Ÿi Ä‘á»™ng Ginkgo vÃ  cháº¡y cÃ¡c bÃ i kiá»ƒm tra Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a báº±ng Ginkgo. RegisterFailHandler(Fail): ÄÄƒng kÃ½ má»™t hÃ m xá»­ lÃ½ lá»—i. Trong trÆ°á»ng há»£p cÃ³ lá»—i trong cÃ¡c bÃ i kiá»ƒm tra, hÃ m Fail cá»§a Ginkgo sáº½ Ä‘Æ°á»£c gá»i, dáº«n Ä‘áº¿n viá»‡c bÃ¡o cÃ¡o lá»—i vÃ  dá»«ng quÃ¡ trÃ¬nh kiá»ƒm tra. RunSpecs(t, \u0026quot;UserService Suite\u0026quot;): Khá»Ÿi Ä‘á»™ng Ginkgo vÃ  thá»±c hiá»‡n táº¥t cáº£ cÃ¡c bÃ i kiá»ƒm tra Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a. Tham sá»‘ Ä‘áº§u tiÃªn lÃ  Ä‘á»‘i tÆ°á»£ng testing.T Ä‘á»ƒ Ginkgo cÃ³ thá»ƒ tÃ­ch há»£p vá»›i há»‡ thá»‘ng kiá»ƒm tra cá»§a Go. Tham sá»‘ thá»© hai lÃ  tÃªn cá»§a suite kiá»ƒm tra, dÃ¹ng Ä‘á»ƒ tá»• chá»©c vÃ  bÃ¡o cÃ¡o cÃ¡c bÃ i kiá»ƒm tra. fx.Populate(\u0026amp;userService) yÃªu cáº§u Uberfx cung cáº¥p má»™t instance cá»§a UserService vÃ  gÃ¡n nÃ³ cho biáº¿n userService. LÃ m tháº¿ nÃ o fx.Populate hoáº¡t Ä‘á»™ng: Khi á»©ng dá»¥ng Uberfx khá»Ÿi Ä‘á»™ng, nÃ³ tÃ¬m cÃ¡c dá»‹ch vá»¥ hoáº·c phá»¥ thuá»™c Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng kÃ½ (trong vÃ­ dá»¥ nÃ y lÃ  UserService thÃ´ng qua example.Module()) vÃ  tá»± Ä‘á»™ng cung cáº¥p chÃºng cho cÃ¡c biáº¿n Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh thÃ´ng qua fx.Populate. Äiá»u nÃ y giÃºp tÃ¡ch biá»‡t viá»‡c khá»Ÿi táº¡o cÃ¡c Ä‘á»‘i tÆ°á»£ng khá»i logic cá»§a bÃ i kiá»ƒm tra, lÃ m cho mÃ£ nguá»“n trá»Ÿ nÃªn sáº¡ch sáº½ vÃ  dá»… báº£o trÃ¬ hÆ¡n\nBÆ°á»›c 3: Cháº¡y test Cháº¡y test báº±ng go test\n1 go run test -v Káº¿t quáº£:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 === RUN TestService Running Suite: UserService Suite - /home/phongthien/Desktop/start-up/unit-test/module/example ============================================================================================= Random Seed: 1726234713 Will run 2 of 2 specs [Fx] PROVIDE fx.Lifecycle \u0026lt;= go.uber.org/fx.New.func1() [Fx] PROVIDE fx.Shutdowner \u0026lt;= go.uber.org/fx.(*App).shutdowner-fm() [Fx] PROVIDE fx.DotGraph \u0026lt;= go.uber.org/fx.(*App).dotGraph-fm() [Fx] PROVIDE example.UserService \u0026lt;= unit-test-example/module/example.NewUserService() [Fx] INVOKE reflect.makeFuncStub() [Fx] RUN provide: unit-test-example/module/example.NewUserService() [Fx] RUNNING [Fx] PROVIDE fx.Lifecycle \u0026lt;= go.uber.org/fx.New.func1() [Fx] PROVIDE fx.Shutdowner \u0026lt;= go.uber.org/fx.(*App).shutdowner-fm() [Fx] PROVIDE fx.DotGraph \u0026lt;= go.uber.org/fx.(*App).dotGraph-fm() â€¢[Fx] PROVIDE fx.Lifecycle \u0026lt;= go.uber.org/fx.New.func1() [Fx] PROVIDE fx.Shutdowner \u0026lt;= go.uber.org/fx.(*App).shutdowner-fm() [Fx] PROVIDE fx.DotGraph \u0026lt;= go.uber.org/fx.(*App).dotGraph-fm() [Fx] PROVIDE example.UserService \u0026lt;= unit-test-example/module/example.NewUserService() [Fx] INVOKE reflect.makeFuncStub() [Fx] RUN provide: unit-test-example/module/example.NewUserService() [Fx] RUNNING [Fx] PROVIDE fx.Lifecycle \u0026lt;= go.uber.org/fx.New.func1() [Fx] PROVIDE fx.Shutdowner \u0026lt;= go.uber.org/fx.(*App).shutdowner-fm() [Fx] PROVIDE fx.DotGraph \u0026lt;= go.uber.org/fx.(*App).dotGraph-fm() â€¢ Ran 2 of 2 Specs in 0.003 seconds SUCCESS! -- 2 Passed | 0 Failed | 0 Pending | 0 Skipped --- PASS: TestService (0.00s) PASS ok unit-test-example/module/example 0.012s Káº¿t Luáº­n Báº±ng cÃ¡ch sá»­ dá»¥ng Uberfx Ä‘á»ƒ quáº£n lÃ½ phá»¥ thuá»™c vÃ  Ginkgo Ä‘á»ƒ viáº¿t cÃ¡c bÃ i kiá»ƒm tra, báº¡n cÃ³ thá»ƒ xÃ¢y dá»±ng má»™t quy trÃ¬nh phÃ¡t triá»ƒn mÃ£ nguá»“n máº¡nh máº½ vÃ  dá»… báº£o trÃ¬ hÆ¡n. Viá»‡c tá»• chá»©c mÃ£ nguá»“n vÃ  kiá»ƒm tra theo cÃ¡ch nÃ y giÃºp cáº£i thiá»‡n cháº¥t lÆ°á»£ng mÃ£ vÃ  dá»… dÃ ng phÃ¡t hiá»‡n lá»—i hÆ¡n trong cÃ¡c á»©ng dá»¥ng phá»©c táº¡p.\nTÃ i liá»‡u tham kháº£o Uberfx Documentation Ginkgo Documentation ","date":"2024-09-13T21:17:00+08:00","permalink":"https://phongthien99.github.io/posts/guide-to-using-uberfx-and-ginkgo-for-building-unit-testing-workflow-in-go/","title":"Guide to Using Uberfx and Ginkgo for Building Unit Testing Workflow in Go"},{"content":"Building an Efficient Data Synchronization System: Combining Rclone and Temporal to Ensure High Availability and Avoid Data Duplication Äáº·t Váº¥n Äá» Trong má»™t há»‡ thá»‘ng cáº§n Ä‘áº£m báº£o tÃ­nh sáºµn sÃ ng cao (High Availability - HA), báº¡n cÃ³ ba mÃ¡y chá»§ hoáº¡t Ä‘á»™ng trong má»™t cá»¥m. CÃ¡c mÃ¡y chá»§ nÃ y cÃ¹ng chia sáº» má»™t volume lÆ°u trá»¯ dá»¯ liá»‡u chung. YÃªu cáº§u cá»§a há»‡ thá»‘ng lÃ  pháº£i Ä‘á»“ng bá»™ dá»¯ liá»‡u tá»« volume chia sáº» nÃ y lÃªn nhiá»u há»‡ lÆ°u trá»¯ khÃ¡c nhau nhÆ° AWS S3, Google Cloud Storage (GCS), vÃ  FTP.\nTuy nhiÃªn, viá»‡c Ä‘áº£m báº£o Ä‘á»“ng bá»™ dá»¯ liá»‡u lÃªn cÃ¡c há»‡ lÆ°u trá»¯ nÃ y mÃ  váº«n giá»¯ Ä‘Æ°á»£c tÃ­nh HA vÃ  trÃ¡nh trÃ¹ng láº·p dá»¯ liá»‡u láº¡i Ä‘áº·t ra má»™t thÃ¡ch thá»©c khÃ´ng nhá».\nTriá»ƒn khai cron job trÃªn má»™t mÃ¡y chá»§ duy nháº¥t: Náº¿u báº¡n chá»n má»™t mÃ¡y chá»§ duy nháº¥t Ä‘á»ƒ thá»±c hiá»‡n Ä‘á»“ng bá»™ hÃ³a báº±ng cÃ¡ch sá»­ dá»¥ng cron job, há»‡ thá»‘ng sáº½ gáº·p rá»§i ro náº¿u mÃ¡y chá»§ nÃ y gáº·p sá»± cá»‘. Trong trÆ°á»ng há»£p Ä‘Ã³, viá»‡c Ä‘á»“ng bá»™ dá»¯ liá»‡u sáº½ bá»‹ giÃ¡n Ä‘oáº¡n, dáº«n Ä‘áº¿n kháº£ nÄƒng máº¥t mÃ¡t dá»¯ liá»‡u. Triá»ƒn khai cron job trÃªn nhiá»u mÃ¡y chá»§: Äá»ƒ Ä‘áº£m báº£o tÃ­nh HA, náº¿u báº¡n triá»ƒn khai cron job trÃªn cáº£ ba mÃ¡y chá»§, cÃ³ kháº£ nÄƒng cáº£ ba mÃ¡y chá»§ sáº½ thá»±c hiá»‡n Ä‘á»“ng bá»™ cÃ¹ng má»™t lÃºc. Äiá»u nÃ y dáº«n Ä‘áº¿n viá»‡c dá»¯ liá»‡u bá»‹ Ä‘á»“ng bá»™ nhiá»u láº§n lÃªn cÃ¡c há»‡ lÆ°u trá»¯ khÃ¡c nhau, gÃ¢y ra sá»± trÃ¹ng láº·p dá»¯ liá»‡u. Há»‡ quáº£ lÃ  lÃ£ng phÃ­ bÄƒng thÃ´ng vÃ  lÃ m phá»©c táº¡p hÃ³a viá»‡c quáº£n lÃ½ dá»¯ liá»‡u trÃªn cÃ¡c há»‡ lÆ°u trá»¯. NhÆ° váº­y, há»‡ thá»‘ng cáº§n má»™t giáº£i phÃ¡p cÃ³ thá»ƒ vá»«a Ä‘áº£m báº£o Ä‘á»“ng bá»™ dá»¯ liá»‡u lÃªn cÃ¡c há»‡ lÆ°u trá»¯ má»™t cÃ¡ch nháº¥t quÃ¡n, vá»«a trÃ¡nh Ä‘Æ°á»£c viá»‡c dá»¯ liá»‡u bá»‹ trÃ¹ng láº·p, Ä‘á»“ng thá»i váº«n giá»¯ Ä‘Æ°á»£c tÃ­nh sáºµn sÃ ng cao trong trÆ°á»ng há»£p cÃ³ sá»± cá»‘ xáº£y ra\nGiáº£i phÃ¡p Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» Ä‘áº£m báº£o tÃ­nh sáºµn sÃ ng cao (HA) vÃ  trÃ¡nh trÃ¹ng láº·p dá»¯ liá»‡u khi Ä‘á»“ng bá»™ tá»« 3 mÃ¡y chá»§ chia sáº» volume lÃªn cÃ¡c há»‡ lÆ°u trá»¯ nhÆ° AWS S3, Google Cloud Storage (GCS), vÃ  FTP, chÃºng ta cÃ³ thá»ƒ káº¿t há»£p Rclone vá»›i Temporal. ÄÃ¢y lÃ  giáº£i phÃ¡p khÃ´ng chá»‰ tá»‘i Æ°u hÃ³a quÃ¡ trÃ¬nh Ä‘á»“ng bá»™ mÃ  cÃ²n giÃºp quáº£n lÃ½ hiá»‡u quáº£ vÃ  tá»± Ä‘á»™ng hÃ³a quy trÃ¬nh..\n1. Rclone: CÃ´ng Cá»¥ Äá»“ng Bá»™ Dá»¯ Liá»‡u Linh Hoáº¡t Rclone lÃ  má»™t cÃ´ng cá»¥ máº¡nh máº½ Ä‘á»ƒ Ä‘á»“ng bá»™ hÃ³a dá»¯ liá»‡u giá»¯a nhiá»u há»‡ lÆ°u trá»¯ Ä‘Ã¡m mÃ¢y vÃ  mÃ¡y chá»§ cá»¥c bá»™. Rclone há»— trá»£ nhiá»u giao thá»©c vÃ  dá»‹ch vá»¥ lÆ°u trá»¯ khÃ¡c nhau nhÆ° AWS S3, Google Cloud Storage, FTP, vÃ  nhiá»u dá»‹ch vá»¥ khÃ¡c. Äáº·c biá»‡t, nÃ³ há»— trá»£ cÃ¡c tÃ­nh nÄƒng nhÆ°:\nÄá»“ng bá»™ hÃ³a dá»¯ liá»‡u tá»« volume chia sáº» lÃªn nhiá»u há»‡ lÆ°u trá»¯. Kiá»ƒm tra sá»± khÃ¡c biá»‡t cá»§a dá»¯ liá»‡u trÆ°á»›c khi Ä‘á»“ng bá»™ Ä‘á»ƒ trÃ¡nh táº£i lÃªn cÃ¡c dá»¯ liá»‡u khÃ´ng cáº§n thiáº¿t. Há»— trá»£ nÃ©n vÃ  mÃ£ hÃ³a dá»¯ liá»‡u khi cáº§n thiáº¿t. 2. Temporal: Há»‡ Thá»‘ng Quáº£n LÃ½ Workflow Äáº£m Báº£o HA Temporal lÃ  má»™t há»‡ thá»‘ng quáº£n lÃ½ workflow giÃºp báº¡n Ä‘iá»u phá»‘i cÃ¡c quy trÃ¬nh phá»©c táº¡p trong mÃ´i trÆ°á»ng phÃ¢n tÃ¡n. Vá»›i Temporal, báº¡n cÃ³ thá»ƒ Ä‘áº£m báº£o ráº±ng cÃ¡c tÃ¡c vá»¥ Ä‘á»“ng bá»™ dá»¯ liá»‡u chá»‰ Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi má»™t mÃ¡y chá»§ táº¡i má»™t thá»i Ä‘iá»ƒm nháº¥t Ä‘á»‹nh, vÃ  khi mÃ¡y chá»§ Ä‘Ã³ gáº·p sá»± cá»‘, má»™t mÃ¡y chá»§ khÃ¡c sáº½ tá»± Ä‘á»™ng tiáº¿p quáº£n quÃ¡ trÃ¬nh Ä‘á»“ng bá»™. Temporal giÃºp giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» liÃªn quan Ä‘áº¿n tÃ­nh HA vÃ  trÃ¡nh trÃ¹ng láº·p dá»¯ liá»‡u báº±ng cÃ¡ch:\nQuáº£n lÃ½ tráº¡ng thÃ¡i: Temporal giá»¯ tráº¡ng thÃ¡i cá»§a cÃ¡c workflow vÃ  Ä‘áº£m báº£o chá»‰ cÃ³ má»™t instance cá»§a workflow Ä‘ang cháº¡y táº¡i má»™t thá»i Ä‘iá»ƒm. Failover tá»± Ä‘á»™ng: Náº¿u mÃ¡y chá»§ Ä‘ang thá»±c hiá»‡n workflow gáº·p sá»± cá»‘, Temporal sáº½ tá»± Ä‘á»™ng chuyá»ƒn trÃ¡ch nhiá»‡m sang má»™t mÃ¡y chá»§ khÃ¡c. Thá»±c hiá»‡n BÆ°á»›c 1: Thiáº¿t láº­p cÆ¡ sá»Ÿ dá»¯ liá»‡u SQL chung CÃ i Ä‘áº·t MySQL/PostgreSQL. Táº¡o báº£ng Temporal vÃ  cáº¥u hÃ¬nh Temporal server káº¿t ná»‘i Ä‘áº¿n cÆ¡ sá»Ÿ dá»¯ liá»‡u nÃ y. BÆ°á»›c 2: CÃ i Ä‘áº·t Temporal trÃªn 3 server Táº£i Temporal server trÃªn má»—i server. Cáº¥u hÃ¬nh Temporal Ä‘á»ƒ káº¿t ná»‘i Ä‘áº¿n cÆ¡ sá»Ÿ dá»¯ liá»‡u SQL chung. BÆ°á»›c 3: CÃ i Ä‘áº·t vÃ  cáº¥u hÃ¬nh Worker CÃ i Ä‘áº·t rclone vÃ  worker Temporal trÃªn má»—i server. Cáº¥u hÃ¬nh worker Ä‘á»ƒ sá»­ dá»¥ng rclone Ä‘á»“ng bá»™ dá»¯ liá»‡u lÃªn S3. BÆ°á»›c 4: Quáº£n lÃ½ Ä‘á»“ng bá»™ vÃ  HA Sá»­ dá»¥ng Temporal workflow Ä‘á»ƒ quáº£n lÃ½ tiáº¿n trÃ¬nh Ä‘á»“ng bá»™, chá»‰ cho phÃ©p má»™t server Ä‘á»“ng bá»™ táº¡i má»™t thá»i Ä‘iá»ƒm. Äáº£m báº£o tÃ­nh HA, náº¿u má»™t server gáº·p sá»± cá»‘, cÃ¡c server khÃ¡c tiáº¿p quáº£n tiáº¿n trÃ¬nh Ä‘á»“ng bá»™. BÆ°á»›c 5: Cháº¡y vÃ  kiá»ƒm tra Cháº¡y Temporal server vÃ  worker trÃªn cáº£ 3 server. Kiá»ƒm tra tÃ­nh Ä‘á»“ng bá»™ vÃ  HA cá»§a há»‡ thá»‘ng. Káº¿t Luáº­n Trong viá»‡c Ä‘áº£m báº£o tÃ­nh sáºµn sÃ ng cao (HA) vÃ  trÃ¡nh trÃ¹ng láº·p dá»¯ liá»‡u khi Ä‘á»“ng bá»™ tá»« má»™t volume chia sáº» lÃªn nhiá»u há»‡ lÆ°u trá»¯ nhÆ° AWS S3, Google Cloud Storage (GCS), vÃ  FTP, viá»‡c sá»­ dá»¥ng Rclone káº¿t há»£p vá»›i Temporal mang láº¡i giáº£i phÃ¡p tá»‘i Æ°u vÃ  hiá»‡u quáº£. NgoÃ i ra chÃºng ta cÃ³ thá»ƒ thá»­ nghiá»‡m trÃªn 1 mÃ¡y duy nháº¥t báº±ng cÃ¡ch sá»­ dá»±ng temporal káº¿t há»£p vá»›i sqlite3.\n","date":"2024-09-07T00:40:00+08:00","permalink":"https://phongthien99.github.io/posts/combining-rclone-and-temporal-to-ensure-high-availability-and-avoid-data-duplication/","title":"Combining Rclone and Temporal to Ensure High Availability and Avoid Data Duplication\""},{"content":"Development environment with Docker and Traefik Äáº·t váº¥n Ä‘á» PhÃ¡t triá»ƒn cá»¥c bá»™ vá»›i Docker Ä‘Ã£ trá»Ÿ nÃªn phá»• biáº¿n trong cÃ¡c quy trÃ¬nh phÃ¡t triá»ƒn pháº§n má»m. ThÃ´ng thÆ°á»ng, báº¡n chá»‰ cáº§n cháº¡y má»™t container vÃ  Ã¡nh xáº¡ cÃ¡c cá»•ng cáº§n thiáº¿t lÃ  cÃ³ thá»ƒ báº¯t Ä‘áº§u cÃ´ng viá»‡c. Tuy nhiÃªn, khi lÃ m viá»‡c vá»›i nhiá»u dá»± Ã¡n Ä‘á»“ng thá»i, viá»‡c xung Ä‘á»™t cá»•ng giá»¯a cÃ¡c dá»± Ã¡n trÃªn cÃ¹ng má»™t mÃ¡y chá»§ Docker cÃ³ thá»ƒ gÃ¢y ra khÃ³ khÄƒn trong viá»‡c quáº£n lÃ½. Äiá»u nÃ y khÃ´ng chá»‰ lÃ m giáº£m hiá»‡u quáº£ lÃ m viá»‡c mÃ  cÃ²n gÃ¢y phiá»n toÃ¡i khi báº¡n pháº£i nhá»› chÃ­nh xÃ¡c dá»± Ã¡n nÃ o sá»­ dá»¥ng cá»•ng nÃ o.\nGiáº£i phÃ¡p Sá»­ dá»¥ng má»™t reverse proxy cá»¥c bá»™ Ä‘á»ƒ quáº£n lÃ½ cÃ¡c dá»± Ã¡n sáº½ giÃºp báº¡n giáº£i quyáº¿t váº¥n Ä‘á» xung Ä‘á»™t cá»•ng. Traefik lÃ  má»™t lá»±a chá»n phÃ¹ há»£p Ä‘á»ƒ Ä‘á»‹nh tuyáº¿n vÃ  quáº£n lÃ½ cÃ¡c dá»± Ã¡n cá»¥c bá»™ thÃ´ng qua viá»‡c Ã¡nh xáº¡ miá»n vÃ  base path tÆ°Æ¡ng á»©ng.\nThá»±c hiá»‡n BÆ°á»›c 1: Khá»Ÿi táº¡o máº¡ng lÆ°á»›i (network) TrÆ°á»›c khi cÃ i Ä‘áº·t Traefik, báº¡n cáº§n táº¡o má»™t máº¡ng lÆ°á»›i Docker Ä‘á»ƒ Ä‘áº£m báº£o cÃ¡c dá»‹ch vá»¥ cá»§a báº¡n cÃ³ thá»ƒ giao tiáº¿p vá»›i nhau. 1 2 bashCopy code docker network create traefik-ingress BÆ°á»›c 2: CÃ i Ä‘áº·t Traefik ChÃºng ta sáº½ cÃ i Ä‘áº·t Traefik thÃ´ng qua Docker Compose. File docker-compose.yml dÆ°á»›i Ä‘Ã¢y sáº½ cÃ i Ä‘áº·t Traefik vÃ  thiáº¿t láº­p cÃ¡c cá»•ng cáº§n thiáº¿t.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 yamlCopy code version: \u0026#39;3.7\u0026#39; services: traefik: image: \u0026#34;traefik:v3.1\u0026#34; container_name: \u0026#34;traefik\u0026#34; command: - \u0026#34;--log.level=DEBUG\u0026#34; - \u0026#34;--api.insecure=true\u0026#34; - \u0026#34;--providers.docker=true\u0026#34; - \u0026#34;--providers.docker.exposedbydefault=false\u0026#34; - \u0026#34;--entryPoints.web.address=:80\u0026#34; ports: - \u0026#34;8080:80\u0026#34; # Äá»‹nh tuyáº¿n web (HTTP) - \u0026#34;8443:80\u0026#34; # Äá»‹nh tuyáº¿n cho HTTPS - \u0026#34;18080:8080\u0026#34; # Dashboard cá»§a Traefik volumes: - \u0026#34;/var/run/docker.sock:/var/run/docker.sock:ro\u0026#34; networks: - traefik-ingress restart: unless-stopped networks: traefik-ingress: external: true BÆ°á»›c 3: Thiáº¿t láº­p má»™t dá»± Ã¡n má»›i Sau khi Traefik Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t, báº¡n cÃ³ thá»ƒ báº¯t Ä‘áº§u thÃªm cÃ¡c dá»± Ã¡n cá»§a mÃ¬nh vÃ  cáº¥u hÃ¬nh Ä‘á»ƒ chÃºng hoáº¡t Ä‘á»™ng qua Traefik. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 yamlCopy code version: \u0026#39;3.8\u0026#39; services: mam.svc: build: context: . dockerfile: Dockerfile.dev labels: - \u0026#34;traefik.enable=true\u0026#34; - \u0026#34;traefik.http.routers.mam-api-svc.rule=PathPrefix(`/api/library`)\u0026#34; - \u0026#34;traefik.http.routers.mam-api-svc.service=mam-api-svc\u0026#34; - \u0026#34;traefik.http.services.mam-api-svc.loadbalancer.server.port=8080\u0026#34; - \u0026#34;traefik.http.routers.mam-grpc-svc.rule=Host(`mam.lh`)\u0026#34; - \u0026#34;traefik.http.routers.mam-grpc-svc.service=mam-grpc-svc\u0026#34; - \u0026#34;traefik.http.services.mam-grpc-svc.loadbalancer.server.port=50051\u0026#34; - \u0026#34;traefik.http.services.mam-grpc-svc.loadbalancer.server.scheme=h2c\u0026#34; environment: - NODE_ENV=development volumes: - .:/src command: [\u0026#34;pnpm\u0026#34;, \u0026#34;run\u0026#34;, \u0026#34;start:dev\u0026#34;] networks: - traefik-ingress networks: traefik-ingress: external: true Giáº£i thÃ­ch cáº¥u hÃ¬nh: traefik.enable=true: KÃ­ch hoáº¡t Traefik cho dá»‹ch vá»¥ nÃ y. traefik.http.routers.mam-api-svc.rule=PathPrefix(/api/library): Äá»‹nh tuyáº¿n cÃ¡c yÃªu cáº§u HTTP cÃ³ Ä‘Æ°á»ng dáº«n báº¯t Ä‘áº§u báº±ng /api/library tá»›i dá»‹ch vá»¥ mam-api-svc. traefik.http.routers.mam-api-svc.service=mam-api-svc: Äáº·t tÃªn dá»‹ch vá»¥ HTTP lÃ  mam-api-svc. traefik.http.services.mam-api-svc.loadbalancer.server.port=8080: Äá»‹nh tuyáº¿n lÆ°u lÆ°á»£ng HTTP tá»›i cá»•ng 8080 cá»§a dá»‹ch vá»¥ nÃ y. traefik.http.routers.mam-grpc-svc.rule=Host(mam.lh): Äá»‹nh tuyáº¿n cÃ¡c yÃªu cáº§u GRPC tá»›i dá»‹ch vá»¥ mam-grpc-svc khi host lÃ  mam.lh. traefik.http.services.mam-grpc-svc.loadbalancer.server.port=50051: Äá»‹nh tuyáº¿n lÆ°u lÆ°á»£ng GRPC tá»›i cá»•ng 50051. traefik.http.services.mam-grpc-svc.loadbalancer.server.scheme=h2c: Sá»­ dá»¥ng HTTP/2 khÃ´ng báº£o máº­t (h2c) cho GRPC. Káº¿t luáº­n Triá»ƒn khai Traefik lÃ m reverse proxy cá»¥c bá»™ giÃºp báº¡n quáº£n lÃ½ cÃ¡c dá»± Ã¡n má»™t cÃ¡ch dá»… dÃ ng vÃ  trÃ¡nh xung Ä‘á»™t cá»•ng. Vá»›i kháº£ nÄƒng Ä‘á»‹nh tuyáº¿n theo miá»n vÃ  base path, báº¡n cÃ³ thá»ƒ dá»… dÃ ng phÃ¢n biá»‡t cÃ¡c dá»‹ch vá»¥ mÃ  khÃ´ng cáº§n nhá»› cá»•ng cá»§a tá»«ng á»©ng dá»¥ng. HÆ¡n ná»¯a, Traefik há»— trá»£ HTTP/2 vÃ  GRPC, mang láº¡i sá»± linh hoáº¡t vÃ  máº¡nh máº½ cho mÃ´i trÆ°á»ng phÃ¡t triá»ƒn cá»¥c bá»™, tá»« Ä‘Ã³ tÄƒng hiá»‡u suáº¥t lÃ m viá»‡c.\nTÃ i liá»‡u tham kháº£o Traefik Documentation Development Environment with Docker and Traefik ","date":"2024-08-30T01:17:00+08:00","permalink":"https://phongthien99.github.io/posts/development-environment-with-docker-and-traefik/","title":"Development environment with Docker and Traefik"},{"content":"Fast Connection Localhost to Kubernetes with Telepresence Váº¥n Ä‘á» gáº·p pháº£i Trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn vá»›i kiáº¿n trÃºc microservice, viá»‡c tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c dá»‹ch vá»¥ khÃ¡c lÃ  Ä‘iá»u khÃ´ng thá»ƒ trÃ¡nh khá»i. Thay vÃ¬ pháº£i triá»ƒn khai toÃ n bá»™ cÃ¡c microservice trÃªn mÃ¡y local, báº¡n cÃ³ thá»ƒ táº­n dá»¥ng cÃ¡c dá»‹ch vá»¥ Ä‘Ã£ Ä‘Æ°á»£c triá»ƒn khai trÃªn cá»¥m Kubernetes (K8s). Má»™t giáº£i phÃ¡p thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng lÃ  kubectl port-forward Ä‘á»ƒ chuyá»ƒn tiáº¿p cÃ¡c cá»•ng tá»« cluster vá» mÃ¡y local. Tuy nhiÃªn, phÆ°Æ¡ng phÃ¡p nÃ y cÃ³ thá»ƒ trá»Ÿ nÃªn phá»©c táº¡p vÃ  tá»‘n thá»i gian khi sá»‘ lÆ°á»£ng microservice tÄƒng lÃªn, Ä‘Ã²i há»i viá»‡c má»Ÿ nhiá»u cá»•ng cho tá»«ng dá»‹ch vá»¥.\nGiáº£i phÃ¡p Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» phá»©c táº¡p khi pháº£i má»Ÿ nhiá»u cá»•ng báº±ng kubectl port-forward, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng Telepresence. CÃ´ng cá»¥ nÃ y cung cáº¥p má»™t cÃ¡ch tiáº¿p cáº­n Ä‘Æ¡n giáº£n vÃ  hiá»‡u quáº£ hÆ¡n, loáº¡i bá» nhu cáº§u má»Ÿ tá»«ng cá»•ng cho tá»«ng dá»‹ch vá»¥ microservice.\nTelepresence cho phÃ©p báº¡n cháº¡y á»©ng dá»¥ng trÃªn mÃ¡y local vÃ  káº¿t ná»‘i trá»±c tiáº¿p vá»›i cá»¥m Kubernetes. Thay vÃ¬ pháº£i thá»§ cÃ´ng má»Ÿ cá»•ng cho tá»«ng dá»‹ch vá»¥, Telepresence thiáº¿t láº­p má»™t káº¿t ná»‘i máº¡ng toÃ n diá»‡n giá»¯a mÃ¡y local vÃ  cluster Kubernetes. Äiá»u nÃ y cho phÃ©p báº¡n truy cáº­p má»i dá»‹ch vá»¥ trong cluster nhÆ° thá»ƒ chÃºng Ä‘ang cháº¡y trÃªn chÃ­nh mÃ¡y local cá»§a báº¡n.\nThá»±c hiá»‡n 1. CÃ i Ä‘áº·t trÃªn Ubuntu TrÆ°á»›c khi cÃ i Ä‘áº·t Telepresence, hÃ£y Ä‘áº£m báº£o ráº±ng mÃ¡y cá»§a báº¡n Ä‘Ã£ cÃ i Ä‘áº·t kubectl.\n1 2 3 4 5 # 1. Download the latest binary (~50 MB): sudo curl -fL https://app.getambassador.io/download/tel2/linux/amd64/latest/telepresence -o /usr/local/bin/telepresence # 2. Make the binary executable: sudo chmod a+x /usr/local/bin/telepresence 2. Thiáº¿t láº­p káº¿t ná»‘i vá»›i cá»¥m Kubernetes Äá»ƒ káº¿t ná»‘i mÃ¡y local vá»›i cá»¥m Kubernetes, báº¡n chá»‰ cáº§n cháº¡y lá»‡nh sau:\n1 telepresence connect 3. CÃ i Ä‘áº·t Traffic Manager Traffic Manager lÃ  thÃ nh pháº§n quan trá»ng giÃºp Telepresence quáº£n lÃ½ lÆ°u lÆ°á»£ng giá»¯a mÃ¡y local vÃ  cá»¥m Kubernetes. Báº¡n cÃ³ thá»ƒ cÃ i Ä‘áº·t Traffic Manager báº±ng cÃ¡ch sá»­ dá»¥ng Helm:\n1 telepresence helm install 4. Thá»­ nghiá»‡m Sau khi cÃ i Ä‘áº·t vÃ  káº¿t ná»‘i thÃ nh cÃ´ng, báº¡n cÃ³ thá»ƒ thá»­ nghiá»‡m káº¿t ná»‘i vá»›i cÃ¡c dá»‹ch vá»¥ trong cá»¥m Kubernetes:\n1 telnet \u0026lt;\u0026lt;service-name\u0026gt;\u0026gt;.\u0026lt;\u0026lt;namespace\u0026gt;\u0026gt; \u0026lt;\u0026lt;port\u0026gt;\u0026gt; VÃ­ dá»¥: Náº¿u báº¡n muá»‘n káº¿t ná»‘i tá»›i dá»‹ch vá»¥ my-service trong namespace default táº¡i cá»•ng 8080, báº¡n cÃ³ thá»ƒ cháº¡y:\n1 telnet my-service.default 8080 Káº¿t luáº­n Telepresence lÃ  má»™t cÃ´ng cá»¥ máº¡nh máº½ giÃºp Ä‘Æ¡n giáº£n hÃ³a viá»‡c phÃ¡t triá»ƒn vÃ  thá»­ nghiá»‡m cÃ¡c á»©ng dá»¥ng trong kiáº¿n trÃºc microservice vá»›i Kubernetes. Báº±ng cÃ¡ch loáº¡i bá» nhu cáº§u má»Ÿ cá»•ng cho tá»«ng dá»‹ch vá»¥, Telepresence cho phÃ©p báº¡n táº­p trung vÃ o viá»‡c phÃ¡t triá»ƒn vÃ  kiá»ƒm thá»­ á»©ng dá»¥ng mÃ  khÃ´ng cáº§n lo láº¯ng vá» cáº¥u hÃ¬nh phá»©c táº¡p.\nVá»›i Telepresence, viá»‡c káº¿t ná»‘i vá»›i cá»¥m Kubernetes trá»Ÿ nÃªn dá»… dÃ ng vÃ  liá»n máº¡ch, giÃºp báº¡n tiáº¿t kiá»‡m thá»i gian vÃ  nÃ¢ng cao hiá»‡u suáº¥t lÃ m viá»‡c.\nTÃ i liá»‡u tham kháº£o Telepresence Quick Start Guide ","date":"2024-08-24T01:17:00+08:00","permalink":"https://phongthien99.github.io/posts/fast-connection-localhost-to-kubernetes-with-telepresence/","title":"Fast Connection Localhost to Kubernetes with Telepresence"},{"content":"Setting Up Fake Wildcard Domain with Coredns on Ubuntu Äáº·t váº¥n Ä‘á» Trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn pháº§n má»m, viá»‡c sá»­ dá»¥ng nhiá»u tÃªn miá»n giáº£ dáº¡ng *.lh lÃ  khÃ¡ phá»• biáº¿n. ThÃ´ng thÆ°á»ng, Ä‘á»ƒ xá»­ lÃ½ cÃ¡c tÃªn miá»n nÃ y, chÃºng ta pháº£i thá»§ cÃ´ng sá»­a file /etc/hosts má»—i khi cáº§n táº¡o má»™t tÃªn miá»n má»›i. Äiá»u nÃ y khÃ´ng chá»‰ gÃ¢y máº¥t thá»i gian mÃ  Ä‘Ã´i khi cÃ²n dáº«n tá»›i cÃ¡c lá»—i khÃ´ng mong muá»‘n náº¿u quÃªn cáº­p nháº­t file.\nGiáº£i phÃ¡p CoreDNS cung cáº¥p kháº£ nÄƒng Ä‘á»‹nh tuyáº¿n DNS máº¡nh máº½ vÃ  cÃ³ thá»ƒ dá»… dÃ ng cáº¥u hÃ¬nh Ä‘á»ƒ xá»­ lÃ½ cÃ¡c wildcard domain.\nThá»±c hiá»‡n Triá»ƒn khai thÃ´ng qua Docker-compose\nBÆ°á»›c 1: Táº¡o file Docker Compose Táº¡o má»™t thÆ° má»¥c cho cáº¥u hÃ¬nh Docker Compose:\n1 2 3 mkdir coredns-wildcard cd coredns-wildcard Táº¡o má»™t file docker-compose.yml vá»›i ná»™i dung sau:\n1 2 3 4 5 6 7 8 9 10 11 12 version: \u0026#39;3\u0026#39; services: coredns: image: coredns/coredns:latest container_name: coredns command: \u0026#34;-conf /Corefile\u0026#34; ports: - \u0026#34;53:53/udp\u0026#34; volumes: - ./Corefile:/etc/coredns/Corefile restart: unless-stopped BÆ°á»›c 2: Cáº¥u hÃ¬nh CoreDNS Táº¡o má»™t file cáº¥u hÃ¬nh tÃªn lÃ  Corefile trong thÆ° má»¥c coredns-wildcard vá»›i ná»™i dung sau:\n1 2 3 4 5 6 7 8 9 10 .:53 { template IN ANY lh { match \u0026#34;\\w*\\.(lh\\.)$\u0026#34; answer \u0026#34;{{ .Name }} 3600 IN A 127.0.0.1\u0026#34; fallthrough } forward . 8.8.8.8 log } Cáº¥u hÃ¬nh nÃ y sáº½ chuyá»ƒn hÆ°á»›ng táº¥t cáº£ cÃ¡c tÃªn miá»n dáº¡ng *.lh tá»›i Ä‘á»‹a chá»‰ 127.0.0.1 vÃ  sá»­ dá»¥ng Google DNS cho cÃ¡c yÃªu cáº§u khÃ¡c.\nBÆ°á»›c 3: Cháº¡y Docker Compose Trong thÆ° má»¥c coredns-wildcard, cháº¡y lá»‡nh sau Ä‘á»ƒ khá»Ÿi Ä‘á»™ng CoreDNS:\n1 2 docker-compose up -d BÆ°á»›c 4: Cáº¥u hÃ¬nh DNS trÃªn mÃ¡y tÃ­nh cÃ¡ nhÃ¢n Äá»ƒ sá»­ dá»¥ng CoreDNS, chá»‰nh sá»­a file /etc/resolv.conf Ä‘á»ƒ sá»­ dá»¥ng CoreDNS lÃ m DNS cá»¥c bá»™:\n1 2 sudo nano /etc/resolv.conf ThÃªm dÃ²ng sau vÃ o Ä‘áº§u file:\n1 2 nameserver 127.0.0.1 BÆ°á»›c 6: Kiá»ƒm tra cáº¥u hÃ¬nh Kiá»ƒm tra xem cáº¥u hÃ¬nh Ä‘Ã£ hoáº¡t Ä‘á»™ng hay chÆ°a báº±ng cÃ¡ch sá»­ dá»¥ng lá»‡nh nslookup:\n1 2 nslookup test.lt Náº¿u cáº¥u hÃ¬nh Ä‘Ãºng, báº¡n sáº½ nháº­n Ä‘Æ°á»£c pháº£n há»“i vá»›i Ä‘á»‹a chá»‰ IP 127.0.0.1.\nKáº¿t luáº­n Vá»›i cÃ¡c bÆ°á»›c trÃªn, viá»‡c thiáº¿t láº­p wildcard domain vá»›i CoreDNS trÃªn Ubuntu thÃ´ng qua Docker Compose trá»Ÿ nÃªn Ä‘Æ¡n giáº£n vÃ  hiá»‡u quáº£. ÄÃ¢y lÃ  má»™t giáº£i phÃ¡p tá»‘t Ä‘á»ƒ quáº£n lÃ½ cÃ¡c tÃªn miá»n giáº£ phá»¥c vá»¥ cho quÃ¡ trÃ¬nh phÃ¡t triá»ƒn pháº§n má»m má»™t cÃ¡ch linh hoáº¡t.\n","date":"2024-08-17T01:17:00+08:00","permalink":"https://phongthien99.github.io/posts/setting-up-fake-wildcard-domain-with-coredns-on-local-ubuntu/","title":"Setting Up Fake Wildcard Domain with Coredns on Local Ubuntu"},{"content":"Bypass login Portainer Váº¥n Ä‘á» gáº·p pháº£i Khi sá»­ dá»¥ng Portainer phiÃªn báº£n 2.19.4, há»‡ thá»‘ng yÃªu cáº§u ngÆ°á»i dÃ¹ng pháº£i Ä‘Äƒng nháº­p báº±ng tÃ i khoáº£n vÃ  máº­t kháº©u. Máº·c dÃ¹ Ä‘Ã¢y lÃ  má»™t tÃ­nh nÄƒng quan trá»ng nháº±m tÄƒng cÆ°á»ng báº£o máº­t, nhÆ°ng trong mÃ´i trÆ°á»ng lÃ m viá»‡c local, viá»‡c nÃ y cÃ³ thá»ƒ trá»Ÿ nÃªn khÃ´ng cáº§n thiáº¿t vÃ  gÃ¢y ra sá»± phiá»n toÃ¡i cho ngÆ°á»i dÃ¹ng.\nGiáº£i phÃ¡p Äá»ƒ Ä‘Æ¡n giáº£n hÃ³a viá»‡c truy cáº­p vÃ o Potainer trong mÃ´i trÆ°á»ng local mÃ  khÃ´ng cáº§n pháº£i Ä‘Äƒng nháº­p, báº¡n cÃ³ thá»ƒ:\nÄáº·t má»™t proxy server trÆ°á»›c Portainer vÃ  sá»­ dá»¥ng access token Ä‘á»ƒ truy cáº­p Portainer API. Táº¡o má»™t JWT token giáº£ dÃ i háº¡n Ä‘á»ƒ trÃ¡nh viá»‡c token háº¿t háº¡n quÃ¡ sá»›m khi client kiá»ƒm tra. Thá»±c hiá»‡n 1. Láº¥y Access Token Theo hÆ°á»›ng dáº«n cá»§a Portainer: Portainer API Access.\n2. Cáº¥u hÃ¬nh Traefik lÃ m Proxy Server Cáº¥u hÃ¬nh Traefik Ä‘á»ƒ lÃ m proxy server vá»›i file cáº¥u hÃ¬nh YAML sau:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 http: serversTransports: portainer-transport: insecureSkipVerify: true routers: portainer-local-router: rule: \u0026#34;Host(`portainer.lh`)\u0026#34; # Thay tháº¿ báº±ng domain hoáº·c quy táº¯c routing cá»§a báº¡n service: portainer-local middlewares: - portainerApiKeyHeaders middlewares: portainerApiKeyHeaders: headers: customRequestHeaders: X-API-Key: \u0026lt;\u0026lt;access token\u0026gt;\u0026gt; # Thay tháº¿ báº±ng access token cá»§a báº¡n services: portainer-local: loadBalancer: servers: - url: \u0026lt;\u0026lt;address portainer\u0026gt;\u0026gt; # Thay tháº¿ báº±ng Ä‘á»‹a chá»‰ IP cá»§a Portainer serversTransport: portainer-transport Sau Ä‘Ã³, Ã¡nh xáº¡ domain giáº£ portainer.lh vá» Ä‘á»‹a chá»‰ IP local.\n3. Táº¡o JWT Token dÃ i háº¡n VÃ­ dá»¥ vá» má»™t JWT token dÃ i háº¡n:\n1 2 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidXNlcm5hbWUiOiJhZG1pbiIsInJvbGUiOjEsInNjb3BlIjoiZGVmYXVsdCIsImZvcmNlQ2hhbmdlUGFzc3dvcmQiOmZhbHNlLCJleHAiOjM4MDYxNTA3OTIsImlhdCI6MTcyMzM5MjA3N30.49qEbdGLK39PgplVPUwsiDud_vgP1wyP19lAYic19Gs Set key portainer.JWT vÃ  giÃ¡ trá»‹ trÃªn vÃ o localStorage cá»§a trang portainer.lh:8089, trong Ä‘Ã³:\n8089 lÃ  cá»•ng HTTP entry cá»§a Traefik. CÃ³ thá»ƒ sá»­ dá»¥ng script sau Ä‘á»ƒ thiáº¿t láº­p token:\n1 2 3 4 5 6 7 8 9 10 // Define your JWT token const jwtToken = \u0026#39;\u0026#34;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwidXNlcm5hbWUiOiJhZG1pbiIsInJvbGUiOjEsInNjb3BlIjoiZGVmYXVsdCIsImZvcmNlQ2hhbmdlUGFzc3dvcmQiOmZhbHNlLCJleHAiOjM4MDYxNTA3OTIsImlhdCI6MTcyMzM5MjA3N30.49qEbdGLK39PgplVPUwsiDud_vgP1wyP19lAYic19Gs\u0026#34;\u0026#39;; // Store the token in localStorage localStorage.setItem(\u0026#39;portainer.JWT\u0026#39;, jwtToken); // Verify by retrieving it const storedToken = localStorage.getItem(\u0026#39;portainer.JWT\u0026#39;); console.log(storedToken); // Should output the JWT token Káº¿t luáº­n Viá»‡c cáº¥u hÃ¬nh Traefik lÃ m proxy server vÃ  sá»­ dá»¥ng JWT token dÃ i háº¡n giÃºp Ä‘Æ¡n giáº£n hÃ³a viá»‡c truy cáº­p vÃ o Portainer trong mÃ´i trÆ°á»ng local mÃ  khÃ´ng cáº§n pháº£i Ä‘Äƒng nháº­p liÃªn tá»¥c. HÃ£y Ä‘áº£m báº£o ráº±ng báº¡n Ä‘Ã£ cáº¥u hÃ¬nh chÃ­nh xÃ¡c vÃ  kiá»ƒm tra token Ä‘á»ƒ Ä‘áº£m báº£o sá»± hoáº¡t Ä‘á»™ng trÆ¡n tru.\nTÃ i liá»‡u Traefik Routing Documentation ","date":"2024-08-12T01:17:00+08:00","permalink":"https://phongthien99.github.io/posts/bypass-login-portainer/","title":"Bypass login Portainer"},{"content":"Building an HTTP Server for Multi-Platform Data Storage Introduction In the deployment of Video On Demand (VOD) services, transcoding and storing video require a flexible and efficient system. To address this issue, we can build an HTTP server to manage the writing and retrieving of data from FFmpeg to various storage platforms such as S3, FTP, OS, and HTTP.\nSolution We will design an HTTP server with two main endpoints:\nPUT /origin/{config}/{filepath} Receive data from FFmpeg and save it to the configured storage platform. config is encoded in base64, decoded to determine the storage platform, and then save the data accordingly (S3, FTP, OS, HTTP). The request can store data on multiple platforms simultaneously. GET /origin/{config}/{filepath} Retrieve data from the configured storage platforms based on config. Configure FFmpeg to use the HTTP server for testing:\n1 2 3 4 5 6 7 8 9 10 11 ffmpeg -i video.mp4 \\ -c:a aac \\ -c:v h264 \\ -f hls \\ -force_key_frames expr:gte(t,n_forced*2) \\ -hls_base_url /origin/BASE64_ENCODED_CONFIG/segments/ \\ -hls_playlist_type vod \\ -hls_segment_filename http://localhost:8086/origin/BASE64_ENCODED_CONFIG/segments/segment_%03d.ts \\ -hls_time 2 \\ -vf scale=1280:-1 \\ http://localhost:8086/origin/BASE64_ENCODED_CONFIG/manifest/master.m3u8 -y Conclusion Building an HTTP server with the structure /origin/:config/:filePath helps manage and retrieve data efficiently and simplifies the storage process in a VOD system. This approach minimizes the complexity in data transmission and configuration handling, meeting the needs of a modern VOD system effectively.\n","date":"2024-06-24T00:40:00+08:00","permalink":"https://phongthien99.github.io/posts/building-an-http-server-for-multi-platform-data-storage/","title":"Building an HTTP Server for Multi-Platform Data Storage"},{"content":"Builder pattern Intent BuilderÂ is a creational design pattern that lets you construct complex objects step by step. The pattern allows you to produce different types and representations of an object using the same constructionÂ code Problem When an object has too many properties or optional properties, creating a constructor with all the parameters or using multiple constructors can become complex and difficult to maintain.. Solution The Builder pattern suggests that you extract the object construction code out of its own class and move it to separate objects calledÂ builders.\nDirector: Responsible for building an object using Builder. Builder: Interface or abstract class defines the steps necessary to construct an object. ConcreteBuilder: Concretizes the Builder, implements specific steps to build the object and provides a method to retrieve the final object. Product: Represents the built object. Example 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 package main import \u0026#34;log\u0026#34; // Product type User struct { Name string Age int } // ConcreteBuilder type UserBuilder struct { Name string Age int } // Director type IDiretor[T any] interface { Builder() T } // Builder type IUserBuilder interface { SetName(name string) IUserBuilder SetAge(age int) IUserBuilder IDiretor[*User] } func (u *UserBuilder) SetName(name string) IUserBuilder { u.Name = name return u } func (u *UserBuilder) SetAge(age int) IUserBuilder { u.Age = age return u } func (u *UserBuilder) Builder() *User { return \u0026amp;User{ Name: u.Name, Age: u.Age, } } func NewUserBuilder() IUserBuilder { return \u0026amp;UserBuilder{} } func main() { user := NewUserBuilder().SetName(\u0026#34;test\u0026#34;).SetAge(12).Builder() log.Print(user) } Pros and Cons âœ… You can construct objects step-by-step, defer construction steps or run steps recursively.\nâœ… You can reuse the same construction code when building various representations of products.\nâœ… Single Responsibility Principle. You can isolate complex construction code from the business logic of the product.\nâŒ The overall complexity of the code increases since the pattern requires creating multiple new classes.\nConclusion Although the Option Pattern offers many benefits in terms of flexibility and readability, it also requires careful consideration when used, especially for cases with a large number of options.\n","date":"2024-05-04T00:40:00+08:00","permalink":"https://phongthien99.github.io/posts/builder-pattern/","title":"Builder Pattern"},{"content":"Options Pattern Intent helps solve the problem when a function or constructor has too many parameters, making calling the function or constructor complicated and confusing. instead of passing a series of parameters, we create an object containing optional parameters (options object), from which we can set the values for those parameters dynamically. Problem calling a function or constructor with too many parameters can result in code that is difficult to read, verbose, and confusing. additionally, when we need to change parameters, we must modify each function or constructor call. Solution Step 1: create an object containing options parameters (options object). Step 2: define methods in the options object to set the values for those parameters Step 3: When calling a function or constructor, instead of passing a series of parameters, we pass in the options object that was previously set. Step 4: In the function or constructor, we use the value set in the options object to perform the necessary tasks. Step 5: When calling a function or constructor, instead of passing a series of parameters, we pass in the options object that was previously set. Example 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 package main // step 1 create an object containing options parameters (options object). type Config struct { URL string DocExpansion string } // Step 2: define methods in the options object to set the values for those parameters func URL(url string) func(*Config) { return func(c *Config) { c.URL = url } } func DocExpansion(docExpansion string) func(*Config) { return func(c *Config) { c.DocExpansion = docExpansion } } // Step 3: When calling a function or constructor, instead of passing a series of parameters, we pass in the options object that was previously set. func newConfig(configFns ...func(*Config)) *Config { config := Config{ } // Step 4: In the function or constructor, we use the value set in the options object to perform the necessary tasks. for _, fn := range configFns { fn(\u0026amp;config) } return \u0026amp;config } // Step 5: When calling a function or constructor, instead of passing a series of parameters, we pass in the options object that was previously set. func main() { r := newConfig(URL(\u0026#34;http://test.com\u0026#34;),DocExpansion(\u0026#34;test\u0026#34;)) } Pros and Cons Pros Cons Flexible and extensible: Option Pattern allows adding or changing optional parameters without changing the structure of the function or constructor. This makes the code more extensible and flexible. Complexity with large number of options: When there are too many options, managing and using the Option Pattern can become complicated. This can lead to defining too many constructors and optional setters, making the code complex and confusing. Ease of reading and maintenance: When using the Option Pattern, function or constructor calls become more concise and easier to read. Instead of having a bunch of parameters, we just need to pass an options object, making the code easy to maintain. Unclear with required options: If there are parameters that are optional but necessary for use, using the Option Pattern can make the code unclear. In this case, using the Option Pattern may not be appropriate and one should consider other methods such as using default parameters or structured data types. Minimize errors: Option Pattern helps reduce the number of errors caused by confusion about the order or data type of parameters. Instead of having to remember the order or data type of each parameter, we just need to set the values for the fields in the options object. Conclusion Although the Option Pattern offers many benefits in terms of flexibility and readability, it also requires careful consideration when used, especially for cases with a large number of options.\n","date":"2024-05-03T00:40:00+08:00","permalink":"https://phongthien99.github.io/posts/options-pattern/","title":"Options Pattern"},{"content":"AWS DEA 1. Data Engineering Fundamentals Structured Data\nDefinition Data that is organized in a defined manner or schema, typically found in relational databases Unstructured Data\napiVersion: PhiÃªn báº£n API.\nkind: Loáº¡i tÃ i nguyÃªn (Pod).\nmetadata: ThÃ´ng tin (tÃªn, nhÃ£n).\nspec:\nContainers Ports Volumes Kiá»ƒu Pod\nSingle-container Pod: Cháº¡y 1 container chÃ­nh. Multi-container Pod: MÃ´ hÃ¬nh: Sidecar, Ambassador, Adapter, init container Chia sáº» IP, Volume. ğŸš€ VÃ²ng Ä‘á»i Pod Pending: Äang chá» tÃ i nguyÃªn. Running: Container Ä‘ang hoáº¡t Ä‘á»™ng. Succeeded: HoÃ n táº¥t thÃ nh cÃ´ng. Failed: Container gáº·p lá»—i. CrashLoopBackOff: LiÃªn tá»¥c khá»Ÿi Ä‘á»™ng láº¡i do lá»—i. ğŸ” Quáº£n lÃ½ vá»›i kubectl Táº¡o Pod: kubectl apply -f pod.yaml Xem Pod: kubectl get pods Chi tiáº¿t Pod: kubectl describe pod \u0026lt;name\u0026gt; Xem log: kubectl logs \u0026lt;pod\u0026gt; -c \u0026lt;container\u0026gt; Truy cáº­p Pod: kubectl exec -it \u0026lt;pod\u0026gt; -- /bin/bash ğŸ—‚ï¸ Pod vÃ  TÃ­nh Há»“i Phá»¥c Pod KHÃ”NG tá»± há»“i phá»¥c khi lá»—i. Sá»­ dá»¥ng Controller Ä‘á»ƒ quáº£n lÃ½: Deployment (Stateless) StatefulSet (Stateful) DaemonSet (Cháº¡y trÃªn má»i node) âš¡ Æ¯u - NhÆ°á»£c Ä‘iá»ƒm âœ… ÄÆ¡n giáº£n, dá»… triá»ƒn khai. âœ… Hiá»‡u quáº£ khi chia sáº» tÃ i nguyÃªn. âŒ KhÃ´ng tá»± phá»¥c há»“i khi lá»—i. âŒ KhÃ´ng tá»‘i Æ°u cho á»©ng dá»¥ng lá»›n. ReplicaSet: Äáº£m báº£o sá»‘ Pod mong muá»‘n.\nDeployment: Quáº£n lÃ½ ReplicaSet, há»— trá»£ rolling updates.\nStatefulSet: Quáº£n lÃ½ á»©ng dá»¥ng cÃ³ tráº¡ng thÃ¡i.\nDaemonSet: Cháº¡y Pod trÃªn táº¥t cáº£ cÃ¡c node.\nJob: Thá»±c thi tÃ¡c vá»¥ má»™t láº§n rá»“i dá»«ng.\nCronJob: Cháº¡y tÃ¡c vá»¥ Ä‘á»‹nh ká»³.\n2. Networking Resources Service: Expose Pod (ClusterIP, NodePort, LoadBalancer). Ingress: Quáº£n lÃ½ HTTP/HTTPS traffic. NetworkPolicy: Kiá»ƒm soÃ¡t lÆ°u lÆ°á»£ng máº¡ng giá»¯a cÃ¡c Pod. 3. Storage Resources PersistentVolume (PV): Äá»‹nh nghÄ©a lÆ°u trá»¯ váº­t lÃ½. PersistentVolumeClaim (PVC): YÃªu cáº§u sá»­ dá»¥ng PV. StorageClass: Dynamic provisioning cho lÆ°u trá»¯. Volume: Gáº¯n vÃ o Pod Ä‘á»ƒ chia sáº» dá»¯ liá»‡u. 4. Configuration \u0026amp; Secret Management ConfigMap: LÆ°u cáº¥u hÃ¬nh dáº¡ng key-value. Secret: LÆ°u dá»¯ liá»‡u nháº¡y cáº£m (token, máº­t kháº©u). ResourceQuota: Giá»›i háº¡n tÃ i nguyÃªn theo namespace. LimitRange: Äáº·t giá»›i háº¡n CPU, RAM cho Pod. 5. Cluster Resources Namespace: PhÃ¢n chia tÃ i nguyÃªn logic. Node: MÃ¡y chá»§ váº­t lÃ½/áº£o trong cluster. Role/RoleBinding: Quáº£n lÃ½ quyá»n trong namespace. ClusterRole/ClusterRoleBinding: Quáº£n lÃ½ quyá»n toÃ n cá»¥m. ServiceAccount: Cáº¥p quyá»n cho Pod truy cáº­p API. 6. Custom Resources CustomResourceDefinition (CRD): Äá»‹nh nghÄ©a tÃ i nguyÃªn tÃ¹y chá»‰nh. Operator: Tá»± Ä‘á»™ng hÃ³a quáº£n lÃ½ á»©ng dá»¥ng phá»©c táº¡p. ","date":"0001-01-01T00:00:00Z","permalink":"https://phongthien99.github.io/posts/","title":""},{"content":"Kubernetes Resources 1. Workload Resources Pod Äá»‹nh nghÄ©a\nÄÆ¡n vá»‹ nhá» nháº¥t trong Kubernetes. Chá»©a má»™t hoáº·c nhiá»u container. Chia sáº»: Network, Storage, Namespace. Cáº¥u trÃºc Pod\napiVersion: PhiÃªn báº£n API. kind: Loáº¡i tÃ i nguyÃªn (Pod). metadata: ThÃ´ng tin (tÃªn, nhÃ£n). spec: Containers Ports Volumes Kiá»ƒu Pod\nSingle-container Pod: Cháº¡y 1 container chÃ­nh. Multi-container Pod: MÃ´ hÃ¬nh: Sidecar, Ambassador, Adapter, init container Chia sáº» IP, Volume. ğŸš€ VÃ²ng Ä‘á»i Pod Pending: Äang chá» tÃ i nguyÃªn. Running: Container Ä‘ang hoáº¡t Ä‘á»™ng. Succeeded: HoÃ n táº¥t thÃ nh cÃ´ng. Failed: Container gáº·p lá»—i. CrashLoopBackOff: LiÃªn tá»¥c khá»Ÿi Ä‘á»™ng láº¡i do lá»—i. ğŸ” Quáº£n lÃ½ vá»›i kubectl Táº¡o Pod: kubectl apply -f pod.yaml Xem Pod: kubectl get pods Chi tiáº¿t Pod: kubectl describe pod \u0026lt;name\u0026gt; Xem log: kubectl logs \u0026lt;pod\u0026gt; -c \u0026lt;container\u0026gt; Truy cáº­p Pod: kubectl exec -it \u0026lt;pod\u0026gt; -- /bin/bash ğŸ—‚ï¸ Pod vÃ  TÃ­nh Há»“i Phá»¥c Pod KHÃ”NG tá»± há»“i phá»¥c khi lá»—i. Sá»­ dá»¥ng Controller Ä‘á»ƒ quáº£n lÃ½: Deployment (Stateless) StatefulSet (Stateful) DaemonSet (Cháº¡y trÃªn má»i node) âš¡ Æ¯u - NhÆ°á»£c Ä‘iá»ƒm âœ… ÄÆ¡n giáº£n, dá»… triá»ƒn khai. âœ… Hiá»‡u quáº£ khi chia sáº» tÃ i nguyÃªn. âŒ KhÃ´ng tá»± phá»¥c há»“i khi lá»—i. âŒ KhÃ´ng tá»‘i Æ°u cho á»©ng dá»¥ng lá»›n. ReplicaSet: Äáº£m báº£o sá»‘ Pod mong muá»‘n. Deployment: Quáº£n lÃ½ ReplicaSet, há»— trá»£ rolling updates. StatefulSet: Quáº£n lÃ½ á»©ng dá»¥ng cÃ³ tráº¡ng thÃ¡i. DaemonSet: Cháº¡y Pod trÃªn táº¥t cáº£ cÃ¡c node. Job: Thá»±c thi tÃ¡c vá»¥ má»™t láº§n rá»“i dá»«ng. CronJob: Cháº¡y tÃ¡c vá»¥ Ä‘á»‹nh ká»³. 2. Networking Resources Service: Expose Pod (ClusterIP, NodePort, LoadBalancer). Ingress: Quáº£n lÃ½ HTTP/HTTPS traffic. NetworkPolicy: Kiá»ƒm soÃ¡t lÆ°u lÆ°á»£ng máº¡ng giá»¯a cÃ¡c Pod. 3. Storage Resources PersistentVolume (PV): Äá»‹nh nghÄ©a lÆ°u trá»¯ váº­t lÃ½. PersistentVolumeClaim (PVC): YÃªu cáº§u sá»­ dá»¥ng PV. StorageClass: Dynamic provisioning cho lÆ°u trá»¯. Volume: Gáº¯n vÃ o Pod Ä‘á»ƒ chia sáº» dá»¯ liá»‡u. 4. Configuration \u0026amp; Secret Management ConfigMap: LÆ°u cáº¥u hÃ¬nh dáº¡ng key-value. Secret: LÆ°u dá»¯ liá»‡u nháº¡y cáº£m (token, máº­t kháº©u). ResourceQuota: Giá»›i háº¡n tÃ i nguyÃªn theo namespace. LimitRange: Äáº·t giá»›i háº¡n CPU, RAM cho Pod. 5. Cluster Resources Namespace: PhÃ¢n chia tÃ i nguyÃªn logic. Node: MÃ¡y chá»§ váº­t lÃ½/áº£o trong cluster. Role/RoleBinding: Quáº£n lÃ½ quyá»n trong namespace. ClusterRole/ClusterRoleBinding: Quáº£n lÃ½ quyá»n toÃ n cá»¥m. ServiceAccount: Cáº¥p quyá»n cho Pod truy cáº­p API. 6. Custom Resources CustomResourceDefinition (CRD): Äá»‹nh nghÄ©a tÃ i nguyÃªn tÃ¹y chá»‰nh. Operator: Tá»± Ä‘á»™ng hÃ³a quáº£n lÃ½ á»©ng dá»¥ng phá»©c táº¡p. ","date":"0001-01-01T00:00:00Z","permalink":"https://phongthien99.github.io/posts/","title":""}]